(self.webpackChunkchruch_project=self.webpackChunkchruch_project||[]).push([[792],{84:(wv,df,hf)=>{"use strict";function Yi(e){return"function"==typeof e}function n_(e){const n=e(s=>{Error.call(s),s.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const Ev=n_(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((s,u)=>`${u+1}) ${s.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function d(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class tr{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const _ of n)_.remove(this);else n.remove(this);const{initialTeardown:s}=this;if(Yi(s))try{s()}catch(_){t=_ instanceof Ev?_.errors:[_]}const{_finalizers:u}=this;if(u){this._finalizers=null;for(const _ of u)try{Nd(_)}catch(w){t=t??[],w instanceof Ev?t=[...t,...w.errors]:t.push(w)}}if(t)throw new Ev(t)}}add(t){var n;if(t&&t!==this)if(this.closed)Nd(t);else{if(t instanceof tr){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&d(n,t)}remove(t){const{_finalizers:n}=this;n&&d(n,t),t instanceof tr&&t._removeParent(this)}}tr.EMPTY=(()=>{const e=new tr;return e.closed=!0,e})();const Ui=tr.EMPTY;function Da(e){return e instanceof tr||e&&"closed"in e&&Yi(e.remove)&&Yi(e.add)&&Yi(e.unsubscribe)}function Nd(e){Yi(e)?e():e.unsubscribe()}const ks={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Fs={setTimeout(e,t,...n){const{delegate:s}=Fs;return s?.setTimeout?s.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=Fs;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function Nl(e){Fs.setTimeout(()=>{const{onUnhandledError:t}=ks;if(!t)throw e;t(e)})}function pn(){}const ts=ro("C",void 0,void 0);function ro(e,t,n){return{kind:e,value:t,error:n}}let vs=null;function Zs(e){if(ks.useDeprecatedSynchronousErrorHandling){const t=!vs;if(t&&(vs={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:s}=vs;if(vs=null,n)throw s}}else e()}class Bl extends tr{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Da(t)&&t.add(this)):this.destination=_r}static create(t,n,s){return new Un(t,n,s)}next(t){this.isStopped?gr(function Uo(e){return ro("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?gr(function Hi(e){return ro("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?gr(ts,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const da=Function.prototype.bind;function Ia(e,t){return da.call(e,t)}class ff{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(s){Wa(s)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(s){Wa(s)}else Wa(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){Wa(n)}}}class Un extends Bl{constructor(t,n,s){let u;if(super(),Yi(t)||!t)u={next:t??void 0,error:n??void 0,complete:s??void 0};else{let _;this&&ks.useDeprecatedNextContext?(_=Object.create(t),_.unsubscribe=()=>this.unsubscribe(),u={next:t.next&&Ia(t.next,_),error:t.error&&Ia(t.error,_),complete:t.complete&&Ia(t.complete,_)}):u=t}this.destination=new ff(u)}}function Wa(e){ks.useDeprecatedSynchronousErrorHandling?function zl(e){ks.useDeprecatedSynchronousErrorHandling&&vs&&(vs.errorThrown=!0,vs.error=e)}(e):Nl(e)}function gr(e,t){const{onStoppedNotification:n}=ks;n&&Fs.setTimeout(()=>n(e,t))}const _r={closed:!0,next:pn,error:function go(e){throw e},complete:pn},ki="function"==typeof Symbol&&Symbol.observable||"@@observable";function oo(e){return e}let Vi=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const s=new e;return s.source=this,s.operator=n,s}subscribe(n,s,u){const _=function Iu(e){return e&&e instanceof Bl||function Ho(e){return e&&Yi(e.next)&&Yi(e.error)&&Yi(e.complete)}(e)&&Da(e)}(n)?n:new Un(n,s,u);return Zs(()=>{const{operator:w,source:S}=this;_.add(w?w.call(_,S):S?this._subscribe(_):this._trySubscribe(_))}),_}_trySubscribe(n){try{return this._subscribe(n)}catch(s){n.error(s)}}forEach(n,s){return new(s=Fi(s))((u,_)=>{const w=new Un({next:S=>{try{n(S)}catch(P){_(P),w.unsubscribe()}},error:_,complete:u});this.subscribe(w)})}_subscribe(n){var s;return null===(s=this.source)||void 0===s?void 0:s.subscribe(n)}[ki](){return this}pipe(...n){return function Aa(e){return 0===e.length?oo:1===e.length?e[0]:function(n){return e.reduce((s,u)=>u(s),n)}}(n)(this)}toPromise(n){return new(n=Fi(n))((s,u)=>{let _;this.subscribe(w=>_=w,w=>u(w),()=>s(_))})}}return e.create=t=>new e(t),e})();function Fi(e){var t;return null!==(t=e??ks.Promise)&&void 0!==t?t:Promise}const mf=n_(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Gi=(()=>{class e extends Vi{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const s=new Mi(this,this);return s.operator=n,s}_throwIfClosed(){if(this.closed)throw new mf}next(n){Zs(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const s of this.currentObservers)s.next(n)}})}error(n){Zs(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:s}=this;for(;s.length;)s.shift().error(n)}})}complete(){Zs(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:s,isStopped:u,observers:_}=this;return s||u?Ui:(this.currentObservers=null,_.push(n),new tr(()=>{this.currentObservers=null,d(_,n)}))}_checkFinalizedStatuses(n){const{hasError:s,thrownError:u,isStopped:_}=this;s?n.error(u):_&&n.complete()}asObservable(){const n=new Vi;return n.source=this,n}}return e.create=(t,n)=>new Mi(t,n),e})();class Mi extends Gi{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,s;null===(s=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===s||s.call(n,t)}error(t){var n,s;null===(s=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===s||s.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,s;return null!==(s=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==s?s:Ui}}function gi(e){return t=>{if(function ar(e){return Yi(e?.lift)}(t))return t.lift(function(n){try{return e(n,this)}catch(s){this.error(s)}});throw new TypeError("Unable to lift unknown Observable type")}}function nr(e,t,n,s,u){return new lr(e,t,n,s,u)}class lr extends Bl{constructor(t,n,s,u,_,w){super(t),this.onFinalize=_,this.shouldUnsubscribe=w,this._next=n?function(S){try{n(S)}catch(P){t.error(P)}}:super._next,this._error=u?function(S){try{u(S)}catch(P){t.error(P)}finally{this.unsubscribe()}}:super._error,this._complete=s?function(){try{s()}catch(S){t.error(S)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Mo(e,t){return gi((n,s)=>{let u=0;n.subscribe(nr(s,_=>{s.next(e.call(t,_,u++))}))})}function Zr(e){return this instanceof Zr?(this.v=e,this):new Zr(e)}function Qa(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function rs(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],s=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n);function s(_){n[_]=e[_]&&function(w){return new Promise(function(S,P){!function u(_,w,S,P){Promise.resolve(P).then(function(z){_({value:z,done:S})},w)}(S,P,(w=e[_](w)).done,w.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Rn=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Pe(e){return Yi(e?.then)}function Z(e){return Yi(e[ki])}function X(e){return Symbol.asyncIterator&&Yi(e?.[Symbol.asyncIterator])}function oe(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const se=function ge(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function we(e){return Yi(e?.[se])}function Fe(e){return function Ka(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,s=n.apply(e,t||[]),_=[];return u=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),S("next"),S("throw"),S("return",function w(xe){return function(Oe){return Promise.resolve(Oe).then(xe,Y)}}),u[Symbol.asyncIterator]=function(){return this},u;function S(xe,Oe){s[xe]&&(u[xe]=function(ze){return new Promise(function(lt,Ct){_.push([xe,ze,lt,Ct])>1||P(xe,ze)})},Oe&&(u[xe]=Oe(u[xe])))}function P(xe,Oe){try{!function z(xe){xe.value instanceof Zr?Promise.resolve(xe.value.v).then(G,Y):ye(_[0][2],xe)}(s[xe](Oe))}catch(ze){ye(_[0][3],ze)}}function G(xe){P("next",xe)}function Y(xe){P("throw",xe)}function ye(xe,Oe){xe(Oe),_.shift(),_.length&&P(_[0][0],_[0][1])}}(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:s,done:u}=yield Zr(n.read());if(u)return yield Zr(void 0);yield yield Zr(s)}}finally{n.releaseLock()}})}function Te(e){return Yi(e?.getReader)}function Ie(e){if(e instanceof Vi)return e;if(null!=e){if(Z(e))return function st(e){return new Vi(t=>{const n=e[ki]();if(Yi(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Rn(e))return function qe(e){return new Vi(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(Pe(e))return function Lt(e){return new Vi(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,Nl)})}(e);if(X(e))return Yt(e);if(we(e))return function Wt(e){return new Vi(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Te(e))return function bn(e){return Yt(Fe(e))}(e)}throw oe(e)}function Yt(e){return new Vi(t=>{(function mn(e,t){var n,s,u,_;return function Pa(e,t,n,s){return new(n||(n=Promise))(function(_,w){function S(G){try{z(s.next(G))}catch(Y){w(Y)}}function P(G){try{z(s.throw(G))}catch(Y){w(Y)}}function z(G){G.done?_(G.value):function u(_){return _ instanceof n?_:new n(function(w){w(_)})}(G.value).then(S,P)}z((s=s.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Qa(e);!(s=yield n.next()).done;)if(t.next(s.value),t.closed)return}catch(w){u={error:w}}finally{try{s&&!s.done&&(_=n.return)&&(yield _.call(n))}finally{if(u)throw u.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function un(e,t,n,s=0,u=!1){const _=t.schedule(function(){n(),u?e.add(this.schedule(null,s)):this.unsubscribe()},s);if(e.add(_),!u)return _}function _n(e,t,n=1/0){return Yi(t)?_n((s,u)=>Mo((_,w)=>t(s,_,u,w))(Ie(e(s,u))),n):("number"==typeof t&&(n=t),gi((s,u)=>function _i(e,t,n,s,u,_,w,S){const P=[];let z=0,G=0,Y=!1;const ye=()=>{Y&&!P.length&&!z&&t.complete()},xe=ze=>z<s?Oe(ze):P.push(ze),Oe=ze=>{_&&t.next(ze),z++;let lt=!1;Ie(n(ze,G++)).subscribe(nr(t,Ct=>{u?.(Ct),_?xe(Ct):t.next(Ct)},()=>{lt=!0},void 0,()=>{if(lt)try{for(z--;P.length&&z<s;){const Ct=P.shift();w?un(t,w,()=>Oe(Ct)):Oe(Ct)}ye()}catch(Ct){t.error(Ct)}}))};return e.subscribe(nr(t,xe,()=>{Y=!0,ye()})),()=>{S?.()}}(s,u,e,n)))}function ir(e=1/0){return _n(oo,e)}const Ir=new Vi(e=>e.complete());function Vn(e){return e&&Yi(e.schedule)}function $i(e){return e[e.length-1]}function Si(e){return Vn($i(e))?e.pop():void 0}function Go(e,t=0){return gi((n,s)=>{n.subscribe(nr(s,u=>un(s,e,()=>s.next(u),t),()=>un(s,e,()=>s.complete(),t),u=>un(s,e,()=>s.error(u),t)))})}function _o(e,t=0){return gi((n,s)=>{s.add(e.schedule(()=>n.subscribe(s),t))})}function Ou(e,t){if(!e)throw new Error("Iterable cannot be null");return new Vi(n=>{un(n,t,()=>{const s=e[Symbol.asyncIterator]();un(n,t,()=>{s.next().then(u=>{u.done?n.complete():n.next(u.value)})},0,!0)})})}function Ra(e,t){return t?function yf(e,t){if(null!=e){if(Z(e))return function Hd(e,t){return Ie(e).pipe(_o(t),Go(t))}(e,t);if(Rn(e))return function Hl(e,t){return new Vi(n=>{let s=0;return t.schedule(function(){s===e.length?n.complete():(n.next(e[s++]),n.closed||this.schedule())})})}(e,t);if(Pe(e))return function so(e,t){return Ie(e).pipe(_o(t),Go(t))}(e,t);if(X(e))return Ou(e,t);if(we(e))return function _f(e,t){return new Vi(n=>{let s;return un(n,t,()=>{s=e[se](),un(n,t,()=>{let u,_;try{({value:u,done:_}=s.next())}catch(w){return void n.error(w)}_?n.complete():n.next(u)},0,!0)}),()=>Yi(s?.return)&&s.return()})}(e,t);if(Te(e))return function Gd(e,t){return Ou(Fe(e),t)}(e,t)}throw oe(e)}(e,t):Ie(e)}function tl(...e){const t=Si(e),n=function Xr(e,t){return"number"==typeof $i(e)?e.pop():t}(e,1/0),s=e;return s.length?1===s.length?Ie(s[0]):ir(n)(Ra(s,t)):Ir}class ku extends Gi{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:s}=this;if(t)throw n;return this._throwIfClosed(),s}next(t){super.next(this._value=t)}}function nl(...e){return Ra(e,Si(e))}function Xs(e={}){const{connector:t=(()=>new Gi),resetOnError:n=!0,resetOnComplete:s=!0,resetOnRefCountZero:u=!0}=e;return _=>{let w,S,P,z=0,G=!1,Y=!1;const ye=()=>{S?.unsubscribe(),S=void 0},xe=()=>{ye(),w=P=void 0,G=Y=!1},Oe=()=>{const ze=w;xe(),ze?.unsubscribe()};return gi((ze,lt)=>{z++,!Y&&!G&&ye();const Ct=P=P??t();lt.add(()=>{z--,0===z&&!Y&&!G&&(S=os(Oe,u))}),Ct.subscribe(lt),!w&&z>0&&(w=new Un({next:ut=>Ct.next(ut),error:ut=>{Y=!0,ye(),S=os(xe,n,ut),Ct.error(ut)},complete:()=>{G=!0,ye(),S=os(xe,s),Ct.complete()}}),Ie(ze).subscribe(w))})(_)}}function os(e,t,...n){if(!0===t)return void e();if(!1===t)return;const s=new Un({next:()=>{s.unsubscribe(),e()}});return Ie(t(...n)).subscribe(s)}function zs(e,t){return gi((n,s)=>{let u=null,_=0,w=!1;const S=()=>w&&!u&&s.complete();n.subscribe(nr(s,P=>{u?.unsubscribe();let z=0;const G=_++;Ie(e(P,G)).subscribe(u=nr(s,Y=>s.next(t?t(P,Y,G,z++):Y),()=>{u=null,S()}))},()=>{w=!0,S()}))})}function Oa(e,t=oo){return e=e??ha,gi((n,s)=>{let u,_=!0;n.subscribe(nr(s,w=>{const S=t(w);(_||!e(u,S))&&(_=!1,u=S,s.next(w))}))})}function ha(e,t){return e===t}function Di(e){for(let t in e)if(e[t]===Di)return t;throw Error("Could not find renamed property on target object.")}function Gl(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function ur(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(ur).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Sc(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Dc=Di({__forward_ref__:Di});function Ki(e){return e.__forward_ref__=Ki,e.toString=function(){return ur(this())},e}function Nn(e){return function $d(e){return"function"==typeof e&&e.hasOwnProperty(Dc)&&e.__forward_ref__===Ki}(e)?e():e}function Ro(e){return e&&!!e.\u0275providers}class bt extends Error{constructor(t,n){super(function qd(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function Wn(e){return"string"==typeof e?e:null==e?"":String(e)}function Ic(e,t){throw new bt(-201,!1)}function Yr(e,t){null==e&&function yn(e,t,n,s){throw new Error(`ASSERTION ERROR: ${e}`+(null==s?"":` [Expected=> ${n} ${s} ${t} <=Actual]`))}(t,e,null,"!=")}function Kt(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Tr(e){return{providers:e.providers||[],imports:e.imports||[]}}function Bu(e){return Vu(e,Nt)||Vu(e,Uu)}function Vu(e,t){return e.hasOwnProperty(t)?e[t]:null}function Yd(e){return e&&(e.hasOwnProperty(xf)||e.hasOwnProperty(Rc))?e[xf]:null}const Nt=Di({\u0275prov:Di}),xf=Di({\u0275inj:Di}),Uu=Di({ngInjectableDef:Di}),Rc=Di({ngInjectorDef:Di});var Hn=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Hn||{});let Kd;function St(e){const t=Kd;return Kd=e,t}function Gn(e,t,n){const s=Bu(e);return s&&"root"==s.providedIn?void 0===s.value?s.value=s.factory():s.value:n&Hn.Optional?null:void 0!==t?t:void Ic(ur(e))}const yi=globalThis;class Ht{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=Kt({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Kr={},pa="__NG_DI_FLAG__",vo="ngTempTokenPath",ln=/\n/gm,Vs="__source";let Vt;function Ys(e){const t=Vt;return Vt=e,t}function Bt(e,t=Hn.Default){if(void 0===Vt)throw new bt(-203,!1);return null===Vt?Gn(e,void 0,t):Vt.get(e,t&Hn.Optional?null:void 0,t)}function gt(e,t=Hn.Default){return(function Oc(){return Kd}()||Bt)(Nn(e),t)}function $n(e,t=Hn.Default){return gt(e,Jd(t))}function Jd(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function ws(e){const t=[];for(let n=0;n<e.length;n++){const s=Nn(e[n]);if(Array.isArray(s)){if(0===s.length)throw new bt(900,!1);let u,_=Hn.Default;for(let w=0;w<s.length;w++){const S=s[w],P=Qd(S);"number"==typeof P?-1===P?u=S.token:_|=P:u=S}t.push(gt(u,_))}else t.push(gt(s))}return t}function Qd(e){return e[pa]}function xo(e){return{toString:e}.toString()}var eo=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(eo||{}),$o=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}($o||{});const ka={},qi=[],ma=Di({\u0275cmp:Di}),Wl=Di({\u0275dir:Di}),il=Di({\u0275pipe:Di}),Bc=Di({\u0275mod:Di}),Fa=Di({\u0275fac:Di}),Zl=Di({__NG_ELEMENT_ID__:Di}),Ef=Di({__NG_ENV_ID__:Di});function rl(e,t,n){let s=e.length;for(;;){const u=e.indexOf(t,n);if(-1===u)return u;if(0===u||e.charCodeAt(u-1)<=32){const _=t.length;if(u+_===s||e.charCodeAt(u+_)<=32)return u}n=u+1}}function nm(e,t,n){let s=0;for(;s<n.length;){const u=n[s];if("number"==typeof u){if(0!==u)break;s++;const _=n[s++],w=n[s++],S=n[s++];e.setAttribute(t,w,S,_)}else{const _=u,w=n[++s];s_(_)?e.setProperty(t,_,w):e.setAttribute(t,_,w),s++}}return s}function im(e){return 3===e||4===e||6===e}function s_(e){return 64===e.charCodeAt(0)}function Hu(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let s=0;s<t.length;s++){const u=t[s];"number"==typeof u?n=u:0===n||rm(e,n,u,null,-1===n||2===n?t[++s]:null)}}return e}function rm(e,t,n,s,u){let _=0,w=e.length;if(-1===t)w=-1;else for(;_<e.length;){const S=e[_++];if("number"==typeof S){if(S===t){w=-1;break}if(S>t){w=_-1;break}}}for(;_<e.length;){const S=e[_];if("number"==typeof S)break;if(S===n){if(null===s)return void(null!==u&&(e[_+1]=u));if(s===e[_+1])return void(e[_+2]=u)}_++,null!==s&&_++,null!==u&&_++}-1!==w&&(e.splice(w,0,t),_=w+1),e.splice(_++,0,n),null!==s&&e.splice(_++,0,s),null!==u&&e.splice(_++,0,u)}const Tf="ng-template";function Xl(e,t,n){let s=0,u=!0;for(;s<e.length;){let _=e[s++];if("string"==typeof _&&u){const w=e[s++];if(n&&"class"===_&&-1!==rl(w.toLowerCase(),t,0))return!0}else{if(1===_){for(;s<e.length&&"string"==typeof(_=e[s++]);)if(_.toLowerCase()===t)return!0;return!1}"number"==typeof _&&(u=!1)}}return!1}function om(e){return 4===e.type&&e.value!==Tf}function a_(e,t,n){return t===(4!==e.type||n?e.value:Tf)}function Cf(e,t,n){let s=4;const u=e.attrs||[],_=function Gu(e){for(let t=0;t<e.length;t++)if(im(e[t]))return t;return e.length}(u);let w=!1;for(let S=0;S<t.length;S++){const P=t[S];if("number"!=typeof P){if(!w)if(4&s){if(s=2|1&s,""!==P&&!a_(e,P,n)||""===P&&1===t.length){if(bo(s))return!1;w=!0}}else{const z=8&s?P:t[++S];if(8&s&&null!==e.attrs){if(!Xl(e.attrs,z,n)){if(bo(s))return!1;w=!0}continue}const Y=eh(8&s?"class":P,u,om(e),n);if(-1===Y){if(bo(s))return!1;w=!0;continue}if(""!==z){let ye;ye=Y>_?"":u[Y+1].toLowerCase();const xe=8&s?ye:null;if(xe&&-1!==rl(xe,z,0)||2&s&&z!==ye){if(bo(s))return!1;w=!0}}}}else{if(!w&&!bo(s)&&!bo(P))return!1;if(w&&bo(P))continue;w=!1,s=P|1&s}}return bo(s)||w}function bo(e){return 0==(1&e)}function eh(e,t,n,s){if(null===t)return-1;let u=0;if(s||!n){let _=!1;for(;u<t.length;){const w=t[u];if(w===e)return u;if(3===w||6===w)_=!0;else{if(1===w||2===w){let S=t[++u];for(;"string"==typeof S;)S=t[++u];continue}if(4===w)break;if(0===w){u+=4;continue}}u+=_?1:2}return-1}return function $u(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const s=e[n];if("number"==typeof s)return-1;if(s===t)return n;n++}return-1}(t,e)}function js(e,t,n=!1){for(let s=0;s<t.length;s++)if(Cf(e,t[s],n))return!0;return!1}function th(e,t){return e?":not("+t.trim()+")":t}function Us(e){let t=e[0],n=1,s=2,u="",_=!1;for(;n<e.length;){let w=e[n];if("string"==typeof w)if(2&s){const S=e[++n];u+="["+w+(S.length>0?'="'+S+'"':"")+"]"}else 8&s?u+="."+w:4&s&&(u+=" "+w);else""!==u&&!bo(w)&&(t+=th(_,u),u=""),s=w,_=_||!bo(s);n++}return""!==u&&(t+=th(_,u)),t}function Yl(e){return xo(()=>{const t=Af(e),n={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===eo.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||$o.Emulated,styles:e.styles||qi,_:null,schemas:e.schemas||null,tView:null,id:""};lm(n);const s=e.dependencies;return n.directiveDefs=Ii(s,!1),n.pipeDefs=Ii(s,!0),n.id=function Av(e){let t=0;const n=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const u of n)t=Math.imul(31,t)+u.charCodeAt(0)<<0;return t+=2147483648,"c"+t}(n),n})}function If(e){return ei(e)||rn(e)}function nh(e){return null!==e}function dr(e){return xo(()=>({type:e.type,bootstrap:e.bootstrap||qi,declarations:e.declarations||qi,imports:e.imports||qi,exports:e.exports||qi,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function ih(e,t){if(null==e)return ka;const n={};for(const s in e)if(e.hasOwnProperty(s)){let u=e[s],_=u;Array.isArray(u)&&(_=u[1],u=u[0]),n[u]=s,t&&(t[u]=_)}return n}function Cn(e){return xo(()=>{const t=Af(e);return lm(t),t})}function ei(e){return e[ma]||null}function rn(e){return e[Wl]||null}function ss(e){return e[il]||null}function Af(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||ka,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||qi,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:ih(e.inputs,t),outputs:ih(e.outputs)}}function lm(e){e.features?.forEach(t=>t(e))}function Ii(e,t){if(!e)return null;const n=t?ss:If;return()=>("function"==typeof e?e():e).map(s=>n(s)).filter(nh)}const Br=0,en=1,ti=2,kr=3,Es=4,rh=5,Oo=6,Kl=7,Fr=8,La=9,Js=10,kn=11,Jl=12,oh=13,ga=14,Vr=15,jc=16,Uc=17,as=18,Ql=19,sh=20,Na=21,Qs=22,ol=23,qu=24,xi=25,ec=1,cm=2,ea=7,Hc=9,ao=11;function ko(e){return Array.isArray(e)&&"object"==typeof e[ec]}function Fo(e){return Array.isArray(e)&&!0===e[ec]}function sl(e){return 0!=(4&e.flags)}function tc(e){return e.componentOffset>-1}function al(e){return 1==(1&e.flags)}function ls(e){return!!e.template}function Wu(e){return 0!=(512&e[ti])}function ll(e,t){return e.hasOwnProperty(Fa)?e[Fa]:null}let Eo=null,uh=!1;function us(e){const t=Eo;return Eo=e,t}const ul={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function dl(e){if(!$c(e)||e.dirty){if(!e.producerMustRecompute(e)&&!dh(e))return void(e.dirty=!1);e.producerRecomputeValue(e),e.dirty=!1}}function gm(e){e.dirty=!0,function hl(e){if(void 0===e.liveConsumerNode)return;const t=uh;uh=!0;try{for(const n of e.liveConsumerNode)n.dirty||gm(n)}finally{uh=t}}(e),e.consumerMarkedDirty?.(e)}function Of(e){return e&&(e.nextProducerIndex=0),us(e)}function Yu(e,t){if(us(t),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if($c(e))for(let n=e.nextProducerIndex;n<e.producerNode.length;n++)za(e.producerNode[n],e.producerIndexOfThis[n]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function dh(e){qc(e);for(let t=0;t<e.producerNode.length;t++){const n=e.producerNode[t],s=e.producerLastReadVersion[t];if(s!==n.version||(dl(n),s!==n.version))return!0}return!1}function _m(e){if(qc(e),$c(e))for(let t=0;t<e.producerNode.length;t++)za(e.producerNode[t],e.producerIndexOfThis[t]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function za(e,t){if(function ym(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),qc(e),1===e.liveConsumerNode.length)for(let s=0;s<e.producerNode.length;s++)za(e.producerNode[s],e.producerIndexOfThis[s]);const n=e.liveConsumerNode.length-1;if(e.liveConsumerNode[t]=e.liveConsumerNode[n],e.liveConsumerIndexOfThis[t]=e.liveConsumerIndexOfThis[n],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,t<e.liveConsumerNode.length){const s=e.liveConsumerIndexOfThis[t],u=e.liveConsumerNode[t];qc(u),u.producerIndexOfThis[s]=t}}function $c(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function qc(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let Lf=null;const zf=()=>{},Lv=(()=>({...ul,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:e=>{e.schedule(e.ref)},hasRun:!1,cleanupFn:zf}))();class Bf{constructor(t,n,s){this.previousValue=t,this.currentValue=n,this.firstChange=s}isFirstChange(){return this.firstChange}}function vm(e){return e.type.prototype.ngOnChanges&&(e.setInput=Nv),Vf}function Vf(){const e=ds(this),t=e?.current;if(t){const n=e.previous;if(n===ka)e.previous=t;else for(let s in t)n[s]=t[s];e.current=null,this.ngOnChanges(t)}}function Nv(e,t,n,s){const u=this.declaredInputs[n],_=ds(e)||function xm(e,t){return e[x_]=t}(e,{previous:ka,current:null}),w=_.current||(_.current={}),S=_.previous,P=S[u];w[u]=new Bf(P&&P.currentValue,t,S===ka),e[s]=t}const x_="__ngSimpleChanges__";function ds(e){return e[x_]||null}const _a=function(e,t,n){};function hr(e){for(;Array.isArray(e);)e=e[Br];return e}function Gs(e,t){return hr(t[e])}function Tn(e,t){return hr(t[e.index])}function gh(e,t){return e.data[t]}function Ts(e,t){const n=t[e];return ko(n)?n:n[Br]}function Co(e,t){return null==t?null:e[t]}function it(e){e[Uc]=0}function _t(e){1024&e[ti]||(e[ti]|=1024,Ji(e,1))}function Yc(e){1024&e[ti]&&(e[ti]&=-1025,Ji(e,-1))}function Ji(e,t){let n=e[kr];if(null===n)return;n[rh]+=t;let s=n;for(n=n[kr];null!==n&&(1===t&&1===s[rh]||-1===t&&0===s[rh]);)n[rh]+=t,s=n,n=n[kr]}const Sn={lFrame:Qc(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function ya(){return Sn.bindingsEnabled}function Mt(){return Sn.lFrame.lView}function bi(){return Sn.lFrame.tView}function Lo(){let e=So();for(;null!==e&&64===e.type;)e=e.parent;return e}function So(){return Sn.lFrame.currentTNode}function Cs(e,t){const n=Sn.lFrame;n.currentTNode=e,n.isParent=t}function wi(){return Sn.lFrame.isParent}function oc(){return Sn.lFrame.bindingIndex++}function sc(e,t){const n=Sn.lFrame;n.bindingIndex=n.bindingRootIndex=e,id(t)}function id(e){Sn.lFrame.currentDirectiveIndex=e}function Jc(){return Sn.lFrame.currentQueryIndex}function Va(e){Sn.lFrame.currentQueryIndex=e}function Cm(e){const t=e[en];return 2===t.type?t.declTNode:1===t.type?e[Oo]:null}function va(e,t,n){if(n&Hn.SkipSelf){let u=t,_=e;for(;!(u=u.parent,null!==u||n&Hn.Host||(u=Cm(_),null===u||(_=_[ga],10&u.type))););if(null===u)return!1;t=u,e=_}const s=Sn.lFrame=xh();return s.currentTNode=t,s.lView=e,!0}function vh(e){const t=xh(),n=e[en];Sn.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function xh(){const e=Sn.lFrame,t=null===e?null:e.child;return null===t?Qc(e):t}function Qc(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function eu(){const e=Sn.lFrame;return Sn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Pi=eu;function ac(){const e=eu();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function $r(){return Sn.lFrame.selectedIndex}function ml(e){Sn.lFrame.selectedIndex=e}function yr(){const e=Sn.lFrame;return gh(e.tView,e.selectedIndex)}let tu=!0;function od(){return tu}function xa(e){tu=e}function wh(e,t){for(let n=t.directiveStart,s=t.directiveEnd;n<s;n++){const _=e.data[n].type.prototype,{ngAfterContentInit:w,ngAfterContentChecked:S,ngAfterViewInit:P,ngAfterViewChecked:z,ngOnDestroy:G}=_;w&&(e.contentHooks??=[]).push(-n,w),S&&((e.contentHooks??=[]).push(n,S),(e.contentCheckHooks??=[]).push(n,S)),P&&(e.viewHooks??=[]).push(-n,P),z&&((e.viewHooks??=[]).push(n,z),(e.viewCheckHooks??=[]).push(n,z)),null!=G&&(e.destroyHooks??=[]).push(n,G)}}function nu(e,t,n){Rm(e,t,3,n)}function cc(e,t,n,s){(3&e[ti])===n&&Rm(e,t,n,s)}function Eh(e,t){let n=e[ti];(3&n)===t&&(n&=8191,n+=1,e[ti]=n)}function Rm(e,t,n,s){const _=s??-1,w=t.length-1;let S=0;for(let P=void 0!==s?65535&e[Uc]:0;P<w;P++)if("number"==typeof t[P+1]){if(S=t[P],null!=s&&S>=s)break}else t[P]<0&&(e[Uc]+=65536),(S<_||-1==_)&&(S_(e,n,t,P),e[Uc]=(4294901760&e[Uc])+P+2),P++}function Zf(e,t){_a(4,e,t);const n=us(null);try{t.call(e)}finally{us(n),_a(5,e,t)}}function S_(e,t,n,s){const u=n[s]<0,_=n[s+1],S=e[u?-n[s]:n[s]];u?e[ti]>>13<e[Uc]>>16&&(3&e[ti])===t&&(e[ti]+=8192,Zf(S,_)):Zf(S,_)}const gl=-1;class sd{constructor(t,n,s){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=s}}function Om(e){return e!==gl}function iu(e){return 32767&e}function _l(e,t){let n=function Hv(e){return e>>16}(e),s=t;for(;n>0;)s=s[ga],n--;return s}let ru=!0;function ad(e){const t=ru;return ru=e,t}const $s=255,Th=5;let vr=0;const lo={};function uc(e,t){const n=Fm(e,t);if(-1!==n)return n;const s=t[en];s.firstCreatePass&&(e.injectorIndex=t.length,Ch(s.data,e),Ch(t,null),Ch(s.blueprint,null));const u=dc(e,t),_=e.injectorIndex;if(Om(u)){const w=iu(u),S=_l(u,t),P=S[en].data;for(let z=0;z<8;z++)t[_+z]=S[w+z]|P[w+z]}return t[_+8]=u,_}function Ch(e,t){e.push(0,0,0,0,0,0,0,0,t)}function Fm(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function dc(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,s=null,u=t;for(;null!==u;){if(s=r(u),null===s)return gl;if(n++,u=u[ga],-1!==s.injectorIndex)return s.injectorIndex|n<<16}return gl}function Lm(e,t,n){!function ld(e,t,n){let s;"string"==typeof n?s=n.charCodeAt(0)||0:n.hasOwnProperty(Zl)&&(s=n[Zl]),null==s&&(s=n[Zl]=vr++);const u=s&$s;t.data[e+(u>>Th)]|=1<<u}(e,t,n)}function Yf(e,t,n){if(n&Hn.Optional||void 0!==e)return e;Ic()}function Kf(e,t,n,s){if(n&Hn.Optional&&void 0===s&&(s=null),!(n&(Hn.Self|Hn.Host))){const u=e[La],_=St(void 0);try{return u?u.get(t,s,n&Hn.Optional):Gn(t,s,n&Hn.Optional)}finally{St(_)}}return Yf(s,0,n)}function cd(e,t,n,s=Hn.Default,u){if(null!==e){if(2048&t[ti]&&!(s&Hn.Self)){const w=function f(e,t,n,s,u){let _=e,w=t;for(;null!==_&&null!==w&&2048&w[ti]&&!(512&w[ti]);){const S=ou(_,w,n,s|Hn.Self,lo);if(S!==lo)return S;let P=_.parent;if(!P){const z=w[sh];if(z){const G=z.get(n,lo,s);if(G!==lo)return G}P=r(w),w=w[ga]}_=P}return u}(e,t,n,s,lo);if(w!==lo)return w}const _=ou(e,t,n,s,lo);if(_!==lo)return _}return Kf(t,n,s,u)}function ou(e,t,n,s,u){const _=function Wo(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Zl)?e[Zl]:void 0;return"number"==typeof t?t>=0?t&$s:M_:t}(n);if("function"==typeof _){if(!va(t,e,s))return s&Hn.Host?Yf(u,0,s):Kf(t,n,s,u);try{let w;if(w=_(s),null!=w||s&Hn.Optional)return w;Ic()}finally{Pi()}}else if("number"==typeof _){let w=null,S=Fm(e,t),P=gl,z=s&Hn.Host?t[Vr][Oo]:null;for((-1===S||s&Hn.SkipSelf)&&(P=-1===S?dc(e,t):t[S+8],P!==gl&&A_(s,!1)?(w=t[en],S=iu(P),t=_l(P,t)):S=-1);-1!==S;){const G=t[en];if(Is(_,S,G.data)){const Y=yl(S,t,n,w,s,z);if(Y!==lo)return Y}P=t[S+8],P!==gl&&A_(s,t[en].data[S+8]===z)&&Is(_,S,t)?(w=G,S=iu(P),t=_l(P,t)):S=-1}}return u}function yl(e,t,n,s,u,_){const w=t[en],S=w.data[e+8],G=fs(S,w,n,null==s?tc(S)&&ru:s!=w&&0!=(3&S.type),u&Hn.Host&&_===S);return null!==G?co(t,w,G,S):lo}function fs(e,t,n,s,u){const _=e.providerIndexes,w=t.data,S=1048575&_,P=e.directiveStart,G=_>>20,ye=u?S+G:e.directiveEnd;for(let xe=s?S:S+G;xe<ye;xe++){const Oe=w[xe];if(xe<P&&n===Oe||xe>=P&&Oe.type===n)return xe}if(u){const xe=w[P];if(xe&&ls(xe)&&xe.type===n)return P}return null}function co(e,t,n,s){let u=e[n];const _=t.data;if(function D_(e){return e instanceof sd}(u)){const w=u;w.resolving&&function On(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new bt(-200,`Circular dependency in DI detected for ${e}${n}`)}(function Li(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Wn(e)}(_[n]));const S=ad(w.canSeeViewProviders);w.resolving=!0;const z=w.injectImpl?St(w.injectImpl):null;va(e,s,Hn.Default);try{u=e[n]=w.factory(void 0,_,e,s),t.firstCreatePass&&n>=s.directiveStart&&function Pm(e,t,n){const{ngOnChanges:s,ngOnInit:u,ngDoCheck:_}=t.type.prototype;if(s){const w=vm(t);(n.preOrderHooks??=[]).push(e,w),(n.preOrderCheckHooks??=[]).push(e,w)}u&&(n.preOrderHooks??=[]).push(0-e,u),_&&((n.preOrderHooks??=[]).push(e,_),(n.preOrderCheckHooks??=[]).push(e,_))}(n,_[n],t)}finally{null!==z&&St(z),ad(S),w.resolving=!1,Pi()}}return u}function Is(e,t,n){return!!(n[t+(e>>Th)]&1<<e)}function A_(e,t){return!(e&Hn.Self||e&Hn.Host&&t)}class ps{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,s){return cd(this._tNode,this._lView,t,Jd(s),n)}}function M_(){return new ps(Lo(),Mt())}function r(e){const t=e[en],n=t.type;return 2===n?t.declTNode:1===n?e[Oo]:null}function ce(e,t){e.forEach(n=>Array.isArray(n)?ce(n,t):t(n))}function ue(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Me(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function Ce(e,t,n){let s=Ne(e,t);return s>=0?e[1|s]=n:(s=~s,function Ge(e,t,n,s){let u=e.length;if(u==t)e.push(n,s);else if(1===u)e.push(s,e[0]),e[0]=n;else{for(u--,e.push(e[u-1],e[u]);u>t;)e[u]=e[u-2],u--;e[t]=n,e[t+1]=s}}(e,s,t,n)),s}function _e(e,t){const n=Ne(e,t);if(n>=0)return e[1|n]}function Ne(e,t){return function We(e,t,n){let s=0,u=e.length>>n;for(;u!==s;){const _=s+(u-s>>1),w=e[_<<n];if(t===w)return _<<n;w>t?u=_:s=_+1}return~(u<<n)}(e,t,1)}function P_(e){return 128==(128&e.flags)}var xl=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(xl||{});const ja=new Map;let au=0;const Um="__ngContext__";function Xo(e,t){ko(t)?(e[Um]=t[Ql],function db(e){ja.set(e[Ql],e)}(t)):e[Um]=t}let Wv;function F_(e,t){return Wv(e,t)}function Hm(e){const t=e[kr];return Fo(t)?t[kr]:t}function Zv(e){return Yv(e[Jl])}function Xv(e){return Yv(e[Es])}function Yv(e){for(;null!==e&&!Fo(e);)e=e[Es];return e}function Dh(e,t,n,s,u){if(null!=s){let _,w=!1;Fo(s)?_=s:ko(s)&&(w=!0,s=s[Br]);const S=hr(s);0===e&&null!==n?null==u?wb(t,n,S):Mh(t,n,S,u||null,!0):1===e&&null!==n?Mh(t,n,S,u||null,!0):2===e?function hd(e,t,n){const s=Wm(e,t);s&&function Jv(e,t,n,s){e.removeChild(t,n,s)}(e,s,t,n)}(t,S,w):3===e&&t.destroyNode(S),null!=_&&function e0(e,t,n,s,u){const _=n[ea];_!==hr(n)&&Dh(t,e,s,_,u);for(let S=ao;S<n.length;S++){const P=n[S];Ym(P[en],P,e,t,s,_)}}(t,e,_,n,u)}}function Wr(e,t,n){return e.createElement(t,n)}function Ih(e,t){const n=e[Hc],s=n.indexOf(t);Yc(t),n.splice(s,1)}function qm(e,t){if(e.length<=ao)return;const n=ao+t,s=e[n];if(s){const u=s[jc];null!==u&&u!==e&&Ih(u,s),t>0&&(e[n-1][Es]=s[Es]);const _=Me(e,ao+t);!function xb(e,t){Ym(e,t,t[kn],2,null,null),t[Br]=null,t[Oo]=null}(s[en],s);const w=_[as];null!==w&&w.detachView(_[en]),s[kr]=null,s[Es]=null,s[ti]&=-129}return s}function cu(e,t){if(!(256&t[ti])){const n=t[kn];t[ol]&&_m(t[ol]),t[qu]&&_m(t[qu]),n.destroyNode&&Ym(e,t,n,3,null,null),function PE(e){let t=e[Jl];if(!t)return Ah(e[en],e);for(;t;){let n=null;if(ko(t))n=t[Jl];else{const s=t[ao];s&&(n=s)}if(!n){for(;t&&!t[Es]&&t!==e;)ko(t)&&Ah(t[en],t),t=t[kr];null===t&&(t=e),ko(t)&&Ah(t[en],t),n=t&&t[Es]}t=n}}(t)}}function Ah(e,t){if(!(256&t[ti])){t[ti]&=-129,t[ti]|=256,function FE(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let s=0;s<n.length;s+=2){const u=t[n[s]];if(!(u instanceof sd)){const _=n[s+1];if(Array.isArray(_))for(let w=0;w<_.length;w+=2){const S=u[_[w]],P=_[w+1];_a(4,S,P);try{P.call(S)}finally{_a(5,S,P)}}else{_a(4,u,_);try{_.call(u)}finally{_a(5,u,_)}}}}}(e,t),function kE(e,t){const n=e.cleanup,s=t[Kl];if(null!==n)for(let _=0;_<n.length-1;_+=2)if("string"==typeof n[_]){const w=n[_+3];w>=0?s[w]():s[-w].unsubscribe(),_+=2}else n[_].call(s[n[_+1]]);null!==s&&(t[Kl]=null);const u=t[Na];if(null!==u){t[Na]=null;for(let _=0;_<u.length;_++)(0,u[_])()}}(e,t),1===t[en].type&&t[kn].destroy();const n=t[jc];if(null!==n&&Fo(t[kr])){n!==t[kr]&&Ih(n,t);const s=t[as];null!==s&&s.detachView(e)}!function $v(e){ja.delete(e[Ql])}(t)}}function Kv(e,t,n){return function bb(e,t,n){let s=t;for(;null!==s&&40&s.type;)s=(t=s).parent;if(null===s)return n[Br];{const{componentOffset:u}=s;if(u>-1){const{encapsulation:_}=e.data[s.directiveStart+u];if(_===$o.None||_===$o.Emulated)return null}return Tn(s,n)}}(e,t.parent,n)}function Mh(e,t,n,s,u){e.insertBefore(t,n,s,u)}function wb(e,t,n){e.appendChild(t,n)}function Eb(e,t,n,s,u){null!==s?Mh(e,t,n,s,u):wb(e,t,n)}function Wm(e,t){return e.parentNode(t)}let N_,H_,Ph=function jr(e,t,n){return 40&e.type?Tn(e,n):null};function Rh(e,t,n,s){const u=Kv(e,s,t),_=t[kn],S=function Tb(e,t,n){return Ph(e,t,n)}(s.parent||t[Oo],s,t);if(null!=u)if(Array.isArray(n))for(let P=0;P<n.length;P++)Eb(_,u,n[P],S,!1);else Eb(_,u,n,S,!1);void 0!==N_&&N_(_,s,t,n,u)}function uu(e,t){if(null!==t){const n=t.type;if(3&n)return Tn(t,e);if(4&n)return z_(-1,e[t.index]);if(8&n){const s=t.child;if(null!==s)return uu(e,s);{const u=e[t.index];return Fo(u)?z_(-1,u):hr(u)}}if(32&n)return F_(t,e)()||hr(e[t.index]);{const s=Qv(e,t);return null!==s?Array.isArray(s)?s[0]:uu(Hm(e[Vr]),s):uu(e,t.next)}}return null}function Qv(e,t){return null!==t?e[Vr][Oo].projection[t.projection]:null}function z_(e,t){const n=ao+e+1;if(n<t.length){const s=t[n],u=s[en].firstChild;if(null!==u)return uu(s,u)}return t[ea]}function Oh(e,t,n,s,u,_,w){for(;null!=n;){const S=s[n.index],P=n.type;if(w&&0===t&&(S&&Xo(hr(S),s),n.flags|=2),32!=(32&n.flags))if(8&P)Oh(e,t,n.child,s,u,_,!1),Dh(t,e,u,S,_);else if(32&P){const z=F_(n,s);let G;for(;G=z();)Dh(t,e,u,G,_);Dh(t,e,u,S,_)}else 16&P?V_(e,t,s,n,u,_):Dh(t,e,u,S,_);n=w?n.projectionNext:n.next}}function Ym(e,t,n,s,u,_){Oh(n,s,e.firstChild,t,u,_,!1)}function V_(e,t,n,s,u,_){const w=n[Vr],P=w[Oo].projection[s.projection];if(Array.isArray(P))for(let z=0;z<P.length;z++)Dh(t,e,u,P[z],_);else{let z=P;const G=w[kr];P_(s)&&(z.flags|=128),Oh(e,t,z,G,u,_,!0)}}function Db(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}function Ms(e,t,n){const{mergedAttrs:s,classes:u,styles:_}=n;null!==s&&nm(e,t,s),null!==u&&Db(e,t,u),null!==_&&function kh(e,t,n){e.setAttribute(t,"style",n)}(e,t,_)}class bl{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const pc=new Ht("ENVIRONMENT_INITIALIZER"),p0=new Ht("INJECTOR",-1),m0=new Ht("INJECTOR_DEF_TYPES");class ty{get(t,n=Kr){if(n===Kr){const s=new Error(`NullInjectorError: No provider for ${ur(t)}!`);throw s.name="NullInjectorError",s}return n}}function XE(...e){return{\u0275providers:g0(0,e),\u0275fromNgModule:!0}}function g0(e,...t){const n=[],s=new Set;let u;const _=w=>{n.push(w)};return ce(t,w=>{const S=w;ig(S,_,[],s)&&(u||=[],u.push(S))}),void 0!==u&&ip(u,_),n}function ip(e,t){for(let n=0;n<e.length;n++){const{ngModule:s,providers:u}=e[n];_0(u,_=>{t(_,s)})}}function ig(e,t,n,s){if(!(e=Nn(e)))return!1;let u=null,_=Yd(e);const w=!_&&ei(e);if(_||w){if(w&&!w.standalone)return!1;u=e}else{const P=e.ngModule;if(_=Yd(P),!_)return!1;u=P}const S=s.has(u);if(w){if(S)return!1;if(s.add(u),w.dependencies){const P="function"==typeof w.dependencies?w.dependencies():w.dependencies;for(const z of P)ig(z,t,n,s)}}else{if(!_)return!1;{if(null!=_.imports&&!S){let z;s.add(u);try{ce(_.imports,G=>{ig(G,t,n,s)&&(z||=[],z.push(G))})}finally{}void 0!==z&&ip(z,t)}if(!S){const z=ll(u)||(()=>new u);t({provide:u,useFactory:z,deps:qi},u),t({provide:m0,useValue:u,multi:!0},u),t({provide:pc,useValue:()=>gt(u),multi:!0},u)}const P=_.providers;if(null!=P&&!S){const z=e;_0(P,G=>{t(G,z)})}}}return u!==e&&void 0!==e.providers}function _0(e,t){for(let n of e)Ro(n)&&(n=n.\u0275providers),Array.isArray(n)?_0(n,t):t(n)}const KE=Di({provide:String,useValue:Di});function ny(e){return null!==e&&"object"==typeof e&&KE in e}function mc(e){return"function"==typeof e}const zh=new Ht("Set Injector scope."),sp={},ry={};let y0;function md(){return void 0===y0&&(y0=new ty),y0}class Ua{}class Ps extends Ua{get destroyed(){return this._destroyed}constructor(t,n,s,u){super(),this.parent=n,this.source=s,this.scopes=u,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,x0(t,w=>this.processProvider(w)),this.records.set(p0,Vh(void 0,this)),u.has("environment")&&this.records.set(Ua,Vh(void 0,this));const _=this.records.get(zh);null!=_&&"string"==typeof _.value&&this.scopes.add(_.value),this.injectorDefTypes=new Set(this.get(m0.multi,qi,Hn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const n of this._ngOnDestroyHooks)n.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const n of t)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const n=Ys(this),s=St(void 0);try{return t()}finally{Ys(n),St(s)}}get(t,n=Kr,s=Hn.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(Ef))return t[Ef](this);s=Jd(s);const _=Ys(this),w=St(void 0);try{if(!(s&Hn.SkipSelf)){let P=this.records.get(t);if(void 0===P){const z=function Bb(e){return"function"==typeof e||"object"==typeof e&&e instanceof Ht}(t)&&Bu(t);P=z&&this.injectableDefInScope(z)?Vh(gd(t),sp):null,this.records.set(t,P)}if(null!=P)return this.hydrate(t,P)}return(s&Hn.Self?md():this.parent).get(t,n=s&Hn.Optional&&n===Kr?null:n)}catch(S){if("NullInjectorError"===S.name){if((S[vo]=S[vo]||[]).unshift(ur(t)),_)throw S;return function Qr(e,t,n,s){const u=e[vo];throw t[Vs]&&u.unshift(t[Vs]),e.message=function tm(e,t,n,s=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let u=ur(t);if(Array.isArray(t))u=t.map(ur).join(" -> ");else if("object"==typeof t){let _=[];for(let w in t)if(t.hasOwnProperty(w)){let S=t[w];_.push(w+":"+("string"==typeof S?JSON.stringify(S):ur(S)))}u=`{${_.join(", ")}}`}return`${n}${s?"("+s+")":""}[${u}]: ${e.replace(ln,"\n  ")}`}("\n"+e.message,u,n,s),e.ngTokenPath=u,e[vo]=null,e}(S,t,"R3InjectorError",this.source)}throw S}finally{St(w),Ys(_)}}resolveInjectorInitializers(){const t=Ys(this),n=St(void 0);try{const u=this.get(pc.multi,qi,Hn.Self);for(const _ of u)_()}finally{Ys(t),St(n)}}toString(){const t=[],n=this.records;for(const s of n.keys())t.push(ur(s));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new bt(205,!1)}processProvider(t){let n=mc(t=Nn(t))?t:Nn(t&&t.provide);const s=function ap(e){return ny(e)?Vh(void 0,e.useValue):Vh(function Bh(e,t,n){let s;if(mc(e)){const u=Nn(e);return ll(u)||gd(u)}if(ny(e))s=()=>Nn(e.useValue);else if(function iy(e){return!(!e||!e.useFactory)}(e))s=()=>e.useFactory(...ws(e.deps||[]));else if(function rp(e){return!(!e||!e.useExisting)}(e))s=()=>gt(Nn(e.useExisting));else{const u=Nn(e&&(e.useClass||e.provide));if(!function oy(e){return!!e.deps}(e))return ll(u)||gd(u);s=()=>new u(...ws(e.deps))}return s}(e),sp)}(t);if(mc(t)||!0!==t.multi)this.records.get(n);else{let u=this.records.get(n);u||(u=Vh(void 0,sp,!0),u.factory=()=>ws(u.multi),this.records.set(n,u)),n=t,u.multi.push(t)}this.records.set(n,s)}hydrate(t,n){return n.value===sp&&(n.value=ry,n.value=n.factory()),"object"==typeof n.value&&n.value&&function zb(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=Nn(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(t){const n=this._onDestroyHooks.indexOf(t);-1!==n&&this._onDestroyHooks.splice(n,1)}}function gd(e){const t=Bu(e),n=null!==t?t.factory:ll(e);if(null!==n)return n;if(e instanceof Ht)throw new bt(204,!1);if(e instanceof Function)return function v0(e){const t=e.length;if(t>0)throw function ve(e,t){const n=[];for(let s=0;s<e;s++)n.push(t);return n}(t,"?"),new bt(204,!1);const n=function ju(e){return e&&(e[Nt]||e[Uu])||null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new bt(204,!1)}function Vh(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function x0(e,t){for(const n of e)Array.isArray(n)?x0(n,t):n&&Ro(n)?x0(n.\u0275providers,t):t(n)}const jh=new Ht("AppId",{providedIn:"root",factory:()=>JE}),JE="ng",lp=new Ht("Platform Initializer"),hu=new Ht("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),rg=new Ht("AnimationModuleType"),cp=new Ht("CSP nonce",{providedIn:"root",factory:()=>function fd(){if(void 0!==H_)return H_;if(typeof document<"u")return document;throw new bt(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let C0=(e,t,n)=>null;function cg(e,t,n=!1){return C0(e,t,n)}class uy{}class dy{}class qb{resolveComponentFactory(t){throw function Gh(e){const t=Error(`No component factory found for ${ur(e)}.`);return t.ngComponent=e,t}(t)}}let fp=(()=>{class e{static{this.NULL=new qb}}return e})();function iT(){return pp(Lo(),Mt())}function pp(e,t){return new Yo(Tn(e,t))}let Yo=(()=>{class e{constructor(n){this.nativeElement=n}static{this.__NG_ELEMENT_ID__=iT}}return e})();function rT(e){return e instanceof Yo?e.nativeElement:e}class mp{}let oT=(()=>{class e{static{this.\u0275prov=Kt({token:e,providedIn:"root",factory:()=>null})}}return e})();class qh{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const sT=new qh("16.2.12"),fy={};function Kb(e,t=null,n=null,s){const u=Jb(e,t,n,s);return u.resolveInjectorInitializers(),u}function Jb(e,t=null,n=null,s,u=new Set){const _=[n||qi,XE(e)];return s=s||("object"==typeof e?void 0:ur(e)),new Ps(_,t||md(),s||null,u)}let Ko=(()=>{class e{static{this.THROW_IF_NOT_FOUND=Kr}static{this.NULL=new ty}static create(n,s){if(Array.isArray(n))return Kb({name:""},s,n,"");{const u=n.name??"";return Kb({name:u},n.parent,n.providers,u)}}static{this.\u0275prov=Kt({token:e,providedIn:"any",factory:()=>gt(p0)})}static{this.__NG_ELEMENT_ID__=-1}}return e})();function P0(e){return e.ngOriginalError}class wl{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&P0(t);for(;n&&P0(n);)n=P0(n);return n||null}}function py(e){return t=>{setTimeout(e,void 0,t)}}const fo=class nw extends Gi{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,s){let u=t,_=n||(()=>null),w=s;if(t&&"object"==typeof t){const P=t;u=P.next?.bind(P),_=P.error?.bind(P),w=P.complete?.bind(P)}this.__isAsync&&(_=py(_),u&&(u=py(u)),w&&(w=py(w)));const S=super.subscribe({next:u,error:_,complete:w});return t instanceof tr&&t.add(S),S}};function R0(...e){}class Ti{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:s=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new fo(!1),this.onMicrotaskEmpty=new fo(!1),this.onStable=new fo(!1),this.onError=new fo(!1),typeof Zone>"u")throw new bt(908,!1);Zone.assertZonePatched();const u=this;u._nesting=0,u._outer=u._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(u._inner=u._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(u._inner=u._inner.fork(Zone.longStackTraceZoneSpec)),u.shouldCoalesceEventChangeDetection=!s&&n,u.shouldCoalesceRunChangeDetection=s,u.lastRequestAnimationFrameId=-1,u.nativeRequestAnimationFrame=function iw(){const e="function"==typeof yi.requestAnimationFrame;let t=yi[e?"requestAnimationFrame":"setTimeout"],n=yi[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&t&&n){const s=t[Zone.__symbol__("OriginalDelegate")];s&&(t=s);const u=n[Zone.__symbol__("OriginalDelegate")];u&&(n=u)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function ow(e){const t=()=>{!function ug(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(yi,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,k0(e),e.isCheckStableRunning=!0,O0(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),k0(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,s,u,_,w,S)=>{if(function fT(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(S))return n.invokeTask(u,_,w,S);try{return sw(e),n.invokeTask(u,_,w,S)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===_.type||e.shouldCoalesceRunChangeDetection)&&t(),aw(e)}},onInvoke:(n,s,u,_,w,S,P)=>{try{return sw(e),n.invoke(u,_,w,S,P)}finally{e.shouldCoalesceRunChangeDetection&&t(),aw(e)}},onHasTask:(n,s,u,_)=>{n.hasTask(u,_),s===u&&("microTask"==_.change?(e._hasPendingMicrotasks=_.microTask,k0(e),O0(e)):"macroTask"==_.change&&(e.hasPendingMacrotasks=_.macroTask))},onHandleError:(n,s,u,_)=>(n.handleError(u,_),e.runOutsideAngular(()=>e.onError.emit(_)),!1)})}(u)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ti.isInAngularZone())throw new bt(909,!1)}static assertNotInAngularZone(){if(Ti.isInAngularZone())throw new bt(909,!1)}run(t,n,s){return this._inner.run(t,n,s)}runTask(t,n,s,u){const _=this._inner,w=_.scheduleEventTask("NgZoneEvent: "+u,t,rw,R0,R0);try{return _.runTask(w,n,s)}finally{_.cancelTask(w)}}runGuarded(t,n,s){return this._inner.runGuarded(t,n,s)}runOutsideAngular(t){return this._outer.run(t)}}const rw={};function O0(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function k0(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function sw(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function aw(e){e._nesting--,O0(e)}class hT{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new fo,this.onMicrotaskEmpty=new fo,this.onStable=new fo,this.onError=new fo}run(t,n,s){return t.apply(n,s)}runGuarded(t,n,s){return t.apply(n,s)}runOutsideAngular(t){return t()}runTask(t,n,s,u){return t.apply(n,s)}}const lw=new Ht("",{providedIn:"root",factory:cw});function cw(){const e=$n(Ti);let t=!0;return tl(new Vi(u=>{t=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{u.next(t),u.complete()})}),new Vi(u=>{let _;e.runOutsideAngular(()=>{_=e.onStable.subscribe(()=>{Ti.assertNotInAngularZone(),queueMicrotask(()=>{!t&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(t=!0,u.next(!0))})})});const w=e.onUnstable.subscribe(()=>{Ti.assertInAngularZone(),t&&(t=!1,e.runOutsideAngular(()=>{u.next(!1)}))});return()=>{_.unsubscribe(),w.unsubscribe()}}).pipe(Xs()))}let gy=(()=>{class e{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static{this.\u0275prov=Kt({token:e,providedIn:"root",factory:()=>new e})}}return e})();function xd(e){for(;e;){e[ti]|=64;const t=Hm(e);if(Wu(e)&&!t)return e;e=t}return null}const hw=new Ht("",{providedIn:"root",factory:()=>!1});let dg=null;function Rs(e,t){return e[t]??hg()}function _p(e,t){const n=hg();n.producerNode?.length&&(e[t]=dg,n.lView=e,dg=_y())}const yp={...ul,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{xd(e.lView)},lView:null};function _y(){return Object.create(yp)}function hg(){return dg??=_y(),dg}const ai={};function fg(e){N0(bi(),Mt(),$r()+e,!1)}function N0(e,t,n,s){if(!s)if(3==(3&t[ti])){const _=e.preOrderCheckHooks;null!==_&&nu(t,_,n)}else{const _=e.preOrderHooks;null!==_&&cc(t,_,0,n)}ml(n)}function Tt(e,t=Hn.Default){const n=Mt();return null===n?gt(e,t):cd(Lo(),n,Nn(e),t)}function vp(e,t,n,s,u,_,w,S,P,z,G){const Y=t.blueprint.slice();return Y[Br]=u,Y[ti]=140|s,(null!==z||e&&2048&e[ti])&&(Y[ti]|=2048),it(Y),Y[kr]=Y[ga]=e,Y[Fr]=n,Y[Js]=w||e&&e[Js],Y[kn]=S||e&&e[kn],Y[La]=P||e&&e[La]||null,Y[Oo]=_,Y[Ql]=function ub(){return au++}(),Y[Qs]=G,Y[sh]=z,Y[Vr]=2==t.type?e[Vr]:Y,Y}function Wh(e,t,n,s,u){let _=e.data[t];if(null===_)_=function yy(e,t,n,s,u){const _=So(),w=wi(),P=e.data[t]=function wT(e,t,n,s,u,_){let w=t?t.injectorIndex:-1,S=0;return function ed(){return null!==Sn.skipHydrationRootTNode}()&&(S|=128),{type:n,index:s,insertBeforeIndex:null,injectorIndex:w,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:S,providerIndexes:0,value:u,attrs:_,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,w?_:_&&_.parent,n,t,s,u);return null===e.firstChild&&(e.firstChild=P),null!==_&&(w?null==_.child&&null!==P.parent&&(_.child=P):null===_.next&&(_.next=P,P.prev=_)),P}(e,t,n,s,u),function Wf(){return Sn.lFrame.inI18n}()&&(_.flags|=32);else if(64&_.type){_.type=n,_.value=s,_.attrs=u;const w=function yh(){const e=Sn.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();_.injectorIndex=null===w?-1:w.injectorIndex}return Cs(_,!0),_}function pg(e,t,n,s){if(0===n)return-1;const u=t.length;for(let _=0;_<n;_++)t.push(s),e.blueprint.push(s),e.data.push(null);return u}function B0(e,t,n,s,u){const _=Rs(t,ol),w=$r(),S=2&s;try{ml(-1),S&&t.length>xi&&N0(e,t,xi,!1),_a(S?2:0,u);const z=S?_:null,G=Of(z);try{null!==z&&(z.dirty=!1),n(s,u)}finally{Yu(z,G)}}finally{S&&null===t[ol]&&_p(t,ol),ml(w),_a(S?3:1,u)}}function vy(e,t,n){if(sl(t)){const s=us(null);try{const _=t.directiveEnd;for(let w=t.directiveStart;w<_;w++){const S=e.data[w];S.contentQueries&&S.contentQueries(1,n[w],w)}}finally{us(s)}}}function xy(e,t,n){ya()&&(function xp(e,t,n,s){const u=n.directiveStart,_=n.directiveEnd;tc(n)&&function TT(e,t,n){const s=Tn(t,e),u=El(n);let w=16;n.signals?w=4096:n.onPush&&(w=64);const S=_g(e,vp(e,u,null,w,s,t,null,e[Js].rendererFactory.createRenderer(s,n),null,null,null));e[t.index]=S}(t,n,e.data[u+n.componentOffset]),e.firstCreatePass||uc(n,t),Xo(s,t);const w=n.initialInputs;for(let S=u;S<_;S++){const P=e.data[S],z=co(t,e,S,n);Xo(z,t),null!==w&&CT(0,S-u,z,P,0,w),ls(P)&&(Ts(n.index,t)[Fr]=co(t,e,S,n))}}(e,t,n,Tn(n,t)),64==(64&n.flags)&&gu(e,t,n))}function by(e,t,n=Tn){const s=t.localNames;if(null!==s){let u=t.index+1;for(let _=0;_<s.length;_+=2){const w=s[_+1],S=-1===w?n(t,e):e[w];e[u++]=S}}}function El(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=wy(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function wy(e,t,n,s,u,_,w,S,P,z,G){const Y=xi+s,ye=Y+u,xe=function V0(e,t){const n=[];for(let s=0;s<t;s++)n.push(s<e?null:ai);return n}(Y,ye),Oe="function"==typeof z?z():z;return xe[en]={type:e,blueprint:xe,template:n,queries:null,viewQuery:S,declTNode:t,data:xe.slice().fill(null,Y),bindingStartIndex:Y,expandoStartIndex:ye,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof _?_():_,pipeRegistry:"function"==typeof w?w():w,firstChild:null,schemas:P,consts:Oe,incompleteFirstPass:!1,ssrId:G}}let j0=e=>null;function bw(e,t,n,s){for(let u in e)if(e.hasOwnProperty(u)){n=null===n?{}:n;const _=e[u];null===s?U0(n,t,u,_):s.hasOwnProperty(u)&&U0(n,t,s[u],_)}return n}function U0(e,t,n,s){e.hasOwnProperty(n)?e[n].push(t,s):e[n]=[t,s]}function gs(e,t,n,s,u,_,w,S){const P=Tn(t,n);let G,z=t.inputs;!S&&null!=z&&(G=z[s])?(X0(e,n,G,s,u),tc(t)&&function H0(e,t){const n=Ts(t,e);16&n[ti]||(n[ti]|=64)}(n,t.index)):3&t.type&&(s=function Zh(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(s),u=null!=w?w(u,t.value||"",s):u,_.setProperty(P,s,u))}function Ty(e,t,n,s){if(ya()){const u=null===s?null:{"":-1},_=function Cw(e,t){const n=e.directiveRegistry;let s=null,u=null;if(n)for(let _=0;_<n.length;_++){const w=n[_];if(js(t,w.selectors,!1))if(s||(s=[]),ls(w))if(null!==w.findHostDirectiveDefs){const S=[];u=u||new Map,w.findHostDirectiveDefs(w,S,u),s.unshift(...S,w),bp(e,t,S.length)}else s.unshift(w),bp(e,t,0);else u=u||new Map,w.findHostDirectiveDefs?.(w,s,u),s.push(w)}return null===s?null:[s,u]}(e,n);let w,S;null===_?w=S=null:[w,S]=_,null!==w&&G0(e,t,n,w,u,S),u&&function Sw(e,t,n){if(t){const s=e.localNames=[];for(let u=0;u<t.length;u+=2){const _=n[t[u+1]];if(null==_)throw new bt(-301,!1);s.push(t[u],_)}}}(n,s,u)}n.mergedAttrs=Hu(n.mergedAttrs,n.attrs)}function G0(e,t,n,s,u,_){for(let z=0;z<s.length;z++)Lm(uc(n,t),e,s[z].type);!function Sy(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}(n,e.data.length,s.length);for(let z=0;z<s.length;z++){const G=s[z];G.providersResolver&&G.providersResolver(G)}let w=!1,S=!1,P=pg(e,t,s.length,null);for(let z=0;z<s.length;z++){const G=s[z];n.mergedAttrs=Hu(n.mergedAttrs,G.hostAttrs),ET(e,n,t,P,G),Cy(P,G,u),null!==G.contentQueries&&(n.flags|=4),(null!==G.hostBindings||null!==G.hostAttrs||0!==G.hostVars)&&(n.flags|=64);const Y=G.type.prototype;!w&&(Y.ngOnChanges||Y.ngOnInit||Y.ngDoCheck)&&((e.preOrderHooks??=[]).push(n.index),w=!0),!S&&(Y.ngOnChanges||Y.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(n.index),S=!0),P++}!function ww(e,t,n){const u=t.directiveEnd,_=e.data,w=t.attrs,S=[];let P=null,z=null;for(let G=t.directiveStart;G<u;G++){const Y=_[G],ye=n?n.get(Y):null,Oe=ye?ye.outputs:null;P=bw(Y.inputs,G,P,ye?ye.inputs:null),z=bw(Y.outputs,G,z,Oe);const ze=null===P||null===w||om(t)?null:ST(P,G,w);S.push(ze)}null!==P&&(P.hasOwnProperty("class")&&(t.flags|=8),P.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=S,t.inputs=P,t.outputs=z}(e,n,_)}function gu(e,t,n){const s=n.directiveStart,u=n.directiveEnd,_=n.index,w=function nd(){return Sn.lFrame.currentDirectiveIndex}();try{ml(_);for(let S=s;S<u;S++){const P=e.data[S],z=t[S];id(S),(null!==P.hostBindings||0!==P.hostVars||null!==P.hostAttrs)&&Tw(P,z)}}finally{ml(-1),id(w)}}function Tw(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function bp(e,t,n){t.componentOffset=n,(e.components??=[]).push(t.index)}function Cy(e,t,n){if(n){if(t.exportAs)for(let s=0;s<t.exportAs.length;s++)n[t.exportAs[s]]=e;ls(t)&&(n[""]=e)}}function ET(e,t,n,s,u){e.data[s]=u;const _=u.factory||(u.factory=ll(u.type)),w=new sd(_,ls(u),Tt);e.blueprint[s]=w,n[s]=w,function Tl(e,t,n,s,u){const _=u.hostBindings;if(_){let w=e.hostBindingOpCodes;null===w&&(w=e.hostBindingOpCodes=[]);const S=~t.index;(function $0(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(w)!=S&&w.push(S),w.push(n,s,_)}}(e,t,s,pg(e,n,u.hostVars,ai),u)}function yc(e,t,n,s,u,_){const w=Tn(e,t);!function bd(e,t,n,s,u,_,w){if(null==_)e.removeAttribute(t,u,n);else{const S=null==w?Wn(_):w(_,s||"",u);e.setAttribute(t,u,S,n)}}(t[kn],w,_,e.value,n,s,u)}function CT(e,t,n,s,u,_){const w=_[t];if(null!==w)for(let S=0;S<w.length;)Dy(s,n,w[S++],w[S++],w[S++])}function Dy(e,t,n,s,u){const _=us(null);try{const w=e.inputTransforms;null!==w&&w.hasOwnProperty(s)&&(u=w[s].call(t,u)),null!==e.setInput?e.setInput(t,u,n,s):t[s]=u}finally{us(_)}}function ST(e,t,n){let s=null,u=0;for(;u<n.length;){const _=n[u];if(0!==_)if(5!==_){if("number"==typeof _)break;if(e.hasOwnProperty(_)){null===s&&(s=[]);const w=e[_];for(let S=0;S<w.length;S+=2)if(w[S]===t){s.push(_,w[S+1],n[u+1]);break}}u+=2}else u+=2;else u+=4}return s}function q0(e,t,n,s){return[e,!0,!1,t,null,0,s,n,null,null,null]}function gg(e,t){const n=e.contentQueries;if(null!==n)for(let s=0;s<n.length;s+=2){const _=n[s+1];if(-1!==_){const w=e.data[_];Va(n[s]),w.contentQueries(2,t[_],_)}}}function _g(e,t){return e[Jl]?e[oh][Es]=t:e[Jl]=t,e[oh]=t,t}function Iy(e,t,n){Va(0);const s=us(null);try{t(e,n)}finally{us(s)}}function W0(e){return e[Kl]||(e[Kl]=[])}function Dw(e){return e.cleanup||(e.cleanup=[])}function Ay(e,t){const n=e[La],s=n?n.get(wl,null):null;s&&s.handleError(t)}function X0(e,t,n,s,u){for(let _=0;_<n.length;){const w=n[_++],S=n[_++];Dy(e.data[w],t[w],s,S,u)}}function yg(e,t){const n=Ts(t,e),s=n[en];!function wd(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(s,n);const u=n[Br];null!==u&&null===n[Qs]&&(n[Qs]=cg(u,n[La])),My(s,n,n[Fr])}function My(e,t,n){vh(t);try{const s=e.viewQuery;null!==s&&Iy(1,s,n);const u=e.template;null!==u&&B0(e,t,u,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&gg(e,t),e.staticViewQueries&&Iy(2,e.viewQuery,n);const _=e.components;null!==_&&function Y0(e,t){for(let n=0;n<t.length;n++)yg(e,t[n])}(t,_)}catch(s){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),s}finally{t[ti]&=-5,ac()}}let vg=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(n,s,u){const _=typeof Zone>"u"?null:Zone.current,w=function jt(e,t,n){const s=Object.create(Lv);n&&(s.consumerAllowSignalWrites=!0),s.fn=e,s.schedule=t;const u=w=>{s.cleanupFn=w};return s.ref={notify:()=>gm(s),run:()=>{if(s.dirty=!1,s.hasRun&&!dh(s))return;s.hasRun=!0;const w=Of(s);try{s.cleanupFn(),s.cleanupFn=zf,s.fn(u)}finally{Yu(s,w)}},cleanup:()=>s.cleanupFn()},s.ref}(n,z=>{this.all.has(z)&&this.queue.set(z,_)},u);let S;this.all.add(w),w.notify();const P=()=>{w.cleanup(),S?.(),this.all.delete(w),this.queue.delete(w)};return S=s?.onDestroy(P),{destroy:P}}flush(){if(0!==this.queue.size)for(const[n,s]of this.queue)this.queue.delete(n),s?s.run(()=>n.run()):n.run()}get isQueueEmpty(){return 0===this.queue.size}static{this.\u0275prov=Kt({token:e,providedIn:"root",factory:()=>new e})}}return e})();function Py(e,t,n){let s=n?e.styles:null,u=n?e.classes:null,_=0;if(null!==t)for(let w=0;w<t.length;w++){const S=t[w];"number"==typeof S?_=S:1==_?u=Sc(u,S):2==_&&(s=Sc(s,S+": "+t[++w]+";"))}n?e.styles=s:e.stylesWithoutHost=s,n?e.classes=u:e.classesWithoutHost=u}function wp(e,t,n,s,u=!1){for(;null!==n;){const _=t[n.index];null!==_&&s.push(hr(_)),Fo(_)&&Ep(_,s);const w=n.type;if(8&w)wp(e,t,n.child,s);else if(32&w){const S=F_(n,t);let P;for(;P=S();)s.push(P)}else if(16&w){const S=Qv(t,n);if(Array.isArray(S))s.push(...S);else{const P=Hm(t[Vr]);wp(P[en],P,S,s,!0)}}n=u?n.projectionNext:n.next}return s}function Ep(e,t){for(let n=ao;n<e.length;n++){const s=e[n],u=s[en].firstChild;null!==u&&wp(s[en],s,u,t)}e[ea]!==e[Br]&&t.push(e[ea])}function xg(e,t,n,s=!0){const u=t[Js],_=u.rendererFactory,w=u.afterRenderEventManager;_.begin?.(),w?.begin();try{Iw(e,t,e.template,n)}catch(P){throw s&&Ay(t,P),P}finally{_.end?.(),u.effectManager?.flush(),w?.end()}}function Iw(e,t,n,s){const u=t[ti];if(256!=(256&u)){t[Js].effectManager?.flush(),vh(t);try{it(t),function qf(e){return Sn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&B0(e,t,n,2,s);const w=3==(3&u);if(w){const z=e.preOrderCheckHooks;null!==z&&nu(t,z,null)}else{const z=e.preOrderHooks;null!==z&&cc(t,z,0,null),Eh(t,0)}if(function bg(e){for(let t=Zv(e);null!==t;t=Xv(t)){if(!t[cm])continue;const n=t[Hc];for(let s=0;s<n.length;s++){_t(n[s])}}}(t),Tp(t,2),null!==e.contentQueries&&gg(e,t),w){const z=e.contentCheckHooks;null!==z&&nu(t,z)}else{const z=e.contentHooks;null!==z&&cc(t,z,1),Eh(t,1)}!function _w(e,t){const n=e.hostBindingOpCodes;if(null===n)return;const s=Rs(t,qu);try{for(let u=0;u<n.length;u++){const _=n[u];if(_<0)ml(~_);else{const w=_,S=n[++u],P=n[++u];sc(S,w),s.dirty=!1;const z=Of(s);try{P(2,t[w])}finally{Yu(s,z)}}}}finally{null===t[qu]&&_p(t,qu),ml(-1)}}(e,t);const S=e.components;null!==S&&Eg(t,S,0);const P=e.viewQuery;if(null!==P&&Iy(2,P,s),w){const z=e.viewCheckHooks;null!==z&&nu(t,z)}else{const z=e.viewHooks;null!==z&&cc(t,z,2),Eh(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[ti]&=-73,Yc(t)}finally{ac()}}}function Tp(e,t){for(let n=Zv(e);null!==n;n=Xv(n))for(let s=ao;s<n.length;s++)Cp(n[s],t)}function wg(e,t,n){Cp(Ts(t,e),n)}function Cp(e,t){if(!function rc(e){return 128==(128&e[ti])}(e))return;const n=e[en],s=e[ti];if(80&s&&0===t||1024&s||2===t)Iw(n,e,n.template,e[Fr]);else if(e[rh]>0){Tp(e,1);const u=n.components;null!==u&&Eg(e,u,1)}}function Eg(e,t,n){for(let s=0;s<t.length;s++)wg(e,t[s],n)}class Tg{get rootNodes(){const t=this._lView,n=t[en];return wp(n,t,n.firstChild,[])}constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Fr]}set context(t){this._lView[Fr]=t}get destroyed(){return 256==(256&this._lView[ti])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[kr];if(Fo(t)){const n=t[8],s=n?n.indexOf(this):-1;s>-1&&(qm(t,s),Me(n,s))}this._attachedToViewContainer=!1}cu(this._lView[en],this._lView)}onDestroy(t){!function Se(e,t){if(256==(256&e[ti]))throw new bt(911,!1);null===e[Na]&&(e[Na]=[]),e[Na].push(t)}(this._lView,t)}markForCheck(){xd(this._cdRefInjectingView||this._lView)}detach(){this._lView[ti]&=-129}reattach(){this._lView[ti]|=128}detectChanges(){xg(this._lView[en],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new bt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function ME(e,t){Ym(e,t,t[kn],2,null,null)}(this._lView[en],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new bt(902,!1);this._appRef=t}}class DT extends Tg{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;xg(t[en],t,t[Fr],!1)}checkNoChanges(){}get context(){return null}}class Xh extends fp{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=ei(t);return new Sp(n,this.ngModule)}}function Cg(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class Aw{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,s){s=Jd(s);const u=this.injector.get(t,fy,s);return u!==fy||n===fy?u:this.parentInjector.get(t,n,s)}}class Sp extends dy{get inputs(){const t=this.componentDef,n=t.inputTransforms,s=Cg(t.inputs);if(null!==n)for(const u of s)n.hasOwnProperty(u.propName)&&(u.transform=n[u.propName]);return s}get outputs(){return Cg(this.componentDef.outputs)}constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function Sf(e){return e.map(Us).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}create(t,n,s,u){let _=(u=u||this.ngModule)instanceof Ua?u:u?.injector;_&&null!==this.componentDef.getStandaloneInjector&&(_=this.componentDef.getStandaloneInjector(_)||_);const w=_?new Aw(t,_):t,S=w.get(mp,null);if(null===S)throw new bt(407,!1);const Y={rendererFactory:S,sanitizer:w.get(oT,null),effectManager:w.get(vg,null),afterRenderEventManager:w.get(gy,null)},ye=S.createRenderer(null,this.componentDef),xe=this.componentDef.selectors[0][0]||"div",Oe=s?function mg(e,t,n,s){const _=s.get(hw,!1)||n===$o.ShadowDom,w=e.selectRootElement(t,_);return function mu(e){j0(e)}(w),w}(ye,s,this.componentDef.encapsulation,w):Wr(ye,xe,function IT(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(xe)),Ct=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let ut=null;null!==Oe&&(ut=cg(Oe,w,!0));const qt=wy(0,null,null,1,0,null,null,null,null,null,null),sn=vp(null,qt,null,Ct,null,null,Y,ye,w,null,ut);let ui,Or;vh(sn);try{const Gr=this.componentDef;let Ws,Fl=null;Gr.findHostDirectiveDefs?(Ws=[],Fl=new Map,Gr.findHostDirectiveDefs(Gr,Ws,Fl),Ws.push(Gr)):Ws=[Gr];const Du=function Mw(e,t){const n=e[en],s=xi;return e[s]=t,Wh(n,s,2,"#host",null)}(sn,Oe),TE=function MT(e,t,n,s,u,_,w){const S=u[en];!function Pw(e,t,n,s){for(const u of e)t.mergedAttrs=Hu(t.mergedAttrs,u.hostAttrs);null!==t.mergedAttrs&&(Py(t,t.mergedAttrs,!0),null!==n&&Ms(s,n,t))}(s,e,t,w);let P=null;null!==t&&(P=cg(t,u[La]));const z=_.rendererFactory.createRenderer(t,n);let G=16;n.signals?G=4096:n.onPush&&(G=64);const Y=vp(u,El(n),null,G,u[e.index],e,_,z,null,null,P);return S.firstCreatePass&&bp(S,e,s.length-1),_g(u,Y),u[e.index]=Y}(Du,Oe,Gr,Ws,sn,Y,ye);Or=gh(qt,xi),Oe&&function Rw(e,t,n,s){if(s)nm(e,n,["ng-version",sT.full]);else{const{attrs:u,classes:_}=function ft(e){const t=[],n=[];let s=1,u=2;for(;s<e.length;){let _=e[s];if("string"==typeof _)2===u?""!==_&&t.push(_,e[++s]):8===u&&n.push(_);else{if(!bo(u))break;u=_}s++}return{attrs:t,classes:n}}(t.selectors[0]);u&&nm(e,n,u),_&&_.length>0&&Db(e,n,_.join(" "))}}(ye,Gr,Oe,s),void 0!==n&&function RT(e,t,n){const s=e.projection=[];for(let u=0;u<t.length;u++){const _=n[u];s.push(null!=_?Array.from(_):null)}}(Or,this.ngContentSelectors,n),ui=function PT(e,t,n,s,u,_){const w=Lo(),S=u[en],P=Tn(w,u);G0(S,u,w,n,null,s);for(let G=0;G<n.length;G++)Xo(co(u,S,w.directiveStart+G,w),u);gu(S,u,w),P&&Xo(P,u);const z=co(u,S,w.directiveStart+w.componentOffset,w);if(e[Fr]=u[Fr]=z,null!==_)for(const G of _)G(z,t);return vy(S,w,e),z}(TE,Gr,Ws,Fl,sn,[OT]),My(qt,sn,null)}finally{ac()}return new AT(this.componentType,ui,pp(Or,sn),sn,Or)}}class AT extends uy{constructor(t,n,s,u,_){super(),this.location=s,this._rootLView=u,this._tNode=_,this.previousInputValues=null,this.instance=n,this.hostView=this.changeDetectorRef=new DT(u),this.componentType=t}setInput(t,n){const s=this._tNode.inputs;let u;if(null!==s&&(u=s[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),n))return;const _=this._rootLView;X0(_[en],_,u,t,n),this.previousInputValues.set(t,n),xd(Ts(this._tNode.index,_))}}get injector(){return new ps(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function OT(){const e=Lo();wh(Mt()[en],e)}function zi(e){let t=function Sg(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const s=[e];for(;t;){let u;if(ls(e))u=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new bt(903,!1);u=t.\u0275dir}if(u){if(n){s.push(u);const w=e;w.inputs=Yh(e.inputs),w.inputTransforms=Yh(e.inputTransforms),w.declaredInputs=Yh(e.declaredInputs),w.outputs=Yh(e.outputs);const S=u.hostBindings;S&&J0(e,S);const P=u.viewQuery,z=u.contentQueries;if(P&&Oy(e,P),z&&kT(e,z),Gl(e.inputs,u.inputs),Gl(e.declaredInputs,u.declaredInputs),Gl(e.outputs,u.outputs),null!==u.inputTransforms&&(null===w.inputTransforms&&(w.inputTransforms={}),Gl(w.inputTransforms,u.inputTransforms)),ls(u)&&u.data.animation){const G=e.data;G.animation=(G.animation||[]).concat(u.data.animation)}}const _=u.features;if(_)for(let w=0;w<_.length;w++){const S=_[w];S&&S.ngInherit&&S(e),S===zi&&(n=!1)}}t=Object.getPrototypeOf(t)}!function Ry(e){let t=0,n=null;for(let s=e.length-1;s>=0;s--){const u=e[s];u.hostVars=t+=u.hostVars,u.hostAttrs=Hu(u.hostAttrs,n=Hu(n,u.hostAttrs))}}(s)}function Yh(e){return e===ka?{}:e===qi?[]:e}function Oy(e,t){const n=e.viewQuery;e.viewQuery=n?(s,u)=>{t(s,u),n(s,u)}:t}function kT(e,t){const n=e.contentQueries;e.contentQueries=n?(s,u,_)=>{t(s,u,_),n(s,u,_)}:t}function J0(e,t){const n=e.hostBindings;e.hostBindings=n?(s,u)=>{t(s,u),n(s,u)}:t}function _s(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function Ha(e,t,n,s){const u=Mt();return _s(u,oc(),t)&&(bi(),yc(yr(),u,e,t,n,s)),Ha}function Rg(e,t,n,s,u,_,w,S){const P=Mt(),z=bi(),G=e+xi,Y=z.firstCreatePass?function GT(e,t,n,s,u,_,w,S,P){const z=t.consts,G=Wh(t,e,4,w||null,Co(z,S));Ty(t,n,G,Co(z,P)),wh(t,G);const Y=G.tView=wy(2,G,s,u,_,t.directiveRegistry,t.pipeRegistry,null,t.schemas,z,null);return null!==t.queries&&(t.queries.template(t,G),Y.queries=t.queries.embeddedTView(G)),G}(G,z,P,t,n,s,u,_,w):z.data[G];Cs(Y,!1);const ye=jw(z,P,Y,e);od()&&Rh(z,P,ye,Y),Xo(ye,P),_g(P,P[G]=q0(ye,P,ye,Y)),al(Y)&&xy(z,P,Y),null!=w&&by(P,Y,S)}let jw=function rf(e,t,n,s){return xa(!0),t[kn].createComment("")};function Ap(e,t,n){const s=Mt();return _s(s,oc(),t)&&gs(bi(),yr(),s,e,t,s[kn],n,!1),Ap}function Ky(e,t,n,s,u){const w=u?"class":"style";X0(e,n,t.inputs[w],w,s)}function Sl(e,t,n,s){const u=Mt(),_=bi(),w=xi+e,S=u[kn],P=_.firstCreatePass?function Hw(e,t,n,s,u,_){const w=t.consts,P=Wh(t,e,2,s,Co(w,u));return Ty(t,n,P,Co(w,_)),null!==P.attrs&&Py(P,P.attrs,!1),null!==P.mergedAttrs&&Py(P,P.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,P),P}(w,_,u,t,n,s):_.data[w],z=gx(_,u,P,S,t,e);u[w]=z;const G=al(P);return Cs(P,!0),Ms(S,z,P),32!=(32&P.flags)&&od()&&Rh(_,u,z,P),0===function bm(){return Sn.lFrame.elementDepthCount}()&&Xo(z,u),function Gf(){Sn.lFrame.elementDepthCount++}(),G&&(xy(_,u,P),vy(_,P,u)),null!==s&&by(u,P),Sl}function vc(){let e=Lo();wi()?function En(){Sn.lFrame.isParent=!1}():(e=e.parent,Cs(e,!1));const t=e;(function wm(e){return Sn.skipHydrationRootTNode===e})(t)&&function T_(){Sn.skipHydrationRootTNode=null}(),function Qu(){Sn.lFrame.elementDepthCount--}();const n=bi();return n.firstCreatePass&&(wh(n,e),sl(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function Vv(e){return 0!=(8&e.flags)}(t)&&Ky(n,t,Mt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function jv(e){return 0!=(16&e.flags)}(t)&&Ky(n,t,Mt(),t.stylesWithoutHost,!1),vc}function Id(e,t,n,s){return Sl(e,t,n,s),vc(),Id}let gx=(e,t,n,s,u,_)=>(xa(!0),Wr(s,u,function bh(){return Sn.lFrame.currentNamespace}()));function kg(e){return!!e&&"function"==typeof e.then}function yx(e){return!!e&&"function"==typeof e.subscribe}function aa(e,t,n,s){const u=Mt(),_=bi(),w=Lo();return function Xw(e,t,n,s,u,_,w){const S=al(s),z=e.firstCreatePass&&Dw(e),G=t[Fr],Y=W0(t);let ye=!0;if(3&s.type||w){const ze=Tn(s,t),lt=w?w(ze):ze,Ct=Y.length,ut=w?sn=>w(hr(sn[s.index])):s.index;let qt=null;if(!w&&S&&(qt=function qT(e,t,n,s){const u=e.cleanup;if(null!=u)for(let _=0;_<u.length-1;_+=2){const w=u[_];if(w===n&&u[_+1]===s){const S=t[Kl],P=u[_+2];return S.length>P?S[P]:null}"string"==typeof w&&(_+=2)}return null}(e,t,u,s.index)),null!==qt)(qt.__ngLastListenerFn__||qt).__ngNextListenerFn__=_,qt.__ngLastListenerFn__=_,ye=!1;else{_=Fg(s,t,G,_,!1);const sn=n.listen(lt,u,_);Y.push(_,sn),z&&z.push(u,ut,Ct,Ct+1)}}else _=Fg(s,t,G,_,!1);const xe=s.outputs;let Oe;if(ye&&null!==xe&&(Oe=xe[u])){const ze=Oe.length;if(ze)for(let lt=0;lt<ze;lt+=2){const ui=t[Oe[lt]][Oe[lt+1]].subscribe(_),Or=Y.length;Y.push(_,ui),z&&z.push(u,s.index,Or,-(Or+1))}}}(_,u,u[kn],w,e,t,s),aa}function Yw(e,t,n,s){try{return _a(6,t,n),!1!==n(s)}catch(u){return Ay(e,u),!1}finally{_a(7,t,n)}}function Fg(e,t,n,s,u){return function _(w){if(w===Function)return s;xd(e.componentOffset>-1?Ts(e.index,t):t);let P=Yw(t,n,s,w),z=_.__ngNextListenerFn__;for(;z;)P=Yw(t,n,z,w)&&P,z=z.__ngNextListenerFn__;return u&&!1===P&&w.preventDefault(),P}}function Lg(e,t){return e<<17|t<<2}function bu(e){return e>>17&32767}function ev(e){return 2|e}function Ad(e){return(131068&e)>>2}function xx(e,t){return-131069&e|t<<2}function tv(e){return 1|e}function bx(e,t,n,s,u){const _=e[n+1],w=null===t;let S=s?bu(_):Ad(_),P=!1;for(;0!==S&&(!1===P||w);){const G=e[S+1];QT(e[S],t)&&(P=!0,e[S+1]=s?tv(G):ev(G)),S=s?bu(G):Ad(G)}P&&(e[n+1]=s?ev(_):tv(_))}function QT(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&Ne(e,t)>=0}function kp(e,t){return function $a(e,t,n,s){const u=Mt(),_=bi(),w=function na(e){const t=Sn.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}(2);_.firstUpdatePass&&function rv(e,t,n,s){const u=e.data;if(null===u[n+1]){const _=u[$r()],w=function Sx(e,t){return t>=e.expandoStartIndex}(e,n);(function T(e,t){return 0!=(e.flags&(t?8:16))})(_,s)&&null===t&&!w&&(t=!1),t=function Dx(e,t,n,s){const u=function rd(e){const t=Sn.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let _=s?t.residualClasses:t.residualStyles;if(null===u)0===(s?t.classBindings:t.styleBindings)&&(n=a(n=ov(null,e,t,n,s),t.attrs,s),_=null);else{const w=t.directiveStylingLast;if(-1===w||e[w]!==u)if(n=ov(u,e,t,n,s),null===_){let P=function c1(e,t,n){const s=n?t.classBindings:t.styleBindings;if(0!==Ad(s))return e[bu(s)]}(e,t,s);void 0!==P&&Array.isArray(P)&&(P=ov(null,e,t,P[1],s),P=a(P,t.attrs,s),function Vg(e,t,n,s){e[bu(n?t.classBindings:t.styleBindings)]=s}(e,t,s,P))}else _=function Ix(e,t,n){let s;const u=t.directiveEnd;for(let _=1+t.directiveStylingLast;_<u;_++)s=a(s,e[_].hostAttrs,n);return a(s,t.attrs,n)}(e,t,s)}return void 0!==_&&(s?t.residualClasses=_:t.residualStyles=_),n}(u,_,t,s),function zg(e,t,n,s,u,_){let w=_?t.classBindings:t.styleBindings,S=bu(w),P=Ad(w);e[s]=n;let G,z=!1;if(Array.isArray(n)?(G=n[1],(null===G||Ne(n,G)>0)&&(z=!0)):G=n,u)if(0!==P){const ye=bu(e[S+1]);e[s+1]=Lg(ye,S),0!==ye&&(e[ye+1]=xx(e[ye+1],s)),e[S+1]=function o1(e,t){return 131071&e|t<<17}(e[S+1],s)}else e[s+1]=Lg(S,0),0!==S&&(e[S+1]=xx(e[S+1],s)),S=s;else e[s+1]=Lg(P,0),0===S?S=s:e[P+1]=xx(e[P+1],s),P=s;z&&(e[s+1]=ev(e[s+1])),bx(e,G,s,!0),bx(e,G,s,!1),function Bg(e,t,n,s,u){const _=u?e.residualClasses:e.residualStyles;null!=_&&"string"==typeof t&&Ne(_,t)>=0&&(n[s+1]=tv(n[s+1]))}(t,G,e,s,_),w=Lg(S,P),_?t.classBindings=w:t.styleBindings=w}(u,_,t,n,w,s)}}(_,e,w,s),t!==ai&&_s(u,w,t)&&function m(e,t,n,s,u,_,w,S){if(!(3&t.type))return;const P=e.data,z=P[S+1],G=function JT(e){return 1==(1&e)}(z)?g(P,t,n,u,Ad(z),w):void 0;x(G)||(x(_)||function KT(e){return 2==(2&e)}(z)&&(_=g(P,null,n,u,S,w)),function Sb(e,t,n,s,u){if(t)u?e.addClass(n,s):e.removeClass(n,s);else{let _=-1===s.indexOf("-")?void 0:xl.DashCase;null==u?e.removeStyle(n,s,_):("string"==typeof u&&u.endsWith("!important")&&(u=u.slice(0,-10),_|=xl.Important),e.setStyle(n,s,u,_))}}(s,w,Gs($r(),n),u,_))}(_,_.data[$r()],u,u[kn],e,u[w+1]=function E(e,t){return null==e||""===e||("string"==typeof t?e+=t:"object"==typeof e&&(e=ur(function pd(e){return e instanceof bl?e.changingThisBreaksApplicationSecurity:e}(e)))),e}(t,n),s,w)}(e,t,null,!0),kp}function ov(e,t,n,s,u){let _=null;const w=n.directiveEnd;let S=n.directiveStylingLast;for(-1===S?S=n.directiveStart:S++;S<w&&(_=t[S],s=a(s,_.hostAttrs,u),_!==e);)S++;return null!==e&&(n.directiveStylingLast=S),s}function a(e,t,n){const s=n?1:2;let u=-1;if(null!==t)for(let _=0;_<t.length;_++){const w=t[_];"number"==typeof w?u=w:u===s&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Ce(e,w,!!n||t[++_]))}return void 0===e?null:e}function g(e,t,n,s,u,_){const w=null===t;let S;for(;u>0;){const P=e[u],z=Array.isArray(P),G=z?P[1]:P,Y=null===G;let ye=n[u+1];ye===ai&&(ye=Y?qi:void 0);let xe=Y?_e(ye,s):G===s?ye:void 0;if(z&&!x(xe)&&(xe=_e(P,s)),x(xe)&&(S=xe,w))return S;const Oe=e[u+1];u=w?bu(Oe):Ad(Oe)}if(null!==t){let P=_?t.residualClasses:t.residualStyles;null!=P&&(S=_e(P,s))}return S}function x(e){return void 0!==e}function I(e,t=""){const n=Mt(),s=bi(),u=e+xi,_=s.firstCreatePass?Wh(s,u,1,t,null):s.data[u],w=A(s,n,_,t,e);n[u]=w,od()&&Rh(s,n,w,_),Cs(_,!1)}let A=(e,t,n,s,u)=>(xa(!0),function Gm(e,t){return e.createText(t)}(t[kn],s));function L(e){return V("",e,""),L}function V(e,t,n){const s=Mt(),u=function Jh(e,t,n,s){return _s(e,oc(),n)?t+Wn(n)+s:ai}(s,e,t,n);return u!==ai&&function _u(e,t,n){const s=Gs(t,e);!function L_(e,t,n){e.setValue(t,n)}(e[kn],s,n)}(s,$r(),u),V}function vn(e,t,n){const s=Mt();return _s(s,oc(),t)&&gs(bi(),yr(),s,e,t,s[kn],n,!0),vn}const nn="en-US";let pi=nn;class jg{}class AO{}class dC extends jg{constructor(t,n,s){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Xh(this);const u=function Hs(e,t){const n=e[Bc]||null;if(!n&&!0===t)throw new Error(`Type ${ur(e)} does not have '\u0275mod' property.`);return n}(t);this._bootstrapComponents=function fu(e){return e instanceof Function?e():e}(u.bootstrap),this._r3Injector=Jb(t,n,[{provide:jg,useValue:this},{provide:fp,useValue:this.componentFactoryResolver},...s],ur(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class hC extends AO{constructor(t){super(),this.moduleType=t}create(t){return new dC(this.moduleType,t,[])}}function sk(){return this._results[Symbol.iterator]()}class Ox{get changes(){return this._changes||(this._changes=new fo)}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=Ox.prototype;n[Symbol.iterator]||(n[Symbol.iterator]=sk)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){const s=this;s.dirty=!1;const u=function ae(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function pe(e,t,n){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){let u=e[s],_=t[s];if(n&&(u=n(u),_=n(_)),_!==u)return!1}return!0}(s._results,u,n))&&(s._results=u,s.length=u.length,s.last=u[this.length-1],s.first=u[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function lk(e,t,n,s=!0){const u=t[en];if(function RE(e,t,n,s){const u=ao+s,_=n.length;s>0&&(n[u-1][Es]=t),s<_-ao?(t[Es]=n[u],ue(n,ao+s,t)):(n.push(t),t[Es]=null),t[kr]=n;const w=t[jc];null!==w&&n!==w&&function OE(e,t){const n=e[Hc];t[Vr]!==t[kr][kr][Vr]&&(e[cm]=!0),null===n?e[Hc]=[t]:n.push(t)}(w,t);const S=t[as];null!==S&&S.insertView(e),t[ti]|=128}(u,t,e,n),s){const _=z_(n,e),w=t[kn],S=Wm(w,e[ea]);null!==S&&function $m(e,t,n,s,u,_){s[Br]=u,s[Oo]=t,Ym(e,s,n,1,u,_)}(u,e[Oo],w,t,S,_)}}let Md=(()=>{class e{static{this.__NG_ELEMENT_ID__=dk}}return e})();const ck=Md,uk=class extends ck{constructor(t,n,s){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=s}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,n){return this.createEmbeddedViewImpl(t,n)}createEmbeddedViewImpl(t,n,s){const u=function ak(e,t,n,s){const u=t.tView,S=vp(e,u,n,4096&e[ti]?4096:16,null,t,null,null,null,s?.injector??null,s?.hydrationInfo??null);S[jc]=e[t.index];const z=e[as];return null!==z&&(S[as]=z.createEmbeddedView(u)),My(u,S,n),S}(this._declarationLView,this._declarationTContainer,t,{injector:n,hydrationInfo:s});return new Tg(u)}};function dk(){return m1(Lo(),Mt())}function m1(e,t){return 4&e.type?new uk(t,e,pp(e,t)):null}let Eu=(()=>{class e{static{this.__NG_ELEMENT_ID__=_k}}return e})();function _k(){return OI(Lo(),Mt())}const yk=Eu,PI=class extends yk{constructor(t,n,s){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=s}get element(){return pp(this._hostTNode,this._hostLView)}get injector(){return new ps(this._hostTNode,this._hostLView)}get parentInjector(){const t=dc(this._hostTNode,this._hostLView);if(Om(t)){const n=_l(t,this._hostLView),s=iu(t);return new ps(n[en].data[s+8],n)}return new ps(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=RI(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-ao}createEmbeddedView(t,n,s){let u,_;"number"==typeof s?u=s:null!=s&&(u=s.index,_=s.injector);const S=t.createEmbeddedViewImpl(n||{},_,null);return this.insertImpl(S,u,false),S}createComponent(t,n,s,u,_){const w=t&&!function de(e){return"function"==typeof e}(t);let S;if(w)S=n;else{const ze=n||{};S=ze.index,s=ze.injector,u=ze.projectableNodes,_=ze.environmentInjector||ze.ngModuleRef}const P=w?t:new Sp(ei(t)),z=s||this.parentInjector;if(!_&&null==P.ngModule){const lt=(w?z:this.parentInjector).get(Ua,null);lt&&(_=lt)}ei(P.componentType??{});const xe=P.create(z,u,null,_);return this.insertImpl(xe.hostView,S,false),xe}insert(t,n){return this.insertImpl(t,n,!1)}insertImpl(t,n,s){const u=t._lView;if(function Xc(e){return Fo(e[kr])}(u)){const P=this.indexOf(t);if(-1!==P)this.detach(P);else{const z=u[kr],G=new PI(z,z[Oo],z[kr]);G.detach(G.indexOf(t))}}const w=this._adjustIndex(n),S=this._lContainer;return lk(S,u,w,!s),t.attachToViewContainerRef(),ue(pC(S),w,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=RI(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),s=qm(this._lContainer,n);s&&(Me(pC(this._lContainer),n),cu(s[en],s))}detach(t){const n=this._adjustIndex(t,-1),s=qm(this._lContainer,n);return s&&null!=Me(pC(this._lContainer),n)?new Tg(s):null}_adjustIndex(t,n=0){return t??this.length+n}};function RI(e){return e[8]}function pC(e){return e[8]||(e[8]=[])}function OI(e,t){let n;const s=t[e.index];return Fo(s)?n=s:(n=q0(s,t,null,e),t[e.index]=n,_g(t,n)),kI(n,t,e,s),new PI(n,e,t)}let kI=function FI(e,t,n,s){if(e[ea])return;let u;u=8&n.type?hr(s):function vk(e,t){const n=e[kn],s=n.createComment(""),u=Tn(t,e);return Mh(n,Wm(n,u),s,function Zm(e,t){return e.nextSibling(t)}(n,u),!1),s}(t,n),e[ea]=u};class mC{constructor(t){this.queryList=t,this.matches=null}clone(){return new mC(this.queryList)}setDirty(){this.queryList.setDirty()}}class gC{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const s=null!==t.contentQueries?t.contentQueries[0]:n.length,u=[];for(let _=0;_<s;_++){const w=n.getByIndex(_);u.push(this.queries[w.indexInDeclarationView].clone())}return new gC(u)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==HI(t,n).matches&&this.queries[n].setDirty()}}class LI{constructor(t,n,s=null){this.predicate=t,this.flags=n,this.read=s}}class _C{constructor(t=[]){this.queries=t}elementStart(t,n){for(let s=0;s<this.queries.length;s++)this.queries[s].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let s=0;s<this.length;s++){const u=null!==n?n.length:0,_=this.getByIndex(s).embeddedTView(t,u);_&&(_.indexInDeclarationView=s,null!==n?n.push(_):n=[_])}return null!==n?new _C(n):null}template(t,n){for(let s=0;s<this.queries.length;s++)this.queries[s].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class yC{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new yC(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let s=t.parent;for(;null!==s&&8&s.type&&s.index!==n;)s=s.parent;return n===(null!==s?s.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const s=this.metadata.predicate;if(Array.isArray(s))for(let u=0;u<s.length;u++){const _=s[u];this.matchTNodeWithReadOption(t,n,wk(n,_)),this.matchTNodeWithReadOption(t,n,fs(n,t,_,!1,!1))}else s===Md?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,fs(n,t,s,!1,!1))}matchTNodeWithReadOption(t,n,s){if(null!==s){const u=this.metadata.read;if(null!==u)if(u===Yo||u===Eu||u===Md&&4&n.type)this.addMatch(n.index,-2);else{const _=fs(n,t,u,!1,!1);null!==_&&this.addMatch(n.index,_)}else this.addMatch(n.index,s)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function wk(e,t){const n=e.localNames;if(null!==n)for(let s=0;s<n.length;s+=2)if(n[s]===t)return n[s+1];return null}function Tk(e,t,n,s){return-1===n?function Ek(e,t){return 11&e.type?pp(e,t):4&e.type?m1(e,t):null}(t,e):-2===n?function Ck(e,t,n){return n===Yo?pp(t,e):n===Md?m1(t,e):n===Eu?OI(t,e):void 0}(e,t,s):co(e,e[en],n,t)}function NI(e,t,n,s){const u=t[as].queries[s];if(null===u.matches){const _=e.data,w=n.matches,S=[];for(let P=0;P<w.length;P+=2){const z=w[P];S.push(z<0?null:Tk(t,_[z],w[P+1],n.metadata.read))}u.matches=S}return u.matches}function vC(e,t,n,s){const u=e.queries.getByIndex(n),_=u.matches;if(null!==_){const w=NI(e,t,u,n);for(let S=0;S<_.length;S+=2){const P=_[S];if(P>0)s.push(w[S/2]);else{const z=_[S+1],G=t[-P];for(let Y=ao;Y<G.length;Y++){const ye=G[Y];ye[jc]===ye[kr]&&vC(ye[en],ye,z,s)}if(null!==G[Hc]){const Y=G[Hc];for(let ye=0;ye<Y.length;ye++){const xe=Y[ye];vC(xe[en],xe,z,s)}}}}}return s}function zI(e){const t=Mt(),n=bi(),s=Jc();Va(s+1);const u=HI(n,s);if(e.dirty&&function b_(e){return 4==(4&e[ti])}(t)===(2==(2&u.metadata.flags))){if(null===u.matches)e.reset([]);else{const _=u.crossesNgTemplate?vC(n,t,s,[]):NI(n,t,u,s);e.reset(_,rT),e.notifyOnChanges()}return!0}return!1}function BI(e,t,n){const s=bi();s.firstCreatePass&&(function UI(e,t,n){null===e.queries&&(e.queries=new _C),e.queries.track(new yC(t,n))}(s,new LI(e,t,n),-1),2==(2&t)&&(s.staticViewQueries=!0)),function jI(e,t,n){const s=new Ox(4==(4&n));(function xw(e,t,n,s){const u=W0(t);u.push(n),e.firstCreatePass&&Dw(e).push(s,u.length-1)})(e,t,s,s.destroy),null===t[as]&&(t[as]=new gC),t[as].queries.push(new mC(s))}(s,Mt(),t)}function HI(e,t){return e.queries.getByIndex(t)}const Yk=new Ht("Application Initializer");let TC=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,s)=>{this.resolve=n,this.reject=s}),this.appInits=$n(Yk,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const n=[];for(const u of this.appInits){const _=u();if(kg(_))n.push(_);else if(yx(_)){const w=new Promise((S,P)=>{_.subscribe({complete:S,error:P})});n.push(w)}}const s=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{s()}).catch(u=>{this.reject(u)}),0===n.length&&s(),this.initialized=!0}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const Pd=new Ht("LocaleId",{providedIn:"root",factory:()=>$n(Pd,Hn.Optional|Hn.SkipSelf)||function Jk(){return typeof $localize<"u"&&$localize.locale||nn}()});let CC=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new ku(!1)}add(){this.hasPendingTasks.next(!0);const n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const uA=new Ht(""),v1=new Ht("");let MC,IC=(()=>{class e{constructor(n,s,u){this._ngZone=n,this.registry=s,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,MC||(function EF(e){MC=e}(u),u.addToWindow(s)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ti.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(s=>!s.updateCb||!s.updateCb(n)||(clearTimeout(s.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,s,u){let _=-1;s&&s>0&&(_=setTimeout(()=>{this._callbacks=this._callbacks.filter(w=>w.timeoutId!==_),n(this._didWork,this.getPendingTasks())},s)),this._callbacks.push({doneCb:n,timeoutId:_,updateCb:u})}whenStable(n,s,u){if(u&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,s,u),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,s,u){return[]}static{this.\u0275fac=function(s){return new(s||e)(gt(Ti),gt(AC),gt(v1))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})(),AC=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,s){this._applications.set(n,s)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,s=!0){return MC?.findTestabilityInTree(this,n,s)??null}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"platform"})}}return e})(),Np=null;const dA=new Ht("AllowMultipleToken"),PC=new Ht("PlatformDestroyListeners"),hA=new Ht("appBootstrapListener");function mA(e,t,n=[]){const s=`Platform: ${t}`,u=new Ht(s);return(_=[])=>{let w=RC();if(!w||w.injector.get(dA,!1)){const S=[...n,..._,{provide:u,useValue:!0}];e?e(S):function SF(e){if(Np&&!Np.get(dA,!1))throw new bt(400,!1);(function fA(){!function hh(e){Lf=e}(()=>{throw new bt(600,!1)})})(),Np=e;const t=e.get(_A);(function pA(e){e.get(lp,null)?.forEach(n=>n())})(e)}(function gA(e=[],t){return Ko.create({name:t,providers:[{provide:zh,useValue:"platform"},{provide:PC,useValue:new Set([()=>Np=null])},...e]})}(S,s))}return function IF(e){const t=RC();if(!t)throw new bt(401,!1);return t}()}}function RC(){return Np?.get(_A)??null}let _A=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,s){const u=function AF(e="zone.js",t){return"noop"===e?new hT:"zone.js"===e?new Ti(t):e}(s?.ngZone,function yA(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:s?.ngZoneEventCoalescing,runCoalescing:s?.ngZoneRunCoalescing}));return u.run(()=>{const _=function PO(e,t,n){return new dC(e,t,n)}(n.moduleType,this.injector,function EA(e){return[{provide:Ti,useFactory:e},{provide:pc,multi:!0,useFactory:()=>{const t=$n(PF,{optional:!0});return()=>t.initialize()}},{provide:wA,useFactory:MF},{provide:lw,useFactory:cw}]}(()=>u)),w=_.injector.get(wl,null);return u.runOutsideAngular(()=>{const S=u.onError.subscribe({next:P=>{w.handleError(P)}});_.onDestroy(()=>{x1(this._modules,_),S.unsubscribe()})}),function vA(e,t,n){try{const s=n();return kg(s)?s.catch(u=>{throw t.runOutsideAngular(()=>e.handleError(u)),u}):s}catch(s){throw t.runOutsideAngular(()=>e.handleError(s)),s}}(w,u,()=>{const S=_.injector.get(TC);return S.runInitializers(),S.donePromise.then(()=>(function vi(e){Yr(e,"Expected localeId to be defined"),"string"==typeof e&&(pi=e.toLowerCase().replace(/_/g,"-"))}(_.injector.get(Pd,nn)||nn),this._moduleDoBootstrap(_),_))})})}bootstrapModule(n,s=[]){const u=xA({},s);return function TF(e,t,n){const s=new hC(n);return Promise.resolve(s)}(0,0,n).then(_=>this.bootstrapModuleFactory(_,u))}_moduleDoBootstrap(n){const s=n.injector.get(Ug);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(u=>s.bootstrap(u));else{if(!n.instance.ngDoBootstrap)throw new bt(-403,!1);n.instance.ngDoBootstrap(s)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new bt(404,!1);this._modules.slice().forEach(s=>s.destroy()),this._destroyListeners.forEach(s=>s());const n=this._injector.get(PC,null);n&&(n.forEach(s=>s()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static{this.\u0275fac=function(s){return new(s||e)(gt(Ko))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"platform"})}}return e})();function xA(e,t){return Array.isArray(t)?t.reduce(xA,e):{...e,...t}}let Ug=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=$n(wA),this.zoneIsStable=$n(lw),this.componentTypes=[],this.components=[],this.isStable=$n(CC).hasPendingTasks.pipe(zs(n=>n?nl(!1):this.zoneIsStable),Oa(),Xs()),this._injector=$n(Ua)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,s){const u=n instanceof dy;if(!this._injector.get(TC).done)throw!u&&function Vc(e){const t=ei(e)||rn(e)||ss(e);return null!==t&&t.standalone}(n),new bt(405,!1);let w;w=u?n:this._injector.get(fp).resolveComponentFactory(n),this.componentTypes.push(w.componentType);const S=function CF(e){return e.isBoundToModule}(w)?void 0:this._injector.get(jg),z=w.create(Ko.NULL,[],s||w.selector,S),G=z.location.nativeElement,Y=z.injector.get(uA,null);return Y?.registerApplication(G),z.onDestroy(()=>{this.detachView(z.hostView),x1(this.components,z),Y?.unregisterApplication(G)}),this._loadComponent(z),z}tick(){if(this._runningTick)throw new bt(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this.internalErrorHandler(n)}finally{this._runningTick=!1}}attachView(n){const s=n;this._views.push(s),s.attachToAppRef(this)}detachView(n){const s=n;x1(this._views,s),s.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const s=this._injector.get(hA,[]);s.push(...this._bootstrapListeners),s.forEach(u=>u(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>x1(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new bt(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function x1(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const wA=new Ht("",{providedIn:"root",factory:()=>$n(wl).handleError.bind(void 0)});function MF(){const e=$n(Ti),t=$n(wl);return n=>e.runOutsideAngular(()=>t.handleError(n))}let PF=(()=>{class e{constructor(){this.zone=$n(Ti),this.applicationRef=$n(Ug)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const qF=mA(null,"core",[]);let WF=(()=>{class e{constructor(n){}static{this.\u0275fac=function(s){return new(s||e)(gt(Ug))}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({})}}return e})(),BC=null;function zp(){return BC}class sL{}const br=new Ht("DocumentToken");let HA=(()=>{class e{historyGo(n){throw new Error("Not implemented")}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Kt({token:e,factory:function(){return $n(aL)},providedIn:"platform"})}}return e})(),aL=(()=>{class e extends HA{constructor(){super(),this._doc=$n(br),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return zp().getBaseHref(this._doc)}onPopState(n){const s=zp().getGlobalEventTarget(this._doc,"window");return s.addEventListener("popstate",n,!1),()=>s.removeEventListener("popstate",n)}onHashChange(n){const s=zp().getGlobalEventTarget(this._doc,"window");return s.addEventListener("hashchange",n,!1),()=>s.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,s,u){this._history.pushState(n,s,u)}replaceState(n,s,u){this._history.replaceState(n,s,u)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Kt({token:e,factory:function(){return new e},providedIn:"platform"})}}return e})();function GA(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function $A(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Gg(e){return e&&"?"!==e[0]?"?"+e:e}let VC=(()=>{class e{historyGo(n){throw new Error("Not implemented")}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Kt({token:e,factory:function(){return $n(cL)},providedIn:"root"})}}return e})();const lL=new Ht("appBaseHref");let cL=(()=>{class e extends VC{constructor(n,s){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=s??this._platformLocation.getBaseHrefFromDOM()??$n(br).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return GA(this._baseHref,n)}path(n=!1){const s=this._platformLocation.pathname+Gg(this._platformLocation.search),u=this._platformLocation.hash;return u&&n?`${s}${u}`:s}pushState(n,s,u,_){const w=this.prepareExternalUrl(u+Gg(_));this._platformLocation.pushState(n,s,w)}replaceState(n,s,u,_){const w=this.prepareExternalUrl(u+Gg(_));this._platformLocation.replaceState(n,s,w)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}static{this.\u0275fac=function(s){return new(s||e)(gt(HA),gt(lL,8))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),jC=(()=>{class e{constructor(n){this._subject=new fo,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const s=this._locationStrategy.getBaseHref();this._basePath=function hL(e){if(new RegExp("^(https?:)?//").test(e)){const[,n]=e.split(/\/\/[^\/]+/);return n}return e}($A(qA(s))),this._locationStrategy.onPopState(u=>{this._subject.emit({url:this.path(!0),pop:!0,state:u.state,type:u.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,s=""){return this.path()==this.normalize(n+Gg(s))}normalize(n){return e.stripTrailingSlash(function dL(e,t){if(!e||!t.startsWith(e))return t;const n=t.substring(e.length);return""===n||["/",";","?","#"].includes(n[0])?n:t}(this._basePath,qA(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,s="",u=null){this._locationStrategy.pushState(u,"",n,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Gg(s)),u)}replaceState(n,s="",u=null){this._locationStrategy.replaceState(u,"",n,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Gg(s)),u)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(s=>{this._notifyUrlChangeListeners(s.url,s.state)})),()=>{const s=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(s,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",s){this._urlChangeListeners.forEach(u=>u(n,s))}subscribe(n,s,u){return this._subject.subscribe({next:n,error:s,complete:u})}static{this.normalizeQueryParams=Gg}static{this.joinWithSlash=GA}static{this.stripTrailingSlash=$A}static{this.\u0275fac=function(s){return new(s||e)(gt(VC))}}static{this.\u0275prov=Kt({token:e,factory:function(){return function uL(){return new jC(gt(VC))}()},providedIn:"root"})}}return e})();function qA(e){return e.replace(/\/index.html$/,"")}function tM(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const s=n.indexOf("="),[u,_]=-1==s?[n,""]:[n.slice(0,s),n.slice(s+1)];if(u.trim()===t)return decodeURIComponent(_)}return null}let oM=(()=>{class e{constructor(n,s){this._viewContainer=n,this._context=new eN,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=s}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){sM("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){sM("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,s){return!0}static{this.\u0275fac=function(s){return new(s||e)(Tt(Eu),Tt(Md))}}static{this.\u0275dir=Cn({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0})}}return e})();class eN{constructor(){this.$implicit=null,this.ngIf=null}}function sM(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${ur(t)}'.`)}let CN=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({})}}return e})();const cM="browser";function uM(e){return"server"===e}class dM{}class QN extends sL{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class rS extends QN{static makeCurrent(){!function oL(e){BC||(BC=e)}(new rS)}onAndCancel(t,n,s){return t.addEventListener(n,s),()=>{t.removeEventListener(n,s)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function ez(){return Vx=Vx||document.querySelector("base"),Vx?Vx.getAttribute("href"):null}();return null==n?null:function tz(e){N1=N1||document.createElement("a"),N1.setAttribute("href",e);const t=N1.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){Vx=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return tM(document.cookie,t)}}let N1,Vx=null,iz=(()=>{class e{build(){return new XMLHttpRequest}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})();const oS=new Ht("EventManagerPlugins");let gM=(()=>{class e{constructor(n,s){this._zone=s,this._eventNameToPlugin=new Map,n.forEach(u=>{u.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,s,u){return this._findPluginFor(s).addEventListener(n,s,u)}getZone(){return this._zone}_findPluginFor(n){let s=this._eventNameToPlugin.get(n);if(s)return s;if(s=this._plugins.find(_=>_.supports(n)),!s)throw new bt(5101,!1);return this._eventNameToPlugin.set(n,s),s}static{this.\u0275fac=function(s){return new(s||e)(gt(oS),gt(Ti))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})();class _M{constructor(t){this._doc=t}}const sS="ng-app-id";let yM=(()=>{class e{constructor(n,s,u,_={}){this.doc=n,this.appId=s,this.nonce=u,this.platformId=_,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=uM(_),this.resetHostNodes()}addStyles(n){for(const s of n)1===this.changeUsageCount(s,1)&&this.onStyleAdded(s)}removeStyles(n){for(const s of n)this.changeUsageCount(s,-1)<=0&&this.onStyleRemoved(s)}ngOnDestroy(){const n=this.styleNodesInDOM;n&&(n.forEach(s=>s.remove()),n.clear());for(const s of this.getAllStyles())this.onStyleRemoved(s);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const s of this.getAllStyles())this.addStyleToHost(n,s)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(const s of this.hostNodes)this.addStyleToHost(s,n)}onStyleRemoved(n){const s=this.styleRef;s.get(n)?.elements?.forEach(u=>u.remove()),s.delete(n)}collectServerRenderedStyles(){const n=this.doc.head?.querySelectorAll(`style[${sS}="${this.appId}"]`);if(n?.length){const s=new Map;return n.forEach(u=>{null!=u.textContent&&s.set(u.textContent,u)}),s}return null}changeUsageCount(n,s){const u=this.styleRef;if(u.has(n)){const _=u.get(n);return _.usage+=s,_.usage}return u.set(n,{usage:s,elements:[]}),s}getStyleElement(n,s){const u=this.styleNodesInDOM,_=u?.get(s);if(_?.parentNode===n)return u.delete(s),_.removeAttribute(sS),_;{const w=this.doc.createElement("style");return this.nonce&&w.setAttribute("nonce",this.nonce),w.textContent=s,this.platformIsServer&&w.setAttribute(sS,this.appId),w}}addStyleToHost(n,s){const u=this.getStyleElement(n,s);n.appendChild(u);const _=this.styleRef,w=_.get(s)?.elements;w?w.push(u):_.set(s,{elements:[u],usage:1})}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}static{this.\u0275fac=function(s){return new(s||e)(gt(br),gt(jh),gt(cp,8),gt(hu))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})();const aS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},lS=/%COMP%/g,az=new Ht("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function xM(e,t){return t.map(n=>n.replace(lS,e))}let cS=(()=>{class e{constructor(n,s,u,_,w,S,P,z=null){this.eventManager=n,this.sharedStylesHost=s,this.appId=u,this.removeStylesOnCompDestroy=_,this.doc=w,this.platformId=S,this.ngZone=P,this.nonce=z,this.rendererByCompId=new Map,this.platformIsServer=uM(S),this.defaultRenderer=new uS(n,w,P,this.platformIsServer)}createRenderer(n,s){if(!n||!s)return this.defaultRenderer;this.platformIsServer&&s.encapsulation===$o.ShadowDom&&(s={...s,encapsulation:$o.Emulated});const u=this.getOrCreateRenderer(n,s);return u instanceof wM?u.applyToHost(n):u instanceof dS&&u.applyStyles(),u}getOrCreateRenderer(n,s){const u=this.rendererByCompId;let _=u.get(s.id);if(!_){const w=this.doc,S=this.ngZone,P=this.eventManager,z=this.sharedStylesHost,G=this.removeStylesOnCompDestroy,Y=this.platformIsServer;switch(s.encapsulation){case $o.Emulated:_=new wM(P,z,s,this.appId,G,w,S,Y);break;case $o.ShadowDom:return new dz(P,z,n,s,w,S,this.nonce,Y);default:_=new dS(P,z,s,G,w,S,Y)}u.set(s.id,_)}return _}ngOnDestroy(){this.rendererByCompId.clear()}static{this.\u0275fac=function(s){return new(s||e)(gt(gM),gt(yM),gt(jh),gt(az),gt(br),gt(hu),gt(Ti),gt(cp))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})();class uS{constructor(t,n,s,u){this.eventManager=t,this.doc=n,this.ngZone=s,this.platformIsServer=u,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?this.doc.createElementNS(aS[n]||n,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,n){(bM(t)?t.content:t).appendChild(n)}insertBefore(t,n,s){t&&(bM(t)?t.content:t).insertBefore(n,s)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let s="string"==typeof t?this.doc.querySelector(t):t;if(!s)throw new bt(-5104,!1);return n||(s.textContent=""),s}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,s,u){if(u){n=u+":"+n;const _=aS[u];_?t.setAttributeNS(_,n,s):t.setAttribute(n,s)}else t.setAttribute(n,s)}removeAttribute(t,n,s){if(s){const u=aS[s];u?t.removeAttributeNS(u,n):t.removeAttribute(`${s}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,s,u){u&(xl.DashCase|xl.Important)?t.style.setProperty(n,s,u&xl.Important?"important":""):t.style[n]=s}removeStyle(t,n,s){s&xl.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,s){t[n]=s}setValue(t,n){t.nodeValue=n}listen(t,n,s){if("string"==typeof t&&!(t=zp().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${n}`);return this.eventManager.addEventListener(t,n,this.decoratePreventDefault(s))}decoratePreventDefault(t){return n=>{if("__ngUnwrap__"===n)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(n)):t(n))&&n.preventDefault()}}}function bM(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class dz extends uS{constructor(t,n,s,u,_,w,S,P){super(t,_,w,P),this.sharedStylesHost=n,this.hostEl=s,this.shadowRoot=s.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const z=xM(u.id,u.styles);for(const G of z){const Y=document.createElement("style");S&&Y.setAttribute("nonce",S),Y.textContent=G,this.shadowRoot.appendChild(Y)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,s){return super.insertBefore(this.nodeOrShadowRoot(t),n,s)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class dS extends uS{constructor(t,n,s,u,_,w,S,P){super(t,_,w,S),this.sharedStylesHost=n,this.removeStylesOnCompDestroy=u,this.styles=P?xM(P,s.styles):s.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class wM extends dS{constructor(t,n,s,u,_,w,S,P){const z=u+"-"+s.id;super(t,n,s,_,w,S,P,z),this.contentAttr=function lz(e){return"_ngcontent-%COMP%".replace(lS,e)}(z),this.hostAttr=function cz(e){return"_nghost-%COMP%".replace(lS,e)}(z)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,n){const s=super.createElement(t,n);return super.setAttribute(s,this.contentAttr,""),s}}let hz=(()=>{class e extends _M{constructor(n){super(n)}supports(n){return!0}addEventListener(n,s,u){return n.addEventListener(s,u,!1),()=>this.removeEventListener(n,s,u)}removeEventListener(n,s,u){return n.removeEventListener(s,u)}static{this.\u0275fac=function(s){return new(s||e)(gt(br))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})();const EM=["alt","control","meta","shift"],fz={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},pz={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let mz=(()=>{class e extends _M{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,s,u){const _=e.parseEventName(s),w=e.eventCallback(_.fullKey,u,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>zp().onAndCancel(n,_.domEventName,w))}static parseEventName(n){const s=n.toLowerCase().split("."),u=s.shift();if(0===s.length||"keydown"!==u&&"keyup"!==u)return null;const _=e._normalizeKey(s.pop());let w="",S=s.indexOf("code");if(S>-1&&(s.splice(S,1),w="code."),EM.forEach(z=>{const G=s.indexOf(z);G>-1&&(s.splice(G,1),w+=z+".")}),w+=_,0!=s.length||0===_.length)return null;const P={};return P.domEventName=u,P.fullKey=w,P}static matchEventFullKeyCode(n,s){let u=fz[n.key]||n.key,_="";return s.indexOf("code.")>-1&&(u=n.code,_="code."),!(null==u||!u)&&(u=u.toLowerCase()," "===u?u="space":"."===u&&(u="dot"),EM.forEach(w=>{w!==u&&(0,pz[w])(n)&&(_+=w+".")}),_+=u,_===s)}static eventCallback(n,s,u){return _=>{e.matchEventFullKeyCode(_,n)&&u.runGuarded(()=>s(_))}}static _normalizeKey(n){return"esc"===n?"escape":n}static{this.\u0275fac=function(s){return new(s||e)(gt(br))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})();const vz=mA(qF,"browser",[{provide:hu,useValue:cM},{provide:lp,useValue:function gz(){rS.makeCurrent()},multi:!0},{provide:br,useFactory:function yz(){return function n0(e){H_=e}(document),document},deps:[]}]),xz=new Ht(""),SM=[{provide:v1,useClass:class nz{addToWindow(t){yi.getAngularTestability=(s,u=!0)=>{const _=t.findTestabilityInTree(s,u);if(null==_)throw new bt(5103,!1);return _},yi.getAllAngularTestabilities=()=>t.getAllTestabilities(),yi.getAllAngularRootElements=()=>t.getAllRootElements(),yi.frameworkStabilizers||(yi.frameworkStabilizers=[]),yi.frameworkStabilizers.push(s=>{const u=yi.getAllAngularTestabilities();let _=u.length,w=!1;const S=function(P){w=w||P,_--,0==_&&s(w)};u.forEach(P=>{P.whenStable(S)})})}findTestabilityInTree(t,n,s){return null==n?null:t.getTestability(n)??(s?zp().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:uA,useClass:IC,deps:[Ti,AC,v1]},{provide:IC,useClass:IC,deps:[Ti,AC,v1]}],DM=[{provide:zh,useValue:"root"},{provide:wl,useFactory:function _z(){return new wl},deps:[]},{provide:oS,useClass:hz,multi:!0,deps:[br,Ti,hu]},{provide:oS,useClass:mz,multi:!0,deps:[br]},cS,yM,gM,{provide:mp,useExisting:cS},{provide:dM,useClass:iz,deps:[]},[]];let IM=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:jh,useValue:n.appId}]}}static{this.\u0275fac=function(s){return new(s||e)(gt(xz,12))}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({providers:[...DM,...SM],imports:[CN,WF]})}}return e})();typeof window<"u"&&window;class RM{}class Dz{}const lf="*";function FM(e,t=null){return{type:2,steps:e,options:t}}function cv(e){return{type:6,styles:e,offset:null}}class jx{constructor(t=0,n=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=t+n}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){const n="start"==t?this._onStartFns:this._onDoneFns;n.forEach(s=>s()),n.length=0}}class VM{constructor(t){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;let n=0,s=0,u=0;const _=this.players.length;0==_?queueMicrotask(()=>this._onFinish()):this.players.forEach(w=>{w.onDone(()=>{++n==_&&this._onFinish()}),w.onDestroy(()=>{++s==_&&this._onDestroy()}),w.onStart(()=>{++u==_&&this._onStart()})}),this.totalTime=this.players.reduce((w,S)=>Math.max(w,S.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){const n=t*this.totalTime;this.players.forEach(s=>{const u=s.totalTime?Math.min(1,n/s.totalTime):1;s.setPosition(u)})}getPosition(){const t=this.players.reduce((n,s)=>null===n||s.totalTime>n.totalTime?s:n,null);return null!=t?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){const n="start"==t?this._onStartFns:this._onDoneFns;n.forEach(s=>s()),n.length=0}}function jM(e){return new bt(3e3,!1)}function Vp(e){switch(e.length){case 0:return new jx;case 1:return e[0];default:return new VM(e)}}function UM(e,t,n=new Map,s=new Map){const u=[],_=[];let w=-1,S=null;if(t.forEach(P=>{const z=P.get("offset"),G=z==w,Y=G&&S||new Map;P.forEach((ye,xe)=>{let Oe=xe,ze=ye;if("offset"!==xe)switch(Oe=e.normalizePropertyName(Oe,u),ze){case"!":ze=n.get(xe);break;case lf:ze=s.get(xe);break;default:ze=e.normalizeStyleValue(xe,Oe,ze,u)}Y.set(Oe,ze)}),G||_.push(Y),S=Y,w=z}),u.length)throw function Kz(e){return new bt(3502,!1)}();return _}function pS(e,t,n,s){switch(t){case"start":e.onStart(()=>s(n&&mS(n,"start",e)));break;case"done":e.onDone(()=>s(n&&mS(n,"done",e)));break;case"destroy":e.onDestroy(()=>s(n&&mS(n,"destroy",e)))}}function mS(e,t,n){const _=gS(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,n.totalTime??e.totalTime,!!n.disabled),w=e._data;return null!=w&&(_._data=w),_}function gS(e,t,n,s,u="",_=0,w){return{element:e,triggerName:t,fromState:n,toState:s,phaseName:u,totalTime:_,disabled:!!w}}function Ol(e,t,n){let s=e.get(t);return s||e.set(t,s=n),s}function HM(e){const t=e.indexOf(":");return[e.substring(1,t),e.slice(t+1)]}const cB=(()=>typeof document>"u"?null:document.documentElement)();function _S(e){const t=e.parentNode||e.host||null;return t===cB?null:t}let $g=null,GM=!1;function $M(e,t){for(;t;){if(t===e)return!0;t=_S(t)}return!1}function qM(e,t,n){if(n)return Array.from(e.querySelectorAll(t));const s=e.querySelector(t);return s?[s]:[]}let WM=(()=>{class e{validateStyleProperty(n){return function dB(e){$g||($g=function hB(){return typeof document<"u"?document.body:null}()||{},GM=!!$g.style&&"WebkitAppearance"in $g.style);let t=!0;return $g.style&&!function uB(e){return"ebkit"==e.substring(1,6)}(e)&&(t=e in $g.style,!t&&GM&&(t="Webkit"+e.charAt(0).toUpperCase()+e.slice(1)in $g.style)),t}(n)}matchesElement(n,s){return!1}containsElement(n,s){return $M(n,s)}getParentElement(n){return _S(n)}query(n,s,u){return qM(n,s,u)}computeStyle(n,s,u){return u||""}animate(n,s,u,_,w,S=[],P){return new jx(u,_)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})(),yS=(()=>{class e{static{this.NOOP=new WM}}return e})();const fB=1e3,vS="ng-enter",z1="ng-leave",B1="ng-trigger",V1=".ng-trigger",XM="ng-animating",xS=".ng-animating";function cf(e){if("number"==typeof e)return e;const t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:bS(parseFloat(t[1]),t[2])}function bS(e,t){return"s"===t?e*fB:e}function j1(e,t,n){return e.hasOwnProperty("duration")?e:function mB(e,t,n){let u,_=0,w="";if("string"==typeof e){const S=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===S)return t.push(jM()),{duration:0,delay:0,easing:""};u=bS(parseFloat(S[1]),S[2]);const P=S[3];null!=P&&(_=bS(parseFloat(P),S[4]));const z=S[5];z&&(w=z)}else u=e;if(!n){let S=!1,P=t.length;u<0&&(t.push(function Az(){return new bt(3100,!1)}()),S=!0),_<0&&(t.push(function Mz(){return new bt(3101,!1)}()),S=!0),S&&t.splice(P,0,jM())}return{duration:u,delay:_,easing:w}}(e,t,n)}function Ux(e,t={}){return Object.keys(e).forEach(n=>{t[n]=e[n]}),t}function YM(e){const t=new Map;return Object.keys(e).forEach(n=>{t.set(n,e[n])}),t}function jp(e,t=new Map,n){if(n)for(let[s,u]of n)t.set(s,u);for(let[s,u]of e)t.set(s,u);return t}function Rd(e,t,n){t.forEach((s,u)=>{const _=ES(u);n&&!n.has(u)&&n.set(u,e.style[_]),e.style[_]=s})}function qg(e,t){t.forEach((n,s)=>{const u=ES(s);e.style[u]=""})}function Hx(e){return Array.isArray(e)?1==e.length?e[0]:FM(e):e}const wS=new RegExp("{{\\s*(.+?)\\s*}}","g");function JM(e){let t=[];if("string"==typeof e){let n;for(;n=wS.exec(e);)t.push(n[1]);wS.lastIndex=0}return t}function Gx(e,t,n){const s=e.toString(),u=s.replace(wS,(_,w)=>{let S=t[w];return null==S&&(n.push(function Rz(e){return new bt(3003,!1)}()),S=""),S.toString()});return u==s?e:u}function U1(e){const t=[];let n=e.next();for(;!n.done;)t.push(n.value),n=e.next();return t}const yB=/-+([a-z0-9])/g;function ES(e){return e.replace(yB,(...t)=>t[1].toUpperCase())}function kl(e,t,n){switch(t.type){case 7:return e.visitTrigger(t,n);case 0:return e.visitState(t,n);case 1:return e.visitTransition(t,n);case 2:return e.visitSequence(t,n);case 3:return e.visitGroup(t,n);case 4:return e.visitAnimate(t,n);case 5:return e.visitKeyframes(t,n);case 6:return e.visitStyle(t,n);case 8:return e.visitReference(t,n);case 9:return e.visitAnimateChild(t,n);case 10:return e.visitAnimateRef(t,n);case 11:return e.visitQuery(t,n);case 12:return e.visitStagger(t,n);default:throw function Oz(e){return new bt(3004,!1)}()}}function QM(e,t){return window.getComputedStyle(e)[t]}const H1="*";function bB(e,t){const n=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(s=>function wB(e,t,n){if(":"==e[0]){const P=function EB(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(n,s)=>parseFloat(s)>parseFloat(n);case":decrement":return(n,s)=>parseFloat(s)<parseFloat(n);default:return t.push(function Wz(e){return new bt(3016,!1)}()),"* => *"}}(e,n);if("function"==typeof P)return void t.push(P);e=P}const s=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==s||s.length<4)return n.push(function qz(e){return new bt(3015,!1)}()),t;const u=s[1],_=s[2],w=s[3];t.push(e2(u,w));"<"==_[0]&&!(u==H1&&w==H1)&&t.push(e2(w,u))}(s,n,t)):n.push(e),n}const G1=new Set(["true","1"]),$1=new Set(["false","0"]);function e2(e,t){const n=G1.has(e)||$1.has(e),s=G1.has(t)||$1.has(t);return(u,_)=>{let w=e==H1||e==u,S=t==H1||t==_;return!w&&n&&"boolean"==typeof u&&(w=u?G1.has(e):$1.has(e)),!S&&s&&"boolean"==typeof _&&(S=_?G1.has(t):$1.has(t)),w&&S}}const TB=new RegExp("s*:selfs*,?","g");function TS(e,t,n,s){return new CB(e).build(t,n,s)}class CB{constructor(t){this._driver=t}build(t,n,s){const u=new IB(n);return this._resetContextStyleTimingState(u),kl(this,Hx(t),u)}_resetContextStyleTimingState(t){t.currentQuerySelector="",t.collectedStyles=new Map,t.collectedStyles.set("",new Map),t.currentTime=0}visitTrigger(t,n){let s=n.queryCount=0,u=n.depCount=0;const _=[],w=[];return"@"==t.name.charAt(0)&&n.errors.push(function Fz(){return new bt(3006,!1)}()),t.definitions.forEach(S=>{if(this._resetContextStyleTimingState(n),0==S.type){const P=S,z=P.name;z.toString().split(/\s*,\s*/).forEach(G=>{P.name=G,_.push(this.visitState(P,n))}),P.name=z}else if(1==S.type){const P=this.visitTransition(S,n);s+=P.queryCount,u+=P.depCount,w.push(P)}else n.errors.push(function Lz(){return new bt(3007,!1)}())}),{type:7,name:t.name,states:_,transitions:w,queryCount:s,depCount:u,options:null}}visitState(t,n){const s=this.visitStyle(t.styles,n),u=t.options&&t.options.params||null;if(s.containsDynamicStyles){const _=new Set,w=u||{};s.styles.forEach(S=>{S instanceof Map&&S.forEach(P=>{JM(P).forEach(z=>{w.hasOwnProperty(z)||_.add(z)})})}),_.size&&(U1(_.values()),n.errors.push(function Nz(e,t){return new bt(3008,!1)}()))}return{type:0,name:t.name,style:s,options:u?{params:u}:null}}visitTransition(t,n){n.queryCount=0,n.depCount=0;const s=kl(this,Hx(t.animation),n);return{type:1,matchers:bB(t.expr,n.errors),animation:s,queryCount:n.queryCount,depCount:n.depCount,options:Wg(t.options)}}visitSequence(t,n){return{type:2,steps:t.steps.map(s=>kl(this,s,n)),options:Wg(t.options)}}visitGroup(t,n){const s=n.currentTime;let u=0;const _=t.steps.map(w=>{n.currentTime=s;const S=kl(this,w,n);return u=Math.max(u,n.currentTime),S});return n.currentTime=u,{type:3,steps:_,options:Wg(t.options)}}visitAnimate(t,n){const s=function MB(e,t){if(e.hasOwnProperty("duration"))return e;if("number"==typeof e)return CS(j1(e,t).duration,0,"");const n=e;if(n.split(/\s+/).some(_=>"{"==_.charAt(0)&&"{"==_.charAt(1))){const _=CS(0,0,"");return _.dynamic=!0,_.strValue=n,_}const u=j1(n,t);return CS(u.duration,u.delay,u.easing)}(t.timings,n.errors);n.currentAnimateTimings=s;let u,_=t.styles?t.styles:cv({});if(5==_.type)u=this.visitKeyframes(_,n);else{let w=t.styles,S=!1;if(!w){S=!0;const z={};s.easing&&(z.easing=s.easing),w=cv(z)}n.currentTime+=s.duration+s.delay;const P=this.visitStyle(w,n);P.isEmptyStep=S,u=P}return n.currentAnimateTimings=null,{type:4,timings:s,style:u,options:null}}visitStyle(t,n){const s=this._makeStyleAst(t,n);return this._validateStyleAst(s,n),s}_makeStyleAst(t,n){const s=[],u=Array.isArray(t.styles)?t.styles:[t.styles];for(let S of u)"string"==typeof S?S===lf?s.push(S):n.errors.push(new bt(3002,!1)):s.push(YM(S));let _=!1,w=null;return s.forEach(S=>{if(S instanceof Map&&(S.has("easing")&&(w=S.get("easing"),S.delete("easing")),!_))for(let P of S.values())if(P.toString().indexOf("{{")>=0){_=!0;break}}),{type:6,styles:s,easing:w,offset:t.offset,containsDynamicStyles:_,options:null}}_validateStyleAst(t,n){const s=n.currentAnimateTimings;let u=n.currentTime,_=n.currentTime;s&&_>0&&(_-=s.duration+s.delay),t.styles.forEach(w=>{"string"!=typeof w&&w.forEach((S,P)=>{const z=n.collectedStyles.get(n.currentQuerySelector),G=z.get(P);let Y=!0;G&&(_!=u&&_>=G.startTime&&u<=G.endTime&&(n.errors.push(function Bz(e,t,n,s,u){return new bt(3010,!1)}()),Y=!1),_=G.startTime),Y&&z.set(P,{startTime:_,endTime:u}),n.options&&function _B(e,t,n){const s=t.params||{},u=JM(e);u.length&&u.forEach(_=>{s.hasOwnProperty(_)||n.push(function Pz(e){return new bt(3001,!1)}())})}(S,n.options,n.errors)})})}visitKeyframes(t,n){const s={type:5,styles:[],options:null};if(!n.currentAnimateTimings)return n.errors.push(function Vz(){return new bt(3011,!1)}()),s;let _=0;const w=[];let S=!1,P=!1,z=0;const G=t.steps.map(Ct=>{const ut=this._makeStyleAst(Ct,n);let qt=null!=ut.offset?ut.offset:function AB(e){if("string"==typeof e)return null;let t=null;if(Array.isArray(e))e.forEach(n=>{if(n instanceof Map&&n.has("offset")){const s=n;t=parseFloat(s.get("offset")),s.delete("offset")}});else if(e instanceof Map&&e.has("offset")){const n=e;t=parseFloat(n.get("offset")),n.delete("offset")}return t}(ut.styles),sn=0;return null!=qt&&(_++,sn=ut.offset=qt),P=P||sn<0||sn>1,S=S||sn<z,z=sn,w.push(sn),ut});P&&n.errors.push(function jz(){return new bt(3012,!1)}()),S&&n.errors.push(function Uz(){return new bt(3200,!1)}());const Y=t.steps.length;let ye=0;_>0&&_<Y?n.errors.push(function Hz(){return new bt(3202,!1)}()):0==_&&(ye=1/(Y-1));const xe=Y-1,Oe=n.currentTime,ze=n.currentAnimateTimings,lt=ze.duration;return G.forEach((Ct,ut)=>{const qt=ye>0?ut==xe?1:ye*ut:w[ut],sn=qt*lt;n.currentTime=Oe+ze.delay+sn,ze.duration=sn,this._validateStyleAst(Ct,n),Ct.offset=qt,s.styles.push(Ct)}),s}visitReference(t,n){return{type:8,animation:kl(this,Hx(t.animation),n),options:Wg(t.options)}}visitAnimateChild(t,n){return n.depCount++,{type:9,options:Wg(t.options)}}visitAnimateRef(t,n){return{type:10,animation:this.visitReference(t.animation,n),options:Wg(t.options)}}visitQuery(t,n){const s=n.currentQuerySelector,u=t.options||{};n.queryCount++,n.currentQuery=t;const[_,w]=function SB(e){const t=!!e.split(/\s*,\s*/).find(n=>":self"==n);return t&&(e=e.replace(TB,"")),e=e.replace(/@\*/g,V1).replace(/@\w+/g,n=>V1+"-"+n.slice(1)).replace(/:animating/g,xS),[e,t]}(t.selector);n.currentQuerySelector=s.length?s+" "+_:_,Ol(n.collectedStyles,n.currentQuerySelector,new Map);const S=kl(this,Hx(t.animation),n);return n.currentQuery=null,n.currentQuerySelector=s,{type:11,selector:_,limit:u.limit||0,optional:!!u.optional,includeSelf:w,animation:S,originalSelector:t.selector,options:Wg(t.options)}}visitStagger(t,n){n.currentQuery||n.errors.push(function Gz(){return new bt(3013,!1)}());const s="full"===t.timings?{duration:0,delay:0,easing:"full"}:j1(t.timings,n.errors,!0);return{type:12,animation:kl(this,Hx(t.animation),n),timings:s,options:null}}}class IB{constructor(t){this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Wg(e){return e?(e=Ux(e)).params&&(e.params=function DB(e){return e?Ux(e):null}(e.params)):e={},e}function CS(e,t,n){return{duration:e,delay:t,easing:n}}function SS(e,t,n,s,u,_,w=null,S=!1){return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:s,duration:u,delay:_,totalTime:u+_,easing:w,subTimeline:S}}class q1{constructor(){this._map=new Map}get(t){return this._map.get(t)||[]}append(t,n){let s=this._map.get(t);s||this._map.set(t,s=[]),s.push(...n)}has(t){return this._map.has(t)}clear(){this._map.clear()}}const OB=new RegExp(":enter","g"),FB=new RegExp(":leave","g");function DS(e,t,n,s,u,_=new Map,w=new Map,S,P,z=[]){return(new LB).buildKeyframes(e,t,n,s,u,_,w,S,P,z)}class LB{buildKeyframes(t,n,s,u,_,w,S,P,z,G=[]){z=z||new q1;const Y=new IS(t,n,z,u,_,G,[]);Y.options=P;const ye=P.delay?cf(P.delay):0;Y.currentTimeline.delayNextStep(ye),Y.currentTimeline.setStyles([w],null,Y.errors,P),kl(this,s,Y);const xe=Y.timelines.filter(Oe=>Oe.containsAnimation());if(xe.length&&S.size){let Oe;for(let ze=xe.length-1;ze>=0;ze--){const lt=xe[ze];if(lt.element===n){Oe=lt;break}}Oe&&!Oe.allowOnlyTimelineStyles()&&Oe.setStyles([S],null,Y.errors,P)}return xe.length?xe.map(Oe=>Oe.buildKeyframes()):[SS(n,[],[],[],0,ye,"",!1)]}visitTrigger(t,n){}visitState(t,n){}visitTransition(t,n){}visitAnimateChild(t,n){const s=n.subInstructions.get(n.element);if(s){const u=n.createSubContext(t.options),_=n.currentTimeline.currentTime,w=this._visitSubInstructions(s,u,u.options);_!=w&&n.transformIntoNewTimeline(w)}n.previousNode=t}visitAnimateRef(t,n){const s=n.createSubContext(t.options);s.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],n,s),this.visitReference(t.animation,s),n.transformIntoNewTimeline(s.currentTimeline.currentTime),n.previousNode=t}_applyAnimationRefDelays(t,n,s){for(const u of t){const _=u?.delay;if(_){const w="number"==typeof _?_:cf(Gx(_,u?.params??{},n.errors));s.delayNextStep(w)}}}_visitSubInstructions(t,n,s){let _=n.currentTimeline.currentTime;const w=null!=s.duration?cf(s.duration):null,S=null!=s.delay?cf(s.delay):null;return 0!==w&&t.forEach(P=>{const z=n.appendInstructionToTimeline(P,w,S);_=Math.max(_,z.duration+z.delay)}),_}visitReference(t,n){n.updateOptions(t.options,!0),kl(this,t.animation,n),n.previousNode=t}visitSequence(t,n){const s=n.subContextCount;let u=n;const _=t.options;if(_&&(_.params||_.delay)&&(u=n.createSubContext(_),u.transformIntoNewTimeline(),null!=_.delay)){6==u.previousNode.type&&(u.currentTimeline.snapshotCurrentStyles(),u.previousNode=W1);const w=cf(_.delay);u.delayNextStep(w)}t.steps.length&&(t.steps.forEach(w=>kl(this,w,u)),u.currentTimeline.applyStylesToKeyframe(),u.subContextCount>s&&u.transformIntoNewTimeline()),n.previousNode=t}visitGroup(t,n){const s=[];let u=n.currentTimeline.currentTime;const _=t.options&&t.options.delay?cf(t.options.delay):0;t.steps.forEach(w=>{const S=n.createSubContext(t.options);_&&S.delayNextStep(_),kl(this,w,S),u=Math.max(u,S.currentTimeline.currentTime),s.push(S.currentTimeline)}),s.forEach(w=>n.currentTimeline.mergeTimelineCollectedStyles(w)),n.transformIntoNewTimeline(u),n.previousNode=t}_visitTiming(t,n){if(t.dynamic){const s=t.strValue;return j1(n.params?Gx(s,n.params,n.errors):s,n.errors)}return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,n){const s=n.currentAnimateTimings=this._visitTiming(t.timings,n),u=n.currentTimeline;s.delay&&(n.incrementTime(s.delay),u.snapshotCurrentStyles());const _=t.style;5==_.type?this.visitKeyframes(_,n):(n.incrementTime(s.duration),this.visitStyle(_,n),u.applyStylesToKeyframe()),n.currentAnimateTimings=null,n.previousNode=t}visitStyle(t,n){const s=n.currentTimeline,u=n.currentAnimateTimings;!u&&s.hasCurrentStyleProperties()&&s.forwardFrame();const _=u&&u.easing||t.easing;t.isEmptyStep?s.applyEmptyStep(_):s.setStyles(t.styles,_,n.errors,n.options),n.previousNode=t}visitKeyframes(t,n){const s=n.currentAnimateTimings,u=n.currentTimeline.duration,_=s.duration,S=n.createSubContext().currentTimeline;S.easing=s.easing,t.styles.forEach(P=>{S.forwardTime((P.offset||0)*_),S.setStyles(P.styles,P.easing,n.errors,n.options),S.applyStylesToKeyframe()}),n.currentTimeline.mergeTimelineCollectedStyles(S),n.transformIntoNewTimeline(u+_),n.previousNode=t}visitQuery(t,n){const s=n.currentTimeline.currentTime,u=t.options||{},_=u.delay?cf(u.delay):0;_&&(6===n.previousNode.type||0==s&&n.currentTimeline.hasCurrentStyleProperties())&&(n.currentTimeline.snapshotCurrentStyles(),n.previousNode=W1);let w=s;const S=n.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!u.optional,n.errors);n.currentQueryTotal=S.length;let P=null;S.forEach((z,G)=>{n.currentQueryIndex=G;const Y=n.createSubContext(t.options,z);_&&Y.delayNextStep(_),z===n.element&&(P=Y.currentTimeline),kl(this,t.animation,Y),Y.currentTimeline.applyStylesToKeyframe(),w=Math.max(w,Y.currentTimeline.currentTime)}),n.currentQueryIndex=0,n.currentQueryTotal=0,n.transformIntoNewTimeline(w),P&&(n.currentTimeline.mergeTimelineCollectedStyles(P),n.currentTimeline.snapshotCurrentStyles()),n.previousNode=t}visitStagger(t,n){const s=n.parentContext,u=n.currentTimeline,_=t.timings,w=Math.abs(_.duration),S=w*(n.currentQueryTotal-1);let P=w*n.currentQueryIndex;switch(_.duration<0?"reverse":_.easing){case"reverse":P=S-P;break;case"full":P=s.currentStaggerTime}const G=n.currentTimeline;P&&G.delayNextStep(P);const Y=G.currentTime;kl(this,t.animation,n),n.previousNode=t,s.currentStaggerTime=u.currentTime-Y+(u.startTime-s.currentTimeline.startTime)}}const W1={};class IS{constructor(t,n,s,u,_,w,S,P){this._driver=t,this.element=n,this.subInstructions=s,this._enterClassName=u,this._leaveClassName=_,this.errors=w,this.timelines=S,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=W1,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=P||new Z1(this._driver,n,0),S.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,n){if(!t)return;const s=t;let u=this.options;null!=s.duration&&(u.duration=cf(s.duration)),null!=s.delay&&(u.delay=cf(s.delay));const _=s.params;if(_){let w=u.params;w||(w=this.options.params={}),Object.keys(_).forEach(S=>{(!n||!w.hasOwnProperty(S))&&(w[S]=Gx(_[S],w,this.errors))})}}_copyOptions(){const t={};if(this.options){const n=this.options.params;if(n){const s=t.params={};Object.keys(n).forEach(u=>{s[u]=n[u]})}}return t}createSubContext(t=null,n,s){const u=n||this.element,_=new IS(this._driver,u,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(u,s||0));return _.previousNode=this.previousNode,_.currentAnimateTimings=this.currentAnimateTimings,_.options=this._copyOptions(),_.updateOptions(t),_.currentQueryIndex=this.currentQueryIndex,_.currentQueryTotal=this.currentQueryTotal,_.parentContext=this,this.subContextCount++,_}transformIntoNewTimeline(t){return this.previousNode=W1,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,n,s){const u={duration:n??t.duration,delay:this.currentTimeline.currentTime+(s??0)+t.delay,easing:""},_=new NB(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,u,t.stretchStartingKeyframe);return this.timelines.push(_),u}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,n,s,u,_,w){let S=[];if(u&&S.push(this.element),t.length>0){t=(t=t.replace(OB,"."+this._enterClassName)).replace(FB,"."+this._leaveClassName);let z=this._driver.query(this.element,t,1!=s);0!==s&&(z=s<0?z.slice(z.length+s,z.length):z.slice(0,s)),S.push(...z)}return!_&&0==S.length&&w.push(function $z(e){return new bt(3014,!1)}()),S}}class Z1{constructor(t,n,s,u){this._driver=t,this.element=n,this.startTime=s,this._elementTimelineStylesLookup=u,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(n),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(n,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){const n=1===this._keyframes.size&&this._pendingStyles.size;this.duration||n?(this.forwardTime(this.currentTime+t),n&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,n){return this.applyStylesToKeyframe(),new Z1(this._driver,t,n||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,n){this._localTimelineStyles.set(t,n),this._globalTimelineStyles.set(t,n),this._styleSummary.set(t,{time:this.currentTime,value:n})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[n,s]of this._globalTimelineStyles)this._backFill.set(n,s||lf),this._currentKeyframe.set(n,lf);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,n,s,u){n&&this._previousKeyframe.set("easing",n);const _=u&&u.params||{},w=function zB(e,t){const n=new Map;let s;return e.forEach(u=>{if("*"===u){s=s||t.keys();for(let _ of s)n.set(_,lf)}else jp(u,n)}),n}(t,this._globalTimelineStyles);for(let[S,P]of w){const z=Gx(P,_,s);this._pendingStyles.set(S,z),this._localTimelineStyles.has(S)||this._backFill.set(S,this._globalTimelineStyles.get(S)??lf),this._updateStyle(S,z)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((t,n)=>{this._currentKeyframe.set(n,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,n)=>{this._currentKeyframe.has(n)||this._currentKeyframe.set(n,t)}))}snapshotCurrentStyles(){for(let[t,n]of this._localTimelineStyles)this._pendingStyles.set(t,n),this._updateStyle(t,n)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const t=[];for(let n in this._currentKeyframe)t.push(n);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((n,s)=>{const u=this._styleSummary.get(s);(!u||n.time>u.time)&&this._updateStyle(s,n.value)})}buildKeyframes(){this.applyStylesToKeyframe();const t=new Set,n=new Set,s=1===this._keyframes.size&&0===this.duration;let u=[];this._keyframes.forEach((S,P)=>{const z=jp(S,new Map,this._backFill);z.forEach((G,Y)=>{"!"===G?t.add(Y):G===lf&&n.add(Y)}),s||z.set("offset",P/this.duration),u.push(z)});const _=t.size?U1(t.values()):[],w=n.size?U1(n.values()):[];if(s){const S=u[0],P=new Map(S);S.set("offset",0),P.set("offset",1),u=[S,P]}return SS(this.element,u,_,w,this.duration,this.startTime,this.easing,!1)}}class NB extends Z1{constructor(t,n,s,u,_,w,S=!1){super(t,n,w.delay),this.keyframes=s,this.preStyleProps=u,this.postStyleProps=_,this._stretchStartingKeyframe=S,this.timings={duration:w.duration,delay:w.delay,easing:w.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:n,duration:s,easing:u}=this.timings;if(this._stretchStartingKeyframe&&n){const _=[],w=s+n,S=n/w,P=jp(t[0]);P.set("offset",0),_.push(P);const z=jp(t[0]);z.set("offset",r2(S)),_.push(z);const G=t.length-1;for(let Y=1;Y<=G;Y++){let ye=jp(t[Y]);const xe=ye.get("offset");ye.set("offset",r2((n+xe*s)/w)),_.push(ye)}s=w,n=0,u="",t=_}return SS(this.element,t,this.preStyleProps,this.postStyleProps,s,n,u,!0)}}function r2(e,t=3){const n=Math.pow(10,t-1);return Math.round(e*n)/n}class AS{}const BB=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class VB extends AS{normalizePropertyName(t,n){return ES(t)}normalizeStyleValue(t,n,s,u){let _="";const w=s.toString().trim();if(BB.has(n)&&0!==s&&"0"!==s)if("number"==typeof s)_="px";else{const S=s.match(/^[+-]?[\d\.]+([a-z]*)$/);S&&0==S[1].length&&u.push(function kz(e,t){return new bt(3005,!1)}())}return w+_}}function o2(e,t,n,s,u,_,w,S,P,z,G,Y,ye){return{type:0,element:e,triggerName:t,isRemovalTransition:u,fromState:n,fromStyles:_,toState:s,toStyles:w,timelines:S,queriedElements:P,preStyleProps:z,postStyleProps:G,totalTime:Y,errors:ye}}const MS={};class s2{constructor(t,n,s){this._triggerName=t,this.ast=n,this._stateStyles=s}match(t,n,s,u){return function jB(e,t,n,s,u){return e.some(_=>_(t,n,s,u))}(this.ast.matchers,t,n,s,u)}buildStyles(t,n,s){let u=this._stateStyles.get("*");return void 0!==t&&(u=this._stateStyles.get(t?.toString())||u),u?u.buildStyles(n,s):new Map}build(t,n,s,u,_,w,S,P,z,G){const Y=[],ye=this.ast.options&&this.ast.options.params||MS,Oe=this.buildStyles(s,S&&S.params||MS,Y),ze=P&&P.params||MS,lt=this.buildStyles(u,ze,Y),Ct=new Set,ut=new Map,qt=new Map,sn="void"===u,ui={params:UB(ze,ye),delay:this.ast.options?.delay},Or=G?[]:DS(t,n,this.ast.animation,_,w,Oe,lt,ui,z,Y);let Gr=0;if(Or.forEach(Fl=>{Gr=Math.max(Fl.duration+Fl.delay,Gr)}),Y.length)return o2(n,this._triggerName,s,u,sn,Oe,lt,[],[],ut,qt,Gr,Y);Or.forEach(Fl=>{const Du=Fl.element,TE=Ol(ut,Du,new Set);Fl.preStyleProps.forEach(e_=>TE.add(e_));const ob=Ol(qt,Du,new Set);Fl.postStyleProps.forEach(e_=>ob.add(e_)),Du!==n&&Ct.add(Du)});const Ws=U1(Ct.values());return o2(n,this._triggerName,s,u,sn,Oe,lt,Or,Ws,ut,qt,Gr)}}function UB(e,t){const n=Ux(t);for(const s in e)e.hasOwnProperty(s)&&null!=e[s]&&(n[s]=e[s]);return n}class HB{constructor(t,n,s){this.styles=t,this.defaultParams=n,this.normalizer=s}buildStyles(t,n){const s=new Map,u=Ux(this.defaultParams);return Object.keys(t).forEach(_=>{const w=t[_];null!==w&&(u[_]=w)}),this.styles.styles.forEach(_=>{"string"!=typeof _&&_.forEach((w,S)=>{w&&(w=Gx(w,u,n));const P=this.normalizer.normalizePropertyName(S,n);w=this.normalizer.normalizeStyleValue(S,P,w,n),s.set(S,w)})}),s}}class $B{constructor(t,n,s){this.name=t,this.ast=n,this._normalizer=s,this.transitionFactories=[],this.states=new Map,n.states.forEach(u=>{this.states.set(u.name,new HB(u.style,u.options&&u.options.params||{},s))}),a2(this.states,"true","1"),a2(this.states,"false","0"),n.transitions.forEach(u=>{this.transitionFactories.push(new s2(t,u,this.states))}),this.fallbackTransition=function qB(e,t,n){return new s2(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(w,S)=>!0],options:null,queryCount:0,depCount:0},t)}(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,n,s,u){return this.transitionFactories.find(w=>w.match(t,n,s,u))||null}matchStyles(t,n,s){return this.fallbackTransition.buildStyles(t,n,s)}}function a2(e,t,n){e.has(t)?e.has(n)||e.set(n,e.get(t)):e.has(n)&&e.set(t,e.get(n))}const WB=new q1;class ZB{constructor(t,n,s){this.bodyNode=t,this._driver=n,this._normalizer=s,this._animations=new Map,this._playersById=new Map,this.players=[]}register(t,n){const s=[],_=TS(this._driver,n,s,[]);if(s.length)throw function Jz(e){return new bt(3503,!1)}();this._animations.set(t,_)}_buildPlayer(t,n,s){const u=t.element,_=UM(this._normalizer,t.keyframes,n,s);return this._driver.animate(u,_,t.duration,t.delay,t.easing,[],!0)}create(t,n,s={}){const u=[],_=this._animations.get(t);let w;const S=new Map;if(_?(w=DS(this._driver,n,_,vS,z1,new Map,new Map,s,WB,u),w.forEach(G=>{const Y=Ol(S,G.element,new Map);G.postStyleProps.forEach(ye=>Y.set(ye,null))})):(u.push(function Qz(){return new bt(3300,!1)}()),w=[]),u.length)throw function eB(e){return new bt(3504,!1)}();S.forEach((G,Y)=>{G.forEach((ye,xe)=>{G.set(xe,this._driver.computeStyle(Y,xe,lf))})});const z=Vp(w.map(G=>{const Y=S.get(G.element);return this._buildPlayer(G,new Map,Y)}));return this._playersById.set(t,z),z.onDestroy(()=>this.destroy(t)),this.players.push(z),z}destroy(t){const n=this._getPlayer(t);n.destroy(),this._playersById.delete(t);const s=this.players.indexOf(n);s>=0&&this.players.splice(s,1)}_getPlayer(t){const n=this._playersById.get(t);if(!n)throw function tB(e){return new bt(3301,!1)}();return n}listen(t,n,s,u){const _=gS(n,"","","");return pS(this._getPlayer(t),s,_,u),()=>{}}command(t,n,s,u){if("register"==s)return void this.register(t,u[0]);if("create"==s)return void this.create(t,n,u[0]||{});const _=this._getPlayer(t);switch(s){case"play":_.play();break;case"pause":_.pause();break;case"reset":_.reset();break;case"restart":_.restart();break;case"finish":_.finish();break;case"init":_.init();break;case"setPosition":_.setPosition(parseFloat(u[0]));break;case"destroy":this.destroy(t)}}}const l2="ng-animate-queued",PS="ng-animate-disabled",QB=[],c2={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},e3={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Su="__ng_removed";class RS{get params(){return this.options.params}constructor(t,n=""){this.namespaceId=n;const s=t&&t.hasOwnProperty("value");if(this.value=function o3(e){return e??null}(s?t.value:t),s){const _=Ux(t);delete _.value,this.options=_}else this.options={};this.options.params||(this.options.params={})}absorbOptions(t){const n=t.params;if(n){const s=this.options.params;Object.keys(n).forEach(u=>{null==s[u]&&(s[u]=n[u])})}}}const $x="void",OS=new RS($x);class t3{constructor(t,n,s){this.id=t,this.hostElement=n,this._engine=s,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,Ec(n,this._hostClassName)}listen(t,n,s,u){if(!this._triggers.has(n))throw function nB(e,t){return new bt(3302,!1)}();if(null==s||0==s.length)throw function iB(e){return new bt(3303,!1)}();if(!function s3(e){return"start"==e||"done"==e}(s))throw function rB(e,t){return new bt(3400,!1)}();const _=Ol(this._elementListeners,t,[]),w={name:n,phase:s,callback:u};_.push(w);const S=Ol(this._engine.statesByElement,t,new Map);return S.has(n)||(Ec(t,B1),Ec(t,B1+"-"+n),S.set(n,OS)),()=>{this._engine.afterFlush(()=>{const P=_.indexOf(w);P>=0&&_.splice(P,1),this._triggers.has(n)||S.delete(n)})}}register(t,n){return!this._triggers.has(t)&&(this._triggers.set(t,n),!0)}_getTrigger(t){const n=this._triggers.get(t);if(!n)throw function oB(e){return new bt(3401,!1)}();return n}trigger(t,n,s,u=!0){const _=this._getTrigger(n),w=new kS(this.id,n,t);let S=this._engine.statesByElement.get(t);S||(Ec(t,B1),Ec(t,B1+"-"+n),this._engine.statesByElement.set(t,S=new Map));let P=S.get(n);const z=new RS(s,this.id);if(!(s&&s.hasOwnProperty("value"))&&P&&z.absorbOptions(P.options),S.set(n,z),P||(P=OS),z.value!==$x&&P.value===z.value){if(!function c3(e,t){const n=Object.keys(e),s=Object.keys(t);if(n.length!=s.length)return!1;for(let u=0;u<n.length;u++){const _=n[u];if(!t.hasOwnProperty(_)||e[_]!==t[_])return!1}return!0}(P.params,z.params)){const ze=[],lt=_.matchStyles(P.value,P.params,ze),Ct=_.matchStyles(z.value,z.params,ze);ze.length?this._engine.reportError(ze):this._engine.afterFlush(()=>{qg(t,lt),Rd(t,Ct)})}return}const ye=Ol(this._engine.playersByElement,t,[]);ye.forEach(ze=>{ze.namespaceId==this.id&&ze.triggerName==n&&ze.queued&&ze.destroy()});let xe=_.matchTransition(P.value,z.value,t,z.params),Oe=!1;if(!xe){if(!u)return;xe=_.fallbackTransition,Oe=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:n,transition:xe,fromState:P,toState:z,player:w,isFallbackTransition:Oe}),Oe||(Ec(t,l2),w.onStart(()=>{uv(t,l2)})),w.onDone(()=>{let ze=this.players.indexOf(w);ze>=0&&this.players.splice(ze,1);const lt=this._engine.playersByElement.get(t);if(lt){let Ct=lt.indexOf(w);Ct>=0&&lt.splice(Ct,1)}}),this.players.push(w),ye.push(w),w}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(n=>n.delete(t)),this._elementListeners.forEach((n,s)=>{this._elementListeners.set(s,n.filter(u=>u.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);const n=this._engine.playersByElement.get(t);n&&(n.forEach(s=>s.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,n){const s=this._engine.driver.query(t,V1,!0);s.forEach(u=>{if(u[Su])return;const _=this._engine.fetchNamespacesByElement(u);_.size?_.forEach(w=>w.triggerLeaveAnimation(u,n,!1,!0)):this.clearElementCache(u)}),this._engine.afterFlushAnimationsDone(()=>s.forEach(u=>this.clearElementCache(u)))}triggerLeaveAnimation(t,n,s,u){const _=this._engine.statesByElement.get(t),w=new Map;if(_){const S=[];if(_.forEach((P,z)=>{if(w.set(z,P.value),this._triggers.has(z)){const G=this.trigger(t,z,$x,u);G&&S.push(G)}}),S.length)return this._engine.markElementAsRemoved(this.id,t,!0,n,w),s&&Vp(S).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){const n=this._elementListeners.get(t),s=this._engine.statesByElement.get(t);if(n&&s){const u=new Set;n.forEach(_=>{const w=_.name;if(u.has(w))return;u.add(w);const P=this._triggers.get(w).fallbackTransition,z=s.get(w)||OS,G=new RS($x),Y=new kS(this.id,w,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:w,transition:P,fromState:z,toState:G,player:Y,isFallbackTransition:!0})})}}removeNode(t,n){const s=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,n),this.triggerLeaveAnimation(t,n,!0))return;let u=!1;if(s.totalAnimations){const _=s.players.length?s.playersByQueriedElement.get(t):[];if(_&&_.length)u=!0;else{let w=t;for(;w=w.parentNode;)if(s.statesByElement.get(w)){u=!0;break}}}if(this.prepareLeaveAnimationListeners(t),u)s.markElementAsRemoved(this.id,t,!1,n);else{const _=t[Su];(!_||_===c2)&&(s.afterFlush(()=>this.clearElementCache(t)),s.destroyInnerAnimations(t),s._onRemovalComplete(t,n))}}insertNode(t,n){Ec(t,this._hostClassName)}drainQueuedTransitions(t){const n=[];return this._queue.forEach(s=>{const u=s.player;if(u.destroyed)return;const _=s.element,w=this._elementListeners.get(_);w&&w.forEach(S=>{if(S.name==s.triggerName){const P=gS(_,s.triggerName,s.fromState.value,s.toState.value);P._data=t,pS(s.player,S.phase,P,S.callback)}}),u.markedForDestroy?this._engine.afterFlush(()=>{u.destroy()}):n.push(s)}),this._queue=[],n.sort((s,u)=>{const _=s.transition.ast.depCount,w=u.transition.ast.depCount;return 0==_||0==w?_-w:this._engine.driver.containsElement(s.element,u.element)?1:-1})}destroy(t){this.players.forEach(n=>n.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}}class n3{_onRemovalComplete(t,n){this.onRemovalComplete(t,n)}constructor(t,n,s){this.bodyNode=t,this.driver=n,this._normalizer=s,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(u,_)=>{}}get queuedPlayers(){const t=[];return this._namespaceList.forEach(n=>{n.players.forEach(s=>{s.queued&&t.push(s)})}),t}createNamespace(t,n){const s=new t3(t,n,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,n)?this._balanceNamespaceList(s,n):(this.newHostElements.set(n,s),this.collectEnterElement(n)),this._namespaceLookup[t]=s}_balanceNamespaceList(t,n){const s=this._namespaceList,u=this.namespacesByHostElement;if(s.length-1>=0){let w=!1,S=this.driver.getParentElement(n);for(;S;){const P=u.get(S);if(P){const z=s.indexOf(P);s.splice(z+1,0,t),w=!0;break}S=this.driver.getParentElement(S)}w||s.unshift(t)}else s.push(t);return u.set(n,t),t}register(t,n){let s=this._namespaceLookup[t];return s||(s=this.createNamespace(t,n)),s}registerTrigger(t,n,s){let u=this._namespaceLookup[t];u&&u.register(n,s)&&this.totalAnimations++}destroy(t,n){t&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{const s=this._fetchNamespace(t);this.namespacesByHostElement.delete(s.hostElement);const u=this._namespaceList.indexOf(s);u>=0&&this._namespaceList.splice(u,1),s.destroy(n),delete this._namespaceLookup[t]}))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){const n=new Set,s=this.statesByElement.get(t);if(s)for(let u of s.values())if(u.namespaceId){const _=this._fetchNamespace(u.namespaceId);_&&n.add(_)}return n}trigger(t,n,s,u){if(X1(n)){const _=this._fetchNamespace(t);if(_)return _.trigger(n,s,u),!0}return!1}insertNode(t,n,s,u){if(!X1(n))return;const _=n[Su];if(_&&_.setForRemoval){_.setForRemoval=!1,_.setForMove=!0;const w=this.collectedLeaveElements.indexOf(n);w>=0&&this.collectedLeaveElements.splice(w,1)}if(t){const w=this._fetchNamespace(t);w&&w.insertNode(n,s)}u&&this.collectEnterElement(n)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,n){n?this.disabledNodes.has(t)||(this.disabledNodes.add(t),Ec(t,PS)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),uv(t,PS))}removeNode(t,n,s){if(X1(n)){const u=t?this._fetchNamespace(t):null;u?u.removeNode(n,s):this.markElementAsRemoved(t,n,!1,s);const _=this.namespacesByHostElement.get(n);_&&_.id!==t&&_.removeNode(n,s)}else this._onRemovalComplete(n,s)}markElementAsRemoved(t,n,s,u,_){this.collectedLeaveElements.push(n),n[Su]={namespaceId:t,setForRemoval:u,hasAnimation:s,removedBeforeQueried:!1,previousTriggersValues:_}}listen(t,n,s,u,_){return X1(n)?this._fetchNamespace(t).listen(n,s,u,_):()=>{}}_buildInstruction(t,n,s,u,_){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,s,u,t.fromState.options,t.toState.options,n,_)}destroyInnerAnimations(t){let n=this.driver.query(t,V1,!0);n.forEach(s=>this.destroyActiveAnimationsForElement(s)),0!=this.playersByQueriedElement.size&&(n=this.driver.query(t,xS,!0),n.forEach(s=>this.finishActiveQueriedAnimationOnElement(s)))}destroyActiveAnimationsForElement(t){const n=this.playersByElement.get(t);n&&n.forEach(s=>{s.queued?s.markedForDestroy=!0:s.destroy()})}finishActiveQueriedAnimationOnElement(t){const n=this.playersByQueriedElement.get(t);n&&n.forEach(s=>s.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return Vp(this.players).onDone(()=>t());t()})}processLeaveNode(t){const n=t[Su];if(n&&n.setForRemoval){if(t[Su]=c2,n.namespaceId){this.destroyInnerAnimations(t);const s=this._fetchNamespace(n.namespaceId);s&&s.clearElementCache(t)}this._onRemovalComplete(t,n.setForRemoval)}t.classList?.contains(PS)&&this.markElementAsDisabled(t,!1),this.driver.query(t,".ng-animate-disabled",!0).forEach(s=>{this.markElementAsDisabled(s,!1)})}flush(t=-1){let n=[];if(this.newHostElements.size&&(this.newHostElements.forEach((s,u)=>this._balanceNamespaceList(s,u)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let s=0;s<this.collectedEnterElements.length;s++)Ec(this.collectedEnterElements[s],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const s=[];try{n=this._flushAnimations(s,t)}finally{for(let u=0;u<s.length;u++)s[u]()}}else for(let s=0;s<this.collectedLeaveElements.length;s++)this.processLeaveNode(this.collectedLeaveElements[s]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(s=>s()),this._flushFns=[],this._whenQuietFns.length){const s=this._whenQuietFns;this._whenQuietFns=[],n.length?Vp(n).onDone(()=>{s.forEach(u=>u())}):s.forEach(u=>u())}}reportError(t){throw function sB(e){return new bt(3402,!1)}()}_flushAnimations(t,n){const s=new q1,u=[],_=new Map,w=[],S=new Map,P=new Map,z=new Map,G=new Set;this.disabledNodes.forEach(xn=>{G.add(xn);const Bn=this.driver.query(xn,".ng-animate-queued",!0);for(let Kn=0;Kn<Bn.length;Kn++)G.add(Bn[Kn])});const Y=this.bodyNode,ye=Array.from(this.statesByElement.keys()),xe=h2(ye,this.collectedEnterElements),Oe=new Map;let ze=0;xe.forEach((xn,Bn)=>{const Kn=vS+ze++;Oe.set(Bn,Kn),xn.forEach(sr=>Ec(sr,Kn))});const lt=[],Ct=new Set,ut=new Set;for(let xn=0;xn<this.collectedLeaveElements.length;xn++){const Bn=this.collectedLeaveElements[xn],Kn=Bn[Su];Kn&&Kn.setForRemoval&&(lt.push(Bn),Ct.add(Bn),Kn.hasAnimation?this.driver.query(Bn,".ng-star-inserted",!0).forEach(sr=>Ct.add(sr)):ut.add(Bn))}const qt=new Map,sn=h2(ye,Array.from(Ct));sn.forEach((xn,Bn)=>{const Kn=z1+ze++;qt.set(Bn,Kn),xn.forEach(sr=>Ec(sr,Kn))}),t.push(()=>{xe.forEach((xn,Bn)=>{const Kn=Oe.get(Bn);xn.forEach(sr=>uv(sr,Kn))}),sn.forEach((xn,Bn)=>{const Kn=qt.get(Bn);xn.forEach(sr=>uv(sr,Kn))}),lt.forEach(xn=>{this.processLeaveNode(xn)})});const ui=[],Or=[];for(let xn=this._namespaceList.length-1;xn>=0;xn--)this._namespaceList[xn].drainQueuedTransitions(n).forEach(Kn=>{const sr=Kn.player,Os=Kn.element;if(ui.push(sr),this.collectedEnterElements.length){const ua=Os[Su];if(ua&&ua.setForMove){if(ua.previousTriggersValues&&ua.previousTriggersValues.has(Kn.triggerName)){const t_=ua.previousTriggersValues.get(Kn.triggerName),Tc=this.statesByElement.get(Kn.element);if(Tc&&Tc.has(Kn.triggerName)){const CE=Tc.get(Kn.triggerName);CE.value=t_,Tc.set(Kn.triggerName,CE)}}return void sr.destroy()}}const Ld=!Y||!this.driver.containsElement(Y,Os),Ll=qt.get(Os),Zp=Oe.get(Os),mo=this._buildInstruction(Kn,s,Zp,Ll,Ld);if(mo.errors&&mo.errors.length)return void Or.push(mo);if(Ld)return sr.onStart(()=>qg(Os,mo.fromStyles)),sr.onDestroy(()=>Rd(Os,mo.toStyles)),void u.push(sr);if(Kn.isFallbackTransition)return sr.onStart(()=>qg(Os,mo.fromStyles)),sr.onDestroy(()=>Rd(Os,mo.toStyles)),void u.push(sr);const qR=[];mo.timelines.forEach(ua=>{ua.stretchStartingKeyframe=!0,this.disabledNodes.has(ua.element)||qR.push(ua)}),mo.timelines=qR,s.append(Os,mo.timelines),w.push({instruction:mo,player:sr,element:Os}),mo.queriedElements.forEach(ua=>Ol(S,ua,[]).push(sr)),mo.preStyleProps.forEach((ua,t_)=>{if(ua.size){let Tc=P.get(t_);Tc||P.set(t_,Tc=new Set),ua.forEach((CE,LD)=>Tc.add(LD))}}),mo.postStyleProps.forEach((ua,t_)=>{let Tc=z.get(t_);Tc||z.set(t_,Tc=new Set),ua.forEach((CE,LD)=>Tc.add(LD))})});if(Or.length){const xn=[];Or.forEach(Bn=>{xn.push(function aB(e,t){return new bt(3505,!1)}())}),ui.forEach(Bn=>Bn.destroy()),this.reportError(xn)}const Gr=new Map,Ws=new Map;w.forEach(xn=>{const Bn=xn.element;s.has(Bn)&&(Ws.set(Bn,Bn),this._beforeAnimationBuild(xn.player.namespaceId,xn.instruction,Gr))}),u.forEach(xn=>{const Bn=xn.element;this._getPreviousPlayers(Bn,!1,xn.namespaceId,xn.triggerName,null).forEach(sr=>{Ol(Gr,Bn,[]).push(sr),sr.destroy()})});const Fl=lt.filter(xn=>p2(xn,P,z)),Du=new Map;d2(Du,this.driver,ut,z,lf).forEach(xn=>{p2(xn,P,z)&&Fl.push(xn)});const ob=new Map;xe.forEach((xn,Bn)=>{d2(ob,this.driver,new Set(xn),P,"!")}),Fl.forEach(xn=>{const Bn=Du.get(xn),Kn=ob.get(xn);Du.set(xn,new Map([...Bn?.entries()??[],...Kn?.entries()??[]]))});const e_=[],GR=[],$R={};w.forEach(xn=>{const{element:Bn,player:Kn,instruction:sr}=xn;if(s.has(Bn)){if(G.has(Bn))return Kn.onDestroy(()=>Rd(Bn,sr.toStyles)),Kn.disabled=!0,Kn.overrideTotalTime(sr.totalTime),void u.push(Kn);let Os=$R;if(Ws.size>1){let Ll=Bn;const Zp=[];for(;Ll=Ll.parentNode;){const mo=Ws.get(Ll);if(mo){Os=mo;break}Zp.push(Ll)}Zp.forEach(mo=>Ws.set(mo,Os))}const Ld=this._buildAnimation(Kn.namespaceId,sr,Gr,_,ob,Du);if(Kn.setRealPlayer(Ld),Os===$R)e_.push(Kn);else{const Ll=this.playersByElement.get(Os);Ll&&Ll.length&&(Kn.parentPlayer=Vp(Ll)),u.push(Kn)}}else qg(Bn,sr.fromStyles),Kn.onDestroy(()=>Rd(Bn,sr.toStyles)),GR.push(Kn),G.has(Bn)&&u.push(Kn)}),GR.forEach(xn=>{const Bn=_.get(xn.element);if(Bn&&Bn.length){const Kn=Vp(Bn);xn.setRealPlayer(Kn)}}),u.forEach(xn=>{xn.parentPlayer?xn.syncPlayerEvents(xn.parentPlayer):xn.destroy()});for(let xn=0;xn<lt.length;xn++){const Bn=lt[xn],Kn=Bn[Su];if(uv(Bn,z1),Kn&&Kn.hasAnimation)continue;let sr=[];if(S.size){let Ld=S.get(Bn);Ld&&Ld.length&&sr.push(...Ld);let Ll=this.driver.query(Bn,xS,!0);for(let Zp=0;Zp<Ll.length;Zp++){let mo=S.get(Ll[Zp]);mo&&mo.length&&sr.push(...mo)}}const Os=sr.filter(Ld=>!Ld.destroyed);Os.length?a3(this,Bn,Os):this.processLeaveNode(Bn)}return lt.length=0,e_.forEach(xn=>{this.players.push(xn),xn.onDone(()=>{xn.destroy();const Bn=this.players.indexOf(xn);this.players.splice(Bn,1)}),xn.play()}),e_}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,n,s,u,_){let w=[];if(n){const S=this.playersByQueriedElement.get(t);S&&(w=S)}else{const S=this.playersByElement.get(t);if(S){const P=!_||_==$x;S.forEach(z=>{z.queued||!P&&z.triggerName!=u||w.push(z)})}}return(s||u)&&(w=w.filter(S=>!(s&&s!=S.namespaceId||u&&u!=S.triggerName))),w}_beforeAnimationBuild(t,n,s){const _=n.element,w=n.isRemovalTransition?void 0:t,S=n.isRemovalTransition?void 0:n.triggerName;for(const P of n.timelines){const z=P.element,G=z!==_,Y=Ol(s,z,[]);this._getPreviousPlayers(z,G,w,S,n.toState).forEach(xe=>{const Oe=xe.getRealPlayer();Oe.beforeDestroy&&Oe.beforeDestroy(),xe.destroy(),Y.push(xe)})}qg(_,n.fromStyles)}_buildAnimation(t,n,s,u,_,w){const S=n.triggerName,P=n.element,z=[],G=new Set,Y=new Set,ye=n.timelines.map(Oe=>{const ze=Oe.element;G.add(ze);const lt=ze[Su];if(lt&&lt.removedBeforeQueried)return new jx(Oe.duration,Oe.delay);const Ct=ze!==P,ut=function l3(e){const t=[];return f2(e,t),t}((s.get(ze)||QB).map(Gr=>Gr.getRealPlayer())).filter(Gr=>!!Gr.element&&Gr.element===ze),qt=_.get(ze),sn=w.get(ze),ui=UM(this._normalizer,Oe.keyframes,qt,sn),Or=this._buildPlayer(Oe,ui,ut);if(Oe.subTimeline&&u&&Y.add(ze),Ct){const Gr=new kS(t,S,ze);Gr.setRealPlayer(Or),z.push(Gr)}return Or});z.forEach(Oe=>{Ol(this.playersByQueriedElement,Oe.element,[]).push(Oe),Oe.onDone(()=>function r3(e,t,n){let s=e.get(t);if(s){if(s.length){const u=s.indexOf(n);s.splice(u,1)}0==s.length&&e.delete(t)}return s}(this.playersByQueriedElement,Oe.element,Oe))}),G.forEach(Oe=>Ec(Oe,XM));const xe=Vp(ye);return xe.onDestroy(()=>{G.forEach(Oe=>uv(Oe,XM)),Rd(P,n.toStyles)}),Y.forEach(Oe=>{Ol(u,Oe,[]).push(xe)}),xe}_buildPlayer(t,n,s){return n.length>0?this.driver.animate(t.element,n,t.duration,t.delay,t.easing,s):new jx(t.duration,t.delay)}}class kS{constructor(t,n,s){this.namespaceId=t,this.triggerName=n,this.element=s,this._player=new jx,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((n,s)=>{n.forEach(u=>pS(t,s,void 0,u))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){const n=this._player;n.triggerCallback&&t.onStart(()=>n.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,n){Ol(this._queuedCallbacks,t,[]).push(n)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){const n=this._player;n.triggerCallback&&n.triggerCallback(t)}}function X1(e){return e&&1===e.nodeType}function u2(e,t){const n=e.style.display;return e.style.display=t??"none",n}function d2(e,t,n,s,u){const _=[];n.forEach(P=>_.push(u2(P)));const w=[];s.forEach((P,z)=>{const G=new Map;P.forEach(Y=>{const ye=t.computeStyle(z,Y,u);G.set(Y,ye),(!ye||0==ye.length)&&(z[Su]=e3,w.push(z))}),e.set(z,G)});let S=0;return n.forEach(P=>u2(P,_[S++])),w}function h2(e,t){const n=new Map;if(e.forEach(S=>n.set(S,[])),0==t.length)return n;const u=new Set(t),_=new Map;function w(S){if(!S)return 1;let P=_.get(S);if(P)return P;const z=S.parentNode;return P=n.has(z)?z:u.has(z)?1:w(z),_.set(S,P),P}return t.forEach(S=>{const P=w(S);1!==P&&n.get(P).push(S)}),n}function Ec(e,t){e.classList?.add(t)}function uv(e,t){e.classList?.remove(t)}function a3(e,t,n){Vp(n).onDone(()=>e.processLeaveNode(t))}function f2(e,t){for(let n=0;n<e.length;n++){const s=e[n];s instanceof VM?f2(s.players,t):t.push(s)}}function p2(e,t,n){const s=n.get(e);if(!s)return!1;let u=t.get(e);return u?s.forEach(_=>u.add(_)):t.set(e,s),n.delete(e),!0}class Y1{constructor(t,n,s){this.bodyNode=t,this._driver=n,this._normalizer=s,this._triggerCache={},this.onRemovalComplete=(u,_)=>{},this._transitionEngine=new n3(t,n,s),this._timelineEngine=new ZB(t,n,s),this._transitionEngine.onRemovalComplete=(u,_)=>this.onRemovalComplete(u,_)}registerTrigger(t,n,s,u,_){const w=t+"-"+u;let S=this._triggerCache[w];if(!S){const P=[],G=TS(this._driver,_,P,[]);if(P.length)throw function Yz(e,t){return new bt(3404,!1)}();S=function GB(e,t,n){return new $B(e,t,n)}(u,G,this._normalizer),this._triggerCache[w]=S}this._transitionEngine.registerTrigger(n,u,S)}register(t,n){this._transitionEngine.register(t,n)}destroy(t,n){this._transitionEngine.destroy(t,n)}onInsert(t,n,s,u){this._transitionEngine.insertNode(t,n,s,u)}onRemove(t,n,s){this._transitionEngine.removeNode(t,n,s)}disableAnimations(t,n){this._transitionEngine.markElementAsDisabled(t,n)}process(t,n,s,u){if("@"==s.charAt(0)){const[_,w]=HM(s);this._timelineEngine.command(_,n,w,u)}else this._transitionEngine.trigger(t,n,s,u)}listen(t,n,s,u,_){if("@"==s.charAt(0)){const[w,S]=HM(s);return this._timelineEngine.listen(w,n,S,_)}return this._transitionEngine.listen(t,n,s,u,_)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(t){this._transitionEngine.afterFlushAnimationsDone(t)}}let d3=(()=>{class e{static{this.initialStylesByElement=new WeakMap}constructor(n,s,u){this._element=n,this._startStyles=s,this._endStyles=u,this._state=0;let _=e.initialStylesByElement.get(n);_||e.initialStylesByElement.set(n,_=new Map),this._initialStyles=_}start(){this._state<1&&(this._startStyles&&Rd(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Rd(this._element,this._initialStyles),this._endStyles&&(Rd(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(qg(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(qg(this._element,this._endStyles),this._endStyles=null),Rd(this._element,this._initialStyles),this._state=3)}}return e})();function FS(e){let t=null;return e.forEach((n,s)=>{(function h3(e){return"display"===e||"position"===e})(s)&&(t=t||new Map,t.set(s,n))}),t}class m2{constructor(t,n,s,u){this.element=t,this.keyframes=n,this.options=s,this._specialStyles=u,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=s.duration,this._delay=s.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:new Map;const n=()=>this._onFinish();this.domPlayer.addEventListener("finish",n),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",n)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(t){const n=[];return t.forEach(s=>{n.push(Object.fromEntries(s))}),n}_triggerWebAnimation(t,n,s){return t.animate(this._convertKeyframesToObject(n),s)}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=t*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((s,u)=>{"offset"!==u&&t.set(u,this._finished?s:QM(this.element,u))}),this.currentSnapshot=t}triggerCallback(t){const n="start"===t?this._onStartFns:this._onDoneFns;n.forEach(s=>s()),n.length=0}}class f3{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}matchesElement(t,n){return!1}containsElement(t,n){return $M(t,n)}getParentElement(t){return _S(t)}query(t,n,s){return qM(t,n,s)}computeStyle(t,n,s){return window.getComputedStyle(t)[n]}animate(t,n,s,u,_,w=[]){const P={duration:s,delay:u,fill:0==u?"both":"forwards"};_&&(P.easing=_);const z=new Map,G=w.filter(xe=>xe instanceof m2);(function vB(e,t){return 0===e||0===t})(s,u)&&G.forEach(xe=>{xe.currentSnapshot.forEach((Oe,ze)=>z.set(ze,Oe))});let Y=function gB(e){return e.length?e[0]instanceof Map?e:e.map(t=>YM(t)):[]}(n).map(xe=>jp(xe));Y=function xB(e,t,n){if(n.size&&t.length){let s=t[0],u=[];if(n.forEach((_,w)=>{s.has(w)||u.push(w),s.set(w,_)}),u.length)for(let _=1;_<t.length;_++){let w=t[_];u.forEach(S=>w.set(S,QM(e,S)))}}return t}(t,Y,z);const ye=function u3(e,t){let n=null,s=null;return Array.isArray(t)&&t.length?(n=FS(t[0]),t.length>1&&(s=FS(t[t.length-1]))):t instanceof Map&&(n=FS(t)),n||s?new d3(e,n,s):null}(t,Y);return new m2(t,Y,P,ye)}}let p3=(()=>{class e extends RM{constructor(n,s){super(),this._nextAnimationId=0,this._renderer=n.createRenderer(s.body,{id:"0",encapsulation:$o.None,styles:[],data:{animation:[]}})}build(n){const s=this._nextAnimationId.toString();this._nextAnimationId++;const u=Array.isArray(n)?FM(n):n;return g2(this._renderer,null,s,"register",[u]),new m3(s,this._renderer)}static{this.\u0275fac=function(s){return new(s||e)(gt(mp),gt(br))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})();class m3 extends Dz{constructor(t,n){super(),this._id=t,this._renderer=n}create(t,n){return new g3(this._id,t,n||{},this._renderer)}}class g3{constructor(t,n,s,u){this.id=t,this.element=n,this._renderer=u,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",s)}_listen(t,n){return this._renderer.listen(this.element,`@@${this.id}:${t}`,n)}_command(t,...n){return g2(this._renderer,this.element,this.id,t,n)}onDone(t){this._listen("done",t)}onStart(t){this._listen("start",t)}onDestroy(t){this._listen("destroy",t)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(t){this._command("setPosition",t)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function g2(e,t,n,s,u){return e.setProperty(t,`@@${n}:${s}`,u)}const _2="@.disabled";let _3=(()=>{class e{constructor(n,s,u){this.delegate=n,this.engine=s,this._zone=u,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,s.onRemovalComplete=(_,w)=>{const S=w?.parentNode(_);S&&w.removeChild(S,_)}}createRenderer(n,s){const _=this.delegate.createRenderer(n,s);if(!(n&&s&&s.data&&s.data.animation)){let G=this._rendererCache.get(_);return G||(G=new y2("",_,this.engine,()=>this._rendererCache.delete(_)),this._rendererCache.set(_,G)),G}const w=s.id,S=s.id+"-"+this._currentId;this._currentId++,this.engine.register(S,n);const P=G=>{Array.isArray(G)?G.forEach(P):this.engine.registerTrigger(w,S,n,G.name,G)};return s.data.animation.forEach(P),new y3(this,S,_,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(n,s,u){n>=0&&n<this._microtaskId?this._zone.run(()=>s(u)):(0==this._animationCallbacksBuffer.length&&queueMicrotask(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(_=>{const[w,S]=_;w(S)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([s,u]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}static{this.\u0275fac=function(s){return new(s||e)(gt(mp),gt(Y1),gt(Ti))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})();class y2{constructor(t,n,s,u){this.namespaceId=t,this.delegate=n,this.engine=s,this._onDestroy=u}get data(){return this.delegate.data}destroyNode(t){this.delegate.destroyNode?.(t)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(t,n){return this.delegate.createElement(t,n)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,n){this.delegate.appendChild(t,n),this.engine.onInsert(this.namespaceId,n,t,!1)}insertBefore(t,n,s,u=!0){this.delegate.insertBefore(t,n,s),this.engine.onInsert(this.namespaceId,n,t,u)}removeChild(t,n,s){this.engine.onRemove(this.namespaceId,n,this.delegate)}selectRootElement(t,n){return this.delegate.selectRootElement(t,n)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,n,s,u){this.delegate.setAttribute(t,n,s,u)}removeAttribute(t,n,s){this.delegate.removeAttribute(t,n,s)}addClass(t,n){this.delegate.addClass(t,n)}removeClass(t,n){this.delegate.removeClass(t,n)}setStyle(t,n,s,u){this.delegate.setStyle(t,n,s,u)}removeStyle(t,n,s){this.delegate.removeStyle(t,n,s)}setProperty(t,n,s){"@"==n.charAt(0)&&n==_2?this.disableAnimations(t,!!s):this.delegate.setProperty(t,n,s)}setValue(t,n){this.delegate.setValue(t,n)}listen(t,n,s){return this.delegate.listen(t,n,s)}disableAnimations(t,n){this.engine.disableAnimations(t,n)}}class y3 extends y2{constructor(t,n,s,u,_){super(n,s,u,_),this.factory=t,this.namespaceId=n}setProperty(t,n,s){"@"==n.charAt(0)?"."==n.charAt(1)&&n==_2?this.disableAnimations(t,s=void 0===s||!!s):this.engine.process(this.namespaceId,t,n.slice(1),s):this.delegate.setProperty(t,n,s)}listen(t,n,s){if("@"==n.charAt(0)){const u=function v3(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(t);let _=n.slice(1),w="";return"@"!=_.charAt(0)&&([_,w]=function x3(e){const t=e.indexOf(".");return[e.substring(0,t),e.slice(t+1)]}(_)),this.engine.listen(this.namespaceId,u,_,w,S=>{this.factory.scheduleListenerCallback(S._data||-1,s,S)})}return this.delegate.listen(t,n,s)}}const v2=[{provide:RM,useClass:p3},{provide:AS,useFactory:function w3(){return new VB}},{provide:Y1,useClass:(()=>{class e extends Y1{constructor(n,s,u,_){super(n.body,s,u)}ngOnDestroy(){this.flush()}static{this.\u0275fac=function(s){return new(s||e)(gt(br),gt(yS),gt(AS),gt(Ug))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})()},{provide:mp,useFactory:function E3(e,t,n){return new _3(e,t,n)},deps:[cS,Y1,Ti]}],LS=[{provide:yS,useFactory:()=>new f3},{provide:rg,useValue:"BrowserAnimations"},...v2],x2=[{provide:yS,useClass:WM},{provide:rg,useValue:"NoopAnimations"},...v2];let T3=(()=>{class e{static withConfig(n){return{ngModule:e,providers:n.disableAnimations?x2:LS}}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({providers:LS,imports:[IM]})}}return e})();function b2(e,t=0){return function C3(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):t}function J1(e){return Array.isArray(e)?e:[e]}function es(e){return null==e?"":"string"==typeof e?e:`${e}px`}function dv(e){return e instanceof Yo?e.nativeElement:e}const{isArray:S3}=Array;function NS(e){return Mo(t=>function D3(e,t){return S3(t)?e(...t):e(t)}(e,t))}const I3=["addListener","removeListener"],A3=["addEventListener","removeEventListener"],M3=["on","off"];function zS(e,t,n,s){if(Yi(n)&&(s=n,n=void 0),s)return zS(e,t,n).pipe(NS(s));const[u,_]=function O3(e){return Yi(e.addEventListener)&&Yi(e.removeEventListener)}(e)?A3.map(w=>S=>e[w](t,S,n)):function P3(e){return Yi(e.addListener)&&Yi(e.removeListener)}(e)?I3.map(w2(e,t)):function R3(e){return Yi(e.on)&&Yi(e.off)}(e)?M3.map(w2(e,t)):[];if(!u&&Rn(e))return _n(w=>zS(w,t,n))(Ie(e));if(!u)throw new TypeError("Invalid event target");return new Vi(w=>{const S=(...P)=>w.next(1<P.length?P:P[0]);return u(S),()=>_(S)})}function w2(e,t){return n=>s=>e[n](t,s)}class k3 extends tr{constructor(t,n){super()}schedule(t,n=0){return this}}const Q1={setInterval(e,t,...n){const{delegate:s}=Q1;return s?.setInterval?s.setInterval(e,t,...n):setInterval(e,t,...n)},clearInterval(e){const{delegate:t}=Q1;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};class BS extends k3{constructor(t,n){super(t,n),this.scheduler=t,this.work=n,this.pending=!1}schedule(t,n=0){var s;if(this.closed)return this;this.state=t;const u=this.id,_=this.scheduler;return null!=u&&(this.id=this.recycleAsyncId(_,u,n)),this.pending=!0,this.delay=n,this.id=null!==(s=this.id)&&void 0!==s?s:this.requestAsyncId(_,this.id,n),this}requestAsyncId(t,n,s=0){return Q1.setInterval(t.flush.bind(t,this),s)}recycleAsyncId(t,n,s=0){if(null!=s&&this.delay===s&&!1===this.pending)return n;null!=n&&Q1.clearInterval(n)}execute(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const s=this._execute(t,n);if(s)return s;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,n){let u,s=!1;try{this.work(t)}catch(_){s=!0,u=_||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),u}unsubscribe(){if(!this.closed){const{id:t,scheduler:n}=this,{actions:s}=n;this.work=this.state=this.scheduler=null,this.pending=!1,d(s,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,super.unsubscribe()}}}const qx={schedule(e){let t=requestAnimationFrame,n=cancelAnimationFrame;const{delegate:s}=qx;s&&(t=s.requestAnimationFrame,n=s.cancelAnimationFrame);const u=t(_=>{n=void 0,e(_)});return new tr(()=>n?.(u))},requestAnimationFrame(...e){const{delegate:t}=qx;return(t?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:t}=qx;return(t?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0},E2={now:()=>(E2.delegate||Date).now(),delegate:void 0};class Wx{constructor(t,n=Wx.now){this.schedulerActionCtor=t,this.now=n}schedule(t,n=0,s){return new this.schedulerActionCtor(this,t).schedule(s,n)}}Wx.now=E2.now;class VS extends Wx{constructor(t,n=Wx.now){super(t,n),this.actions=[],this._active=!1}flush(t){const{actions:n}=this;if(this._active)return void n.push(t);let s;this._active=!0;do{if(s=t.execute(t.state,t.delay))break}while(t=n.shift());if(this._active=!1,s){for(;t=n.shift();)t.unsubscribe();throw s}}}new class L3 extends VS{flush(t){let n;this._active=!0,t?n=t.id:(n=this._scheduled,this._scheduled=void 0);const{actions:s}=this;let u;t=t||s.shift();do{if(u=t.execute(t.state,t.delay))break}while((t=s[0])&&t.id===n&&s.shift());if(this._active=!1,u){for(;(t=s[0])&&t.id===n&&s.shift();)t.unsubscribe();throw u}}}(class F3 extends BS{constructor(t,n){super(t,n),this.scheduler=t,this.work=n}requestAsyncId(t,n,s=0){return null!==s&&s>0?super.requestAsyncId(t,n,s):(t.actions.push(this),t._scheduled||(t._scheduled=qx.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,n,s=0){var u;if(null!=s?s>0:this.delay>0)return super.recycleAsyncId(t,n,s);const{actions:_}=t;null!=n&&n===t._scheduled&&(null===(u=_[_.length-1])||void 0===u?void 0:u.id)!==n&&(qx.cancelAnimationFrame(n),t._scheduled=void 0)}});let jS,z3=1;const eE={};function T2(e){return e in eE&&(delete eE[e],!0)}const B3={setImmediate(e){const t=z3++;return eE[t]=!0,jS||(jS=Promise.resolve()),jS.then(()=>T2(t)&&e()),t},clearImmediate(e){T2(e)}},{setImmediate:V3,clearImmediate:j3}=B3,tE={setImmediate(...e){const{delegate:t}=tE;return(t?.setImmediate||V3)(...e)},clearImmediate(e){const{delegate:t}=tE;return(t?.clearImmediate||j3)(e)},delegate:void 0},US=(new class H3 extends VS{flush(t){this._active=!0;const n=this._scheduled;this._scheduled=void 0;const{actions:s}=this;let u;t=t||s.shift();do{if(u=t.execute(t.state,t.delay))break}while((t=s[0])&&t.id===n&&s.shift());if(this._active=!1,u){for(;(t=s[0])&&t.id===n&&s.shift();)t.unsubscribe();throw u}}}(class U3 extends BS{constructor(t,n){super(t,n),this.scheduler=t,this.work=n}requestAsyncId(t,n,s=0){return null!==s&&s>0?super.requestAsyncId(t,n,s):(t.actions.push(this),t._scheduled||(t._scheduled=tE.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,n,s=0){var u;if(null!=s?s>0:this.delay>0)return super.recycleAsyncId(t,n,s);const{actions:_}=t;null!=n&&(null===(u=_[_.length-1])||void 0===u?void 0:u.id)!==n&&(tE.clearImmediate(n),t._scheduled===n&&(t._scheduled=void 0))}}),new VS(BS)),$3=US;function C2(e,t=US){return function q3(e){return gi((t,n)=>{let s=!1,u=null,_=null,w=!1;const S=()=>{if(_?.unsubscribe(),_=null,s){s=!1;const z=u;u=null,n.next(z)}w&&n.complete()},P=()=>{_=null,w&&n.complete()};t.subscribe(nr(n,z=>{s=!0,u=z,_||Ie(e(z)).subscribe(_=nr(n,S,P))},()=>{w=!0,(!s||!_||_.closed)&&n.complete()}))})}(()=>function Z3(e=0,t,n=$3){let s=-1;return null!=t&&(Vn(t)?n=t:s=t),new Vi(u=>{let _=function W3(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;_<0&&(_=0);let w=0;return n.schedule(function(){u.closed||(u.next(w++),0<=s?this.schedule(void 0,s):u.complete())},_)})}(e,t))}function uf(e,t){return gi((n,s)=>{let u=0;n.subscribe(nr(s,_=>e.call(t,_,u++)&&s.next(_)))})}let HS;try{HS=typeof Intl<"u"&&Intl.v8BreakIterator}catch{HS=!1}let Zx,Zg,GS,Od=(()=>{class e{constructor(n){this._platformId=n,this.isBrowser=this._platformId?function AN(e){return e===cM}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!HS)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static{this.\u0275fac=function(s){return new(s||e)(gt(hu))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function nE(e){return function X3(){if(null==Zx&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Zx=!0}))}finally{Zx=Zx||!1}return Zx}()?e:!!e.capture}function Y3(){if(null==Zg){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Zg=!1,Zg;if("scrollBehavior"in document.documentElement.style)Zg=!0;else{const e=Element.prototype.scrollTo;Zg=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return Zg}function $S(){let e=typeof document<"u"&&document?document.activeElement:null;for(;e&&e.shadowRoot;){const t=e.shadowRoot.activeElement;if(t===e)break;e=t}return e}function Up(e){return e.composedPath?e.composedPath()[0]:e.target}function qS(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}const Q3=new Ht("cdk-dir-doc",{providedIn:"root",factory:function eV(){return $n(br)}}),tV=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let WS=(()=>{class e{constructor(n){this.value="ltr",this.change=new fo,n&&(this.value=function nV(e){const t=e?.toLowerCase()||"";return"auto"===t&&typeof navigator<"u"&&navigator?.language?tV.test(navigator.language)?"rtl":"ltr":"rtl"===t?"rtl":"ltr"}((n.body?n.body.dir:null)||(n.documentElement?n.documentElement.dir:null)||"ltr"))}ngOnDestroy(){this.change.complete()}static{this.\u0275fac=function(s){return new(s||e)(gt(Q3,8))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),Xx=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({})}}return e})(),rV=(()=>{class e{constructor(n,s,u){this._ngZone=n,this._platform=s,this._scrolled=new Gi,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=u}register(n){this.scrollContainers.has(n)||this.scrollContainers.set(n,n.elementScrolled().subscribe(()=>this._scrolled.next(n)))}deregister(n){const s=this.scrollContainers.get(n);s&&(s.unsubscribe(),this.scrollContainers.delete(n))}scrolled(n=20){return this._platform.isBrowser?new Vi(s=>{this._globalSubscription||this._addGlobalListener();const u=n>0?this._scrolled.pipe(C2(n)).subscribe(s):this._scrolled.subscribe(s);return this._scrolledCount++,()=>{u.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):nl()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((n,s)=>this.deregister(s)),this._scrolled.complete()}ancestorScrolled(n,s){const u=this.getAncestorScrollContainers(n);return this.scrolled(s).pipe(uf(_=>!_||u.indexOf(_)>-1))}getAncestorScrollContainers(n){const s=[];return this.scrollContainers.forEach((u,_)=>{this._scrollableContainsElement(_,n)&&s.push(_)}),s}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(n,s){let u=dv(s),_=n.getElementRef().nativeElement;do{if(u==_)return!0}while(u=u.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>zS(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static{this.\u0275fac=function(s){return new(s||e)(gt(Ti),gt(Od),gt(br,8))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),D2=(()=>{class e{constructor(n,s,u){this._platform=n,this._change=new Gi,this._changeListener=_=>{this._change.next(_)},this._document=u,s.runOutsideAngular(()=>{if(n.isBrowser){const _=this._getWindow();_.addEventListener("resize",this._changeListener),_.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const n=this._getWindow();n.removeEventListener("resize",this._changeListener),n.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const n={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),n}getViewportRect(){const n=this.getViewportScrollPosition(),{width:s,height:u}=this.getViewportSize();return{top:n.top,left:n.left,bottom:n.top+u,right:n.left+s,height:u,width:s}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const n=this._document,s=this._getWindow(),u=n.documentElement,_=u.getBoundingClientRect();return{top:-_.top||n.body.scrollTop||s.scrollY||u.scrollTop||0,left:-_.left||n.body.scrollLeft||s.scrollX||u.scrollLeft||0}}change(n=20){return n>0?this._change.pipe(C2(n)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const n=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:n.innerWidth,height:n.innerHeight}:{width:0,height:0}}static{this.\u0275fac=function(s){return new(s||e)(gt(Od),gt(Ti),gt(br,8))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),I2=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({})}}return e})(),ZS=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({imports:[Xx,I2,Xx,I2]})}}return e})();function fv(e){return e<=0?()=>Ir:gi((t,n)=>{let s=0;t.subscribe(nr(n,u=>{++s<=e&&(n.next(u),e<=s&&n.complete())}))})}function XS(e){return gi((t,n)=>{Ie(e).subscribe(nr(n,()=>n.complete(),pn)),!n.closed&&t.subscribe(n)})}class YS{attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;null!=t&&(this._attachedHost=null,t.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(t){this._attachedHost=t}}class KS extends YS{constructor(t,n,s,u,_){super(),this.component=t,this.viewContainerRef=n,this.injector=s,this.componentFactoryResolver=u,this.projectableNodes=_}}class A2 extends YS{constructor(t,n,s,u){super(),this.templateRef=t,this.viewContainerRef=n,this.context=s,this.injector=u}get origin(){return this.templateRef.elementRef}attach(t,n=this.context){return this.context=n,super.attach(t)}detach(){return this.context=void 0,super.detach()}}class sV extends YS{constructor(t){super(),this.element=t instanceof Yo?t.nativeElement:t}}class JS{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(t){return t instanceof KS?(this._attachedPortal=t,this.attachComponentPortal(t)):t instanceof A2?(this._attachedPortal=t,this.attachTemplatePortal(t)):this.attachDomPortal&&t instanceof sV?(this._attachedPortal=t,this.attachDomPortal(t)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class aV extends JS{constructor(t,n,s,u,_){super(),this.outletElement=t,this._componentFactoryResolver=n,this._appRef=s,this._defaultInjector=u,this.attachDomPortal=w=>{const S=w.element,P=this._document.createComment("dom-portal");S.parentNode.insertBefore(P,S),this.outletElement.appendChild(S),this._attachedPortal=w,super.setDisposeFn(()=>{P.parentNode&&P.parentNode.replaceChild(S,P)})},this._document=_}attachComponentPortal(t){const s=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component);let u;return t.viewContainerRef?(u=t.viewContainerRef.createComponent(s,t.viewContainerRef.length,t.injector||t.viewContainerRef.injector,t.projectableNodes||void 0),this.setDisposeFn(()=>u.destroy())):(u=s.create(t.injector||this._defaultInjector||Ko.NULL),this._appRef.attachView(u.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(u.hostView),u.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(u)),this._attachedPortal=t,u}attachTemplatePortal(t){let n=t.viewContainerRef,s=n.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return s.rootNodes.forEach(u=>this.outletElement.appendChild(u)),s.detectChanges(),this.setDisposeFn(()=>{let u=n.indexOf(s);-1!==u&&n.remove(u)}),this._attachedPortal=t,s}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}}let QS=(()=>{class e extends JS{constructor(n,s,u){super(),this._componentFactoryResolver=n,this._viewContainerRef=s,this._isInitialized=!1,this.attached=new fo,this.attachDomPortal=_=>{const w=_.element,S=this._document.createComment("dom-portal");_.setAttachedHost(this),w.parentNode.insertBefore(S,w),this._getRootNode().appendChild(w),this._attachedPortal=_,super.setDisposeFn(()=>{S.parentNode&&S.parentNode.replaceChild(w,S)})},this._document=u}get portal(){return this._attachedPortal}set portal(n){this.hasAttached()&&!n&&!this._isInitialized||(this.hasAttached()&&super.detach(),n&&super.attach(n),this._attachedPortal=n||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(n){n.setAttachedHost(this);const s=null!=n.viewContainerRef?n.viewContainerRef:this._viewContainerRef,_=(n.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(n.component),w=s.createComponent(_,s.length,n.injector||s.injector,n.projectableNodes||void 0);return s!==this._viewContainerRef&&this._getRootNode().appendChild(w.hostView.rootNodes[0]),super.setDisposeFn(()=>w.destroy()),this._attachedPortal=n,this._attachedRef=w,this.attached.emit(w),w}attachTemplatePortal(n){n.setAttachedHost(this);const s=this._viewContainerRef.createEmbeddedView(n.templateRef,n.context,{injector:n.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=n,this._attachedRef=s,this.attached.emit(s),s}_getRootNode(){const n=this._viewContainerRef.element.nativeElement;return n.nodeType===n.ELEMENT_NODE?n:n.parentNode}static{this.\u0275fac=function(s){return new(s||e)(Tt(fp),Tt(Eu),Tt(br))}}static{this.\u0275dir=Cn({type:e,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[zi]})}}return e})(),rE=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({})}}return e})();const M2=Y3();class lV{constructor(t,n){this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=n}attach(){}enable(){if(this._canBeEnabled()){const t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=es(-this._previousScrollPosition.left),t.style.top=es(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const t=this._document.documentElement,s=t.style,u=this._document.body.style,_=s.scrollBehavior||"",w=u.scrollBehavior||"";this._isEnabled=!1,s.left=this._previousHTMLStyles.left,s.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),M2&&(s.scrollBehavior=u.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),M2&&(s.scrollBehavior=_,u.scrollBehavior=w)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const n=this._document.body,s=this._viewportRuler.getViewportSize();return n.scrollHeight>s.height||n.scrollWidth>s.width}}class cV{constructor(t,n,s,u){this._scrollDispatcher=t,this._ngZone=n,this._viewportRuler=s,this._config=u,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(t){this._overlayRef=t}enable(){if(this._scrollSubscription)return;const t=this._scrollDispatcher.scrolled(0).pipe(uf(n=>!n||!this._overlayRef.overlayElement.contains(n.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{const n=this._viewportRuler.getViewportScrollPosition().top;Math.abs(n-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class P2{enable(){}disable(){}attach(){}}function eD(e,t){return t.some(n=>e.bottom<n.top||e.top>n.bottom||e.right<n.left||e.left>n.right)}function R2(e,t){return t.some(n=>e.top<n.top||e.bottom>n.bottom||e.left<n.left||e.right>n.right)}class uV{constructor(t,n,s,u){this._scrollDispatcher=t,this._viewportRuler=n,this._ngZone=s,this._config=u,this._scrollSubscription=null}attach(t){this._overlayRef=t}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const n=this._overlayRef.overlayElement.getBoundingClientRect(),{width:s,height:u}=this._viewportRuler.getViewportSize();eD(n,[{width:s,height:u,bottom:u,right:s,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let dV=(()=>{class e{constructor(n,s,u,_){this._scrollDispatcher=n,this._viewportRuler=s,this._ngZone=u,this.noop=()=>new P2,this.close=w=>new cV(this._scrollDispatcher,this._ngZone,this._viewportRuler,w),this.block=()=>new lV(this._viewportRuler,this._document),this.reposition=w=>new uV(this._scrollDispatcher,this._viewportRuler,this._ngZone,w),this._document=_}static{this.\u0275fac=function(s){return new(s||e)(gt(rV),gt(D2),gt(Ti),gt(br))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();class O2{constructor(t){if(this.scrollStrategy=new P2,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t){const n=Object.keys(t);for(const s of n)void 0!==t[s]&&(this[s]=t[s])}}}class hV{constructor(t,n){this.connectionPair=t,this.scrollableViewProperties=n}}let k2=(()=>{class e{constructor(n){this._attachedOverlays=[],this._document=n}ngOnDestroy(){this.detach()}add(n){this.remove(n),this._attachedOverlays.push(n)}remove(n){const s=this._attachedOverlays.indexOf(n);s>-1&&this._attachedOverlays.splice(s,1),0===this._attachedOverlays.length&&this.detach()}static{this.\u0275fac=function(s){return new(s||e)(gt(br))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),fV=(()=>{class e extends k2{constructor(n,s){super(n),this._ngZone=s,this._keydownListener=u=>{const _=this._attachedOverlays;for(let w=_.length-1;w>-1;w--)if(_[w]._keydownEvents.observers.length>0){const S=_[w]._keydownEvents;this._ngZone?this._ngZone.run(()=>S.next(u)):S.next(u);break}}}add(n){super.add(n),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}static{this.\u0275fac=function(s){return new(s||e)(gt(br),gt(Ti,8))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),pV=(()=>{class e extends k2{constructor(n,s,u){super(n),this._platform=s,this._ngZone=u,this._cursorStyleIsSet=!1,this._pointerDownListener=_=>{this._pointerDownEventTarget=Up(_)},this._clickListener=_=>{const w=Up(_),S="click"===_.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:w;this._pointerDownEventTarget=null;const P=this._attachedOverlays.slice();for(let z=P.length-1;z>-1;z--){const G=P[z];if(G._outsidePointerEvents.observers.length<1||!G.hasAttached())continue;if(G.overlayElement.contains(w)||G.overlayElement.contains(S))break;const Y=G._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>Y.next(_)):Y.next(_)}}}add(n){if(super.add(n),!this._isAttached){const s=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(s)):this._addEventListeners(s),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=s.style.cursor,s.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const n=this._document.body;n.removeEventListener("pointerdown",this._pointerDownListener,!0),n.removeEventListener("click",this._clickListener,!0),n.removeEventListener("auxclick",this._clickListener,!0),n.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(n.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(n){n.addEventListener("pointerdown",this._pointerDownListener,!0),n.addEventListener("click",this._clickListener,!0),n.addEventListener("auxclick",this._clickListener,!0),n.addEventListener("contextmenu",this._clickListener,!0)}static{this.\u0275fac=function(s){return new(s||e)(gt(br),gt(Od),gt(Ti,8))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),oE=(()=>{class e{constructor(n,s){this._platform=s,this._document=n}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const n="cdk-overlay-container";if(this._platform.isBrowser||qS()){const u=this._document.querySelectorAll(`.${n}[platform="server"], .${n}[platform="test"]`);for(let _=0;_<u.length;_++)u[_].remove()}const s=this._document.createElement("div");s.classList.add(n),qS()?s.setAttribute("platform","test"):this._platform.isBrowser||s.setAttribute("platform","server"),this._document.body.appendChild(s),this._containerElement=s}static{this.\u0275fac=function(s){return new(s||e)(gt(br),gt(Od))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();class Yx{constructor(t,n,s,u,_,w,S,P,z,G=!1){this._portalOutlet=t,this._host=n,this._pane=s,this._config=u,this._ngZone=_,this._keyboardDispatcher=w,this._document=S,this._location=P,this._outsideClickDispatcher=z,this._animationsDisabled=G,this._backdropElement=null,this._backdropClick=new Gi,this._attachments=new Gi,this._detachments=new Gi,this._locationChanges=tr.EMPTY,this._backdropClickHandler=Y=>this._backdropClick.next(Y),this._backdropTransitionendHandler=Y=>{this._disposeBackdrop(Y.target)},this._keydownEvents=new Gi,this._outsidePointerEvents=new Gi,u.scrollStrategy&&(this._scrollStrategy=u.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=u.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(t){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const n=this._portalOutlet.attach(t);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(fv(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof n?.onDestroy&&n.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),n}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const t=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config={...this._config,...t},this._updateElementSize()}setDirection(t){this._config={...this._config,direction:t},this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){const t=this._config.direction;return t?"string"==typeof t?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const t=this._pane.style;t.width=es(this._config.width),t.height=es(this._config.height),t.minWidth=es(this._config.minWidth),t.minHeight=es(this._config.minHeight),t.maxWidth=es(this._config.maxWidth),t.maxHeight=es(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachBackdrop(){const t="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(t)})}):this._backdropElement.classList.add(t)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const t=this._backdropElement;if(t){if(this._animationsDisabled)return void this._disposeBackdrop(t);t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",this._backdropTransitionendHandler)}),t.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(t)},500))}}_toggleClasses(t,n,s){const u=J1(n||[]).filter(_=>!!_);u.length&&(s?t.classList.add(...u):t.classList.remove(...u))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const t=this._ngZone.onStable.pipe(XS(tl(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),t.unsubscribe())})})}_disposeScrollStrategy(){const t=this._scrollStrategy;t&&(t.disable(),t.detach&&t.detach())}_disposeBackdrop(t){t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",this._backdropTransitionendHandler),t.remove(),this._backdropElement===t&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const F2="cdk-overlay-connected-position-bounding-box",mV=/([A-Za-z%]+)$/;class gV{get positions(){return this._preferredPositions}constructor(t,n,s,u,_){this._viewportRuler=n,this._document=s,this._platform=u,this._overlayContainer=_,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Gi,this._resizeSubscription=tr.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(t)}attach(t){this._validatePositions(),t.hostElement.classList.add(F2),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._originRect,n=this._overlayRect,s=this._viewportRect,u=this._containerRect,_=[];let w;for(let S of this._preferredPositions){let P=this._getOriginPoint(t,u,S),z=this._getOverlayPoint(P,n,S),G=this._getOverlayFit(z,n,s,S);if(G.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(S,P);this._canFitWithFlexibleDimensions(G,z,s)?_.push({position:S,origin:P,overlayRect:n,boundingBoxRect:this._calculateBoundingBoxRect(P,S)}):(!w||w.overlayFit.visibleArea<G.visibleArea)&&(w={overlayFit:G,overlayPoint:z,originPoint:P,position:S,overlayRect:n})}if(_.length){let S=null,P=-1;for(const z of _){const G=z.boundingBoxRect.width*z.boundingBoxRect.height*(z.position.weight||1);G>P&&(P=G,S=z)}return this._isPushed=!1,void this._applyPosition(S.position,S.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(w.position,w.originPoint);this._applyPosition(w.position,w.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Xg(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(F2),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const t=this._lastPosition;if(t){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const n=this._getOriginPoint(this._originRect,this._containerRect,t);this._applyPosition(t,n)}else this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,-1===t.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}_getOriginPoint(t,n,s){let u,_;if("center"==s.originX)u=t.left+t.width/2;else{const w=this._isRtl()?t.right:t.left,S=this._isRtl()?t.left:t.right;u="start"==s.originX?w:S}return n.left<0&&(u-=n.left),_="center"==s.originY?t.top+t.height/2:"top"==s.originY?t.top:t.bottom,n.top<0&&(_-=n.top),{x:u,y:_}}_getOverlayPoint(t,n,s){let u,_;return u="center"==s.overlayX?-n.width/2:"start"===s.overlayX?this._isRtl()?-n.width:0:this._isRtl()?0:-n.width,_="center"==s.overlayY?-n.height/2:"top"==s.overlayY?0:-n.height,{x:t.x+u,y:t.y+_}}_getOverlayFit(t,n,s,u){const _=N2(n);let{x:w,y:S}=t,P=this._getOffset(u,"x"),z=this._getOffset(u,"y");P&&(w+=P),z&&(S+=z);let ye=0-S,xe=S+_.height-s.height,Oe=this._subtractOverflows(_.width,0-w,w+_.width-s.width),ze=this._subtractOverflows(_.height,ye,xe),lt=Oe*ze;return{visibleArea:lt,isCompletelyWithinViewport:_.width*_.height===lt,fitsInViewportVertically:ze===_.height,fitsInViewportHorizontally:Oe==_.width}}_canFitWithFlexibleDimensions(t,n,s){if(this._hasFlexibleDimensions){const u=s.bottom-n.y,_=s.right-n.x,w=L2(this._overlayRef.getConfig().minHeight),S=L2(this._overlayRef.getConfig().minWidth);return(t.fitsInViewportVertically||null!=w&&w<=u)&&(t.fitsInViewportHorizontally||null!=S&&S<=_)}return!1}_pushOverlayOnScreen(t,n,s){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};const u=N2(n),_=this._viewportRect,w=Math.max(t.x+u.width-_.width,0),S=Math.max(t.y+u.height-_.height,0),P=Math.max(_.top-s.top-t.y,0),z=Math.max(_.left-s.left-t.x,0);let G=0,Y=0;return G=u.width<=_.width?z||-w:t.x<this._viewportMargin?_.left-s.left-t.x:0,Y=u.height<=_.height?P||-S:t.y<this._viewportMargin?_.top-s.top-t.y:0,this._previousPushAmount={x:G,y:Y},{x:t.x+G,y:t.y+Y}}_applyPosition(t,n){if(this._setTransformOrigin(t),this._setOverlayElementStyles(n,t),this._setBoundingBoxStyles(n,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._lastPosition=t,this._positionChanges.observers.length){const s=this._getScrollVisibility(),u=new hV(t,s);this._positionChanges.next(u)}this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;const n=this._boundingBox.querySelectorAll(this._transformOriginSelector);let s,u=t.overlayY;s="center"===t.overlayX?"center":this._isRtl()?"start"===t.overlayX?"right":"left":"start"===t.overlayX?"left":"right";for(let _=0;_<n.length;_++)n[_].style.transformOrigin=`${s} ${u}`}_calculateBoundingBoxRect(t,n){const s=this._viewportRect,u=this._isRtl();let _,w,S,G,Y,ye;if("top"===n.overlayY)w=t.y,_=s.height-w+this._viewportMargin;else if("bottom"===n.overlayY)S=s.height-t.y+2*this._viewportMargin,_=s.height-S+this._viewportMargin;else{const xe=Math.min(s.bottom-t.y+s.top,t.y),Oe=this._lastBoundingBoxSize.height;_=2*xe,w=t.y-xe,_>Oe&&!this._isInitialRender&&!this._growAfterOpen&&(w=t.y-Oe/2)}if("end"===n.overlayX&&!u||"start"===n.overlayX&&u)ye=s.width-t.x+this._viewportMargin,G=t.x-this._viewportMargin;else if("start"===n.overlayX&&!u||"end"===n.overlayX&&u)Y=t.x,G=s.right-t.x;else{const xe=Math.min(s.right-t.x+s.left,t.x),Oe=this._lastBoundingBoxSize.width;G=2*xe,Y=t.x-xe,G>Oe&&!this._isInitialRender&&!this._growAfterOpen&&(Y=t.x-Oe/2)}return{top:w,left:Y,bottom:S,right:ye,width:G,height:_}}_setBoundingBoxStyles(t,n){const s=this._calculateBoundingBoxRect(t,n);!this._isInitialRender&&!this._growAfterOpen&&(s.height=Math.min(s.height,this._lastBoundingBoxSize.height),s.width=Math.min(s.width,this._lastBoundingBoxSize.width));const u={};if(this._hasExactPosition())u.top=u.left="0",u.bottom=u.right=u.maxHeight=u.maxWidth="",u.width=u.height="100%";else{const _=this._overlayRef.getConfig().maxHeight,w=this._overlayRef.getConfig().maxWidth;u.height=es(s.height),u.top=es(s.top),u.bottom=es(s.bottom),u.width=es(s.width),u.left=es(s.left),u.right=es(s.right),u.alignItems="center"===n.overlayX?"center":"end"===n.overlayX?"flex-end":"flex-start",u.justifyContent="center"===n.overlayY?"center":"bottom"===n.overlayY?"flex-end":"flex-start",_&&(u.maxHeight=es(_)),w&&(u.maxWidth=es(w))}this._lastBoundingBoxSize=s,Xg(this._boundingBox.style,u)}_resetBoundingBoxStyles(){Xg(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Xg(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,n){const s={},u=this._hasExactPosition(),_=this._hasFlexibleDimensions,w=this._overlayRef.getConfig();if(u){const G=this._viewportRuler.getViewportScrollPosition();Xg(s,this._getExactOverlayY(n,t,G)),Xg(s,this._getExactOverlayX(n,t,G))}else s.position="static";let S="",P=this._getOffset(n,"x"),z=this._getOffset(n,"y");P&&(S+=`translateX(${P}px) `),z&&(S+=`translateY(${z}px)`),s.transform=S.trim(),w.maxHeight&&(u?s.maxHeight=es(w.maxHeight):_&&(s.maxHeight="")),w.maxWidth&&(u?s.maxWidth=es(w.maxWidth):_&&(s.maxWidth="")),Xg(this._pane.style,s)}_getExactOverlayY(t,n,s){let u={top:"",bottom:""},_=this._getOverlayPoint(n,this._overlayRect,t);return this._isPushed&&(_=this._pushOverlayOnScreen(_,this._overlayRect,s)),"bottom"===t.overlayY?u.bottom=this._document.documentElement.clientHeight-(_.y+this._overlayRect.height)+"px":u.top=es(_.y),u}_getExactOverlayX(t,n,s){let w,u={left:"",right:""},_=this._getOverlayPoint(n,this._overlayRect,t);return this._isPushed&&(_=this._pushOverlayOnScreen(_,this._overlayRect,s)),w=this._isRtl()?"end"===t.overlayX?"left":"right":"end"===t.overlayX?"right":"left","right"===w?u.right=this._document.documentElement.clientWidth-(_.x+this._overlayRect.width)+"px":u.left=es(_.x),u}_getScrollVisibility(){const t=this._getOriginRect(),n=this._pane.getBoundingClientRect(),s=this._scrollables.map(u=>u.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:R2(t,s),isOriginOutsideView:eD(t,s),isOverlayClipped:R2(n,s),isOverlayOutsideView:eD(n,s)}}_subtractOverflows(t,...n){return n.reduce((s,u)=>s-Math.max(u,0),t)}_getNarrowedViewportRect(){const t=this._document.documentElement.clientWidth,n=this._document.documentElement.clientHeight,s=this._viewportRuler.getViewportScrollPosition();return{top:s.top+this._viewportMargin,left:s.left+this._viewportMargin,right:s.left+t-this._viewportMargin,bottom:s.top+n-this._viewportMargin,width:t-2*this._viewportMargin,height:n-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,n){return"x"===n?null==t.offsetX?this._offsetX:t.offsetX:null==t.offsetY?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&J1(t).forEach(n=>{""!==n&&-1===this._appliedPanelClasses.indexOf(n)&&(this._appliedPanelClasses.push(n),this._pane.classList.add(n))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getOriginRect(){const t=this._origin;if(t instanceof Yo)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();const n=t.width||0,s=t.height||0;return{top:t.y,bottom:t.y+s,left:t.x,right:t.x+n,height:s,width:n}}}function Xg(e,t){for(let n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function L2(e){if("number"!=typeof e&&null!=e){const[t,n]=e.split(mV);return n&&"px"!==n?null:parseFloat(t)}return e||null}function N2(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}const z2="cdk-global-overlay-wrapper";class _V{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(t){const n=t.getConfig();this._overlayRef=t,this._width&&!n.width&&t.updateSize({width:this._width}),this._height&&!n.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(z2),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const t=this._overlayRef.overlayElement.style,n=this._overlayRef.hostElement.style,s=this._overlayRef.getConfig(),{width:u,height:_,maxWidth:w,maxHeight:S}=s,P=!("100%"!==u&&"100vw"!==u||w&&"100%"!==w&&"100vw"!==w),z=!("100%"!==_&&"100vh"!==_||S&&"100%"!==S&&"100vh"!==S),G=this._xPosition,Y=this._xOffset,ye="rtl"===this._overlayRef.getConfig().direction;let xe="",Oe="",ze="";P?ze="flex-start":"center"===G?(ze="center",ye?Oe=Y:xe=Y):ye?"left"===G||"end"===G?(ze="flex-end",xe=Y):("right"===G||"start"===G)&&(ze="flex-start",Oe=Y):"left"===G||"start"===G?(ze="flex-start",xe=Y):("right"===G||"end"===G)&&(ze="flex-end",Oe=Y),t.position=this._cssPosition,t.marginLeft=P?"0":xe,t.marginTop=z?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=P?"0":Oe,n.justifyContent=ze,n.alignItems=z?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const t=this._overlayRef.overlayElement.style,n=this._overlayRef.hostElement,s=n.style;n.classList.remove(z2),s.justifyContent=s.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}}let yV=(()=>{class e{constructor(n,s,u,_){this._viewportRuler=n,this._document=s,this._platform=u,this._overlayContainer=_}global(){return new _V}flexibleConnectedTo(n){return new gV(n,this._viewportRuler,this._document,this._platform,this._overlayContainer)}static{this.\u0275fac=function(s){return new(s||e)(gt(D2),gt(br),gt(Od),gt(oE))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),vV=0,pv=(()=>{class e{constructor(n,s,u,_,w,S,P,z,G,Y,ye,xe){this.scrollStrategies=n,this._overlayContainer=s,this._componentFactoryResolver=u,this._positionBuilder=_,this._keyboardDispatcher=w,this._injector=S,this._ngZone=P,this._document=z,this._directionality=G,this._location=Y,this._outsideClickDispatcher=ye,this._animationsModuleType=xe}create(n){const s=this._createHostElement(),u=this._createPaneElement(s),_=this._createPortalOutlet(u),w=new O2(n);return w.direction=w.direction||this._directionality.value,new Yx(_,s,u,w,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(n){const s=this._document.createElement("div");return s.id="cdk-overlay-"+vV++,s.classList.add("cdk-overlay-pane"),n.appendChild(s),s}_createHostElement(){const n=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(n),n}_createPortalOutlet(n){return this._appRef||(this._appRef=this._injector.get(Ug)),new aV(n,this._componentFactoryResolver,this._appRef,this._injector,this._document)}static{this.\u0275fac=function(s){return new(s||e)(gt(dV),gt(oE),gt(fp),gt(yV),gt(fV),gt(Ko),gt(Ti),gt(br),gt(WS),gt(jC),gt(pV),gt(rg,8))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const wV={provide:new Ht("cdk-connected-overlay-scroll-strategy"),deps:[pv],useFactory:function bV(e){return()=>e.scrollStrategies.reposition()}};let B2=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({providers:[pv,wV],imports:[Xx,rE,ZS,ZS]})}}return e})();function tD(e,...t){return t.length?t.some(n=>e[n]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}function U2(e){return uf((t,n)=>e<=n)}let UV=(()=>{class e{create(n){return typeof MutationObserver>"u"?null:new MutationObserver(n)}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),HV=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({providers:[UV]})}}return e})();const{isArray:GV}=Array,{getPrototypeOf:$V,prototype:qV,keys:WV}=Object;function XV(...e){const t=Si(e),n=function ji(e){return Yi($i(e))?e.pop():void 0}(e),{args:s,keys:u}=function H2(e){if(1===e.length){const t=e[0];if(GV(t))return{args:t,keys:null};if(function ZV(e){return e&&"object"==typeof e&&$V(e)===qV}(t)){const n=WV(t);return{args:n.map(s=>t[s]),keys:n}}}return{args:e,keys:null}}(e);if(0===s.length)return Ra([],t);const _=new Vi(function YV(e,t,n=oo){return s=>{$2(t,()=>{const{length:u}=e,_=new Array(u);let w=u,S=u;for(let P=0;P<u;P++)$2(t,()=>{const z=Ra(e[P],t);let G=!1;z.subscribe(nr(s,Y=>{_[P]=Y,G||(G=!0,S--),S||s.next(n(_.slice()))},()=>{--w||s.complete()}))},s)},s)}}(s,t,u?w=>function G2(e,t){return e.reduce((n,s,u)=>(n[s]=t[u],n),{})}(u,w):oo));return n?_.pipe(NS(n)):_}function $2(e,t,n){e?un(n,e,t):t()}function nD(...e){return function KV(){return ir(1)}()(Ra(e,Si(e)))}function iD(...e){const t=Si(e);return gi((n,s)=>{(t?nD(e,n,t):nD(e,n)).subscribe(s)})}const q2=new Set;let Yg,JV=(()=>{class e{constructor(n,s){this._platform=n,this._nonce=s,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):e5}matchMedia(n){return(this._platform.WEBKIT||this._platform.BLINK)&&function QV(e,t){if(!q2.has(e))try{Yg||(Yg=document.createElement("style"),t&&(Yg.nonce=t),Yg.setAttribute("type","text/css"),document.head.appendChild(Yg)),Yg.sheet&&(Yg.sheet.insertRule(`@media ${e} {body{ }}`,0),q2.add(e))}catch(n){console.error(n)}}(n,this._nonce),this._matchMedia(n)}static{this.\u0275fac=function(s){return new(s||e)(gt(Od),gt(cp,8))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function e5(e){return{matches:"all"===e||""===e,media:e,addListener:()=>{},removeListener:()=>{}}}let t5=(()=>{class e{constructor(n,s){this._mediaMatcher=n,this._zone=s,this._queries=new Map,this._destroySubject=new Gi}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(n){return W2(J1(n)).some(u=>this._registerQuery(u).mql.matches)}observe(n){let _=XV(W2(J1(n)).map(w=>this._registerQuery(w).observable));return _=nD(_.pipe(fv(1)),_.pipe(U2(1),function j2(e,t=US){return gi((n,s)=>{let u=null,_=null,w=null;const S=()=>{if(u){u.unsubscribe(),u=null;const z=_;_=null,s.next(z)}};function P(){const z=w+e,G=t.now();if(G<z)return u=this.schedule(void 0,z-G),void s.add(u);S()}n.subscribe(nr(s,z=>{_=z,w=t.now(),u||(u=t.schedule(P,e),s.add(u))},()=>{S(),s.complete()},void 0,()=>{_=u=null}))})}(0))),_.pipe(Mo(w=>{const S={matches:!1,breakpoints:{}};return w.forEach(({matches:P,query:z})=>{S.matches=S.matches||P,S.breakpoints[z]=P}),S}))}_registerQuery(n){if(this._queries.has(n))return this._queries.get(n);const s=this._mediaMatcher.matchMedia(n),_={observable:new Vi(w=>{const S=P=>this._zone.run(()=>w.next(P));return s.addListener(S),()=>{s.removeListener(S)}}).pipe(iD(s),Mo(({matches:w})=>({query:n,matches:w})),XS(this._destroySubject)),mql:s};return this._queries.set(n,_),_}static{this.\u0275fac=function(s){return new(s||e)(gt(JV),gt(Ti))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function W2(e){return e.map(t=>t.split(",")).reduce((t,n)=>t.concat(n)).map(t=>t.trim())}let sE=(()=>{class e{constructor(n){this._platform=n}isDisabled(n){return n.hasAttribute("disabled")}isVisible(n){return function a5(e){return!!(e.offsetWidth||e.offsetHeight||"function"==typeof e.getClientRects&&e.getClientRects().length)}(n)&&"visible"===getComputedStyle(n).visibility}isTabbable(n){if(!this._platform.isBrowser)return!1;const s=function s5(e){try{return e.frameElement}catch{return null}}(function m5(e){return e.ownerDocument&&e.ownerDocument.defaultView||window}(n));if(s&&(-1===K2(s)||!this.isVisible(s)))return!1;let u=n.nodeName.toLowerCase(),_=K2(n);return n.hasAttribute("contenteditable")?-1!==_:!("iframe"===u||"object"===u||this._platform.WEBKIT&&this._platform.IOS&&!function f5(e){let t=e.nodeName.toLowerCase(),n="input"===t&&e.type;return"text"===n||"password"===n||"select"===t||"textarea"===t}(n))&&("audio"===u?!!n.hasAttribute("controls")&&-1!==_:"video"===u?-1!==_&&(null!==_||this._platform.FIREFOX||n.hasAttribute("controls")):n.tabIndex>=0)}isFocusable(n,s){return function p5(e){return!function c5(e){return function d5(e){return"input"==e.nodeName.toLowerCase()}(e)&&"hidden"==e.type}(e)&&(function l5(e){let t=e.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(e)||function u5(e){return function h5(e){return"a"==e.nodeName.toLowerCase()}(e)&&e.hasAttribute("href")}(e)||e.hasAttribute("contenteditable")||Y2(e))}(n)&&!this.isDisabled(n)&&(s?.ignoreVisibility||this.isVisible(n))}static{this.\u0275fac=function(s){return new(s||e)(gt(Od))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Y2(e){if(!e.hasAttribute("tabindex")||void 0===e.tabIndex)return!1;let t=e.getAttribute("tabindex");return!(!t||isNaN(parseInt(t,10)))}function K2(e){if(!Y2(e))return null;const t=parseInt(e.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}class J2{get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}constructor(t,n,s,u,_=!1){this._element=t,this._checker=n,this._ngZone=s,this._document=u,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,_||this.attachAnchors()}destroy(){const t=this._startAnchor,n=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),n&&(n.removeEventListener("focus",this.endAnchorListener),n.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return!!this._hasAttached||(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(n=>{this._executeOnStable(()=>n(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(n=>{this._executeOnStable(()=>n(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(n=>{this._executeOnStable(()=>n(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){const n=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return"start"==t?n.length?n[0]:this._getFirstTabbableElement(this._element):n.length?n[n.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){const n=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(n){if(!this._checker.isFocusable(n)){const s=this._getFirstTabbableElement(n);return s?.focus(t),!!s}return n.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){const n=this._getRegionBoundary("start");return n&&n.focus(t),!!n}focusLastTabbableElement(t){const n=this._getRegionBoundary("end");return n&&n.focus(t),!!n}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const n=t.children;for(let s=0;s<n.length;s++){const u=n[s].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(n[s]):null;if(u)return u}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;const n=t.children;for(let s=n.length-1;s>=0;s--){const u=n[s].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(n[s]):null;if(u)return u}return null}_createAnchor(){const t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,n){t?n.setAttribute("tabindex","0"):n.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._ngZone.isStable?t():this._ngZone.onStable.pipe(fv(1)).subscribe(t)}}let rD=(()=>{class e{constructor(n,s,u){this._checker=n,this._ngZone=s,this._document=u}create(n,s=!1){return new J2(n,this._checker,this._ngZone,this._document,s)}static{this.\u0275fac=function(s){return new(s||e)(gt(sE),gt(Ti),gt(br))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function Q2(e){return 0===e.buttons||0===e.detail}function eP(e){const t=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}const g5=new Ht("cdk-input-modality-detector-options"),_5={ignoreKeys:[18,17,224,91,16]},mv=nE({passive:!0,capture:!0});let y5=(()=>{class e{get mostRecentModality(){return this._modality.value}constructor(n,s,u,_){this._platform=n,this._mostRecentTarget=null,this._modality=new ku(null),this._lastTouchMs=0,this._onKeydown=w=>{this._options?.ignoreKeys?.some(S=>S===w.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Up(w))},this._onMousedown=w=>{Date.now()-this._lastTouchMs<650||(this._modality.next(Q2(w)?"keyboard":"mouse"),this._mostRecentTarget=Up(w))},this._onTouchstart=w=>{eP(w)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Up(w))},this._options={..._5,..._},this.modalityDetected=this._modality.pipe(U2(1)),this.modalityChanged=this.modalityDetected.pipe(Oa()),n.isBrowser&&s.runOutsideAngular(()=>{u.addEventListener("keydown",this._onKeydown,mv),u.addEventListener("mousedown",this._onMousedown,mv),u.addEventListener("touchstart",this._onTouchstart,mv)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,mv),document.removeEventListener("mousedown",this._onMousedown,mv),document.removeEventListener("touchstart",this._onTouchstart,mv))}static{this.\u0275fac=function(s){return new(s||e)(gt(Od),gt(Ti),gt(br),gt(g5,8))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const x5=new Ht("cdk-focus-monitor-default-options"),aE=nE({passive:!0,capture:!0});let oD=(()=>{class e{constructor(n,s,u,_,w){this._ngZone=n,this._platform=s,this._inputModalityDetector=u,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Gi,this._rootNodeFocusAndBlurListener=S=>{for(let z=Up(S);z;z=z.parentElement)"focus"===S.type?this._onFocus(S,z):this._onBlur(S,z)},this._document=_,this._detectionMode=w?.detectionMode||0}monitor(n,s=!1){const u=dv(n);if(!this._platform.isBrowser||1!==u.nodeType)return nl();const _=function J3(e){if(function K3(){if(null==GS){const e=typeof document<"u"?document.head:null;GS=!(!e||!e.createShadowRoot&&!e.attachShadow)}return GS}()){const t=e.getRootNode?e.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(u)||this._getDocument(),w=this._elementInfo.get(u);if(w)return s&&(w.checkChildren=!0),w.subject;const S={checkChildren:s,subject:new Gi,rootNode:_};return this._elementInfo.set(u,S),this._registerGlobalListeners(S),S.subject}stopMonitoring(n){const s=dv(n),u=this._elementInfo.get(s);u&&(u.subject.complete(),this._setClasses(s),this._elementInfo.delete(s),this._removeGlobalListeners(u))}focusVia(n,s,u){const _=dv(n);_===this._getDocument().activeElement?this._getClosestElementsInfo(_).forEach(([S,P])=>this._originChanged(S,s,P)):(this._setOrigin(s),"function"==typeof _.focus&&_.focus(u))}ngOnDestroy(){this._elementInfo.forEach((n,s)=>this.stopMonitoring(s))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(n){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(n)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:n&&this._isLastInteractionFromInputLabel(n)?"mouse":"program"}_shouldBeAttributedToTouch(n){return 1===this._detectionMode||!!n?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(n,s){n.classList.toggle("cdk-focused",!!s),n.classList.toggle("cdk-touch-focused","touch"===s),n.classList.toggle("cdk-keyboard-focused","keyboard"===s),n.classList.toggle("cdk-mouse-focused","mouse"===s),n.classList.toggle("cdk-program-focused","program"===s)}_setOrigin(n,s=!1){this._ngZone.runOutsideAngular(()=>{this._origin=n,this._originFromTouchInteraction="touch"===n&&s,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(n,s){const u=this._elementInfo.get(s),_=Up(n);!u||!u.checkChildren&&s!==_||this._originChanged(s,this._getFocusOrigin(_),u)}_onBlur(n,s){const u=this._elementInfo.get(s);!u||u.checkChildren&&n.relatedTarget instanceof Node&&s.contains(n.relatedTarget)||(this._setClasses(s),this._emitOrigin(u,null))}_emitOrigin(n,s){n.subject.observers.length&&this._ngZone.run(()=>n.subject.next(s))}_registerGlobalListeners(n){if(!this._platform.isBrowser)return;const s=n.rootNode,u=this._rootNodeFocusListenerCount.get(s)||0;u||this._ngZone.runOutsideAngular(()=>{s.addEventListener("focus",this._rootNodeFocusAndBlurListener,aE),s.addEventListener("blur",this._rootNodeFocusAndBlurListener,aE)}),this._rootNodeFocusListenerCount.set(s,u+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(XS(this._stopInputModalityDetector)).subscribe(_=>{this._setOrigin(_,!0)}))}_removeGlobalListeners(n){const s=n.rootNode;if(this._rootNodeFocusListenerCount.has(s)){const u=this._rootNodeFocusListenerCount.get(s);u>1?this._rootNodeFocusListenerCount.set(s,u-1):(s.removeEventListener("focus",this._rootNodeFocusAndBlurListener,aE),s.removeEventListener("blur",this._rootNodeFocusAndBlurListener,aE),this._rootNodeFocusListenerCount.delete(s))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(n,s,u){this._setClasses(n,s),this._emitOrigin(u,s),this._lastFocusOrigin=s}_getClosestElementsInfo(n){const s=[];return this._elementInfo.forEach((u,_)=>{(_===n||u.checkChildren&&_.contains(n))&&s.push([_,u])}),s}_isLastInteractionFromInputLabel(n){const{_mostRecentTarget:s,mostRecentModality:u}=this._inputModalityDetector;if("mouse"!==u||!s||s===n||"INPUT"!==n.nodeName&&"TEXTAREA"!==n.nodeName||n.disabled)return!1;const _=n.labels;if(_)for(let w=0;w<_.length;w++)if(_[w].contains(s))return!0;return!1}static{this.\u0275fac=function(s){return new(s||e)(gt(Ti),gt(Od),gt(y5),gt(br,8),gt(x5,8))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const nP="cdk-high-contrast-black-on-white",iP="cdk-high-contrast-white-on-black",sD="cdk-high-contrast-active";let rP=(()=>{class e{constructor(n,s){this._platform=n,this._document=s,this._breakpointSubscription=$n(t5).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const n=this._document.createElement("div");n.style.backgroundColor="rgb(1,2,3)",n.style.position="absolute",this._document.body.appendChild(n);const s=this._document.defaultView||window,u=s&&s.getComputedStyle?s.getComputedStyle(n):null,_=(u&&u.backgroundColor||"").replace(/ /g,"");switch(n.remove(),_){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const n=this._document.body.classList;n.remove(sD,nP,iP),this._hasCheckedHighContrastMode=!0;const s=this.getHighContrastMode();1===s?n.add(sD,nP):2===s&&n.add(sD,iP)}}static{this.\u0275fac=function(s){return new(s||e)(gt(Od),gt(br))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})(),b5=(()=>{class e{constructor(n){n._applyBodyHighContrastModeCssClasses()}static{this.\u0275fac=function(s){return new(s||e)(gt(rP))}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({imports:[HV]})}}return e})();function oP(e){return new Vi(t=>{Ie(e()).subscribe(t)})}function w5(e,t){}class lE{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}}let sP=(()=>{class e extends JS{constructor(n,s,u,_,w,S,P,z){super(),this._elementRef=n,this._focusTrapFactory=s,this._config=_,this._interactivityChecker=w,this._ngZone=S,this._overlayRef=P,this._focusMonitor=z,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this.attachDomPortal=G=>{this._portalOutlet.hasAttached();const Y=this._portalOutlet.attachDomPortal(G);return this._contentAttached(),Y},this._document=u,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(n){this._portalOutlet.hasAttached();const s=this._portalOutlet.attachComponentPortal(n);return this._contentAttached(),s}attachTemplatePortal(n){this._portalOutlet.hasAttached();const s=this._portalOutlet.attachTemplatePortal(n);return this._contentAttached(),s}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(n,s){this._interactivityChecker.isFocusable(n)||(n.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const u=()=>{n.removeEventListener("blur",u),n.removeEventListener("mousedown",u),n.removeAttribute("tabindex")};n.addEventListener("blur",u),n.addEventListener("mousedown",u)})),n.focus(s)}_focusByCssSelector(n,s){let u=this._elementRef.nativeElement.querySelector(n);u&&this._forceFocus(u,s)}_trapFocus(){const n=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||n.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(s=>{s||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const n=this._config.restoreFocus;let s=null;if("string"==typeof n?s=this._document.querySelector(n):"boolean"==typeof n?s=n?this._elementFocusedBeforeDialogWasOpened:null:n&&(s=n),this._config.restoreFocus&&s&&"function"==typeof s.focus){const u=$S(),_=this._elementRef.nativeElement;(!u||u===this._document.body||u===_||_.contains(u))&&(this._focusMonitor?(this._focusMonitor.focusVia(s,this._closeInteractionType),this._closeInteractionType=null):s.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const n=this._elementRef.nativeElement,s=$S();return n===s||n.contains(s)}_initializeFocusTrap(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=$S())}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}static{this.\u0275fac=function(s){return new(s||e)(Tt(Yo),Tt(rD),Tt(br,8),Tt(lE),Tt(sE),Tt(Ti),Tt(Yx),Tt(oD))}}static{this.\u0275cmp=Yl({type:e,selectors:[["cdk-dialog-container"]],viewQuery:function(s,u){if(1&s&&BI(QS,7),2&s){let _;zI(_=function VI(){return function Dk(e,t){return e[as].queries[t].queryList}(Mt(),Jc())}())&&(u._portalOutlet=_.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(s,u){2&s&&Ha("id",u._config.id||null)("role",u._config.role)("aria-modal",u._config.ariaModal)("aria-labelledby",u._config.ariaLabel?null:u._ariaLabelledByQueue[0])("aria-label",u._config.ariaLabel)("aria-describedby",u._config.ariaDescribedBy||null)},features:[zi],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(s,u){1&s&&Rg(0,w5,0,0,"ng-template",0)},dependencies:[QS],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2})}}return e})();class aD{constructor(t,n){this.overlayRef=t,this.config=n,this.closed=new Gi,this.disableClose=n.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=n.id,this.keydownEvents.subscribe(s=>{27===s.keyCode&&!this.disableClose&&!tD(s)&&(s.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=t.detachments().subscribe(()=>{!1!==n.closeOnOverlayDetachments&&this.close()})}close(t,n){if(this.containerInstance){const s=this.closed;this.containerInstance._closeInteractionType=n?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),s.next(t),s.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",n=""){return this.overlayRef.updateSize({width:t,height:n}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}}const aP=new Ht("DialogScrollStrategy"),E5=new Ht("DialogData"),T5=new Ht("DefaultDialogConfig"),S5={provide:aP,deps:[pv],useFactory:function C5(e){return()=>e.scrollStrategies.block()}};let D5=0,lP=(()=>{class e{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(n,s,u,_,w,S){this._overlay=n,this._injector=s,this._defaultOptions=u,this._parentDialog=_,this._overlayContainer=w,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Gi,this._afterOpenedAtThisLevel=new Gi,this._ariaHiddenElements=new Map,this.afterAllClosed=oP(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(iD(void 0))),this._scrollStrategy=S}open(n,s){(s={...this._defaultOptions||new lE,...s}).id=s.id||"cdk-dialog-"+D5++,s.id&&this.getDialogById(s.id);const _=this._getOverlayConfig(s),w=this._overlay.create(_),S=new aD(w,s),P=this._attachContainer(w,S,s);return S.containerInstance=P,this._attachDialogContent(n,S,P,s),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(S),S.closed.subscribe(()=>this._removeOpenDialog(S,!0)),this.afterOpened.next(S),S}closeAll(){lD(this.openDialogs,n=>n.close())}getDialogById(n){return this.openDialogs.find(s=>s.id===n)}ngOnDestroy(){lD(this._openDialogsAtThisLevel,n=>{!1===n.config.closeOnDestroy&&this._removeOpenDialog(n,!1)}),lD(this._openDialogsAtThisLevel,n=>n.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(n){const s=new O2({positionStrategy:n.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:n.scrollStrategy||this._scrollStrategy(),panelClass:n.panelClass,hasBackdrop:n.hasBackdrop,direction:n.direction,minWidth:n.minWidth,minHeight:n.minHeight,maxWidth:n.maxWidth,maxHeight:n.maxHeight,width:n.width,height:n.height,disposeOnNavigation:n.closeOnNavigation});return n.backdropClass&&(s.backdropClass=n.backdropClass),s}_attachContainer(n,s,u){const _=u.injector||u.viewContainerRef?.injector,w=[{provide:lE,useValue:u},{provide:aD,useValue:s},{provide:Yx,useValue:n}];let S;u.container?"function"==typeof u.container?S=u.container:(S=u.container.type,w.push(...u.container.providers(u))):S=sP;const P=new KS(S,u.viewContainerRef,Ko.create({parent:_||this._injector,providers:w}),u.componentFactoryResolver);return n.attach(P).instance}_attachDialogContent(n,s,u,_){if(n instanceof Md){const w=this._createInjector(_,s,u,void 0);let S={$implicit:_.data,dialogRef:s};_.templateContext&&(S={...S,..."function"==typeof _.templateContext?_.templateContext():_.templateContext}),u.attachTemplatePortal(new A2(n,null,S,w))}else{const w=this._createInjector(_,s,u,this._injector),S=u.attachComponentPortal(new KS(n,_.viewContainerRef,w,_.componentFactoryResolver));s.componentRef=S,s.componentInstance=S.instance}}_createInjector(n,s,u,_){const w=n.injector||n.viewContainerRef?.injector,S=[{provide:E5,useValue:n.data},{provide:aD,useValue:s}];return n.providers&&("function"==typeof n.providers?S.push(...n.providers(s,n,u)):S.push(...n.providers)),n.direction&&(!w||!w.get(WS,null,{optional:!0}))&&S.push({provide:WS,useValue:{value:n.direction,change:nl()}}),Ko.create({parent:w||_,providers:S})}_removeOpenDialog(n,s){const u=this.openDialogs.indexOf(n);u>-1&&(this.openDialogs.splice(u,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((_,w)=>{_?w.setAttribute("aria-hidden",_):w.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),s&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const n=this._overlayContainer.getContainerElement();if(n.parentElement){const s=n.parentElement.children;for(let u=s.length-1;u>-1;u--){const _=s[u];_!==n&&"SCRIPT"!==_.nodeName&&"STYLE"!==_.nodeName&&!_.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(_,_.getAttribute("aria-hidden")),_.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){const n=this._parentDialog;return n?n._getAfterAllClosed():this._afterAllClosedAtThisLevel}static{this.\u0275fac=function(s){return new(s||e)(gt(pv),gt(Ko),gt(T5,8),gt(e,12),gt(oE),gt(aP))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})();function lD(e,t){let n=e.length;for(;n--;)t(e[n])}let I5=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({providers:[lP,S5],imports:[B2,rE,b5,rE]})}}return e})();const M5=new Ht("mat-sanity-checks",{providedIn:"root",factory:function A5(){return!0}});let gv=(()=>{class e{constructor(n,s,u){this._sanityChecks=s,this._document=u,this._hasDoneGlobalChecks=!1,n._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(n){return!qS()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[n])}static{this.\u0275fac=function(s){return new(s||e)(gt(rP),gt(M5,8),gt(br))}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({imports:[Xx,Xx]})}}return e})();const dP=nE({passive:!0,capture:!0});class O5{constructor(){this._events=new Map,this._delegateEventHandler=t=>{const n=Up(t);n&&this._events.get(t.type)?.forEach((s,u)=>{(u===n||u.contains(n))&&s.forEach(_=>_.handleEvent(t))})}}addHandler(t,n,s,u){const _=this._events.get(n);if(_){const w=_.get(s);w?w.add(u):_.set(s,new Set([u]))}else this._events.set(n,new Map([[s,new Set([u])]])),t.runOutsideAngular(()=>{document.addEventListener(n,this._delegateEventHandler,dP)})}removeHandler(t,n,s){const u=this._events.get(t);if(!u)return;const _=u.get(n);_&&(_.delete(s),0===_.size&&u.delete(n),0===u.size&&(this._events.delete(t),document.removeEventListener(t,this._delegateEventHandler,dP)))}}class cD{static{this._eventManager=new O5}constructor(t,n,s,u){this._target=t,this._ngZone=n,this._platform=u,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,u.isBrowser&&(this._containerElement=dv(s))}fadeInRipple(t,n,s={}){const u=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),_={...hP,...s.animation},w=s.radius||function F5(e,t,n){const s=Math.max(Math.abs(e-n.left),Math.abs(e-n.right)),u=Math.max(Math.abs(t-n.top),Math.abs(t-n.bottom));return Math.sqrt(s*s+u*u)}(t,n,u),S=t-u.left,P=n-u.top,z=_.enterDuration,G=document.createElement("div");G.classList.add("mat-ripple-element"),G.style.left=S-w+"px",G.style.top=P-w+"px",G.style.height=2*w+"px",G.style.width=2*w+"px",null!=s.color&&(G.style.backgroundColor=s.color),G.style.transitionDuration=`${z}ms`,this._containerElement.appendChild(G);const Y=window.getComputedStyle(G),xe=Y.transitionDuration,Oe="none"===Y.transitionProperty||"0s"===xe||"0s, 0s"===xe||0===u.width&&0===u.height,ze=new R5(this,G,s,Oe);G.style.transform="scale3d(1, 1, 1)",ze.state=0,s.persistent||(this._mostRecentTransientRipple=ze);return!Oe&&(z||_.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const Ct=()=>this._finishRippleTransition(ze),ut=()=>this._destroyRipple(ze);G.addEventListener("transitionend",Ct),G.addEventListener("transitioncancel",ut)}),this._activeRipples.set(ze,null),(Oe||!z)&&this._finishRippleTransition(ze),ze}fadeOutRipple(t){if(2===t.state||3===t.state)return;const n=t.element,s={...hP,...t.config.animation};n.style.transitionDuration=`${s.exitDuration}ms`,n.style.opacity="0",t.state=2,(t._animationForciblyDisabledThroughCss||!s.exitDuration)&&this._finishRippleTransition(t)}fadeOutAll(){this._getActiveRipples().forEach(t=>t.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(t=>{t.config.persistent||t.fadeOut()})}setupTriggerEvents(t){const n=dv(t);!this._platform.isBrowser||!n||n===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=n,pP.forEach(s=>{cD._eventManager.addHandler(this._ngZone,s,n,this)}))}handleEvent(t){"mousedown"===t.type?this._onMousedown(t):"touchstart"===t.type?this._onTouchStart(t):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{mP.forEach(n=>{this._triggerElement.addEventListener(n,this,fP)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(t){0===t.state?this._startFadeOutTransition(t):2===t.state&&this._destroyRipple(t)}_startFadeOutTransition(t){const n=t===this._mostRecentTransientRipple,{persistent:s}=t.config;t.state=1,!s&&(!n||!this._isPointerDown)&&t.fadeOut()}_destroyRipple(t){const n=this._activeRipples.get(t)??null;this._activeRipples.delete(t),this._activeRipples.size||(this._containerRect=null),t===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),t.state=3,null!==n&&(t.element.removeEventListener("transitionend",n.onTransitionEnd),t.element.removeEventListener("transitioncancel",n.onTransitionCancel)),t.element.remove()}_onMousedown(t){const n=Q2(t),s=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!n&&!s&&(this._isPointerDown=!0,this.fadeInRipple(t.clientX,t.clientY,this._target.rippleConfig))}_onTouchStart(t){if(!this._target.rippleDisabled&&!eP(t)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const n=t.changedTouches;if(n)for(let s=0;s<n.length;s++)this.fadeInRipple(n[s].clientX,n[s].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(t=>{!t.config.persistent&&(1===t.state||t.config.terminateOnPointerUp&&0===t.state)&&t.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const t=this._triggerElement;t&&(pP.forEach(n=>cD._eventManager.removeHandler(n,t,this)),this._pointerUpEventsRegistered&&mP.forEach(n=>t.removeEventListener(n,this,fP)))}}let L5=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({imports:[gv,gv]})}}return e})();function N5(e,t){}class cE{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}}const uD="mdc-dialog--open",gP="mdc-dialog--opening",_P="mdc-dialog--closing";let V5=(()=>{class e extends sP{constructor(n,s,u,_,w,S,P,z){super(n,s,u,_,w,S,P,z),this._animationStateChanged=new fo}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(n){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:n})}static{this.\u0275fac=function(s){return new(s||e)(Tt(Yo),Tt(rD),Tt(br,8),Tt(cE),Tt(sE),Tt(Ti),Tt(Yx),Tt(oD))}}static{this.\u0275cmp=Yl({type:e,selectors:[["ng-component"]],features:[zi],decls:0,vars:0,template:function(s,u){},encapsulation:2})}}return e})();const yP="--mat-dialog-transition-duration";function vP(e){return null==e?null:"number"==typeof e?e:e.endsWith("ms")?b2(e.substring(0,e.length-2)):e.endsWith("s")?1e3*b2(e.substring(0,e.length-1)):"0"===e?0:null}let j5=(()=>{class e extends V5{constructor(n,s,u,_,w,S,P,z,G){super(n,s,u,_,w,S,P,G),this._animationMode=z,this._animationsEnabled="NoopAnimations"!==this._animationMode,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?vP(this._config.enterAnimationDuration)??150:0,this._exitAnimationDuration=this._animationsEnabled?vP(this._config.exitAnimationDuration)??75:0,this._animationTimer=null,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}ngOnDestroy(){super.ngOnDestroy(),null!==this._animationTimer&&clearTimeout(this._animationTimer)}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(yP,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(gP,uD)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(uD),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(uD),this._animationsEnabled?(this._hostElement.style.setProperty(yP,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(_P)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_clearAnimationClasses(){this._hostElement.classList.remove(gP,_P)}_waitForAnimationToComplete(n,s){null!==this._animationTimer&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(s,n)}_requestAnimationFrame(n){this._ngZone.runOutsideAngular(()=>{"function"==typeof requestAnimationFrame?requestAnimationFrame(n):n()})}static{this.\u0275fac=function(s){return new(s||e)(Tt(Yo),Tt(rD),Tt(br,8),Tt(cE),Tt(sE),Tt(Ti),Tt(Yx),Tt(rg,8),Tt(oD))}}static{this.\u0275cmp=Yl({type:e,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:8,hostBindings:function(s,u){2&s&&(vn("id",u._config.id),Ha("aria-modal",u._config.ariaModal)("role",u._config.role)("aria-labelledby",u._config.ariaLabel?null:u._ariaLabelledByQueue[0])("aria-label",u._config.ariaLabel)("aria-describedby",u._config.ariaDescribedBy||null),kp("_mat-animation-noopable",!u._animationsEnabled))},features:[zi],decls:3,vars:0,consts:[[1,"mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(s,u){1&s&&(Sl(0,"div",0)(1,"div",1),Rg(2,N5,0,0,"ng-template",2),vc()())},dependencies:[QS],styles:['.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-dialog,.mdc-dialog__scrim{position:fixed;top:0;left:0;align-items:center;justify-content:center;box-sizing:border-box;width:100%;height:100%}.mdc-dialog{display:none;z-index:var(--mdc-dialog-z-index, 7)}.mdc-dialog .mdc-dialog__content{padding:20px 24px 20px 24px}.mdc-dialog .mdc-dialog__surface{min-width:280px}@media(max-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:calc(100vw - 32px)}}@media(min-width: 592px){.mdc-dialog .mdc-dialog__surface{max-width:560px}}.mdc-dialog .mdc-dialog__surface{max-height:calc(100% - 32px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-width:none}@media(max-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px;width:560px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 112px)}}@media(max-width: 720px)and (min-width: 672px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:560px}}@media(max-width: 720px)and (max-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:calc(100vh - 160px)}}@media(max-width: 720px)and (min-height: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{max-height:560px}}@media(max-width: 720px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}@media(max-width: 720px)and (max-height: 400px),(max-width: 600px),(min-width: 720px)and (max-height: 400px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{height:100%;max-height:100vh;max-width:100vw;width:100vw;border-radius:0}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{order:-1;left:-12px}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__header{padding:0 16px 9px;justify-content:flex-start}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__title{margin-left:calc(16px - 2 * 12px)}}@media(min-width: 960px){.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface{width:calc(100vw - 400px)}.mdc-dialog.mdc-dialog--fullscreen .mdc-dialog__surface .mdc-dialog__close{right:-12px}}.mdc-dialog.mdc-dialog__scrim--hidden .mdc-dialog__scrim{opacity:0}.mdc-dialog__scrim{opacity:0;z-index:-1}.mdc-dialog__container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;transform:scale(0.8);opacity:0;pointer-events:none}.mdc-dialog__surface{position:relative;display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;max-width:100%;max-height:100%;pointer-events:auto;overflow-y:auto;outline:0}.mdc-dialog__surface .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}[dir=rtl] .mdc-dialog__surface,.mdc-dialog__surface[dir=rtl]{text-align:right}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-dialog__surface{outline:2px solid windowText}}.mdc-dialog__surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}@media screen and (forced-colors: active){.mdc-dialog__surface::before{border-color:CanvasText}}@media screen and (-ms-high-contrast: active),screen and (-ms-high-contrast: none){.mdc-dialog__surface::before{content:none}}.mdc-dialog__title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:0 24px 9px}.mdc-dialog__title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mdc-dialog__title,.mdc-dialog__title[dir=rtl]{text-align:right}.mdc-dialog--scrollable .mdc-dialog__title{margin-bottom:1px;padding-bottom:15px}.mdc-dialog--fullscreen .mdc-dialog__header{align-items:baseline;border-bottom:1px solid rgba(0,0,0,0);display:inline-flex;justify-content:space-between;padding:0 24px 9px;z-index:1}@media screen and (forced-colors: active){.mdc-dialog--fullscreen .mdc-dialog__header{border-bottom-color:CanvasText}}.mdc-dialog--fullscreen .mdc-dialog__header .mdc-dialog__close{right:-12px}.mdc-dialog--fullscreen .mdc-dialog__title{margin-bottom:0;padding:0;border-bottom:0}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__title{border-bottom:0;margin-bottom:0}.mdc-dialog--fullscreen .mdc-dialog__close{top:5px}.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog--fullscreen.mdc-dialog--scrollable .mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--fullscreen--titleless .mdc-dialog__close{margin-top:4px}.mdc-dialog--fullscreen--titleless.mdc-dialog--scrollable .mdc-dialog__close{margin-top:0}.mdc-dialog__content{flex-grow:1;box-sizing:border-box;margin:0;overflow:auto}.mdc-dialog__content>:first-child{margin-top:0}.mdc-dialog__content>:last-child{margin-bottom:0}.mdc-dialog__title+.mdc-dialog__content,.mdc-dialog__header+.mdc-dialog__content{padding-top:0}.mdc-dialog--scrollable .mdc-dialog__title+.mdc-dialog__content{padding-top:8px;padding-bottom:8px}.mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:6px 0 0}.mdc-dialog--scrollable .mdc-dialog__content .mdc-deprecated-list:first-child:last-child{padding:0}.mdc-dialog__actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0)}@media screen and (forced-colors: active){.mdc-dialog__actions{border-top-color:CanvasText}}.mdc-dialog--stacked .mdc-dialog__actions{flex-direction:column;align-items:flex-end}.mdc-dialog__button{margin-left:8px;margin-right:0;max-width:100%;text-align:right}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{margin-left:0;margin-right:8px}.mdc-dialog__button:first-child{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button:first-child,.mdc-dialog__button:first-child[dir=rtl]{margin-left:0;margin-right:0}[dir=rtl] .mdc-dialog__button,.mdc-dialog__button[dir=rtl]{text-align:left}.mdc-dialog--stacked .mdc-dialog__button:not(:first-child){margin-top:12px}.mdc-dialog--open,.mdc-dialog--opening,.mdc-dialog--closing{display:flex}.mdc-dialog--opening .mdc-dialog__scrim{transition:opacity 150ms linear}.mdc-dialog--opening .mdc-dialog__container{transition:opacity 75ms linear,transform 150ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-dialog--closing .mdc-dialog__scrim,.mdc-dialog--closing .mdc-dialog__container{transition:opacity 75ms linear}.mdc-dialog--closing .mdc-dialog__container{transform:none}.mdc-dialog--open .mdc-dialog__scrim{opacity:1}.mdc-dialog--open .mdc-dialog__container{transform:none;opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim{opacity:1}.mdc-dialog--open.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{transition:opacity 75ms linear}.mdc-dialog--open.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim{transition:opacity 150ms linear}.mdc-dialog__surface-scrim{display:none;opacity:0;position:absolute;width:100%;height:100%;z-index:1}.mdc-dialog__surface-scrim--shown .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--showing .mdc-dialog__surface-scrim,.mdc-dialog__surface-scrim--hiding .mdc-dialog__surface-scrim{display:block}.mdc-dialog-scroll-lock{overflow:hidden}.mdc-dialog--no-content-padding .mdc-dialog__content{padding:0}.mdc-dialog--sheet .mdc-dialog__container .mdc-dialog__close{right:12px;top:9px;position:absolute;z-index:1}.mdc-dialog__scrim--removed{pointer-events:none}.mdc-dialog__scrim--removed .mdc-dialog__scrim,.mdc-dialog__scrim--removed .mdc-dialog__surface-scrim{display:none}.mat-mdc-dialog-content{max-height:65vh}.mat-mdc-dialog-container{position:static;display:block}.mat-mdc-dialog-container,.mat-mdc-dialog-container .mdc-dialog__container,.mat-mdc-dialog-container .mdc-dialog__surface{max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mat-mdc-dialog-container .mdc-dialog__surface{display:block;width:100%;height:100%}.mat-mdc-dialog-container{--mdc-dialog-container-elevation-shadow:0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12);--mdc-dialog-container-shadow-color:#000;--mdc-dialog-container-shape:4px;--mdc-dialog-container-elevation: var(--mdc-dialog-container-elevation-shadow);outline:0}.mat-mdc-dialog-container .mdc-dialog__surface{background-color:var(--mdc-dialog-container-color, white)}.mat-mdc-dialog-container .mdc-dialog__surface{box-shadow:var(--mdc-dialog-container-elevation, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12))}.mat-mdc-dialog-container .mdc-dialog__surface{border-radius:var(--mdc-dialog-container-shape, 4px)}.mat-mdc-dialog-container .mdc-dialog__title{font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87))}.mat-mdc-dialog-container .mdc-dialog__content{font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mdc-dialog__content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6))}.mat-mdc-dialog-container .mdc-dialog__container{transition-duration:var(--mat-dialog-transition-duration, 0ms)}.mat-mdc-dialog-container._mat-animation-noopable .mdc-dialog__container{transition:none}.mat-mdc-dialog-content{display:block}.mat-mdc-dialog-actions{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2})}}return e})();class U5{constructor(t,n,s){this._ref=t,this._containerInstance=s,this._afterOpened=new Gi,this._beforeClosed=new Gi,this._state=0,this.disableClose=n.disableClose,this.id=t.id,s._animationStateChanged.pipe(uf(u=>"opened"===u.state),fv(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),s._animationStateChanged.pipe(uf(u=>"closed"===u.state),fv(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),tl(this.backdropClick(),this.keydownEvents().pipe(uf(u=>27===u.keyCode&&!this.disableClose&&!tD(u)))).subscribe(u=>{this.disableClose||(u.preventDefault(),function H5(e,t,n){e._closeInteractionType=t,e.close(n)}(this,"keydown"===u.type?"keyboard":"mouse"))})}close(t){this._result=t,this._containerInstance._animationStateChanged.pipe(uf(n=>"closing"===n.state),fv(1)).subscribe(n=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),n.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(t){let n=this._ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?n.left(t.left):n.right(t.right):n.centerHorizontally(),t&&(t.top||t.bottom)?t.top?n.top(t.top):n.bottom(t.bottom):n.centerVertically(),this._ref.updatePosition(),this}updateSize(t="",n=""){return this._ref.updateSize(t,n),this}addPanelClass(t){return this._ref.addPanelClass(t),this}removePanelClass(t){return this._ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}}const G5=new Ht("MatMdcDialogData"),$5=new Ht("mat-mdc-dialog-default-options"),xP=new Ht("mat-mdc-dialog-scroll-strategy"),W5={provide:xP,deps:[pv],useFactory:function q5(e){return()=>e.scrollStrategies.block()}};let Z5=0,X5=(()=>{class e{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const n=this._parentDialog;return n?n._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(n,s,u,_,w,S,P,z,G,Y){this._overlay=n,this._defaultOptions=u,this._parentDialog=_,this._dialogRefConstructor=P,this._dialogContainerType=z,this._dialogDataToken=G,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Gi,this._afterOpenedAtThisLevel=new Gi,this._idPrefix="mat-dialog-",this.dialogConfigClass=cE,this.afterAllClosed=oP(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(iD(void 0))),this._scrollStrategy=S,this._dialog=s.get(lP)}open(n,s){let u;(s={...this._defaultOptions||new cE,...s}).id=s.id||`${this._idPrefix}${Z5++}`,s.scrollStrategy=s.scrollStrategy||this._scrollStrategy();const _=this._dialog.open(n,{...s,positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:s},{provide:lE,useValue:s}]},templateContext:()=>({dialogRef:u}),providers:(w,S,P)=>(u=new this._dialogRefConstructor(w,s,P),u.updatePosition(s?.position),[{provide:this._dialogContainerType,useValue:P},{provide:this._dialogDataToken,useValue:S.data},{provide:this._dialogRefConstructor,useValue:u}])});return u.componentRef=_.componentRef,u.componentInstance=_.componentInstance,this.openDialogs.push(u),this.afterOpened.next(u),u.afterClosed().subscribe(()=>{const w=this.openDialogs.indexOf(u);w>-1&&(this.openDialogs.splice(w,1),this.openDialogs.length||this._getAfterAllClosed().next())}),u}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(n){return this.openDialogs.find(s=>s.id===n)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(n){let s=n.length;for(;s--;)n[s].close()}static{this.\u0275fac=function(s){!function z0(){throw new Error("invalid")}()}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})(),Y5=(()=>{class e extends X5{constructor(n,s,u,_,w,S,P,z){super(n,s,_,S,P,w,U5,j5,G5,z),this._idPrefix="mat-mdc-dialog-"}static{this.\u0275fac=function(s){return new(s||e)(gt(pv),gt(Ko),gt(jC,8),gt($5,8),gt(xP),gt(e,12),gt(oE),gt(rg,8))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})(),K5=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({providers:[Y5,W5],imports:[I5,B2,rE,gv,gv]})}}return e})(),e4=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({imports:[gv,L5,gv]})}}return e})();function wP(e,t,n,s,u,_,w){try{var S=e[_](w),P=S.value}catch(z){return void n(z)}S.done?t(P):Promise.resolve(P).then(s,u)}function t4(e){return function(){var t=this,n=arguments;return new Promise(function(s,u){var _=e.apply(t,n);function w(P){wP(_,s,u,w,S,"next",P)}function S(P){wP(_,s,u,w,S,"throw",P)}w(void 0)})}}var Jx=hf(247);const n4={Afghanistan:{lat:33.9391,lng:67.71},Albania:{lat:41.1533,lng:20.1683},Algeria:{lat:28.0339,lng:1.6596},Andorra:{lat:42.5063,lng:1.5218},Angola:{lat:-11.2027,lng:17.8739},Argentina:{lat:-38.4161,lng:-63.6167},Armenia:{lat:40.0691,lng:45.0382},Australia:{lat:-25.2744,lng:133.7751},Austria:{lat:47.5162,lng:14.5501},Azerbaijan:{lat:40.1431,lng:47.5769},Bahamas:{lat:25.0343,lng:-77.3963},Bahrain:{lat:26.0667,lng:50.5577},Bangladesh:{lat:23.685,lng:90.3563},Belarus:{lat:53.7098,lng:27.9534},Belgium:{lat:50.8503,lng:4.3517},Belize:{lat:17.1899,lng:-88.4976},Benin:{lat:9.3077,lng:2.3158},Bhutan:{lat:27.5142,lng:90.4336},Bolivia:{lat:-16.2902,lng:-63.5887},"Bosnia and Herzegovina":{lat:43.9159,lng:17.6791},Botswana:{lat:-22.3285,lng:24.6849},Brazil:{lat:-14.235,lng:-51.9253},Bulgaria:{lat:42.7339,lng:25.4858},"Burkina Faso":{lat:12.2383,lng:-1.5616},Burundi:{lat:-3.3731,lng:29.9189},Cambodia:{lat:12.5657,lng:104.991},Cameroon:{lat:7.3697,lng:12.3547},Canada:{lat:56.1304,lng:-106.3468},Chile:{lat:-35.6751,lng:-71.543},China:{lat:35.8617,lng:104.1954},Colombia:{lat:4.5709,lng:-74.2973},"Costa Rica":{lat:9.7489,lng:-83.7534},Croatia:{lat:45.1,lng:15.2},Cuba:{lat:21.5218,lng:-77.7812},Cyprus:{lat:35.1264,lng:33.4299},"Czech Republic":{lat:49.8175,lng:15.473},Denmark:{lat:56.2639,lng:9.5018},"Dominican Republic":{lat:18.7357,lng:-70.1627},Ecuador:{lat:-1.8312,lng:-78.1834},Egypt:{lat:26.8206,lng:30.8025},"El Salvador":{lat:13.7942,lng:-88.8965},Estonia:{lat:58.5953,lng:25.0136},Ethiopia:{lat:9.145,lng:40.4897},Finland:{lat:61.9241,lng:25.7482},France:{lat:46.6034,lng:1.8883},Germany:{lat:51.1657,lng:10.4515},Greece:{lat:39.0742,lng:21.8243},Hungary:{lat:47.1625,lng:19.5033},Iceland:{lat:64.9631,lng:-19.0208},India:{lat:20.5937,lng:78.9629},Indonesia:{lat:-.7893,lng:113.9213},Iran:{lat:32.4279,lng:53.688},Iraq:{lat:33.2232,lng:43.6793},Ireland:{lat:53.4129,lng:-8.2439},Israel:{lat:31.0461,lng:34.8516},Italy:{lat:41.8719,lng:12.5674},Jamaica:{lat:18.1096,lng:-77.2975},Japan:{lat:36.2048,lng:138.2529},Kenya:{lat:-.0236,lng:37.9062},"South Korea":{lat:35.9078,lng:127.7669},Mexico:{lat:23.6345,lng:-102.5528},Nepal:{lat:28.3949,lng:84.124},Netherlands:{lat:52.1326,lng:5.2913},"New Zealand":{lat:-40.9006,lng:174.886},Nigeria:{lat:9.082,lng:8.6753},Norway:{lat:60.472,lng:8.4689},Pakistan:{lat:30.3753,lng:69.3451},Philippines:{lat:12.8797,lng:121.774},Poland:{lat:51.9194,lng:19.1451},Portugal:{lat:39.3999,lng:-8.2245},Qatar:{lat:25.3548,lng:51.1839},Romania:{lat:45.9432,lng:24.9668},Russia:{lat:61.524,lng:105.3188},"Saudi Arabia":{lat:23.8859,lng:45.0792},Singapore:{lat:1.3521,lng:103.8198},"South Africa":{lat:-30.5595,lng:22.9375},Spain:{lat:40.4637,lng:-3.7492},"Sri Lanka":{lat:7.8731,lng:80.7718},Sweden:{lat:60.1282,lng:18.6435},Switzerland:{lat:46.8182,lng:8.2275},Thailand:{lat:15.87,lng:100.9925},Turkey:{lat:38.9637,lng:35.2433},Ukraine:{lat:48.3794,lng:31.1656},"United Arab Emirates":{lat:23.4241,lng:53.8478},"United Kingdom":{lat:55.3781,lng:-3.436},"United States":{lat:37.0902,lng:-95.7129},Vietnam:{lat:14.0583,lng:108.2772},Zimbabwe:{lat:-19.0154,lng:29.1549}};function EP(e){return gi((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}class uE{}class dE{}class kd{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?"string"==typeof t?this.lazyInit=()=>{this.headers=new Map,t.split("\n").forEach(n=>{const s=n.indexOf(":");if(s>0){const u=n.slice(0,s),_=u.toLowerCase(),w=n.slice(s+1).trim();this.maybeSetNormalizedName(u,_),this.headers.has(_)?this.headers.get(_).push(w):this.headers.set(_,[w])}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((n,s)=>{this.setHeaderEntries(s,n)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([n,s])=>{this.setHeaderEntries(n,s)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const n=this.headers.get(t.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,n){return this.clone({name:t,value:n,op:"a"})}set(t,n){return this.clone({name:t,value:n,op:"s"})}delete(t,n){return this.clone({name:t,value:n,op:"d"})}maybeSetNormalizedName(t,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,t)}init(){this.lazyInit&&(this.lazyInit instanceof kd?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(n=>{this.headers.set(n,t.headers.get(n)),this.normalizedNames.set(n,t.normalizedNames.get(n))})}clone(t){const n=new kd;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof kd?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}applyUpdate(t){const n=t.name.toLowerCase();switch(t.op){case"a":case"s":let s=t.value;if("string"==typeof s&&(s=[s]),0===s.length)return;this.maybeSetNormalizedName(t.name,n);const u=("a"===t.op?this.headers.get(n):void 0)||[];u.push(...s),this.headers.set(n,u);break;case"d":const _=t.value;if(_){let w=this.headers.get(n);if(!w)return;w=w.filter(S=>-1===_.indexOf(S)),0===w.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,w)}else this.headers.delete(n),this.normalizedNames.delete(n)}}setHeaderEntries(t,n){const s=(Array.isArray(n)?n:[n]).map(_=>_.toString()),u=t.toLowerCase();this.headers.set(u,s),this.maybeSetNormalizedName(t,u)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>t(this.normalizedNames.get(n),this.headers.get(n)))}}class r4{encodeKey(t){return TP(t)}encodeValue(t){return TP(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const s4=/%(\d[a-f0-9])/gi,a4={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function TP(e){return encodeURIComponent(e).replace(s4,(t,n)=>a4[n]??t)}function hE(e){return`${e}`}class Hp{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new r4,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function o4(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(u=>{const _=u.indexOf("="),[w,S]=-1==_?[t.decodeKey(u),""]:[t.decodeKey(u.slice(0,_)),t.decodeValue(u.slice(_+1))],P=n.get(w)||[];P.push(S),n.set(w,P)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(n=>{const s=t.fromObject[n],u=Array.isArray(s)?s.map(hE):[hE(s)];this.map.set(n,u)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const n=this.map.get(t);return n?n[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,n){return this.clone({param:t,value:n,op:"a"})}appendAll(t){const n=[];return Object.keys(t).forEach(s=>{const u=t[s];Array.isArray(u)?u.forEach(_=>{n.push({param:s,value:_,op:"a"})}):n.push({param:s,value:u,op:"a"})}),this.clone(n)}set(t,n){return this.clone({param:t,value:n,op:"s"})}delete(t,n){return this.clone({param:t,value:n,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const n=this.encoder.encodeKey(t);return this.map.get(t).map(s=>n+"="+this.encoder.encodeValue(s)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const n=new Hp({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const n=("a"===t.op?this.map.get(t.param):void 0)||[];n.push(hE(t.value)),this.map.set(t.param,n);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let s=this.map.get(t.param)||[];const u=s.indexOf(hE(t.value));-1!==u&&s.splice(u,1),s.length>0?this.map.set(t.param,s):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class l4{constructor(){this.map=new Map}set(t,n){return this.map.set(t,n),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function CP(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function SP(e){return typeof Blob<"u"&&e instanceof Blob}function DP(e){return typeof FormData<"u"&&e instanceof FormData}class Qx{constructor(t,n,s,u){let _;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function c4(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||u?(this.body=void 0!==s?s:null,_=u):_=s,_&&(this.reportProgress=!!_.reportProgress,this.withCredentials=!!_.withCredentials,_.responseType&&(this.responseType=_.responseType),_.headers&&(this.headers=_.headers),_.context&&(this.context=_.context),_.params&&(this.params=_.params)),this.headers||(this.headers=new kd),this.context||(this.context=new l4),this.params){const w=this.params.toString();if(0===w.length)this.urlWithParams=n;else{const S=n.indexOf("?");this.urlWithParams=n+(-1===S?"?":S<n.length-1?"&":"")+w}}else this.params=new Hp,this.urlWithParams=n}serializeBody(){return null===this.body?null:CP(this.body)||SP(this.body)||DP(this.body)||function u4(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Hp?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||DP(this.body)?null:SP(this.body)?this.body.type||null:CP(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Hp?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const n=t.method||this.method,s=t.url||this.url,u=t.responseType||this.responseType,_=void 0!==t.body?t.body:this.body,w=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,S=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let P=t.headers||this.headers,z=t.params||this.params;const G=t.context??this.context;return void 0!==t.setHeaders&&(P=Object.keys(t.setHeaders).reduce((Y,ye)=>Y.set(ye,t.setHeaders[ye]),P)),t.setParams&&(z=Object.keys(t.setParams).reduce((Y,ye)=>Y.set(ye,t.setParams[ye]),z)),new Qx(n,s,_,{params:z,headers:P,context:G,reportProgress:S,responseType:u,withCredentials:w})}}var _v=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(_v||{});class dD{constructor(t,n=200,s="OK"){this.headers=t.headers||new kd,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||s,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class hD extends dD{constructor(t={}){super(t),this.type=_v.ResponseHeader}clone(t={}){return new hD({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class yv extends dD{constructor(t={}){super(t),this.type=_v.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new yv({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class IP extends dD{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function fD(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let AP=(()=>{class e{constructor(n){this.handler=n}request(n,s,u={}){let _;if(n instanceof Qx)_=n;else{let P,z;P=u.headers instanceof kd?u.headers:new kd(u.headers),u.params&&(z=u.params instanceof Hp?u.params:new Hp({fromObject:u.params})),_=new Qx(n,s,void 0!==u.body?u.body:null,{headers:P,context:u.context,params:z,reportProgress:u.reportProgress,responseType:u.responseType||"json",withCredentials:u.withCredentials})}const w=nl(_).pipe(function i4(e,t){return Yi(t)?_n(e,t,1):_n(e,1)}(P=>this.handler.handle(P)));if(n instanceof Qx||"events"===u.observe)return w;const S=w.pipe(uf(P=>P instanceof yv));switch(u.observe||"body"){case"body":switch(_.responseType){case"arraybuffer":return S.pipe(Mo(P=>{if(null!==P.body&&!(P.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return P.body}));case"blob":return S.pipe(Mo(P=>{if(null!==P.body&&!(P.body instanceof Blob))throw new Error("Response is not a Blob.");return P.body}));case"text":return S.pipe(Mo(P=>{if(null!==P.body&&"string"!=typeof P.body)throw new Error("Response is not a string.");return P.body}));default:return S.pipe(Mo(P=>P.body))}case"response":return S;default:throw new Error(`Unreachable: unhandled observe type ${u.observe}}`)}}delete(n,s={}){return this.request("DELETE",n,s)}get(n,s={}){return this.request("GET",n,s)}head(n,s={}){return this.request("HEAD",n,s)}jsonp(n,s){return this.request("JSONP",n,{params:(new Hp).append(s,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,s={}){return this.request("OPTIONS",n,s)}patch(n,s,u={}){return this.request("PATCH",n,fD(u,s))}post(n,s,u={}){return this.request("POST",n,fD(u,s))}put(n,s,u={}){return this.request("PUT",n,fD(u,s))}static{this.\u0275fac=function(s){return new(s||e)(gt(uE))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})();function RP(e,t){return t(e)}function h4(e,t){return(n,s)=>t.intercept(n,{handle:u=>e(u,s)})}const p4=new Ht(""),eb=new Ht(""),OP=new Ht("");function m4(){let e=null;return(t,n)=>{null===e&&(e=($n(p4,{optional:!0})??[]).reduceRight(h4,RP));const s=$n(CC),u=s.add();return e(t,n).pipe(EP(()=>s.remove(u)))}}let kP=(()=>{class e extends uE{constructor(n,s){super(),this.backend=n,this.injector=s,this.chain=null,this.pendingTasks=$n(CC)}handle(n){if(null===this.chain){const u=Array.from(new Set([...this.injector.get(eb),...this.injector.get(OP,[])]));this.chain=u.reduceRight((_,w)=>function f4(e,t,n){return(s,u)=>n.runInContext(()=>t(s,_=>e(_,u)))}(_,w,this.injector),RP)}const s=this.pendingTasks.add();return this.chain(n,u=>this.backend.handle(u)).pipe(EP(()=>this.pendingTasks.remove(s)))}static{this.\u0275fac=function(s){return new(s||e)(gt(dE),gt(Ua))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})();const v4=/^\)\]\}',?\n/;let LP=(()=>{class e{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new bt(-2800,!1);const s=this.xhrFactory;return(s.\u0275loadImpl?Ra(s.\u0275loadImpl()):nl(null)).pipe(zs(()=>new Vi(_=>{const w=s.build();if(w.open(n.method,n.urlWithParams),n.withCredentials&&(w.withCredentials=!0),n.headers.forEach((ze,lt)=>w.setRequestHeader(ze,lt.join(","))),n.headers.has("Accept")||w.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const ze=n.detectContentTypeHeader();null!==ze&&w.setRequestHeader("Content-Type",ze)}if(n.responseType){const ze=n.responseType.toLowerCase();w.responseType="json"!==ze?ze:"text"}const S=n.serializeBody();let P=null;const z=()=>{if(null!==P)return P;const ze=w.statusText||"OK",lt=new kd(w.getAllResponseHeaders()),Ct=function x4(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(w)||n.url;return P=new hD({headers:lt,status:w.status,statusText:ze,url:Ct}),P},G=()=>{let{headers:ze,status:lt,statusText:Ct,url:ut}=z(),qt=null;204!==lt&&(qt=typeof w.response>"u"?w.responseText:w.response),0===lt&&(lt=qt?200:0);let sn=lt>=200&&lt<300;if("json"===n.responseType&&"string"==typeof qt){const ui=qt;qt=qt.replace(v4,"");try{qt=""!==qt?JSON.parse(qt):null}catch(Or){qt=ui,sn&&(sn=!1,qt={error:Or,text:qt})}}sn?(_.next(new yv({body:qt,headers:ze,status:lt,statusText:Ct,url:ut||void 0})),_.complete()):_.error(new IP({error:qt,headers:ze,status:lt,statusText:Ct,url:ut||void 0}))},Y=ze=>{const{url:lt}=z(),Ct=new IP({error:ze,status:w.status||0,statusText:w.statusText||"Unknown Error",url:lt||void 0});_.error(Ct)};let ye=!1;const xe=ze=>{ye||(_.next(z()),ye=!0);let lt={type:_v.DownloadProgress,loaded:ze.loaded};ze.lengthComputable&&(lt.total=ze.total),"text"===n.responseType&&w.responseText&&(lt.partialText=w.responseText),_.next(lt)},Oe=ze=>{let lt={type:_v.UploadProgress,loaded:ze.loaded};ze.lengthComputable&&(lt.total=ze.total),_.next(lt)};return w.addEventListener("load",G),w.addEventListener("error",Y),w.addEventListener("timeout",Y),w.addEventListener("abort",Y),n.reportProgress&&(w.addEventListener("progress",xe),null!==S&&w.upload&&w.upload.addEventListener("progress",Oe)),w.send(S),_.next({type:_v.Sent}),()=>{w.removeEventListener("error",Y),w.removeEventListener("abort",Y),w.removeEventListener("load",G),w.removeEventListener("timeout",Y),n.reportProgress&&(w.removeEventListener("progress",xe),null!==S&&w.upload&&w.upload.removeEventListener("progress",Oe)),w.readyState!==w.DONE&&w.abort()}})))}static{this.\u0275fac=function(s){return new(s||e)(gt(dM))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})();const pD=new Ht("XSRF_ENABLED"),NP=new Ht("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),zP=new Ht("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class BP{}let E4=(()=>{class e{constructor(n,s,u){this.doc=n,this.platform=s,this.cookieName=u,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=tM(n,this.cookieName),this.lastCookieString=n),this.lastToken}static{this.\u0275fac=function(s){return new(s||e)(gt(br),gt(hu),gt(NP))}}static{this.\u0275prov=Kt({token:e,factory:e.\u0275fac})}}return e})();function T4(e,t){const n=e.url.toLowerCase();if(!$n(pD)||"GET"===e.method||"HEAD"===e.method||n.startsWith("http://")||n.startsWith("https://"))return t(e);const s=$n(BP).getToken(),u=$n(zP);return null!=s&&!e.headers.has(u)&&(e=e.clone({headers:e.headers.set(u,s)})),t(e)}var Gp=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(Gp||{});function Kg(e,t){return{\u0275kind:e,\u0275providers:t}}function C4(...e){const t=[AP,LP,kP,{provide:uE,useExisting:kP},{provide:dE,useExisting:LP},{provide:eb,useValue:T4,multi:!0},{provide:pD,useValue:!0},{provide:BP,useClass:E4}];for(const n of e)t.push(...n.\u0275providers);return function np(e){return{\u0275providers:e}}(t)}const VP=new Ht("LEGACY_INTERCEPTOR_FN");let D4=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({providers:[C4(Kg(Gp.LegacyInterceptors,[{provide:VP,useFactory:m4},{provide:eb,useExisting:VP,multi:!0}]))]})}}return e})();function O4(e,t){1&e&&(Sl(0,"div",9),Id(1,"div",10),Sl(2,"p"),I(3,"Loading map..."),vc()())}function k4(e,t){1&e&&(Sl(0,"div",11),aa("click",function(s){return s.stopPropagation()}),Id(1,"i",12)(2,"i",13),vc())}const vv={Afrikaans:"(Afrikaans) \u201cWant so lief het God die w\xeareld gehad, dat Hy sy eniggebore Seun gegee het, sodat elkeen wat in Hom glo, nie verlore mag gaan nie, maar ewige lewe kan h\xea.\u201d \u2014 Johannes 3:16",Albanian:"(Albanian) \u201cSepse Per\xebndia e ka dashur shum\xeb bot\xebn, sa q\xeb ia dha Birin e vet t\xeb vetmuar, q\xeb kushdo q\xeb beson te Ai t\xeb mos humbas\xeb, por t\xeb ket\xeb jet\xeb t\xeb p\xebrjetshme.\u201d \u2014 Gjoni 3:16",Amharic:"(Amharic) \u201c\u1260\u12a5\u1294 \u12a5\u130d\u12da\u12a0\u1265\u1214\u122d \u12d3\u1208\u121d\u1295 \u12a5\u1295\u12f0\u12da\u1205 \u12a0\u134d\u1245\u122e \u12e8\u1290\u1260\u1228\u1363 \u1265\u127b\u12cd\u1295 \u12e8\u1206\u1290\u12cd\u1295 \u120d\u1301\u1295 \u1230\u1320\u1364 \u12eb\u121d \u12a5\u122d\u1231\u1295 \u12e8\u121a\u1218\u12a8\u122d \u1201\u1209 \u12a5\u1295\u12f3\u12ed\u1320\u134b\u1363 \u1290\u1308\u122d \u130d\u1295 \u1208\u12d8\u120b\u1208\u121d \u1215\u12ed\u12c8\u1275 \u12a5\u1295\u12f2\u1296\u1228\u12cd \u1290\u12cd\u1362\u201d \u2014 \u12ee\u1210\u1295\u1235 3:16",Arabic:'(Arabic) "\u0644\u0623\u064e\u0646\u0651\u064e \u0627\u0644\u0644\u0647\u064e \u0623\u064e\u062d\u064e\u0628\u0651\u064e \u0627\u0644\u0652\u0639\u064e\u0627\u0644\u064e\u0645\u064e \u062d\u064e\u062a\u0651\u064e\u0649 \u0628\u064e\u0630\u064e\u0644\u064e \u0627\u0628\u0652\u0646\u064e\u0647\u064f \u0627\u0644\u0652\u0648\u064e\u062d\u0650\u064a\u062f\u064e\u060c \u0644\u0650\u0643\u064e\u064a\u0652 \u0644\u0627 \u064a\u064e\u0647\u0652\u0644\u0650\u0643\u064e \u0643\u064f\u0644\u0651\u064f \u0645\u064e\u0646\u0652 \u064a\u064f\u0624\u0652\u0645\u0650\u0646\u064f \u0628\u0650\u0647\u0650\u060c \u0628\u064e\u0644\u0652 \u062a\u064e\u0643\u064f\u0648\u0646\u064f \u0644\u064e\u0647\u064f \u0627\u0644\u0652\u062d\u064e\u064a\u064e\u0627\u0629\u064f \u0627\u0644\u0623\u064e\u0628\u064e\u062f\u0650\u064a\u0651\u064e\u0629\u064f.\xbb \u2014 \u064a\u0648\u062d\u0646\u0627 3:16"',Bengali:'(Bengali) "\u0995\u09be\u09b0\u09a3 \u0988\u09b6\u09cd\u09ac\u09b0 \u099c\u0997\u09ce\u0995\u09c7 \u098f\u09ae\u09a8 \u09aa\u09cd\u09b0\u09c7\u09ae \u0995\u09b0\u09bf\u09b2\u09c7\u09a8 \u09af\u09c7, \u09a4\u09be\u0981\u09b0 \u098f\u0995\u09ae\u09be\u09a4\u09cd\u09b0 \u09aa\u09c1\u09a4\u09cd\u09b0\u0995\u09c7 \u09a6\u09be\u09a8 \u0995\u09b0\u09bf\u09b2\u09c7\u09a8, \u09af\u09c7\u09a8, \u09af\u09be\u09b0\u09be \u09a4\u09be\u0981\u0995\u09c7 \u09ac\u09bf\u09b6\u09cd\u09ac\u09be\u09b8 \u0995\u09b0\u09c7, \u09a4\u09be\u09b0\u09be \u09ac\u09bf\u09a8\u09b7\u09cd\u099f \u09a8\u09be \u09b9\u09af\u09bc, \u0995\u09bf\u09a8\u09cd\u09a4\u09c1 \u0985\u09a8\u09a8\u09cd\u09a4 \u099c\u09c0\u09ac\u09a8 \u09aa\u09be\u09af\u09bc\u0964" \u2014 \u09af\u09cb\u09b9\u09a8 3:16',Burmese:"(Burmese) \u201c\u1018\u102f\u101b\u102c\u1038\u101e\u1001\u1004\u103a\u1000\u1000\u1019\u1039\u1018\u102c\u1000\u103c\u102e\u1038\u1000\u102d\u102f\u1012\u102e\u1014\u100a\u103a\u1038\u1014\u100a\u103a\u1038\u1001\u103b\u1005\u103a\u104d\u101e\u1030\u104f\u1010\u1005\u103a\u1026\u1038\u1010\u100a\u103a\u1038\u101e\u1031\u102c\u1000\u101c\u1031\u1038\u1000\u102d\u102f\u1015\u1031\u1038\u101c\u102d\u102f\u1000\u103a\u101e\u100a\u103a\u104a\u101e\u1030\u1037\u1000\u102d\u102f\u101a\u102f\u1036\u1000\u103c\u100a\u103a\u101e\u1030\u1010\u102d\u102f\u1004\u103a\u1038\u1019\u1015\u103b\u1031\u102c\u1000\u103a\u1000\u103d\u101a\u103a\u1015\u102b\u1014\u103e\u1004\u1037\u103a\u104a\u1021\u101e\u1000\u103a\u1021\u1019\u103c\u1032 \u101b\u1031\u1015\u102b\u1005\u1031\u104b\u201d \u2014 \u101a\u1031\u102c\u103a\u101f\u1014 \u1043:\u1041\u1046",Dari:"(Dari) \u201c\u0632\u06cc\u0631\u0627 \u062e\u062f\u0627 \u062c\u0647\u0627\u0646 \u0631\u0627 \u0686\u0646\u0627\u0646 \u062f\u0648\u0633\u062a \u062f\u0627\u0634\u062a \u06a9\u0647 \u067e\u0633\u0631 \u06cc\u06af\u0627\u0646\u0647 \u062e\u0648\u06cc\u0634 \u0631\u0627 \u062f\u0627\u062f\u060c \u062a\u0627 \u0647\u0631 \u06a9\u0647 \u0628\u0647 \u0627\u0648 \u0627\u06cc\u0645\u0627\u0646 \u0622\u0648\u0631\u062f \u0647\u0644\u0627\u06a9 \u0646\u0634\u0648\u062f \u0628\u0644\u06a9\u0647 \u062d\u06cc\u0627\u062a \u0627\u0628\u062f\u06cc \u06cc\u0627\u0628\u062f.\u201d \u2014 \u06cc\u0648\u062d\u0646\u0627 \u06f3:\u06f1\u06f6",Dutch:"(Dutch) \u201cWant God had de wereld zo lief dat hij zijn eniggeboren Zoon gaf, opdat iedereen die in hem gelooft niet verloren gaat, maar eeuwig leven heeft.\u201d \u2014 Johannes 3:16",French:'(French) "Car Dieu a tant aim\xe9 le monde qu\u2019il a donn\xe9 son Fils unique, afin que quiconque croit en lui ne p\xe9risse point, mais qu\u2019il ait la vie \xe9ternelle." \u2014 Jean 3:16',German:'(German) "Denn also hat Gott die Welt geliebt, dass er seinen eingeborenen Sohn gab, damit alle, die an ihn glauben, nicht verloren werden, sondern ewiges Leben haben." \u2014 Johannes 3,16',Hausa:"(Hausa) \u201cGama Allah ya so duniya \u0199warai, har ya ba da \u018aansa \u0257aya tilo, domin duk wanda ya gaskata da shi kada ya \u0253ace, amma ya samu rai na har abada.\u201d \u2014 Yohanna 3:16",Hindi:"(Hindi) \u201c\u0915\u094d\u092f\u094b\u0902\u0915\u093f \u092a\u0930\u092e\u0947\u0936\u094d\u200d\u0935\u0930 \u0928\u0947 \u091c\u0917\u0924 \u0938\u0947 \u0910\u0938\u093e \u092a\u094d\u0930\u0947\u092e \u0930\u0916\u093e \u0915\u093f \u0909\u0938\u0928\u0947 \u0905\u092a\u0928\u093e \u090f\u0915\u0932\u094c\u0924\u093e \u092a\u0941\u0924\u094d\u0930 \u0926\u0947 \u0926\u093f\u092f\u093e, \u0924\u093e\u0915\u093f \u091c\u094b \u0915\u094b\u0908 \u0909\u0938 \u092a\u0930 \u0935\u093f\u0936\u094d\u0935\u093e\u0938 \u0915\u0930\u0947 \u0935\u0939 \u0928\u0937\u094d\u091f \u0928 \u0939\u094b, \u092a\u0930\u0928\u094d\u0924\u0941 \u0905\u0928\u0928\u094d\u0924 \u091c\u0940\u0935\u0928 \u092a\u093e\u090f\u0964\u201d \u2014 \u092f\u094b\u0939\u0928 3:16",Japanese:'(Japanese) "\u795e\u306f\u305d\u306e\u3072\u3068\u308a\u5b50\u3092\u304a\u4e0e\u3048\u306b\u306a\u3063\u305f\u307b\u3069\u306b\u3001\u4e16\u3092\u611b\u3055\u308c\u305f\u3002\u305d\u308c\u306f\u3001\u5f7c\u3092\u4fe1\u3058\u308b\u8005\u304c\u3001\u4e00\u4eba\u3068\u3057\u3066\u6ec5\u3073\u308b\u3053\u3068\u306a\u304f\u3001\u6c38\u9060\u306e\u547d\u3092\u6301\u3064\u305f\u3081\u3067\u3042\u308b\u3002" \u2014 \u30e8\u30cf\u30cd 3:16',Kannada:"(Kannada) \u201c\u0ca6\u0cc7\u0cb5\u0cb0\u0cc1 \u0caa\u0ccd\u0cb0\u0caa\u0c82\u0c9a\u0cb5\u0ca8\u0ccd\u0ca8\u0cc1 \u0c87\u0cb7\u0ccd\u0c9f\u0cc1 \u0caa\u0ccd\u0cb0\u0cc0\u0ca4\u0cbf\u0cb8\u0cbf\u0ca6\u0ca8\u0cc7\u0c95\u0cc6\u0c82\u0ca6\u0cb0\u0cc6, \u0ca4\u0ca8\u0ccd\u0ca8 \u0c8f\u0c95\u0cc8\u0c95 \u0caa\u0cc1\u0ca4\u0ccd\u0cb0\u0ca8\u0ca8\u0ccd\u0ca8\u0cc1 \u0c95\u0cca\u0c9f\u0ccd\u0c9f\u0ca8\u0cc1; \u0c86\u0ca4\u0ca8\u0cbf\u0c97\u0cc6 \u0ca8\u0c82\u0cac\u0cbf\u0c95\u0cc6 \u0c87\u0ca1\u0cc1\u0cb5\u0cb5\u0ca8\u0cc1 \u0cb9\u0cbe\u0ca8\u0cbf\u0c97\u0cca\u0cb3\u0ccd\u0cb3\u0ca6\u0cbf\u0ca6\u0ccd\u0ca6\u0cbe\u0ca8\u0cc6, \u0c86\u0ca6\u0cb0\u0cc6 \u0c8e\u0c82\u0ca6\u0cbf\u0c97\u0cc2 \u0ca8\u0cb2\u0ccd\u0cb2\u0cc7 \u0c87\u0cb0\u0cc1\u0cb5 \u0c9c\u0cc0\u0cb5\u0cb5\u0ca8\u0ccd\u0ca8\u0cc1 \u0cb9\u0cca\u0c82\u0ca6\u0cc1\u0cb5\u0ca8\u0cc1\u0964\u201d \u2014 \u0caf\u0ccb\u0cb9\u0cbe\u0ca8 3:16",Korean:"(Korean) \u201c\ud558\ub098\ub2d8\uc774 \uc138\uc0c1\uc744 \uc774\ucc98\ub7fc \uc0ac\ub791\ud558\uc0ac \ub3c5\uc0dd\uc790\ub97c \uc8fc\uc168\uc73c\ub2c8 \uc774\ub294 \uadf8\ub97c \ubbff\ub294 \uc790\ub9c8\ub2e4 \uba78\ub9dd\uce58 \uc54a\uace0 \uc601\uc0dd\uc744 \uc5bb\uac8c \ud558\ub824 \ud558\uc2ec\uc774\ub77c.\u201d \u2014 \uc694\ud55c\ubcf5\uc74c 3:16",Lao:"(Lao) \u201c\u0ec0\u0e9e\u0eb2\u0eb0\u0e9e\u0ea3\u0eb0\u0ec0\u0e88\u0ebb\u0ec9\u0eb2\u0ec4\u0e94\u0ec9\u0eae\u0eb1\u0e81\u0ec2\u0ea5\u0e81\u0ec3\u0e99\u0e9e\u0eb2\u0e9a\u0e99\u0eb5\u0ec9\u0eab\u0ebc\u0eb2\u0e8d\u0e81\u0ea7\u0ec8\u0eb2\u0eaa\u0eb4\u0ec8\u0e87\u0ec3\u0e94 \u0ec0\u0e96\u0eb4\u0e87\u0e82\u0eb6\u0ec9\u0e99\u0e8a\u0ec9\u0eb2\u0ea7\u0ec3\u0eab\u0ec9\u0ea5\u0eb9\u0e81\u0e9c\u0eb9\u0ec9\u0edc\u0eb6\u0ec8\u0e87\u0e82\u0ead\u0e87\u0e9e\u0ea3\u0eb0\u0ead\u0ebb\u0e87 \u0ec0\u0e9e\u0eb7\u0ec8\u0ead\u0ea7\u0ec8\u0eb2\u0ec3\u0e9c\u0ec0\u0e8a\u0eb7\u0ec8\u0ead\u0ea1\u0eb4\u0e94\u0e95\u0ebb\u0ea7\u0ec0\u0e82\u0ebb\u0eb2\u0e88\u0eb0\u0e9a\u0ecd\u0ec8\u0eaa\u0eb9\u0e99\u0ec0\u0eaa\u0e8d \u0ec1\u0e95\u0ec8\u0e88\u0eb0\u0ec4\u0e94\u0ec9\u0e8a\u0eb5\u0ea7\u0eb4\u0e94\u0e8a\u0ebb\u0ec8\u0ea7\u0e84\u0eb2\u0ea7.\u201d \u2014 \u0ea2\u0eb9\u0e94\u0e8d 3:16",Nepali:"(Nepali) \u201c\u0915\u093f\u0928\u092d\u0928\u0947 \u092a\u0930\u092e\u0947\u0936\u094d\u0935\u0930\u0932\u0947 \u0938\u0902\u0938\u093e\u0930\u0932\u093e\u0908 \u092f\u0924\u093f \u092e\u093e\u092f\u093e \u0917\u0930\u094d\u0928\u0941\u092d\u092f\u094b \u0915\u093f \u0909\u0939\u093e\u0901\u0932\u0947 \u0906\u092b\u094d\u0928\u093e \u090f\u0915\u092e\u093e\u0924\u094d\u0930 \u092a\u0941\u0924\u094d\u0930\u0932\u093e\u0908 \u0926\u093f\u0928\u0941\u092d\u092f\u094b, \u0924\u093e\u0915\u093f \u091c\u094b \u0915\u0941\u0928\u0948 \u0909\u0939\u093e\u0901\u092e\u093e\u0925\u093f \u0935\u093f\u0936\u094d\u0935\u093e\u0938 \u0917\u0930\u094d\u091b, \u0924\u094d\u092f\u0939\u093e\u0901 \u0928\u093e\u0936 \u0928\u0939\u094b\u0938\u094d, \u0924\u0930 \u0905\u0928\u0928\u094d\u0924 \u091c\u0940\u0935\u0928 \u092a\u093e\u0913\u0938\u094d\u0964\u201d \u2014 \u092f\u0941\u0939\u0928\u094d\u0928\u093e 3:16",Odia:"(Odia) \u201c\u0b15\u0b3e\u0b30\u0b23 \u0b2d\u0b32\u0b3f\u0b30\u0b47, \u0b2a\u0b30\u0b2e\u0b47\u0b36\u0b4d\u0b71\u0b30 \u0b32\u0b4b\u0b15\u0b15\u0b41 \u0b0f\u0b24\u0b47 \u0b2d\u0b32 \u0b2a\u0b3e\u0b0f\u0b1b\u0b28\u0b4d\u0b24\u0b3f \u0b2f\u0b47, \u0b38\u0b47 \u0b24\u0b3e\u0b19\u0b4d\u0b15\u0b30 \u0b0f\u0b15\u0b2e\u0b3e\u0b24\u0b4d\u0b30 \u0b2a\u0b41\u0b06\u0b15\u0b41 \u0b26\u0b47\u0b07\u0b1b\u0b28\u0b4d\u0b24\u0b3f, \u0b2f\u0b3e\u0b39\u0b3e\u0b30 \u0b09\u0b2a\u0b30\u0b47 \u0b2f\u0b47 \u0b15\u0b47\u0b39\u0b3f \u0b06\u0b38\u0b4d\u0b25\u0b3e \u0b15\u0b30\u0b47, \u0b38\u0b47 \u0b28\u0b37\u0b4d\u0b1f \u0b39\u0b47\u0b2c \u0b28\u0b3e\u0b39\u0b3f\u0b01, \u0b05\u0b28\u0b28\u0b4d\u0b24 \u0b1c\u0b40\u0b2c\u0b28 \u0b2a\u0b3e\u0b07\u0b2c\u0964\u201d \u2014 \u0b2f\u0b4b\u0b39\u0b28 3:16",Pashto:"(Pashto) \u201c\u0681\u06a9\u0647 \u0686\u06d0 \u062e\u062f\u0627\u06cc \u062f\u0646\u06cc\u0627 \u062f\u0648\u0645\u0631\u0647 \u0645\u06cc\u0646\u0647 \u06a9\u0693\u0647 \u0686\u06d0 \u062e\u067e\u0644 \u06cc\u0648\u0627\u0632\u06cc\u0646\u06cc \u0632\u0648\u06cc \u06cc\u06d0 \u0648\u0631\u06a9\u0693\u060c \u062a\u0631\u0685\u0648 \u0647\u0631 \u0647\u063a\u0647 \u0685\u0648\u06a9 \u0686\u06d0 \u067e\u0647 \u0647\u063a\u0647 \u0628\u0627\u0648\u0631 \u0648\u06a9\u0693\u064a \u0647\u0644\u0627\u06a9 \u0646\u0647 \u0634\u064a \u0628\u0644\u06a9\u0647 \u062f \u062a\u0644 \u0644\u067e\u0627\u0631\u0647 \u0698\u0648\u0646\u062f \u0648\u0644\u0631\u064a.\u201d \u2014 \u06cc\u0648\u062d\u0646\u0627 \u06f3:\u06f1\u06f6",Portuguese:"(Portuguese) \u201cPorque Deus amou o mundo de tal maneira que deu o seu Filho unig\xeanito, para que todo aquele que nele cr\xea n\xe3o pere\xe7a, mas tenha a vida eterna.\u201d \u2014 Jo\xe3o 3:16",Romanian:'(Romanian) "C\u0103ci Dumnezeu a iubit lumea at\xe2t de mult, \xeenc\xe2t L-a dat pe Fiul S\u0103u Unul-N\u0103scut, pentru ca oricine crede \xeen El s\u0103 nu piar\u0103, ci s\u0103 aib\u0103 via\u021b\u0103 ve\u0219nic\u0103." \u2014 Ioan 3:16',Russian:'(Russian) "\u0418\u0431\u043e \u0442\u0430\u043a \u0432\u043e\u0437\u043b\u044e\u0431\u0438\u043b \u0411\u043e\u0433 \u043c\u0438\u0440, \u0447\u0442\u043e \u043e\u0442\u0434\u0430\u043b \u0421\u044b\u043d\u0430 \u0421\u0432\u043e\u0435\u0433\u043e \u0415\u0434\u0438\u043d\u043e\u0440\u043e\u0434\u043d\u043e\u0433\u043e, \u0434\u0430\u0431\u044b \u0432\u0441\u044f\u043a\u0438\u0439, \u0432\u0435\u0440\u0443\u044e\u0449\u0438\u0439 \u0432 \u041d\u0435\u0433\u043e, \u043d\u0435 \u043f\u043e\u0433\u0438\u0431, \u043d\u043e \u0438\u043c\u0435\u043b \u0436\u0438\u0437\u043d\u044c \u0432\u0435\u0447\u043d\u0443\u044e." \u2014 \u0418\u043e\u0430\u043d\u043d 3:16',Spanish:'(Spanish) "Porque de tal manera am\xf3 Dios al mundo, que dio a su Hijo unig\xe9nito, para que todo aquel que en \xe9l cree no se pierda, mas tenga vida eterna." \u2014 Juan 3:16',Swahili:"(Swahili) \u201cMaana Mungu aliupenda ulimwengu hivi, hata akamtoa Mwanawe pekee, ili kila mtu amwaminiye asipoteee, bali awe na uzima wa milele.\u201d \u2014 Yohana 3:16",Tagalog:"(Tagalog) \u201cSapagkat gayon na lamang ang pag-ibig ng Diyos sa sanlibutan, na ibinigay Niya ang Kaniyang bugtong na Anak, upang ang sinumang sumampalataya sa Kanya ay hindi mapahamak, kundi magkaroon ng buhay na walang hanggan.\u201d \u2014 Juan 3:16",Tamil:"(Tamil) \u201c\u0b8f\u0ba9\u0bc6\u0ba9\u0bcd\u0bb1\u0bbe\u0bb2\u0bcd, \u0b95\u0b9f\u0bb5\u0bc1\u0bb3\u0bcd \u0b89\u0bb2\u0b95\u0ba4\u0bcd\u0ba4\u0bc8 \u0b87\u0baa\u0bcd\u0baa\u0b9f\u0bbf\u0ba4\u0bcd\u0ba4\u0bbe\u0ba9\u0bcd \u0ba8\u0bc7\u0b9a\u0bbf\u0ba4\u0bcd\u0ba4\u0bbe\u0bb0\u0bcd: \u0ba4\u0ba9\u0bcd \u0b92\u0bb0\u0bc7 \u0bae\u0b95\u0ba9\u0bc8\u0b95\u0bcd \u0b95\u0bca\u0b9f\u0bc1\u0ba4\u0bcd\u0ba4\u0bbe\u0bb0\u0bcd; \u0b85\u0bb5\u0bb0\u0bc8\u0baa\u0bcd \u0baa\u0baf\u0bbf\u0bb2\u0bcd\u0baa\u0bb5\u0ba9\u0bbe\u0b95\u0bc1\u0b95\u0bbf\u0bb1 \u0baf\u0bbe\u0bb5\u0bb0\u0bc1\u0bae\u0bcd \u0b85\u0bb4\u0bbf\u0ba8\u0bcd\u0ba4\u0bc1 \u0baa\u0bcb\u0b95\u0bb5\u0bbf\u0bb2\u0bcd\u0bb2\u0bc8; \u0b9a\u0bc0\u0bb1\u0bcd\u0bb1 \u0bb5\u0bbe\u0bb4\u0bcd\u0b95\u0bcd\u0b95\u0bc8\u0baf\u0bc8\u0baa\u0bcd \u0baa\u0bc6\u0bb1\u0bc1\u0bb5\u0bb0\u0bcd.\u201d \u2014 \u0baf\u0bcb\u0bb5\u0bbe\u0ba9\u0bcd 3:16",Telugu:"(Telugu) \u201c\u0c26\u0c47\u0c35\u0c41\u0c21\u0c41 \u0c2a\u0c4d\u0c30\u0c2a\u0c02\u0c1a\u0c3e\u0c28\u0c4d\u0c28\u0c3f \u0c08 \u0c35\u0c3f\u0c27\u0c02\u0c17\u0c3e \u0c2a\u0c4d\u0c30\u0c47\u0c2e\u0c3f\u0c02\u0c1a\u0c46\u0c28\u0c41: \u0c24\u0c28 \u0c0f\u0c15\u0c48\u0c15 \u0c15\u0c41\u0c2e\u0c3e\u0c30\u0c41\u0c28\u0c3f \u0c07\u0c1a\u0c4d\u0c1a\u0c46\u0c28\u0c41, \u0c05\u0c24\u0c28\u0c3f\u0c28\u0c3f \u0c28\u0c2e\u0c4d\u0c2e\u0c41\u0c28\u0c02\u0c26\u0c41\u0c15\u0c41 \u0c0e\u0c35\u0c30\u0c48\u0c28\u0c3e \u0c13\u0c21\u0c3f\u0c2a\u0c4b\u0c35\u0c15, \u0c28\u0c3f\u0c24\u0c4d\u0c2f\u0c1c\u0c40\u0c35\u0c3f\u0c24\u0c02 \u0c2a\u0c4a\u0c02\u0c26\u0c3e\u0c32\u0c28\u0c3f\u0964\u201d \u2014 \u0c2f\u0c4b\u0c39\u0c3e\u0c28\u0c41 3:16",Thai:"(Thai) \u201c\u0e40\u0e1e\u0e23\u0e32\u0e30\u0e1e\u0e23\u0e30\u0e40\u0e08\u0e49\u0e32\u0e17\u0e23\u0e07\u0e23\u0e31\u0e01\u0e42\u0e25\u0e01\u0e40\u0e0a\u0e48\u0e19\u0e19\u0e35\u0e49 \u0e08\u0e36\u0e07\u0e17\u0e23\u0e07\u0e1b\u0e23\u0e30\u0e17\u0e32\u0e19\u0e1e\u0e23\u0e30\u0e1a\u0e38\u0e15\u0e23\u0e2d\u0e07\u0e04\u0e4c\u0e40\u0e14\u0e35\u0e22\u0e27\u0e02\u0e2d\u0e07\u0e1e\u0e23\u0e30\u0e2d\u0e07\u0e04\u0e4c \u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e17\u0e38\u0e01\u0e04\u0e19\u0e17\u0e35\u0e48\u0e40\u0e0a\u0e37\u0e48\u0e2d\u0e43\u0e19\u0e1e\u0e23\u0e30\u0e2d\u0e07\u0e04\u0e4c \u0e08\u0e30\u0e44\u0e21\u0e48\u0e1e\u0e34\u0e19\u0e32\u0e28 \u0e41\u0e15\u0e48\u0e08\u0e31\u0e01\u0e21\u0e35\u0e0a\u0e35\u0e27\u0e34\u0e15\u0e19\u0e34\u0e23\u0e31\u0e19\u0e14\u0e23\u0e4c.\u201d \u2014 \u0e22\u0e2d\u0e2b\u0e4c\u0e19 3:16",Ukrainian:'(Ukrainian) "\u0411\u043e \u0442\u0430\u043a \u043f\u043e\u043b\u044e\u0431\u0438\u0432 \u0411\u043e\u0433 \u0441\u0432\u0456\u0442, \u0449\u043e \u0432\u0456\u0434\u0434\u0430\u0432 \u0421\u0438\u043d\u0430 \u0421\u0432\u043e\xad\u0433\u043e \u0404\u0434\u0438\u043d\u043e\u0440\u043e\u0434\u043d\u043e\u0433\u043e, \u0449\u043e\u0431 \u043a\u043e\u0436\u0435\u043d, \u0445\u0442\u043e \u0432\u0456\u0440\u0443\u0454 \u0432 \u041d\u044c\u043e\u0433\u043e, \u043d\u0435 \u0437\u0430\u0433\u0438\u043d\u0443\u0432, \u0430\u043b\u0435 \u043c\u0430\u0432 \u0436\u0438\u0442\u0442\u044f \u0432\u0456\u0447\u043d\u0435." \u2014 \u0406\u0432\u0430\u043d 3:16',Urdu:"(Urdu) \u201c\u06a9\u06cc\u0648\u0646\u06a9\u06c1 \u062e\u062f\u0627 \u0646\u06d2 \u062f\u0646\u06cc\u0627 \u0633\u06d2 \u0627\u06cc\u0633\u06cc \u0645\u062d\u0628\u062a \u0631\u06a9\u06be\u06cc \u06a9\u06c1 \u0627\u064f\u0633 \u0646\u06d2 \u0627\u067e\u0646\u0627 \u0627\u06a9\u0644\u0648\u062a\u0627 \u0628\u06cc\u0679\u0627 \u062f\u06d2 \u062f\u06cc\u0627\u060c \u062a\u0627\u06a9\u06c1 \u062c\u0648 \u06a9\u0648\u0626\u06cc \u0627\u064f\u0633 \u067e\u0631 \u0627\u06cc\u0645\u0627\u0646 \u0644\u0627\u0626\u06d2 \u06c1\u0644\u0627\u06a9 \u0646\u06c1 \u06c1\u0648 \u0628\u0644\u06a9\u06c1 \u06c1\u0645\u06cc\u0634\u06c1 \u06a9\u06cc \u0632\u0646\u062f\u06af\u06cc \u067e\u0627\u0626\u06d2\u06d4\u201d \u2014 \u06cc\u0648\u062d\u0646\u0627 3:16",Uzbek:"(Uzbek) \u201cChunki Xudo dunyoni shunday sevdi: U yagona O\u2018g\u2018lini berdi, shunda Unga ishonadigan har kishi yo\u2018qolib ketmasin, balki abadiy hayotga ega bo\u2018lsin.\u201d \u2014 Yuhanno 3:16",Vietnamese:"(Vietnamese) \u201cV\xec \u0110\u1ee9c Ch\xfaa Tr\u1eddi \u0111\xe3 y\xeau th\u01b0\u01a1ng th\u1ebf gian \u0111\u1ebfn n\u1ed7i ban Con M\u1ed9t c\u1ee7a Ng\xe0i, h\u1ea7u cho h\u1ec5 ai tin Con \u1ea5y kh\xf4ng b\u1ecb h\u01b0 m\u1ea5t m\xe0 \u0111\u01b0\u1ee3c s\u1ef1 s\u1ed1ng \u0111\u1eddi \u0111\u1eddi.\u201d \u2014 Gi\u0103ng 3:16"};let F4=(()=>{class e{toggleMenu(n){n.stopPropagation(),this.isMenuOpen=!this.isMenuOpen}constructor(n,s){this.ngZone=n,this.http=s,this.churches=[],this.churchMarkers=[],this.animationId=null,this.isFlying=!1,this.bearing=0,this.loading=!0,this.currentEnglishQuote=vv.English,this.currentTranslatedQuote=vv.French,this.quoteIndex=1,this.fade=!0,this.churches_new=[],this.isMenuOpen=!1}ngOnInit(){this.startQuoteRotation(),document.addEventListener("click",this.handleOutsideClick.bind(this)),this.http.get("https://server-486354915183.europe-west1.run.app").subscribe({next:s=>{s&&s.length>0?this.churches=s.map(u=>{const _=n4[u.country];if(_){const w=2*(Math.random()-1),S=2*(Math.random()-1);return{...u,latitude:_.lat+w,longitude:_.lng+S}}return console.warn(`No coordinates found for ${u.country}`),{...u,latitude:0,longitude:0}}):(console.warn("API returned empty data, using fallback."),this.churches=this.churches_new),this.initializeMap()},error:s=>{console.error("API error:",s,"Using fallback data."),this.churches=this.churches_new,this.initializeMap()}})}initializeMap(){var n=this;Jx.accessToken="pk.eyJ1Ijoic2Fpa3VtYXJ0dW5ndXR1cmkiLCJhIjoiY21laDkzMGR0MDUycjJrcDZqN2xleXc3biJ9.73urhh9weHk5tslJYZ0vhQ",this.map=new Jx.Map({container:"globe-map",style:{version:8,sources:{"osm-tiles":{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"\xa9 OpenStreetMap contributors"}},layers:[{id:"osm-tiles",type:"raster",source:"osm-tiles",minzoom:0,maxzoom:19}]},center:[0,20],zoom:1.5,projection:"globe"}),this.map.on("style.load",()=>this.map.setFog({})),this.map.on("load",t4(function*(){n.showChurches(),yield n.startInitialRotation(),n.startChurchSlideshow(),n.loading=!1})),this.map.on("zoom",()=>{this.map.getZoom()>=5?this.showChurches():this.hideChurches()})}startInitialRotation(){return new Promise(n=>{const s=performance.now(),u=_=>{_-s<1e3?(this.bearing-=.5,this.map.easeTo({bearing:this.bearing,duration:50,easing:S=>S}),this.animationId=requestAnimationFrame(u)):(this.animationId&&cancelAnimationFrame(this.animationId),n())};this.ngZone.runOutsideAngular(()=>requestAnimationFrame(u))})}startChurchSlideshow(){let n=0;const s=()=>{if(!this.map||this.isFlying)return;this.isFlying=!0;const u=this.churches[n];this.map.flyTo({center:[u.longitude,u.latitude],zoom:5,speed:1.5,curve:1,essential:!0});const _=new Jx.Popup({offset:25,closeOnClick:!1}).setHTML(this.buildPopupCard(u)).setLngLat([u.longitude,u.latitude]).addTo(this.map);setTimeout(()=>{_.remove(),n=(n+1)%this.churches.length,this.isFlying=!1,s()},5e3)};s()}buildPopupCard(n){return`\n      <div style="width:220px; padding:10px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.2); font-family:sans-serif; background:#fff;">\n        <img src="${n.gender.toLowerCase(),"assets/Personicon.jpg"}" alt="${n.gender}" style="width:100%; height:140px; object-fit:cover; border-radius:8px;"/>\n        <h2 style="margin:8px 0 4px; font-size:16px;">Country: ${n.country}</h2>\n        <h3 style="margin:0; font-size:14px;">Language: ${n.language}</h3>\n        <h3 style="margin:0; font-size:14px;">Activity: ${n.activity}</h3>\n      </div>\n    `}addMarkerWithHover(n,s){const u=document.createElement("div");u.className="marker",u.style.backgroundImage=`url(${s})`,u.style.width="30px",u.style.height="30px",u.style.backgroundSize="cover",u.style.cursor="pointer";const _=new Jx.Popup({offset:25,closeButton:!1,closeOnClick:!1}).setHTML(this.buildPopupCard(n)),w=new Jx.Marker(u).setLngLat([n.longitude,n.latitude]).addTo(this.map);return u.addEventListener("mouseenter",()=>_.addTo(this.map).setLngLat([n.longitude,n.latitude])),u.addEventListener("mouseleave",()=>_.remove()),w}showChurches(){0===this.churchMarkers.length&&this.churches.length>0&&(this.churchMarkers=this.churches.map(n=>this.addMarkerWithHover(n,"")))}hideChurches(){this.churchMarkers.forEach(n=>n.remove()),this.churchMarkers=[]}startQuoteRotation(){const n=Object.keys(vv);this.quoteInterval=setInterval(()=>{this.fade=!1,setTimeout(()=>{this.quoteIndex=(this.quoteIndex+1)%n.length,this.currentTranslatedQuote=vv[n[this.quoteIndex]],this.fade=!0},1500)},5e3)}ngOnDestroy(){this.map&&this.map.remove(),this.animationId&&cancelAnimationFrame(this.animationId),this.quoteInterval&&clearInterval(this.quoteInterval),document.removeEventListener("click",this.handleOutsideClick.bind(this))}handleOutsideClick(){this.isMenuOpen&&(this.isMenuOpen=!1)}static{this.\u0275fac=function(s){return new(s||e)(Tt(Ti),Tt(AP))}}static{this.\u0275cmp=Yl({type:e,selectors:[["app-globe-view"]],decls:11,vars:4,consts:[["class","map-loader",4,"ngIf"],[1,"header",3,"hidden"],[1,"quotation-container"],[1,"quotation-line","english"],[1,"quotation-line","translated"],["id","globe-map"],[1,"menu-button",3,"click"],[1,"fas","fa-bars"],["class","menu-popup",3,"click",4,"ngIf"],[1,"map-loader"],[1,"spinner"],[1,"menu-popup",3,"click"],[1,"fas","fa-church"],[1,"fas","fa-user-circle"]],template:function(s,u){1&s&&(Rg(0,O4,4,0,"div",0),Sl(1,"div",1)(2,"div",2)(3,"p",3),I(4,"\u201cFor God so loved the world that He gave His only begotten Son, that whoever believes in Him should not perish but have everlasting life.\u201d \u2014 John 3:16"),vc(),Sl(5,"p",4),I(6),vc()()(),Id(7,"div",5),Sl(8,"div",6),aa("click",function(w){return u.toggleMenu(w)}),Id(9,"i",7),vc(),Rg(10,k4,3,0,"div",8)),2&s&&(Ap("ngIf",u.loading),fg(1),Ap("hidden",u.loading),fg(5),L(u.currentTranslatedQuote),fg(4),Ap("ngIf",u.isMenuOpen))},dependencies:[oM],styles:["[_nghost-%COMP%]{display:block;height:100vh;width:100%}.header[_ngcontent-%COMP%]{position:absolute;top:20px;left:50%;transform:translate(-50%);height:auto;background:rgba(255,255,255,.95);border-radius:12px;padding:10px 20px;display:flex;align-items:center;justify-content:space-between;gap:20px;box-shadow:0 2px 8px #00000040;z-index:10;width:85%}.logo[_ngcontent-%COMP%]{font-size:40px;font-weight:700;color:#fff;display:flex;align-items:center;gap:8px}.logo[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff;font-size:22px}.profile[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:30px;color:#fff;cursor:pointer;transition:opacity .3s ease}.profile[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:hover{opacity:.7}#globe-map[_ngcontent-%COMP%]{position:absolute;inset:0}  .mapboxgl-popup-content{background:transparent!important;box-shadow:none!important;padding:0!important;border-radius:0!important}  .mapboxgl-popup-close-button{display:none!important}.quotation-container[_ngcontent-%COMP%]{flex:1;background:transparent;box-shadow:none;width:auto;text-align:center}.quotation-line.english[_ngcontent-%COMP%]{margin:0;font-weight:700;font-size:17px;color:#000;line-height:1.3}.quotation-line.translated[_ngcontent-%COMP%]{margin:4px 0 0;font-weight:700;font-size:16px;color:#333;opacity:0;animation:_ngcontent-%COMP%_fadeInOut 6s infinite}@keyframes _ngcontent-%COMP%_fadeInOut{0%{opacity:0}20%{opacity:1}80%{opacity:1}to{opacity:0}}.map-loader[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,.9);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999;font-family:sans-serif}.spinner[_ngcontent-%COMP%]{border:6px solid #f3f3f3;border-top:6px solid #11b4da;border-radius:50%;width:50px;height:50px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:10px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.menu-button[_ngcontent-%COMP%]{position:fixed;bottom:25px;left:25px;background:rgba(255,255,255,.9);border-radius:50%;width:50px;height:50px;display:flex;justify-content:center;align-items:center;box-shadow:0 2px 10px #0000004d;cursor:pointer;z-index:20;transition:transform .2s ease}.menu-button[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.menu-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:22px;color:#000}.menu-popup[_ngcontent-%COMP%]{position:fixed;bottom:90px;left:25px;background:rgba(255,255,255,.95);border-radius:12px;padding:10px 15px;display:flex;flex-direction:column;align-items:center;gap:12px;box-shadow:0 4px 12px #00000040;animation:_ngcontent-%COMP%_fadeInUp .25s ease forwards;z-index:20}.menu-popup[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;color:#000;cursor:pointer;transition:transform .2s ease,opacity .2s ease}.menu-popup[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:hover{transform:scale(1.1);opacity:.8}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}"]})}}return e})(),L4=(()=>{class e{constructor(){this.title="chruch-project"}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275cmp=Yl({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(s,u){1&s&&Id(0,"app-globe-view")},dependencies:[F4]})}}return e})();const bv=new Ht("CallSetDisabledState",{providedIn:"root",factory:()=>vE}),vE="always";let SR=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({})}}return e})(),kj=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({imports:[SR]})}}return e})(),Lj=(()=>{class e{static withConfig(n){return{ngModule:e,providers:[{provide:bv,useValue:n.callSetDisabledState??vE}]}}static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e})}static{this.\u0275inj=Tr({imports:[kj]})}}return e})(),Nj=(()=>{class e{static{this.\u0275fac=function(s){return new(s||e)}}static{this.\u0275mod=dr({type:e,bootstrap:[L4]})}static{this.\u0275inj=Tr({imports:[IM,T3,K5,e4,Lj,D4,ZS]})}}return e})();vz().bootstrapModule(Nj).catch(e=>console.error(e))},247:function(wv){wv.exports=function(){"use strict";var df,hf,Yi;function n_(d,tr){if(df)if(hf){var Ui="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+df+")(sharedChunk); ("+hf+")(sharedChunk); self.onerror = null;",Da={};df(Da),Yi=tr(Da),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Yi.workerUrl=window.URL.createObjectURL(new Blob([Ui],{type:"text/javascript"})))}else hf=tr;else df=tr}return n_(0,function(d){var tr=1e-6,Ui=typeof Float32Array<"u"?Float32Array:Array;function Da(a,i){var o=i[0],c=i[1],h=i[2],m=i[3],g=o*m-h*c;return g?(a[0]=m*(g=1/g),a[1]=-c*g,a[2]=-h*g,a[3]=o*g,a):null}function Nd(){var a=new Ui(9);return Ui!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function ks(a,i){var o=i[0],c=i[1],h=i[2],m=i[3],g=i[4],x=i[5],E=i[6],T=i[7],I=i[8];return a[0]=g*I-x*T,a[1]=h*T-c*I,a[2]=c*x-h*g,a[3]=x*E-m*I,a[4]=o*I-h*E,a[5]=h*m-o*x,a[6]=m*T-g*E,a[7]=c*E-o*T,a[8]=o*g-c*m,a}function Fs(a,i,o){var c=i[0],h=i[1],m=i[2],g=i[3],x=i[4],E=i[5],T=i[6],I=i[7],A=i[8],M=o[0],F=o[1],L=o[2],V=o[3],j=o[4],W=o[5],Q=o[6],J=o[7],te=o[8];return a[0]=M*c+F*g+L*T,a[1]=M*h+F*x+L*I,a[2]=M*m+F*E+L*A,a[3]=V*c+j*g+W*T,a[4]=V*h+j*x+W*I,a[5]=V*m+j*E+W*A,a[6]=Q*c+J*g+te*T,a[7]=Q*h+J*x+te*I,a[8]=Q*m+J*E+te*A,a}function Nl(){var a=new Ui(16);return Ui!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function pn(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function ts(a,i){var o=i[0],c=i[1],h=i[2],m=i[3],g=i[4],x=i[5],E=i[6],T=i[7],I=i[8],A=i[9],M=i[10],F=i[11],L=i[12],V=i[13],j=i[14],W=i[15],Q=o*x-c*g,J=o*E-h*g,te=o*T-m*g,me=c*E-h*x,he=c*T-m*x,fe=h*T-m*E,be=I*V-A*L,Ee=I*j-M*L,je=I*W-F*L,De=A*j-M*V,He=A*W-F*V,ot=M*W-F*j,$e=Q*ot-J*He+te*De+me*je-he*Ee+fe*be;return $e?(a[0]=(x*ot-E*He+T*De)*($e=1/$e),a[1]=(h*He-c*ot-m*De)*$e,a[2]=(V*fe-j*he+W*me)*$e,a[3]=(M*he-A*fe-F*me)*$e,a[4]=(E*je-g*ot-T*Ee)*$e,a[5]=(o*ot-h*je+m*Ee)*$e,a[6]=(j*te-L*fe-W*J)*$e,a[7]=(I*fe-M*te+F*J)*$e,a[8]=(g*He-x*je+T*be)*$e,a[9]=(c*je-o*He-m*be)*$e,a[10]=(L*he-V*te+W*Q)*$e,a[11]=(A*te-I*he-F*Q)*$e,a[12]=(x*Ee-g*De-E*be)*$e,a[13]=(o*De-c*Ee+h*be)*$e,a[14]=(V*J-L*me-j*Q)*$e,a[15]=(I*me-A*J+M*Q)*$e,a):null}function Hi(a,i,o){var c=i[0],h=i[1],m=i[2],g=i[3],x=i[4],E=i[5],T=i[6],I=i[7],A=i[8],M=i[9],F=i[10],L=i[11],V=i[12],j=i[13],W=i[14],Q=i[15],J=o[0],te=o[1],me=o[2],he=o[3];return a[0]=J*c+te*x+me*A+he*V,a[1]=J*h+te*E+me*M+he*j,a[2]=J*m+te*T+me*F+he*W,a[3]=J*g+te*I+me*L+he*Q,a[4]=(J=o[4])*c+(te=o[5])*x+(me=o[6])*A+(he=o[7])*V,a[5]=J*h+te*E+me*M+he*j,a[6]=J*m+te*T+me*F+he*W,a[7]=J*g+te*I+me*L+he*Q,a[8]=(J=o[8])*c+(te=o[9])*x+(me=o[10])*A+(he=o[11])*V,a[9]=J*h+te*E+me*M+he*j,a[10]=J*m+te*T+me*F+he*W,a[11]=J*g+te*I+me*L+he*Q,a[12]=(J=o[12])*c+(te=o[13])*x+(me=o[14])*A+(he=o[15])*V,a[13]=J*h+te*E+me*M+he*j,a[14]=J*m+te*T+me*F+he*W,a[15]=J*g+te*I+me*L+he*Q,a}function Uo(a,i,o){var c,h,m,g,x,E,T,I,A,M,F,L,V=o[0],j=o[1],W=o[2];return i===a?(a[12]=i[0]*V+i[4]*j+i[8]*W+i[12],a[13]=i[1]*V+i[5]*j+i[9]*W+i[13],a[14]=i[2]*V+i[6]*j+i[10]*W+i[14],a[15]=i[3]*V+i[7]*j+i[11]*W+i[15]):(h=i[1],m=i[2],g=i[3],x=i[4],E=i[5],T=i[6],I=i[7],A=i[8],M=i[9],F=i[10],L=i[11],a[0]=c=i[0],a[1]=h,a[2]=m,a[3]=g,a[4]=x,a[5]=E,a[6]=T,a[7]=I,a[8]=A,a[9]=M,a[10]=F,a[11]=L,a[12]=c*V+x*j+A*W+i[12],a[13]=h*V+E*j+M*W+i[13],a[14]=m*V+T*j+F*W+i[14],a[15]=g*V+I*j+L*W+i[15]),a}function ro(a,i,o){var c=o[0],h=o[1],m=o[2];return a[0]=i[0]*c,a[1]=i[1]*c,a[2]=i[2]*c,a[3]=i[3]*c,a[4]=i[4]*h,a[5]=i[5]*h,a[6]=i[6]*h,a[7]=i[7]*h,a[8]=i[8]*m,a[9]=i[9]*m,a[10]=i[10]*m,a[11]=i[11]*m,a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15],a}function vs(a,i,o){var c=Math.sin(o),h=Math.cos(o),m=i[4],g=i[5],x=i[6],E=i[7],T=i[8],I=i[9],A=i[10],M=i[11];return i!==a&&(a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[3],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[4]=m*h+T*c,a[5]=g*h+I*c,a[6]=x*h+A*c,a[7]=E*h+M*c,a[8]=T*h-m*c,a[9]=I*h-g*c,a[10]=A*h-x*c,a[11]=M*h-E*c,a}function Zs(a,i,o){var c=Math.sin(o),h=Math.cos(o),m=i[0],g=i[1],x=i[2],E=i[3],T=i[8],I=i[9],A=i[10],M=i[11];return i!==a&&(a[4]=i[4],a[5]=i[5],a[6]=i[6],a[7]=i[7],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[0]=m*h-T*c,a[1]=g*h-I*c,a[2]=x*h-A*c,a[3]=E*h-M*c,a[8]=m*c+T*h,a[9]=g*c+I*h,a[10]=x*c+A*h,a[11]=E*c+M*h,a}function zl(a,i,o){var c=Math.sin(o),h=Math.cos(o),m=i[0],g=i[1],x=i[2],E=i[3],T=i[4],I=i[5],A=i[6],M=i[7];return i!==a&&(a[8]=i[8],a[9]=i[9],a[10]=i[10],a[11]=i[11],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[0]=m*h+T*c,a[1]=g*h+I*c,a[2]=x*h+A*c,a[3]=E*h+M*c,a[4]=T*h-m*c,a[5]=I*h-g*c,a[6]=A*h-x*c,a[7]=M*h-E*c,a}function Bl(a,i){return a[0]=i[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=i[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=i[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function da(a,i,o){var c,h,m,g=o[0],x=o[1],E=o[2],T=Math.hypot(g,x,E);return T<tr?null:(g*=T=1/T,x*=T,E*=T,c=Math.sin(i),h=Math.cos(i),a[0]=g*g*(m=1-h)+h,a[1]=x*g*m+E*c,a[2]=E*g*m-x*c,a[3]=0,a[4]=g*x*m-E*c,a[5]=x*x*m+h,a[6]=E*x*m+g*c,a[7]=0,a[8]=g*E*m+x*c,a[9]=x*E*m-g*c,a[10]=E*E*m+h,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function Ia(a,i){var o=i[0],c=i[1],h=i[2],m=i[3],g=o+o,x=c+c,E=h+h,T=o*g,I=c*g,A=c*x,M=h*g,F=h*x,L=h*E,V=m*g,j=m*x,W=m*E;return a[0]=1-A-L,a[1]=I+W,a[2]=M-j,a[3]=0,a[4]=I-W,a[5]=1-T-L,a[6]=F+V,a[7]=0,a[8]=M+j,a[9]=F-V,a[10]=1-T-A,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}Math.hypot||(Math.hypot=function(){for(var a=0,i=arguments.length;i--;)a+=arguments[i]*arguments[i];return Math.sqrt(a)});var ff=Hi;function Un(){var a=new Ui(3);return Ui!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Wa(a){var i=new Ui(3);return i[0]=a[0],i[1]=a[1],i[2]=a[2],i}function go(a){return Math.hypot(a[0],a[1],a[2])}function gr(a,i,o){var c=new Ui(3);return c[0]=a,c[1]=i,c[2]=o,c}function _r(a,i,o,c){return a[0]=i,a[1]=o,a[2]=c,a}function ki(a,i,o){return a[0]=i[0]+o[0],a[1]=i[1]+o[1],a[2]=i[2]+o[2],a}function oo(a,i,o){return a[0]=i[0]-o[0],a[1]=i[1]-o[1],a[2]=i[2]-o[2],a}function pf(a,i,o){return a[0]=i[0]*o[0],a[1]=i[1]*o[1],a[2]=i[2]*o[2],a}function Aa(a,i,o){return a[0]=Math.min(i[0],o[0]),a[1]=Math.min(i[1],o[1]),a[2]=Math.min(i[2],o[2]),a}function Vi(a,i,o){return a[0]=Math.max(i[0],o[0]),a[1]=Math.max(i[1],o[1]),a[2]=Math.max(i[2],o[2]),a}function Fi(a,i,o){return a[0]=i[0]*o,a[1]=i[1]*o,a[2]=i[2]*o,a}function Ho(a,i,o,c){return a[0]=i[0]+o[0]*c,a[1]=i[1]+o[1]*c,a[2]=i[2]+o[2]*c,a}function Iu(a,i){var o=i[0]-a[0],c=i[1]-a[1],h=i[2]-a[2];return o*o+c*c+h*h}function mf(a){var i=a[0],o=a[1],c=a[2];return i*i+o*o+c*c}function Gi(a,i){return a[0]=-i[0],a[1]=-i[1],a[2]=-i[2],a}function Mi(a,i){var o=i[0],c=i[1],h=i[2],m=o*o+c*c+h*h;return m>0&&(m=1/Math.sqrt(m)),a[0]=i[0]*m,a[1]=i[1]*m,a[2]=i[2]*m,a}function ar(a,i){return a[0]*i[0]+a[1]*i[1]+a[2]*i[2]}function gi(a,i,o){var c=i[0],h=i[1],m=i[2],g=o[0],x=o[1],E=o[2];return a[0]=h*E-m*x,a[1]=m*g-c*E,a[2]=c*x-h*g,a}function nr(a,i,o,c){var h=i[0],m=i[1],g=i[2];return a[0]=h+c*(o[0]-h),a[1]=m+c*(o[1]-m),a[2]=g+c*(o[2]-g),a}function lr(a,i,o){var c=i[0],h=i[1],m=i[2],g=o[3]*c+o[7]*h+o[11]*m+o[15];return a[0]=(o[0]*c+o[4]*h+o[8]*m+o[12])/(g=g||1),a[1]=(o[1]*c+o[5]*h+o[9]*m+o[13])/g,a[2]=(o[2]*c+o[6]*h+o[10]*m+o[14])/g,a}function Mo(a,i,o){var c=i[0],h=i[1],m=i[2];return a[0]=c*o[0]+h*o[3]+m*o[6],a[1]=c*o[1]+h*o[4]+m*o[7],a[2]=c*o[2]+h*o[5]+m*o[8],a}function Ma(a,i,o){var c=o[0],h=o[1],m=o[2],g=i[0],x=i[1],E=i[2],T=h*E-m*x,I=m*g-c*E,A=c*x-h*g,M=h*A-m*I,F=m*T-c*A,L=c*I-h*T,V=2*o[3];return I*=V,A*=V,F*=2,L*=2,a[0]=g+(T*=V)+(M*=2),a[1]=x+I+F,a[2]=E+A+L,a}function zd(a){return a[0]=0,a[1]=0,a[2]=0,a}function xs(a,i){return a[0]===i[0]&&a[1]===i[1]&&a[2]===i[2]}var cr=oo,ns=pf,Vl=go;function Bd(){var a=new Ui(4);return Ui!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function Za(a,i,o){return a[0]=i[0]*o,a[1]=i[1]*o,a[2]=i[2]*o,a[3]=i[3]*o,a}function Ls(a,i){var o=i[0],c=i[1],h=i[2],m=i[3],g=o*o+c*c+h*h+m*m;return g>0&&(g=1/Math.sqrt(g)),a[0]=o*g,a[1]=c*g,a[2]=h*g,a[3]=m*g,a}function bs(a,i,o){var c=i[0],h=i[1],m=i[2],g=i[3];return a[0]=o[0]*c+o[4]*h+o[8]*m+o[12]*g,a[1]=o[1]*c+o[5]*h+o[9]*m+o[13]*g,a[2]=o[2]*c+o[6]*h+o[10]*m+o[14]*g,a[3]=o[3]*c+o[7]*h+o[11]*m+o[15]*g,a}function Xa(){var a=new Ui(4);return Ui!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Pa(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Cc(a,i,o){o*=.5;var c=i[0],h=i[1],m=i[2],g=i[3],x=Math.sin(o),E=Math.cos(o);return a[0]=c*E+g*x,a[1]=h*E+m*x,a[2]=m*E-h*x,a[3]=g*E-c*x,a}function jl(a,i,o){o*=.5;var c=i[0],h=i[1],m=i[2],g=i[3],x=Math.sin(o),E=Math.cos(o);return a[0]=c*E-m*x,a[1]=h*E+g*x,a[2]=m*E+c*x,a[3]=g*E-h*x,a}Un(),Bd();var is,rs,Au,Ya=Ls,Mu=(is=Un(),rs=gr(1,0,0),Au=gr(0,1,0),function(a,i,o){var c=ar(i,o);return c<-.999999?(gi(is,rs,i),Vl(is)<1e-6&&gi(is,Au,i),Mi(is,is),function(h,m,g){g*=.5;var x=Math.sin(g);h[0]=x*m[0],h[1]=x*m[1],h[2]=x*m[2],h[3]=Math.cos(g)}(a,is,Math.PI),a):c>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(gi(is,i,o),a[0]=is[0],a[1]=is[1],a[2]=is[2],a[3]=1+c,Ya(a,a))});function Po(){var a=new Ui(2);return Ui!=Float32Array&&(a[0]=0,a[1]=0),a}function Zr(a,i){var o=new Ui(2);return o[0]=a,o[1]=i,o}function Ka(a,i,o){return a[0]=i[0]+o[0],a[1]=i[1]+o[1],a}function Ja(a,i,o){return a[0]=i[0]-o[0],a[1]=i[1]-o[1],a}function Qa(a,i,o){return a[0]=i[0]*o,a[1]=i[1]*o,a}function Ul(a){return Math.hypot(a[0],a[1])}function Pu(a,i){var o=i[0],c=i[1],h=o*o+c*c;return h>0&&(h=1/Math.sqrt(h)),a[0]=i[0]*h,a[1]=i[1]*h,a}function Ci(a,i){return a[0]*i[0]+a[1]*i[1]}Xa(),Xa(),Nd();var Vd,jd,Ns=Ja;function Ud(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}Po();var Ru=Ud(function(){if(jd)return Vd;function a(i,o,c,h){this.cx=3*i,this.bx=3*(c-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(h-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=c,this.p2y=h}return jd=1,Vd=a,a.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,o){if(void 0===o&&(o=1e-6),i<0)return 0;if(i>1)return 1;for(var c=i,h=0;h<8;h++){var m=this.sampleCurveX(c)-i;if(Math.abs(m)<o)return c;var g=this.sampleCurveDerivativeX(c);if(Math.abs(g)<1e-6)break;c-=m/g}var x=0,E=1;for(c=i,h=0;h<20&&(m=this.sampleCurveX(c),!(Math.abs(m-i)<o));h++)i>m?x=c:E=c,c=.5*(E-x)+x;return c},solve:function(i,o){return this.sampleCurveY(this.solveCurveX(i,o))}},Vd}());function Qe(a,i){this.x=a,this.y=i}function el(a,i){if(Array.isArray(a)){if(!Array.isArray(i)||a.length!==i.length)return!1;for(let o=0;o<a.length;o++)if(!el(a[o],i[o]))return!1;return!0}if("object"==typeof a&&null!==a&&null!==i){if("object"!=typeof i||Object.keys(a).length!==Object.keys(i).length)return!1;for(const o in a)if(!el(a[o],i[o]))return!1;return!0}return a===i}Qe.prototype={clone(){return new Qe(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,i){return this.clone()._rotateAround(a,i)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const i=a.x-this.x,o=a.y-this.y;return i*i+o*o},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,i){return Math.atan2(this.x*i-this.y*a,this.x*a+this.y*i)},_matMult(a){const i=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=i,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const i=Math.cos(a),o=Math.sin(a),c=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=c,this},_rotateAround(a,i){const o=Math.cos(a),c=Math.sin(a),h=i.y+c*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-c*(this.y-i.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Qe},Qe.convert=function(a){if(a instanceof Qe)return a;if(Array.isArray(a))return new Qe(+a[0],+a[1]);if(void 0!==a.x&&void 0!==a.y)return new Qe(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};const Yp=Math.PI/180,gf=180/Math.PI;function Rn(a){return a*Yp}function Pe(a){return a*gf}const Z=[[0,0],[1,0],[1,1],[0,1]];function X(a){if(a<=0)return 0;if(a>=1)return 1;const i=a*a,o=i*a;return 4*(a<.5?o:3*(a-i)+o-.75)}function oe(a,i,o,c){const h=new Ru(a,i,o,c);return function(m){return h.solve(m)}}const ge=oe(.25,.1,.25,1);function se(a,i,o){return Math.min(o,Math.max(i,a))}function we(a,i,o){return(o=se((o-a)/(i-a),0,1))*o*(3-2*o)}function Fe(a,i,o){const c=o-i,h=((a-i)%c+c)%c+i;return h===i?o:h}function Te(a,i,o){if(!a.length)return o(null,[]);let c=a.length;const h=new Array(a.length);let m=null;a.forEach((g,x)=>{i(g,(E,T)=>{E&&(m=E),h[x]=T,0==--c&&o(m,h)})})}function Ie(a,...i){for(const o of i)for(const c in o)a[c]=o[c];return a}let st=1;function qe(){return st++}function Lt(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Wt(a,i){a.forEach(o=>{i[o]&&(i[o]=i[o].bind(i))})}function Yt(a,i,o){const c={};for(const h in a)c[h]=i.call(this,a[h],h,a);return c}function bn(a,i,o){const c={};for(const h in a)i.call(this,a[h],h,a)&&(c[h]=a[h]);return c}function mn(a){return Array.isArray(a)?a.map(mn):"object"==typeof a&&a?Yt(a,mn):a}function un(a,i){for(let o=0;o<a.length;o++)if(i.indexOf(a[o])>=0)return!0;return!1}const _i={};function _n(a){_i[a]||(typeof console<"u"&&console.warn(a),_i[a]=!0)}function ir(a,i,o){return(o.y-a.y)*(i.x-a.x)>(i.y-a.y)*(o.x-a.x)}function Ir(a){let i=0;for(let o,c,h=0,m=a.length,g=m-1;h<m;g=h++)o=a[h],c=a[g],i+=(c.x-o.x)*(o.y+c.y);return i}function Nr([a,i,o]){const c=Rn(i+90),h=Rn(o);return{x:a*Math.cos(c)*Math.sin(h),y:a*Math.sin(c)*Math.sin(h),z:a*Math.cos(h),azimuthal:i,polar:o}}function di(a){return(typeof self<"u"||void 0!==a)&&typeof WorkerGlobalScope<"u"&&(void 0!==a?a:self)instanceof WorkerGlobalScope}function Vn(a){const i={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,c,h,m)=>{const g=h||m;return i[c]=!g||g.toLowerCase(),""}),i["max-age"]){const o=parseInt(i["max-age"],10);isNaN(o)?delete i["max-age"]:i["max-age"]=o}return i}let $i=null;function ji(a,i){return[a[4*i],a[4*i+1],a[4*i+2],a[4*i+3]]}function Si(a,i,o,c){for(;i<o;){const h=i+o>>1;a[h]<c?i=h+1:o=h}return i}function Xr(a,i,o,c){for(;i<o;){const h=i+o>>1;a[h]<=c?i=h+1:o=h}return i}function Go(a){return a>0?1/(1.001-a):1+a}function _o(a){return a>0?1-1/(1.001-a):-a}function Hd(a,i,o){return(a-i.min)*(o.max-o.min)/(i.max-i.min)+o.min}const so={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!so.API_URL)return null;try{const a=new URL(so.API_URL);return"api.mapbox.cn"===a.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===a.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.1.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Hl(a){return so.API_URL_REGEX.test(a)}function _f(a){return so.API_SPRITE_REGEX.test(a)}let Ou,Gd,yf,Ra,tl,ku;function nl(){return null==Ou&&(Ou=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),Ou}const Xs={now:()=>void 0!==Ra?Ra:performance.now(),setNow(a){Ra=a},restoreNow(){Ra=void 0},frame(a){const i=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(a,i=0){const{width:o,height:c}=a;tl||(tl=document.createElement("canvas"));const h=tl.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(o>tl.width||c>tl.height)&&(tl.width=o,tl.height=c),h.clearRect(-i,-i,o+2*i,c+2*i),h.drawImage(a,0,0,o,c),h.getImageData(-i,-i,o+2*i,c+2*i)},resolveURL:a=>(Gd||(Gd=document.createElement("a")),Gd.href=a,Gd.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==yf&&(yf=window.matchMedia("(prefers-reduced-motion: reduce)")),yf.matches)},hasCanvasFingerprintNoise(){if(void 0!==ku)return ku;if(!nl())return ku=!1,!1;const a=new OffscreenCanvas(85,1),i=a.getContext("2d",{willReadFrequently:!0});let o=0;for(let h=0;h<a.width;++h)i.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,i.fillRect(h,0,1,1);const c=i.getImageData(0,0,a.width,a.height);o=0;for(let h=0;h<c.data.length;++h)if(h%4!=3&&o++!==c.data[h])return ku=!0,!0;return ku=!1,!1}};function os(a,i){const o=a.indexOf("?");if(o<0)return`${a}?${new URLSearchParams(i).toString()}`;const c=new URLSearchParams(a.slice(o));for(const h in i)c.set(h,i[h]);return`${a.slice(0,o)}?${c.toString()}`}function zs(a,i={persistentParams:[]}){const o=a.indexOf("?");if(o<0)return a;const c=new URLSearchParams,h=new URLSearchParams(a.slice(o));for(const g of i.persistentParams){const x=h.get(g);x&&c.set(g,x)}const m=c.toString();return`${a.slice(0,o)}${m.length>0?`?${m}`:""}`}const Oa="mapbox-tiles";let ha=500,Di=50;const Gl=["language","worldview","jobid"];let ur,Sc;function Dc(){try{return caches}catch{}}function Ki(){const a=Dc();a&&null==ur&&(ur=a.open(Oa))}let Nn=1/0;const $d={supported:!1,testSupport:function(a){!Lu&&Fu&&(bt?Wn(a):Ro=a)}};let Ro,Fu,Lu=!1,bt=!1;const qd=typeof self<"u"?self:{};function Wn(a){const i=a.createTexture();a.bindTexture(a.TEXTURE_2D,i);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Fu),a.isContextLost())return;$d.supported=!0}catch{}a.deleteTexture(i),Lu=!0}qd.document&&(Fu=qd.document.createElement("img"),Fu.onload=function(){Ro&&Wn(Ro),Ro=null,bt=!0},Fu.onerror=function(){Lu=!0,Ro=null},Fu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Li={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Li);class On extends Error{constructor(i,o,c){401===o&&Hl(c)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=o,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Kp=di()?()=>self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Nu=function(a,i){if(!(/^file:/.test(o=a.url)||/^file:/.test(Kp())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,h){const m=new AbortController,g=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Kp(),referrerPolicy:c.referrerPolicy,signal:m.signal});let x=!1,E=!1;const T=(I=g.url).indexOf("sku=")>0&&Hl(I);var I;"json"===c.type&&g.headers.set("Accept","application/json");const A=(F,L,V)=>{if(E)return;if(F&&"SecurityError"!==F.message&&_n(F.toString()),L&&V)return M(L);const j=Date.now();fetch(g).then(W=>{if(W.ok){const Q=T?W.clone():null;return M(W,Q,j)}return h(new On(W.statusText,W.status,c.url))}).catch(W=>{"AbortError"!==W.name&&h(new Error(`${W.message} ${c.url}`))})},M=(F,L,V)=>{("arrayBuffer"===c.type?F.arrayBuffer():"json"===c.type?F.json():F.text()).then(j=>{E||(L&&V&&function(W,Q,J){if(Ki(),null==ur)return;const te=Vn(Q.headers.get("Cache-Control")||"");if(te["no-store"])return;const me={status:Q.status,statusText:Q.statusText,headers:new Headers};Q.headers.forEach((be,Ee)=>me.headers.set(Ee,be)),te["max-age"]&&me.headers.set("Expires",new Date(J+1e3*te["max-age"]).toUTCString());const he=me.headers.get("Expires");if(!he||new Date(he).getTime()-J<42e4)return;let fe=zs(W.url,{persistentParams:Gl});if(206===Q.status){const be=W.headers.get("Range");if(!be)return;me.status=200,fe=os(fe,{range:be})}!function(be,Ee){if(void 0===Sc)try{new Response(new ReadableStream),Sc=!0}catch{Sc=!1}Sc?Ee(be.body):be.blob().then(Ee).catch(je=>_n(je.message))}(Q,be=>{const Ee=new Response(200!==(je=Q.status)&&404!==je&&[101,103,204,205,304].includes(je)?null:be,me);var je;Ki(),ur?.then(De=>De.put(fe,Ee)).catch(De=>_n(De.message))})}(g,L,V),x=!0,h(null,j,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(j=>{E||h(new Error(j.message))})};return T?function(F,L){if(Ki(),null==ur)return L(null);ur.then(V=>{let j=zs(F.url,{persistentParams:Gl});const W=F.headers.get("Range");W&&(j=os(j,{range:W})),V.match(j).then(Q=>{const J=function(te){if(!te)return!1;const me=new Date(te.headers.get("Expires")||0),he=Vn(te.headers.get("Cache-Control")||"");return Number(me)>Date.now()&&!he["no-cache"]}(Q);V.delete(j).catch(L),J&&V.put(j,Q.clone()).catch(L),L(null,Q,J)}).catch(L)}).catch(L)}(g,A):A(null,null),{cancel:()=>{E=!0,x||m.abort()}}}(a,i);if(di(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,i,void 0,!0)}var o;return function(c,h){const m=new XMLHttpRequest;m.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(m.responseType="arraybuffer");for(const g in c.headers)m.setRequestHeader(g,c.headers[g]);return"json"===c.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===c.credentials,m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let g=m.response;if("json"===c.type)try{g=JSON.parse(m.response)}catch(x){return h(x)}h(null,g,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else h(new On(m.statusText,m.status,c.url))},m.send(c.body),{cancel:()=>m.abort()}}(a,i)},Ic=function(a,i){return Nu(Ie(a,{type:"arrayBuffer"}),i)};function Bs(a){const i=document.createElement("a");return i.href=a,i.protocol===location.protocol&&i.host===location.host}const vf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ac,Mc;Ac=[],Mc=0;const fa=function(a,i){if($d.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Mc>=so.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:a,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Ac.push(m),m}Mc++;let o=!1;const c=()=>{if(!o)for(o=!0,Mc--;Ac.length&&Mc<so.MAX_PARALLEL_IMAGE_REQUESTS;){const m=Ac.shift(),{requestParameters:g,callback:x,cancelled:E}=m;E||(m.cancel=fa(g,x).cancel)}},h=Ic(a,(m,g,x,E)=>{c(),m?i(m):g&&(self.createImageBitmap?function(T,I){const A=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(A).then(M=>{I(null,M)}).catch(M=>{I(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(T,I)=>i(T,I,x,E)):function(T,I){const A=new Image;A.onload=()=>{I(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=vf})},A.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(T)],{type:"image/png"});A.src=T.byteLength?URL.createObjectURL(M):vf}(g,(T,I)=>i(T,I,x,E)))});return{cancel:()=>{h.cancel(),c()}}};var Tv,Jp,Cv,Wd={exports:{}},Pc={exports:{}},Sv={exports:{}},Xd=Ud(function(){if(Cv)return Wd.exports;Cv=1;var a=(Tv||(Tv=1,Pc.exports=function(o,c){var h,m,g,x,E,T,I,A;for(m=o.length-(h=3&o.length),g=c,E=3432918353,T=461845907,A=0;A<m;)I=255&o.charCodeAt(A)|(255&o.charCodeAt(++A))<<8|(255&o.charCodeAt(++A))<<16|(255&o.charCodeAt(++A))<<24,++A,g=27492+(65535&(x=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*E+(((I>>>16)*E&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(I=0,h){case 3:I^=(255&o.charCodeAt(A+2))<<16;case 2:I^=(255&o.charCodeAt(A+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&o.charCodeAt(A)))*E+(((I>>>16)*E&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return g^=o.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),Pc.exports),i=(Jp||(Jp=1,Sv.exports=function(o,c){for(var h,m=o.length,g=c^m,x=0;m>=4;)h=1540483477*(65535&(h=255&o.charCodeAt(x)|(255&o.charCodeAt(++x))<<8|(255&o.charCodeAt(++x))<<16|(255&o.charCodeAt(++x))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++x;switch(m){case 3:g^=(255&o.charCodeAt(x+2))<<16;case 2:g^=(255&o.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&o.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),Sv.exports);return Wd.exports=a,Wd.exports.murmur3=a,Wd.exports.murmur2=i,Wd.exports}());class Yr{constructor(i,...o){Ie(this,o[0]||{}),this.type=i}}class yn extends Yr{constructor(i,o={}){super("error",Ie({error:i},o))}}function i_(a,i,o){o[a]&&-1!==o[a].indexOf(i)||(o[a]=o[a]||[],o[a].push(i))}function r_(a,i,o){if(o&&o[a]){const c=o[a].indexOf(i);-1!==c&&o[a].splice(c,1)}}class zu{on(i,o){return this._listeners=this._listeners||{},i_(i,o,this._listeners),this}off(i,o){return r_(i,o,this._listeners),r_(i,o,this._oneTimeListeners),this}once(i,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},i_(i,o,this._oneTimeListeners),this):new Promise(c=>{this.once(i,c)})}fire(i,o){const c="string"==typeof i?new Yr(i,o):i,h=c.type;if(this.listens(h)){c.target=this;const m=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const E of m)E.call(this,c);const g=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const E of g)r_(h,E,this._oneTimeListeners),E.call(this,c);const x=this._eventedParent;x&&(Ie(c,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),x.fire(c))}else c instanceof yn&&console.error(c.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,o){return this._eventedParent=i,this._eventedParentData=o,this}}class Kt{constructor(i){"string"==typeof i?this.name=i:(this.name=i.name,this.iconsetId=i.iconsetId)}static from(i){return new Kt(i)}static toString(i){return i.iconsetId?`${i.name}\x1f${i.iconsetId}`:i.name}static parse(i){const[o,c]=i.split("\x1f");return new Kt({name:o,iconsetId:c})}static isEqual(i,o){return i.name===o.name&&i.iconsetId===o.iconsetId}toString(){return Kt.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var o_,Tr={},Bu=function(){if(o_)return Tr;o_=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(m){return(m=Math.round(m))<0?0:m>255?255:m}function o(m){return i("%"===m[m.length-1]?parseFloat(m)/100*255:parseInt(m))}function c(m){return(g="%"===m[m.length-1]?parseFloat(m)/100:parseFloat(m))<0?0:g>1?1:g;var g}function h(m,g,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?m+(g-m)*x*6:2*x<1?g:3*x<2?m+(g-m)*(2/3-x)*6:m}try{Tr.parseCSSColor=function(m){var g,x=m.replace(/ /g,"").toLowerCase();if(x in a)return a[x].slice();if("#"===x[0])return 4===x.length?(g=parseInt(x.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:7===x.length&&(g=parseInt(x.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var E=x.indexOf("("),T=x.indexOf(")");if(-1!==E&&T+1===x.length){var I=x.substr(0,E),A=x.substr(E+1,T-(E+1)).split(","),M=1;switch(I){case"rgba":if(4!==A.length)return null;M=c(A.pop());case"rgb":return 3!==A.length?null:[o(A[0]),o(A[1]),o(A[2]),M];case"hsla":if(4!==A.length)return null;M=c(A.pop());case"hsl":if(3!==A.length)return null;var F=(parseFloat(A[0])%360+360)%360/360,L=c(A[1]),V=c(A[2]),j=V<=.5?V*(L+1):V+L-V*L,W=2*V-j;return[i(255*h(W,j,F+1/3)),i(255*h(W,j,F)),i(255*h(W,j,F-1/3)),M];default:return null}}return null}}catch{}return Tr}();class Jn{constructor(i,o,c,h=1){this.r=i,this.g=o,this.b=c,this.a=h}static parse(i){if(!i)return;if(i instanceof Jn)return i;if("string"!=typeof i)return;const o=Bu.parseCSSColor(i);return o?new Jn(o[0]/255,o[1]/255,o[2]/255,o[3]):void 0}toString(){const[i,o,c,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*i)},${Math.round(255*o)},${Math.round(255*c)},${h})`}toNonPremultipliedRenderColor(i){const{r:o,g:c,b:h,a:m}=this;return new ju(i,o,c,h,m)}toPremultipliedRenderColor(i){const{r:o,g:c,b:h,a:m}=this;return new Yd(i,o*m,c*m,h*m,m)}clone(){return new Jn(this.r,this.g,this.b,this.a)}}class Vu{constructor(i,o,c,h,m,g=!1){if(this.premultiplied=!1,this.premultiplied=g,i){const x=i.image.height,E=x*x;this.premultiplied?(o=0===m?0:o/m*(x-1),c=0===m?0:c/m*(x-1),h=0===m?0:h/m*(x-1)):(o*=x-1,c*=x-1,h*=x-1);const T=Math.floor(o),I=Math.floor(c),A=Math.floor(h),M=Math.ceil(o),F=Math.ceil(c),L=Math.ceil(h),V=o-T,j=c-I,W=h-A,Q=i.image.data,J=4*(T+I*E+A*x),te=4*(T+I*E+L*x),me=4*(T+F*E+A*x),he=4*(T+F*E+L*x),fe=4*(M+I*E+A*x),be=4*(M+I*E+L*x),Ee=4*(M+F*E+A*x),je=4*(M+F*E+L*x);if(J<0||je>=Q.length)throw new Error("out of range");this.r=Nt(Nt(Nt(Q[J],Q[te],W),Nt(Q[me],Q[he],W),j),Nt(Nt(Q[fe],Q[be],W),Nt(Q[Ee],Q[je],W),j),V)/255*(this.premultiplied?m:1),this.g=Nt(Nt(Nt(Q[J+1],Q[te+1],W),Nt(Q[me+1],Q[he+1],W),j),Nt(Nt(Q[fe+1],Q[be+1],W),Nt(Q[Ee+1],Q[je+1],W),j),V)/255*(this.premultiplied?m:1),this.b=Nt(Nt(Nt(Q[J+2],Q[te+2],W),Nt(Q[me+2],Q[he+2],W),j),Nt(Nt(Q[fe+2],Q[be+2],W),Nt(Q[Ee+2],Q[je+2],W),j),V)/255*(this.premultiplied?m:1),this.a=m}else this.r=o,this.g=c,this.b=h,this.a=m}toArray(){const{r:i,g:o,b:c,a:h}=this;return[255*i,255*o,255*c,h]}toHslaArray(){let{r:i,g:o,b:c,a:h}=this;if(this.premultiplied){if(0===h)return[0,0,0,0];i/=h,o/=h,c/=h}const m=Math.min(Math.max(i,0),1),g=Math.min(Math.max(o,0),1),x=Math.min(Math.max(c,0),1),E=Math.min(m,g,x),T=Math.max(m,g,x),I=(E+T)/2;if(E===T)return[0,0,100*I,h];const A=T-E,M=I>.5?A/(2-T-E):A/(T+E);let F=0;return T===m?F=(g-x)/A+(g<x?6:0):T===g?F=(x-m)/A+2:T===x&&(F=(m-g)/A+4),F*=60,[Math.min(Math.max(F,0),360),Math.min(Math.max(100*M,0),100),Math.min(Math.max(100*I,0),100),h]}toArray01(){const{r:i,g:o,b:c,a:h}=this;return[i,o,c,h]}toArray01Scaled(i){const{r:o,g:c,b:h}=this;return[o*i,c*i,h*i]}toArray01Linear(){const{r:i,g:o,b:c,a:h}=this;return[Math.pow(i,2.2),Math.pow(o,2.2),Math.pow(c,2.2),h]}}class ju extends Vu{constructor(i,o,c,h,m){super(i,o,c,h,m,!1)}}class Yd extends Vu{constructor(i,o,c,h,m){super(i,o,c,h,m,!0)}}function Nt(a,i,o){return a*(1-o)+i*o}function xf(a,i,o){return a.map((c,h)=>Nt(c,i[h],o))}Jn.black=new Jn(0,0,0,1),Jn.white=new Jn(1,1,1,1),Jn.transparent=new Jn(0,0,0,0),Jn.red=new Jn(1,0,0,1),Jn.blue=new Jn(0,0,1,1);var Uu=Object.freeze({__proto__:null,array:xf,color:function(a,i,o){return new Jn(Nt(a.r,i.r,o),Nt(a.g,i.g,o),Nt(a.b,i.b,o),Nt(a.a,i.a,o))},number:Nt});function Rc(a,...i){for(const o of i)for(const c in o)a[c]=o[c];return a}class Hn extends Error{constructor(i,o){super(o),this.message=o,this.key=i}}class Kd{constructor(i,o=[]){this.parent=i,this.bindings={};for(const[c,h]of o)this.bindings[c]=h}concat(i){return new Kd(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Oc={kind:"null"},St={kind:"number"},Gn={kind:"string"},Yn={kind:"boolean"},yi={kind:"color"},$l={kind:"object"},Qn={kind:"value"},Ht={kind:"collator"},kc={kind:"formatted"},Fc={kind:"resolvedImage"};function yo(a,i){return{kind:"array",itemType:a,N:i}}function Cr(a){if("array"===a.kind){const i=Cr(a.itemType);return"number"==typeof a.N?`array<${i}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${i}>`}return a.kind}const Dv=[Oc,St,Gn,Yn,yi,kc,$l,yo(Qn),Fc];function ql(a,i){if("error"===i.kind)return null;if("array"===a.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!ql(a.itemType,i.itemType))&&("number"!=typeof a.N||a.N===i.N))return null}else{if(a.kind===i.kind)return null;if("value"===a.kind)for(const o of Dv)if(!ql(o,i))return null}return`Expected ${Cr(a)} but found ${Cr(i)} instead.`}function Lc(a,i){return i.some(o=>o.kind===a.kind)}function bf(a,i){return i.some(o=>"null"===o?null===a:"array"===o?Array.isArray(a):"object"===o?a&&!Array.isArray(a)&&"object"==typeof a:o===typeof a)}function Qp(a,i){return"array"===a.kind&&"array"===i.kind?a.N===i.N&&Qp(a.itemType,i.itemType):a.kind===i.kind}class wf{constructor(i,o,c){this.sensitivity=i?o?"variant":"case":o?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,o){return this.collator.compare(i,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class em{constructor(i,o,c,h,m){this.text=i.normalize?i.normalize():i,this.image=o,this.scale=c,this.fontStack=h,this.textColor=m}}class Kr{constructor(i){this.sections=i}static fromString(i){return new Kr([new em(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||!!i.image&&i.image.hasPrimary())}static factory(i){return i instanceof Kr?i:Kr.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const o of this.sections){if(o.image){const h=o.image.getPrimary().id.toString();i.push(["image",h]);continue}i.push(o.text);const c={};o.fontStack&&(c["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(c["font-scale"]=o.scale),o.textColor&&(c["text-color"]=["rgba"].concat(o.textColor.toNonPremultipliedRenderColor(null).toArray())),i.push(c)}return i}}class pa{constructor(i,o={}){if(this.id=Kt.from(i),this.options=Object.assign({},o),o.transform){const{a:c,b:h,c:m,d:g,e:x,f:E}=o.transform;this.options.transform=new DOMMatrix([c,h,m,g,x,E])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:i,b:o,c,d:h,e:m,f:g}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:i,b:o,c,d:h,e:m,f:g}})}static parse(i){let o,c,h,m;try{({name:o,iconsetId:c,params:h,transform:m}=JSON.parse(i)||{})}catch{return null}if(!o)return null;const{a:g,b:x,c:E,d:T,e:I,f:A}=m||{};return new pa({name:o,iconsetId:c},{params:h,transform:new DOMMatrix([g,x,E,T,I,A])})}scaleSelf(i,o){return this.options.transform.scaleSelf(i,o),this}}class vo{constructor(i,o,c,h,m=!1){this.primaryId=Kt.from(i),this.primaryOptions=o,c&&(this.secondaryId=Kt.from(c)),this.secondaryOptions=h,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new pa(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new pa(this.secondaryId,this.secondaryOptions):null}static from(i){return"string"==typeof i?vo.build({name:i}):i}static build(i,o,c,h){return!i||"object"==typeof i&&!("name"in i)?null:new vo(i,c,o,h)}}function Nc(a,i,o,c){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof o&&o>=0&&o<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[a,i,o,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[a,i,o,c]:[a,i,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ln(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof Jn||a instanceof wf||a instanceof Kr||a instanceof vo)return!0;if(Array.isArray(a)){for(const i of a)if(!ln(i))return!1;return!0}if("object"==typeof a){for(const i in a)if(!ln(a[i]))return!1;return!0}return!1}function wt(a){if(null===a)return Oc;if("string"==typeof a)return Gn;if("boolean"==typeof a)return Yn;if("number"==typeof a)return St;if(a instanceof Jn)return yi;if(a instanceof wf)return Ht;if(a instanceof Kr)return kc;if(a instanceof vo)return Fc;if(Array.isArray(a)){const i=a.length;let o;for(const c of a){const h=wt(c);if(o){if(o===h)continue;o=Qn;break}o=h}return yo(o||Qn,i)}return $l}function Vs(a){const i=typeof a;return null===a?"":"string"===i||"number"===i||"boolean"===i?String(a):a instanceof Kr||a instanceof vo||a instanceof Jn?a.toString():JSON.stringify(a)}class Vt{constructor(i,o){this.type=i,this.value=o}static parse(i,o){if(2!==i.length)return o.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!ln(i[1]))return o.error("invalid value");const c=i[1];let h=wt(c);const m=o.expectedType;return"array"!==h.kind||0!==h.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(h=m),new Vt(h,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Jn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Kr?this.value.serialize():this.value}}class Ar{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Ys={string:Gn,number:St,boolean:Yn,object:$l};class Bt{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");let c,h=1;const m=i[0];if("array"===m){let x,E;if(i.length>2){const T=i[1];if("string"!=typeof T||!(T in Ys)||"object"===T)return o.error('The item type argument of "array" must be one of string, number, boolean',1);x=Ys[T],h++}else x=Qn;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return o.error('The length argument to "array" must be a positive integer literal',2);E=i[2],h++}c=yo(x,E)}else c=Ys[m];const g=[];for(;h<i.length;h++){const x=o.parse(i[h],h,Qn);if(!x)return null;g.push(x)}return new Bt(c,g)}evaluate(i){for(let o=0;o<this.args.length;o++){const c=this.args[o].evaluate(i);if(!ql(this.type,wt(c)))return c;if(o===this.args.length-1)throw new Ar(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${Cr(wt(c))} but was expected to be of type ${Cr(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,o=[i.kind];if("array"===i.kind){const c=i.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){o.push(c.kind);const h=i.N;("number"==typeof h||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(c=>c.serialize()))}}class gt{constructor(i){this.type=kc,this.sections=i}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");const c=i[1];if(!Array.isArray(c)&&"object"==typeof c)return o.error("First argument must be an image or text section.");const h=[];let m=!1;for(let g=1;g<=i.length-1;++g){const x=i[g];if(m&&"object"==typeof x&&!Array.isArray(x)){m=!1;let E=null;if(x["font-scale"]&&(E=o.parseObjectValue(x["font-scale"],g,"font-scale",St),!E))return null;let T=null;if(x["text-font"]&&(T=o.parseObjectValue(x["text-font"],g,"text-font",yo(Gn)),!T))return null;let I=null;if(x["text-color"]&&(I=o.parseObjectValue(x["text-color"],g,"text-color",yi),!I))return null;const A=h[h.length-1];A.scale=E,A.font=T,A.textColor=I}else{const E=o.parse(i[g],g,Qn);if(!E)return null;const T=E.type.kind;if("string"!==T&&"value"!==T&&"null"!==T&&"resolvedImage"!==T)return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:E,scale:null,font:null,textColor:null})}}return new gt(h)}evaluate(i){return new Kr(this.sections.map(o=>{const c=o.content.evaluate(i);return Qp(wt(c),Fc)?new em("",c,null,null,null):new em(Vs(c),null,o.scale?o.scale.evaluate(i):null,o.font?o.font.evaluate(i).join(","):null,o.textColor?o.textColor.evaluate(i):null)}))}eachChild(i){for(const o of this.sections)i(o.content),o.scale&&i(o.scale),o.font&&i(o.font),o.textColor&&i(o.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const o of this.sections){i.push(o.content.serialize());const c={};o.scale&&(c["font-scale"]=o.scale.serialize()),o.font&&(c["text-font"]=o.font.serialize()),o.textColor&&(c["text-color"]=o.textColor.serialize()),i.push(c)}return i}}class zc{constructor(i,o,c,h){this._imageWarnHistory={},this.type=Fc,this.namePrimary=i,this.nameSecondary=o,c&&(this.paramsPrimary=c.params,this.iconsetIdPrimary=c.iconset?c.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(i,o){if(i.length<2)return o.error("Expected two or more arguments.");let c=1;const h=[];function m(){if(c<i.length){const x=o.parse(i[c],c++,Gn);return x?(h.push({image:x,options:{}}),!0):(o.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(c<i.length){const E=i[c];if(null===(x=E)||"object"!=typeof x||Array.isArray(x))return!0;const T=E.params,I=E.iconset,A=o.concat(c);if(!T&&!I)return c++,!0;if(T){if("object"!=typeof T||T.constructor!==Object)return A.error('Image options "params" should be an object'),!1;const M={},F=A.concat(void 0,"params");for(const L in T){if(!L)return F.error("Image parameter name should be non-empty"),!1;const V=F.concat(void 0,L).parse(T[L],void 0,yi,void 0,{typeAnnotation:"coerce"});if(!V)return!1;M[L]=V}h[h.length-1].options.params=M}if(I){if("object"!=typeof I||I.constructor!==Object)return A.error('Image options "iconset" should be an object'),!1;if(!I.id)return A.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=I}return c++,!0}var x;return!0}for(let x=0;x<2;x++)if(!m()||!g())return;return new zc(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(i,o){const c={};if(o){for(const h in o)if(o[h])try{c[h]=o[h].evaluate(i)}catch{continue}if(0!==Object.keys(c).length)return{params:c}}}evaluate(i){const o={name:this.namePrimary.evaluate(i),iconsetId:this.iconsetIdPrimary},c=this.nameSecondary?{name:this.nameSecondary.evaluate(i),iconsetId:this.iconsetIdSecondary}:void 0,h=vo.build(o,c,this.paramsPrimary?this.evaluateParams(i,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(i,this.paramsSecondary):void 0);if(h&&i.availableImages){const m=h.getPrimary().id;if(h.available=i.availableImages.some(g=>Kt.isEqual(g,m)),h.available){const g=h.getSecondary()?h.getSecondary().id:null;g&&(h.available=i.availableImages.some(x=>Kt.isEqual(x,g)))}}return h}eachChild(i){if(i(this.namePrimary),this.paramsPrimary)for(const o in this.paramsPrimary)this.paramsPrimary[o]&&i(this.paramsPrimary[o]);if(this.nameSecondary&&(i(this.nameSecondary),this.paramsSecondary))for(const o in this.paramsSecondary)this.paramsSecondary[o]&&i(this.paramsSecondary[o])}outputDefined(){return!1}serializeOptions(i,o){const c={};if(o&&(c.iconset={id:o}),i){c.params={};for(const h in i)i[h]&&(c.params[h]=i[h].serialize())}return Object.keys(c).length>0?c:void 0}serialize(){const i=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const o=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);o&&i.push(o)}if(this.nameSecondary&&(i.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const o=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);o&&i.push(o)}return i}}function $n(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}const Jd={"to-boolean":Yn,"to-color":yi,"to-number":St,"to-string":Gn};class ws{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expected at least one argument.");const c=i[0],h=[];let m=Oc;if("to-array"===c){if(!Array.isArray(i[1]))return null;const g=i[1].length;if(o.expectedType){if("array"!==o.expectedType.kind)return o.error(`Expected ${o.expectedType.kind} but found array.`);m=yo(o.expectedType.itemType,g)}else{if(!(g>0&&ln(i[1][0])))return null;m=yo(wt(i[1][0]),g)}for(let x=0;x<g;x++){const E=i[1][x];let T;if("array"===$n(E))T=o.parse(E,void 0,m.itemType);else{const I=$n(E);if(I!==m.itemType.kind)return o.error(`Expected ${m.itemType.kind} but found ${I}.`);T=o.registry.literal.parse(["literal",void 0===E?null:E],o)}if(!T)return null;h.push(T)}}else{if(("to-boolean"===c||"to-string"===c)&&2!==i.length)return o.error("Expected one argument.");m=Jd[c];for(let g=1;g<i.length;g++){const x=o.parse(i[g],g,Qn);if(!x)return null;h.push(x)}}return new ws(m,h)}evaluate(i){if("boolean"===this.type.kind)return!!this.args[0].evaluate(i);if("color"===this.type.kind){let o,c;for(const h of this.args){if(o=h.evaluate(i),c=null,o instanceof Jn)return o;if("string"==typeof o){const m=i.parseColor(o);if(m)return m}else if(Array.isArray(o)&&(c=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Nc(o[0],o[1],o[2],o[3]),!c))return new Jn(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ar(c||`Could not parse color from value '${"string"==typeof o?o:String(JSON.stringify(o))}'`)}if("number"===this.type.kind){let o=null;for(const c of this.args){if(o=c.evaluate(i),null===o)return 0;const h=Number(o);if(!isNaN(h))return h}throw new Ar(`Could not convert ${JSON.stringify(o)} to number.`)}return"formatted"===this.type.kind?Kr.fromString(Vs(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?vo.build(Vs(this.args[0].evaluate(i))):"array"===this.type.kind?this.args.map(o=>o.evaluate(i)):Vs(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new gt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new zc(this.args[0]).serialize();const i="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{i.push(o.serialize())}),i}}const Jr=["Unknown","Point","LineString","Polygon"];class Qd{constructor(i,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=o}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Jr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:c,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*o-i[0])+this.featureDistanceData.bearing[1]*(h*o-i[1])}return 0}parseColor(i){let o=this._parseColorCache[i];return o||(o=this._parseColorCache[i]=Jn.parse(i)),o}getConfig(i){return this.options?this.options.get(i):null}}class Qr{constructor(i,o,c,h,m){this.name=i,this.type=o,this._evaluate=c,this.args=h,this._overloadIndex=m}evaluate(i){if(!this._evaluate){const o=Qr.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,o){const c=i[0],h=Qr.definitions[c];if(!h)return o.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=[];let E=null,T=-1;for(const[I,A]of g){if(Array.isArray(I)&&I.length!==i.length-1)continue;x.push(I),T++,E=new sh(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const M=[];let F=!1;for(let L=1;L<i.length;L++){const V=i[L],j=Array.isArray(I)?I[L-1]:I.type,W=E.parse(V,1+M.length,j);if(!W){F=!0;break}M.push(W)}if(!F)if(Array.isArray(I)&&I.length!==M.length)E.error(`Expected ${I.length} arguments, but found ${M.length} instead.`);else{for(let L=0;L<M.length;L++){const V=Array.isArray(I)?I[L]:I.type,j=M[L];E.concat(L+1).checkSubtype(V,j.type)}if(0===E.errors.length)return new Qr(c,m,A,M,T)}}if(1===x.length)o.errors.push(...E.errors);else{const I=(x.length?x:g.map(([M])=>M)).map(tm).join(" | "),A=[];for(let M=1;M<i.length;M++){const F=o.parse(i[M],1+A.length);if(!F)return null;A.push(Cr(F.type))}o.error(`Expected arguments of type ${I}, but found (${A.join(", ")}) instead.`)}return null}static register(i,o){Qr.definitions=o;for(const c in o)i[c]=Qr}}function tm(a){return Array.isArray(a)?`(${a.map(Cr).join(", ")})`:`(${Cr(a.type)}...)`}class xo{constructor(i,o,c){this.type=Ht,this.locale=c,this.caseSensitive=i,this.diacriticSensitive=o}static parse(i,o){if(2!==i.length)return o.error("Expected one argument.");const c=i[1];if("object"!=typeof c||Array.isArray(c))return o.error("Collator options argument must be an object.");const h=void 0===c["case-sensitive"]?o.parse(!1,1,Yn):o.parseObjectValue(c["case-sensitive"],1,"case-sensitive",Yn);if(!h)return null;const m=void 0===c["diacritic-sensitive"]?o.parse(!1,1,Yn):o.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",Yn);if(!m)return null;let g=null;return c.locale&&(g=o.parseObjectValue(c.locale,1,"locale",Gn),!g)?null:new xo(h,m,g)}evaluate(i){return new wf(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function eo(a,i,o=0,c=a.length-1,h=ka){for(;c>o;){if(c-o>600){const E=c-o+1,T=i-o+1,I=Math.log(E),A=.5*Math.exp(2*I/3),M=.5*Math.sqrt(I*A*(E-A)/E)*(T-E/2<0?-1:1);eo(a,i,Math.max(o,Math.floor(i-T*A/E+M)),Math.min(c,Math.floor(i+(E-T)*A/E+M)),h)}const m=a[i];let g=o,x=c;for($o(a,o,i),h(a[c],m)>0&&$o(a,o,c);g<x;){for($o(a,g,x),g++,x--;h(a[g],m)<0;)g++;for(;h(a[x],m)>0;)x--}0===h(a[o],m)?$o(a,o,x):(x++,$o(a,x,c)),x<=i&&(o=x+1),i<=x&&(c=x-1)}}function $o(a,i,o){const c=a[i];a[i]=a[o],a[o]=c}function ka(a,i){return a<i?-1:a>i?1:0}function qi(a){let i=0;for(let o,c,h=0,m=a.length,g=m-1;h<m;g=h++)o=a[h],c=a[g],i+=(c.x-o.x)*(o.y+c.y);return i}function ma(a,i){a[0]=Math.min(a[0],i[0]),a[1]=Math.min(a[1],i[1]),a[2]=Math.max(a[2],i[0]),a[3]=Math.max(a[3],i[1])}function Wl(a,i){return!(a[0]<=i[0]||a[2]>=i[2]||a[1]<=i[1]||a[3]>=i[3])}function il(a,i,o){const c=a[0]-i[0],h=a[1]-i[1],m=a[0]-o[0],g=a[1]-o[1];return c*g-m*h==0&&c*m<=0&&h*g<=0}function Bc(a,i,o=!1){let c=!1;for(let x=0,E=i.length;x<E;x++){const T=i[x];for(let I=0,A=T.length,M=A-1;I<A;M=I++){const F=T[M],L=T[I];if(il(a,F,L))return o;(m=F)[1]>(h=a)[1]!=(g=L)[1]>h[1]&&h[0]<(g[0]-m[0])*(h[1]-m[1])/(g[1]-m[1])+m[0]&&(c=!c)}}var h,m,g;return c}function Fa(a,i,o,c){const h=c[0]-o[0],m=c[1]-o[1],g=(a[0]-o[0])*m-h*(a[1]-o[1]),x=(i[0]-o[0])*m-h*(i[1]-o[1]);return g>0&&x<0||g<0&&x>0}function Zl(a,i,o,c){return(h=[c[0]-o[0],c[1]-o[1]])[0]*(m=[i[0]-a[0],i[1]-a[1]])[1]-h[1]*m[0]!=0&&!(!Fa(a,i,o,c)||!Fa(o,c,a,i));var h,m}function Ef(a){const i=new Qe(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=new Qe(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const c of a[0])i.x>c.x&&(i.x=c.x),i.y>c.y&&(i.y=c.y),o.x<c.x&&(o.x=c.x),o.y<c.y&&(o.y=c.y);return{min:i,max:o}}const rl=8192;function nm(a,i){const o=(180+a[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,h=Math.pow(2,i.z);return[Math.round(o*h*rl),Math.round(c*h*rl)]}function im(a,i){for(let o=0;o<i.length;o++)if(Bc(a,i[o]))return!0;return!1}function s_(a,i,o){for(const c of o)for(let h=0,m=c.length,g=m-1;h<m;g=h++)if(Zl(a,i,c[g],c[h]))return!0;return!1}function Hu(a,i){for(let o=0;o<a.length;++o)if(!Bc(a[o],i))return!1;for(let o=0;o<a.length-1;++o)if(s_(a[o],a[o+1],i))return!1;return!0}function rm(a,i){for(let o=0;o<i.length;o++)if(Hu(a,i[o]))return!0;return!1}function Tf(a,i,o){const c=[];for(let h=0;h<a.length;h++){const m=[];for(let g=0;g<a[h].length;g++){const x=nm(a[h][g],o);ma(i,x),m.push(x)}c.push(m)}return c}function Xl(a,i,o){const c=[];for(let h=0;h<a.length;h++){const m=Tf(a[h],i,o);c.push(m)}return c}function om(a,i,o,c){if(a[0]<o[0]||a[0]>o[2]){const h=.5*c;let m=a[0]-o[0]>h?-c:o[0]-a[0]>h?c:0;0===m&&(m=a[0]-o[2]>h?-c:o[2]-a[0]>h?c:0),a[0]+=m}ma(i,a)}function a_(a,i,o,c){const h=Math.pow(2,c.z)*rl,m=[c.x*rl,c.y*rl],g=[];if(!a)return g;for(const x of a)for(const E of x){const T=[E.x+m[0],E.y+m[1]];om(T,i,o,h),g.push(T)}return g}function Cf(a,i,o,c){const h=Math.pow(2,c.z)*rl,m=[c.x*rl,c.y*rl],g=[];if(!a)return g;for(const E of a){const T=[];for(const I of E){const A=[I.x+m[0],I.y+m[1]];ma(i,A),T.push(A)}g.push(T)}if(i[2]-i[0]<=h/2){(x=i)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of g)for(const T of E)om(T,i,o,h)}var x;return g}class bo{constructor(i,o){this.type=Yn,this.geojson=i,this.geometries=o}static parse(i,o){if(2!==i.length)return o.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(ln(i[1])){const c=i[1];if("FeatureCollection"===c.type)for(let h=0;h<c.features.length;++h){const m=c.features[h].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new bo(c,c.features[h].geometry)}else if("Feature"===c.type){const h=c.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new bo(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new bo(c,c)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(o,c){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=o.canonicalID();if(!g)return!1;if("Polygon"===c.type){const x=Tf(c.coordinates,m,g),E=a_(o.geometry(),h,m,g);if(!Wl(h,m))return!1;for(const T of E)if(!Bc(T,x))return!1}if("MultiPolygon"===c.type){const x=Xl(c.coordinates,m,g),E=a_(o.geometry(),h,m,g);if(!Wl(h,m))return!1;for(const T of E)if(!im(T,x))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(o,c){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=o.canonicalID();if(!g)return!1;if("Polygon"===c.type){const x=Tf(c.coordinates,m,g),E=Cf(o.geometry(),h,m,g);if(!Wl(h,m))return!1;for(const T of E)if(!Hu(T,x))return!1}if("MultiPolygon"===c.type){const x=Xl(c.coordinates,m,g),E=Cf(o.geometry(),h,m,g);if(!Wl(h,m))return!1;for(const T of E)if(!rm(T,x))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const eh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},js=1/298.257223563,sm=js*(2-js),Gu=Math.PI/180;class $u{static fromTile(i,o,c){const h=Math.PI*(1-2*(i+.5)/Math.pow(2,o)),m=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Gu;return new $u(m,c)}static get units(){return eh}constructor(i,o){if(void 0===i)throw new Error("No latitude given.");if(o&&!eh[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(eh).join(", ")}`);const c=6378.137*Gu*(o?eh[o]:1),h=Math.cos(i*Gu),m=1/(1-sm*(1-h*h)),g=Math.sqrt(m);this.kx=c*g*h,this.ky=c*g*m*(1-sm)}distance(i,o){const c=Us(i[0]-o[0])*this.kx,h=(i[1]-o[1])*this.ky;return Math.sqrt(c*c+h*h)}bearing(i,o){const c=Us(o[0]-i[0])*this.kx;return Math.atan2(c,(o[1]-i[1])*this.ky)/Gu}destination(i,o,c){const h=c*Gu;return this.offset(i,Math.sin(h)*o,Math.cos(h)*o)}offset(i,o,c){return[i[0]+o/this.kx,i[1]+c/this.ky]}lineDistance(i){let o=0;for(let c=0;c<i.length-1;c++)o+=this.distance(i[c],i[c+1]);return o}area(i){let o=0;for(let c=0;c<i.length;c++){const h=i[c];for(let m=0,g=h.length,x=g-1;m<g;x=m++)o+=Us(h[m][0]-h[x][0])*(h[m][1]+h[x][1])*(c?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(i,o){let c=0;if(o<=0)return i[0];for(let h=0;h<i.length-1;h++){const m=i[h],g=i[h+1],x=this.distance(m,g);if(c+=x,c>o)return th(m,g,(o-(c-x))/x)}return i[i.length-1]}pointToSegmentDistance(i,o,c){let[h,m]=o,g=Us(c[0]-h)*this.kx,x=(c[1]-m)*this.ky;if(0!==g||0!==x){const E=(Us(i[0]-h)*this.kx*g+(i[1]-m)*this.ky*x)/(g*g+x*x);E>1?(h=c[0],m=c[1]):E>0&&(h+=g/this.kx*E,m+=x/this.ky*E)}return g=Us(i[0]-h)*this.kx,x=(i[1]-m)*this.ky,Math.sqrt(g*g+x*x)}pointOnLine(i,o){let c=1/0,h=i[0][0],m=i[0][1],g=0,x=0;for(let E=0;E<i.length-1;E++){let T=i[E][0],I=i[E][1],A=Us(i[E+1][0]-T)*this.kx,M=(i[E+1][1]-I)*this.ky,F=0;0===A&&0===M||(F=(Us(o[0]-T)*this.kx*A+(o[1]-I)*this.ky*M)/(A*A+M*M),F>1?(T=i[E+1][0],I=i[E+1][1]):F>0&&(T+=A/this.kx*F,I+=M/this.ky*F)),A=Us(o[0]-T)*this.kx,M=(o[1]-I)*this.ky;const L=A*A+M*M;L<c&&(c=L,h=T,m=I,g=E,x=F)}return{point:[h,m],index:g,t:Math.max(0,Math.min(1,x))}}lineSlice(i,o,c){let h=this.pointOnLine(c,i),m=this.pointOnLine(c,o);if(h.index>m.index||h.index===m.index&&h.t>m.t){const T=h;h=m,m=T}const g=[h.point],x=h.index+1,E=m.index;!am(c[x],g[0])&&x<=E&&g.push(c[x]);for(let T=x+1;T<=E;T++)g.push(c[T]);return am(c[E],m.point)||g.push(m.point),g}lineSliceAlong(i,o,c){let h=0;const m=[];for(let g=0;g<c.length-1;g++){const x=c[g],E=c[g+1],T=this.distance(x,E);if(h+=T,h>i&&0===m.length&&m.push(th(x,E,(i-(h-T))/T)),h>=o)return m.push(th(x,E,(o-(h-T))/T)),m;h>i&&m.push(E)}return m}bufferPoint(i,o){const c=o/this.ky,h=o/this.kx;return[i[0]-h,i[1]-c,i[0]+h,i[1]+c]}bufferBBox(i,o){const c=o/this.ky,h=o/this.kx;return[i[0]-h,i[1]-c,i[2]+h,i[3]+c]}insideBBox(i,o){return Us(i[0]-o[0])>=0&&Us(i[0]-o[2])<=0&&i[1]>=o[1]&&i[1]<=o[3]}}function am(a,i){return a[0]===i[0]&&a[1]===i[1]}function th(a,i,o){const c=Us(i[0]-a[0]);return[a[0]+c*o,a[1]+(i[1]-a[1])*o]}function Us(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class Sf{constructor(i=[],o=((c,h)=>c<h?-1:c>h?1:0)){if(this.data=i,this.length=this.data.length,this.compare=o,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(0===this.length)return;const i=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:o,compare:c}=this,h=o[i];for(;i>0;){const m=i-1>>1,g=o[m];if(c(h,g)>=0)break;o[i]=g,i=m}o[i]=h}_down(i){const{data:o,compare:c}=this,h=this.length>>1,m=o[i];for(;i<h;){let g=1+(i<<1);const x=g+1;if(x<this.length&&c(o[x],o[g])<0&&(g=x),c(o[g],m)>=0)break;o[i]=o[g],i=g}o[i]=m}}var ft=8192;function Yl(a,i){return i.dist-a.dist}const Df=100,If=50;function nh(a){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==a.length)return!1;for(let o=0;o<i.length;o++)if(i[o]!==a[o])return!1;return!0}function dr(a){return a[1]-a[0]+1}function Ks(a,i){const o=a[1]>=a[0]&&a[1]<i;return o||console.warn("Distance Expression: Index is out of range"),o}function ih(a,i){if(a[0]>a[1])return[null,null];const o=dr(a);if(i){if(2===o)return[a,null];const c=Math.floor(o/2);return[[a[0],a[0]+c],[a[0]+c,a[1]]]}{if(1===o)return[a,null];const c=Math.floor(o/2)-1;return[[a[0],a[0]+c],[a[0]+c+1,a[1]]]}}function Cn(a,i){const o=[1/0,1/0,-1/0,-1/0];if(!Ks(i,a.length))return o;for(let c=i[0];c<=i[1];++c)ma(o,a[c]);return o}function wo(a){const i=[1/0,1/0,-1/0,-1/0];for(let o=0;o<a.length;++o)for(let c=0;c<a[o].length;++c)ma(i,a[o][c]);return i}function ei(a,i,o){if(nh(a)||nh(i))return NaN;let c=0,h=0;return a[2]<i[0]&&(c=i[0]-a[2]),a[0]>i[2]&&(c=a[0]-i[2]),a[1]>i[3]&&(h=a[1]-i[3]),a[3]<i[1]&&(h=i[1]-a[3]),o.distance([0,0],[c,h])}function rn(a){return 360*a-180}function ss(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Vc(a,i){const o=Math.pow(2,i.z),c=(a.y/ft+i.y)/o;return[rn((a.x/ft+i.x)/o),ss(c)]}function Hs(a,i){const o=[];for(let c=0;c<a.length;++c)o.push(Vc(a[c],i));return o}function Af(a,i,o){const c=o.pointOnLine(i,a).point;return o.distance(a,c)}function lm(a,i,o,c,h){const m=o.slice(c[0],c[1]+1);let g=1/0;for(let x=i[0];x<=i[1];++x)if(0===(g=Math.min(g,Af(a[x],m,h))))return 0;return g}function Ii(a,i,o,c,h){const m=Math.min(h.pointToSegmentDistance(a,o,c),h.pointToSegmentDistance(i,o,c)),g=Math.min(h.pointToSegmentDistance(o,a,i),h.pointToSegmentDistance(c,a,i));return Math.min(m,g)}function Iv(a,i,o,c,h){if(!Ks(i,a.length)||!Ks(c,o.length))return NaN;let m=1/0;for(let g=i[0];g<i[1];++g)for(let x=c[0];x<c[1];++x){if(Zl(a[g],a[g+1],o[x],o[x+1]))return 0;m=Math.min(m,Ii(a[g],a[g+1],o[x],o[x+1],h))}return m}function Av(a,i,o,c,h){if(!Ks(i,a.length)||!Ks(c,o.length))return NaN;let m=1/0;for(let g=i[0];g<=i[1];++g)for(let x=c[0];x<=c[1];++x)if(0===(m=Math.min(m,h.distance(a[g],o[x]))))return m;return m}function Br(a,i,o){if(Bc(a,i,!0))return 0;let c=1/0;for(const h of i){const m=h.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[m-1]&&0===(c=Math.min(c,o.pointToSegmentDistance(a,h[m-1],h[0])))||0===(c=Math.min(c,Af(a,h,o))))return c}return c}function en(a,i,o,c){if(!Ks(i,a.length))return NaN;for(let m=i[0];m<=i[1];++m)if(Bc(a[m],o,!0))return 0;let h=1/0;for(let m=i[0];m<i[1];++m)for(const g of o)for(let x=0,E=g.length,T=E-1;x<E;T=x++){if(Zl(a[m],a[m+1],g[T],g[x]))return 0;h=Math.min(h,Ii(a[m],a[m+1],g[T],g[x],c))}return h}function ti(a,i){for(const o of a)for(let c=0;c<=o.length-1;++c)if(Bc(o[c],i,!0))return!0;return!1}function kr(a,i,o,c=1/0){const h=wo(a),m=wo(i);if(c!==1/0&&ei(h,m,o)>=c)return c;if(Wl(h,m)){if(ti(a,i))return 0}else if(ti(i,a))return 0;let g=c;for(const x of a)for(let E=0,T=x.length,I=T-1;E<T;I=E++)for(const A of i)for(let M=0,F=A.length,L=F-1;M<F;L=M++){if(Zl(x[I],x[E],A[L],A[M]))return 0;g=Math.min(g,Ii(x[I],x[E],A[L],A[M],o))}return g}function Es(a,i,o,c,h,m,g){if(null===m||null===g)return;const x=ei(Cn(c,m),Cn(h,g),o);x<i&&a.push({dist:x,range1:m,range2:g})}function rh(a,i,o,c,h=1/0){let m=Math.min(c.distance(a[0],o[0][0]),h);if(0===m)return m;const g=new Sf([{dist:0,range1:[0,a.length-1],range2:[0,0]}],Yl),x=i?If:Df,E=wo(o);for(;g.length;){const T=g.pop();if(T.dist>=m)continue;const I=T.range1;if(dr(I)<=x){if(!Ks(I,a.length))return NaN;if(i){const A=en(a,I,o,c);if(0===(m=Math.min(m,A)))return m}else for(let A=I[0];A<=I[1];++A){const M=Br(a[A],o,c);if(0===(m=Math.min(m,M)))return m}}else{const A=ih(I,i);if(null!==A[0]){const M=ei(Cn(a,A[0]),E,c);M<m&&g.push({dist:M,range1:A[0],range2:[0,0]})}if(null!==A[1]){const M=ei(Cn(a,A[1]),E,c);M<m&&g.push({dist:M,range1:A[1],range2:[0,0]})}}}return m}function Oo(a,i,o,c,h,m=1/0){let g=Math.min(m,h.distance(a[0],o[0]));if(0===g)return g;const x=new Sf([{dist:0,range1:[0,a.length-1],range2:[0,o.length-1]}],Yl),E=i?If:Df,T=c?If:Df;for(;x.length;){const I=x.pop();if(I.dist>=g)continue;const A=I.range1,M=I.range2;if(dr(A)<=E&&dr(M)<=T){if(!Ks(A,a.length)||!Ks(M,o.length))return NaN;if(i&&c?g=Math.min(g,Iv(a,A,o,M,h)):i||c?i&&!c?g=Math.min(g,lm(o,M,a,A,h)):!i&&c&&(g=Math.min(g,lm(a,A,o,M,h))):g=Math.min(g,Av(a,A,o,M,h)),0===g)return g}else{const F=ih(A,i),L=ih(M,c);Es(x,g,h,a,o,F[0],L[0]),Es(x,g,h,a,o,F[0],L[1]),Es(x,g,h,a,o,F[1],L[0]),Es(x,g,h,a,o,F[1],L[1])}}return g}function Kl(a,i,o,c,h=1/0){let m=h;const g=Cn(a,[0,a.length-1]);for(const x of o)if(!(m!==1/0&&ei(g,Cn(x,[0,x.length-1]),c)>=m)&&(m=Math.min(m,Oo(a,i,x,!0,c,m)),0===m))return m;return m}function Fr(a,i,o,c,h=1/0){let m=h;const g=Cn(a,[0,a.length-1]);for(const x of o){if(m!==1/0&&ei(g,wo(x),c)>=m)continue;const E=rh(a,i,x,c,m);if(isNaN(E))return E;if(0===(m=Math.min(m,E)))return m}return m}function La(a){return"Point"===a||"MultiPoint"===a||"LineString"===a||"MultiLineString"===a||"Polygon"===a||"MultiPolygon"===a}class Js{constructor(i,o){this.type=St,this.geojson=i,this.geometries=o}static parse(i,o){if(2!==i.length)return o.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(ln(i[1])){const c=i[1];if("FeatureCollection"===c.type){for(let h=0;h<c.features.length;++h)if(La(c.features[h].geometry.type))return new Js(c,c.features[h].geometry)}else if("Feature"===c.type){if(La(c.geometry.type))return new Js(c,c.geometry)}else if(La(c.type))return new Js(c,c)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const o=i.geometry(),c=i.canonicalID();if(null!=o&&null!=c){if("Point"===i.geometryType())return function(h,m,g){const x=[];for(const T of h)for(const I of T)x.push(Vc(I,m));const E=new $u(x[0][1],"meters");return"Point"===g.type||"MultiPoint"===g.type||"LineString"===g.type?Oo(x,!1,"Point"===g.type?[g.coordinates]:g.coordinates,"LineString"===g.type,E):"MultiLineString"===g.type?Kl(x,!1,g.coordinates,E):"Polygon"===g.type||"MultiPolygon"===g.type?Fr(x,!1,"Polygon"===g.type?[g.coordinates]:g.coordinates,E):null}(o,c,this.geometries);if("LineString"===i.geometryType())return function(h,m,g){const x=[];for(const T of h){const I=[];for(const A of T)I.push(Vc(A,m));x.push(I)}const E=new $u(x[0][0][1],"meters");if("Point"===g.type||"MultiPoint"===g.type||"LineString"===g.type)return Kl("Point"===g.type?[g.coordinates]:g.coordinates,"LineString"===g.type,x,E);if("MultiLineString"===g.type){let T=1/0;for(let I=0;I<g.coordinates.length;I++){const A=Kl(g.coordinates[I],!0,x,E,T);if(isNaN(A))return A;if(0===(T=Math.min(T,A)))return T}return T}if("Polygon"===g.type||"MultiPolygon"===g.type){let T=1/0;for(let I=0;I<x.length;I++){const A=Fr(x[I],!0,"Polygon"===g.type?[g.coordinates]:g.coordinates,E,T);if(isNaN(A))return A;if(0===(T=Math.min(T,A)))return T}return T}return null}(o,c,this.geometries);if("Polygon"===i.geometryType())return function(h,m,g){const x=[];for(const T of function(I,A){const M=I.length;if(M<=1)return[I];const F=[];let L,V;for(let j=0;j<M;j++){const W=qi(I[j]);0!==W&&(I[j].area=Math.abs(W),void 0===V&&(V=W<0),V===W<0?(L&&F.push(L),L=[I[j]]):L.push(I[j]))}return L&&F.push(L),F}(h)){const I=[];for(let A=0;A<T.length;++A)I.push(Hs(T[A],m));x.push(I)}const E=new $u(x[0][0][0][1],"meters");if("Point"===g.type||"MultiPoint"===g.type||"LineString"===g.type)return Fr("Point"===g.type?[g.coordinates]:g.coordinates,"LineString"===g.type,x,E);if("MultiLineString"===g.type){let T=1/0;for(let I=0;I<g.coordinates.length;I++){const A=Fr(g.coordinates[I],!0,x,E,T);if(isNaN(A))return A;if(0===(T=Math.min(T,A)))return T}return T}return"Polygon"===g.type||"MultiPolygon"===g.type?function(T,I,A){let M=1/0;for(const F of T)for(const L of I){const V=kr(F,L,A,M);if(isNaN(V))return V;if(0===(M=Math.min(M,V)))return M}return M}("Polygon"===g.type?[g.coordinates]:g.coordinates,x,E):null}(o,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function kn(a){if(a instanceof Qr&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof bo||a instanceof Js)return!1;if(a instanceof as)return a.featureConstant;let i=!0;return a.eachChild(o=>{i&&!kn(o)&&(i=!1)}),i}function Jl(a){if(a instanceof Qr&&"feature-state"===a.name)return!1;let i=!0;return a.eachChild(o=>{i&&!Jl(o)&&(i=!1)}),i}function oh(a){if(a instanceof as)return new Set([a.key]);let i=new Set;return a.eachChild(o=>{i=new Set([...i,...oh(o)])}),i}function ga(a,i){if(a instanceof Qr&&i.indexOf(a.name)>=0)return!1;let o=!0;return a.eachChild(c=>{o&&!ga(c,i)&&(o=!1)}),o}function Vr(a,i,o){return[a,i,o].filter(Boolean).join("\x1f")}function jc(a,i){switch(a){case"string":return Vs(i);case"number":return+i;case"boolean":return!!i;case"color":return Jn.parse(i);case"formatted":return Kr.fromString(Vs(i));case"resolvedImage":return vo.build(Vs(i))}return i}function Uc(a,i,o,c){return void 0!==c&&(a=c*Math.round(a/c)),void 0!==i&&a<i&&(a=i),void 0!==o&&a>o&&(a=o),a}class as{constructor(i,o,c,h=!1){this.type=i,this.key=o,this.scope=c,this.featureConstant=h}static parse(i,o){let c=o.expectedType;if(null==c&&(c=Qn),i.length<2||i.length>3)return o.error("Invalid number of arguments for 'config' expression.");const h=o.parse(i[1],1);if(!(h instanceof Vt))return o.error("Key name of 'config' expression must be a string literal.");let m,g=!0;const x=Vs(h.value);if(i.length>=3){const E=o.parse(i[2],2);if(!(E instanceof Vt))return o.error("Scope of 'config' expression must be a string literal.");m=Vs(E.value)}if(o.options){const E=Vr(x,m,o._scope),T=o.options.get(E);T&&(g=kn(T.value||T.default))}return new as(c,x,m,g)}evaluate(i){const o=Vr(this.key,this.scope,i.scope),c=i.getConfig(o);if(!c)return null;const{type:h,value:m,values:g,minValue:x,maxValue:E,stepValue:T}=c,I=c.default.evaluate(i);let A=I;if(m){const M=i.scope;i.scope=(M||"").split("\x1f").slice(1).join("\x1f"),A=m.evaluate(i),i.scope=M}return h&&(A=jc(h,A)),void 0===A||void 0===x&&void 0===E&&void 0===T||("number"==typeof A?A=Uc(A,x,E,T):Array.isArray(A)&&(A=A.map(M=>"number"==typeof M?Uc(M,x,E,T):M))),void 0!==m&&void 0!==A&&g&&!g.includes(A)&&(A=I,h&&(A=jc(h,A))),(h&&h!==this.type||void 0!==A&&!Qp(wt(A),this.type))&&(A=jc(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.scope),i}}class Ql{constructor(i,o){this.type=o.type,this.name=i,this.boundExpression=o}static parse(i,o){if(2!==i.length||"string"!=typeof i[1])return o.error("'var' expression requires exactly one string literal argument.");const c=i[1];return o.scope.has(c)?new Ql(c,o.scope.get(c)):o.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class sh{constructor(i,o=[],c,h=new Kd,m=[],g,x){this.registry=i,this.path=o,this.key=o.map(E=>"string"==typeof E?`['${E}']`:`[${E}]`).join(""),this.scope=h,this.errors=m,this.expectedType=c,this._scope=g,this.options=x}parse(i,o,c,h,m={}){return o||c?this.concat(o,null,c,h)._parse(i,m):this._parse(i,m)}parseObjectValue(i,o,c,h,m,g={}){return this.concat(o,c,h,m)._parse(i,g)}_parse(i,o){function c(h,m,g){return"assert"===g?new Bt(m,[h]):"coerce"===g?new ws(m,[h]):h}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h="string"==typeof i[0]?this.registry[i[0]]:void 0;if(h){let m=h.parse(i,this);if(!m)return null;if(this.expectedType){const g=this.expectedType,x=m.type;if("string"!==g.kind&&"number"!==g.kind&&"boolean"!==g.kind&&"object"!==g.kind&&"array"!==g.kind||"value"!==x.kind)if("color"!==g.kind&&"formatted"!==g.kind&&"resolvedImage"!==g.kind||"value"!==x.kind&&"string"!==x.kind){if(this.checkSubtype(g,x))return null}else m=c(m,g,o.typeAnnotation||"coerce");else m=c(m,g,o.typeAnnotation||"assert")}if(!(m instanceof Vt)&&"resolvedImage"!==m.type.kind&&Na(m)){const g=new Qd(this._scope,this.options);try{m=new Vt(m.type,m.evaluate(g))}catch(x){return this.error(x.message),null}}return m}return ws.parse(["to-array",i],this)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,o,c,h){let m="number"==typeof i?this.path.concat(i):this.path;m="string"==typeof o?m.concat(o):m;const g=h?this.scope.concat(h):this.scope;return new sh(this.registry,m,c||null,g,this.errors,this._scope,this.options)}error(i,...o){const c=`${this.key}${o.map(h=>`[${h}]`).join("")}`;this.errors.push(new Hn(c,i))}checkSubtype(i,o){const c=ql(i,o);return c&&this.error(c),c}}function Na(a){if(a instanceof Ql)return Na(a.boundExpression);if(a instanceof Qr&&"error"===a.name||a instanceof xo||a instanceof bo||a instanceof Js||a instanceof as)return!1;const i=a instanceof ws||a instanceof Bt;let o=!0;return a.eachChild(c=>{o=i?o&&Na(c):o&&c instanceof Vt}),!!o&&kn(a)&&ga(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Qs(a,i){const o=a.length-1;let c,h,m=0,g=o,x=0;for(;m<=g;)if(x=Math.floor((m+g)/2),c=a[x],h=a[x+1],c<=i){if(x===o||i<h)return x;m=x+1}else{if(!(c>i))throw new Ar("Input is not a number.");g=x-1}return 0}class ol{constructor(i,o,c){this.type=i,this.input=o,this.labels=[],this.outputs=[];for(const[h,m]of c)this.labels.push(h),this.outputs.push(m)}static parse(i,o){if(i.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return o.error("Expected an even number of arguments.");const c=o.parse(i[1],1,St);if(!c)return null;const h=[];let m=null;o.expectedType&&"value"!==o.expectedType.kind&&(m=o.expectedType);for(let g=1;g<i.length;g+=2){const x=1===g?-1/0:i[g],E=i[g+1],T=g,I=g+1;if("number"!=typeof x)return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=x)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const A=o.parse(E,I,m);if(!A)return null;m=m||A.type,h.push([x,A])}return new ol(m,c,h)}evaluate(i){const o=this.labels,c=this.outputs;if(1===o.length)return c[0].evaluate(i);const h=this.input.evaluate(i);if(h<=o[0])return c[0].evaluate(i);const m=o.length;return h>=o[m-1]?c[m-1].evaluate(i):c[Qs(o,h)].evaluate(i)}eachChild(i){i(this.input);for(const o of this.outputs)i(o)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&i.push(this.labels[o]),i.push(this.outputs[o].serialize());return i}}const Mv=4/29,ec=6/29,cm=3*ec*ec,ea=ec*ec*ec,Mf=Math.PI/180,Hc=180/Math.PI;function Gc(a){return a>ea?Math.pow(a,1/3):a/cm+Mv}function ao(a){return a>ec?a*a*a:cm*(a-Mv)}function l_(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function ko(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Fo(a){const i=ko(a.r),o=ko(a.g),c=ko(a.b),h=Gc((.4124564*i+.3575761*o+.1804375*c)/.95047),m=Gc((.2126729*i+.7151522*o+.072175*c)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-Gc((.0193339*i+.119192*o+.9503041*c)/1.08883)),alpha:a.a}}function sl(a){let i=(a.l+16)/116,o=isNaN(a.a)?i:i+a.a/500,c=isNaN(a.b)?i:i-a.b/200;return i=1*ao(i),o=.95047*ao(o),c=1.08883*ao(c),new Jn(l_(3.2404542*o-1.5371385*i-.4985314*c),l_(-.969266*o+1.8760108*i+.041556*c),l_(.0556434*o-.2040259*i+1.0572252*c),a.alpha)}function tc(a,i,o){const c=i-a;return a+o*(c>180||c<-180?c-360*Math.round(c/360):c)}const al={forward:Fo,reverse:sl,interpolate:function(a,i,o){return{l:Nt(a.l,i.l,o),a:Nt(a.a,i.a,o),b:Nt(a.b,i.b,o),alpha:Nt(a.alpha,i.alpha,o)}}},ls={forward:function(a){const{l:i,a:o,b:c}=Fo(a),h=Math.atan2(c,o)*Hc;return{h:h<0?h+360:h,c:Math.sqrt(o*o+c*c),l:i,alpha:a.a}},reverse:function(a){const i=a.h*Mf,o=a.c;return sl({l:a.l,a:Math.cos(i)*o,b:Math.sin(i)*o,alpha:a.alpha})},interpolate:function(a,i,o){return{h:tc(a.h,i.h,o),c:Nt(a.c,i.c,o),l:Nt(a.l,i.l,o),alpha:Nt(a.alpha,i.alpha,o)}}};var Wu=Object.freeze({__proto__:null,hcl:ls,lab:al});class cs{constructor(i,o,c,h,m){this.type=i,this.operator=o,this.interpolation=c,this.input=h,this.labels=[],this.outputs=[];for(const[g,x]of m)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(i,o,c,h){let m=0;if("exponential"===i.name)m=um(o,i.base,c,h);else if("linear"===i.name)m=um(o,1,c,h);else if("cubic-bezier"===i.name){const g=i.controlPoints;m=new Ru(g[0],g[1],g[2],g[3]).solve(um(o,1,c,h))}return m}static parse(i,o){let[c,h,m,...g]=i;if(!Array.isArray(h)||0===h.length)return o.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const T=h[1];if("number"!=typeof T)return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if("cubic-bezier"!==h[0])return o.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const T=h.slice(1);if(4!==T.length||T.some(I=>"number"!=typeof I||I<0||I>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(i.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length-1>3&&(i.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(m=o.parse(m,2,St),!m)return null;const x=[];let E=null;"interpolate-hcl"===c||"interpolate-lab"===c?E=yi:o.expectedType&&"value"!==o.expectedType.kind&&(E=o.expectedType);for(let T=0;T<g.length;T+=2){const I=g[T],A=g[T+1],M=T+3,F=T+4;if("number"!=typeof I)return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(x.length&&x[x.length-1][0]>=I)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const L=o.parse(A,F,E);if(!L)return null;E=E||L.type,x.push([I,L])}return"number"===E.kind||"color"===E.kind||"array"===E.kind&&"number"===E.itemType.kind&&"number"==typeof E.N?new cs(E,c,h,m,x):o.error(`Type ${Cr(E)} is not interpolatable.`)}evaluate(i){const o=this.labels,c=this.outputs;if(1===o.length)return c[0].evaluate(i);const h=this.input.evaluate(i);if(h<=o[0])return c[0].evaluate(i);const m=o.length;if(h>=o[m-1])return c[m-1].evaluate(i);const g=Qs(o,h),x=cs.interpolationFactor(this.interpolation,h,o[g],o[g+1]),E=c[g].evaluate(i),T=c[g+1].evaluate(i);return"interpolate"===this.operator?Uu[this.type.kind.toLowerCase()](E,T,x):"interpolate-hcl"===this.operator?ls.reverse(ls.interpolate(ls.forward(E),ls.forward(T),x)):al.reverse(al.interpolate(al.forward(E),al.forward(T),x))}eachChild(i){i(this.input);for(const o of this.outputs)i(o)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const o=[this.operator,i,this.input.serialize()];for(let c=0;c<this.labels.length;c++)o.push(this.labels[c],this.outputs[c].serialize());return o}}function um(a,i,o,c){const h=c-o,m=a-o;return 0===h?0:1===i?m/h:(Math.pow(i,m)-1)/(Math.pow(i,h)-1)}class dm{constructor(i,o){this.type=i,this.args=o}static parse(i,o){if(i.length<2)return o.error("Expectected at least one argument.");let c=null;const h=o.expectedType;h&&"value"!==h.kind&&(c=h);const m=[];for(const x of i.slice(1)){const E=o.parse(x,1+m.length,c,void 0,{typeAnnotation:"omit"});if(!E)return null;c=c||E.type,m.push(E)}const g=h&&m.some(x=>ql(h,x.type));return new dm(g?Qn:c,m)}evaluate(i){let o,c=null,h=0;for(const m of this.args){if(h++,c=m.evaluate(i),c&&c instanceof vo&&!c.available&&(o||(o=c),c=null,h===this.args.length))return o;if(null!==c)break}return c}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(o=>{i.push(o.serialize())}),i}}class ah{constructor(i,o){this.type=o.type,this.bindings=[].concat(i),this.result=o}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const o of this.bindings)i(o[1]);i(this.result)}static parse(i,o){if(i.length<4)return o.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const c=[];for(let m=1;m<i.length-1;m+=2){const g=i[m];if("string"!=typeof g)return o.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return o.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=o.parse(i[m+1],m+1);if(!x)return null;c.push([g,x])}const h=o.parse(i[i.length-1],i.length-1,o.expectedType,c);return h?new ah(c,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[o,c]of this.bindings)i.push(o,c.serialize());return i.push(this.result.serialize()),i}}class Pf{constructor(i,o,c){this.type=i,this.index=o,this.input=c}static parse(i,o){if(3!==i.length)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=o.parse(i[1],1,St),h=o.parse(i[2],2,yo(o.expectedType||Qn));return c&&h?new Pf(h.type.itemType,c,h):null}evaluate(i){const o=this.index.evaluate(i),c=this.input.evaluate(i);if(o<0)throw new Ar(`Array index out of bounds: ${o} < 0.`);if(o>=c.length)throw new Ar(`Array index out of bounds: ${o} > ${c.length-1}.`);if(o!==Math.floor(o))throw new Ar(`Array index must be an integer, but found ${o} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return c[o]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class c_{constructor(i,o,c){this.type=i,this.index=o,this.input=c}static parse(i,o){if(3!==i.length)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=o.parse(i[1],1,St),h=o.parse(i[2],2,yo(o.expectedType||Qn));return c&&h?new c_(h.type.itemType,c,h):null}evaluate(i){const o=this.index.evaluate(i),c=this.input.evaluate(i);if(o<0)throw new Ar(`Array index out of bounds: ${o} < 0.`);if(o>c.length-1)throw new Ar(`Array index out of bounds: ${o} > ${c.length-1}.`);if(o===Math.floor(o))return c[o];const h=Math.floor(o),m=Math.ceil(o),g=c[h],x=c[m];if("number"!=typeof g||"number"!=typeof x)throw new Ar(`Cannot interpolate between non-number values at index ${o}.`);const E=o-h;return g*(1-E)+x*E}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class u_{constructor(i,o){this.type=Yn,this.needle=i,this.haystack=o}static parse(i,o){if(3!==i.length)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=o.parse(i[1],1,Qn),h=o.parse(i[2],2,Qn);return c&&h?Lc(c.type,[Yn,Gn,St,Oc,Qn])?new u_(c,h):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(c.type)} instead`):null}evaluate(i){const o=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(null==c)return!1;if(!bf(o,["boolean","string","number","null"]))throw new Ar(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(wt(o))} instead.`);if(!bf(c,["string","array"]))throw new Ar(`Expected second argument to be of type array or string, but found ${Cr(wt(c))} instead.`);return c.indexOf(o)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class hm{constructor(i,o,c){this.type=St,this.needle=i,this.haystack=o,this.fromIndex=c}static parse(i,o){if(i.length<=2||i.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=o.parse(i[1],1,Qn),h=o.parse(i[2],2,Qn);if(!c||!h)return null;if(!Lc(c.type,[Yn,Gn,St,Oc,Qn]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(c.type)} instead`);if(4===i.length){const m=o.parse(i[3],3,St);return m?new hm(c,h,m):null}return new hm(c,h)}evaluate(i){const o=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(!bf(o,["boolean","string","number","null"]))throw new Ar(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(wt(o))} instead.`);if(!bf(c,["string","array"]))throw new Ar(`Expected second argument to be of type array or string, but found ${Cr(wt(c))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(i);return c.indexOf(o,h)}return c.indexOf(o)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class fm{constructor(i,o,c,h,m,g){this.inputType=i,this.type=o,this.input=c,this.cases=h,this.outputs=m,this.otherwise=g}static parse(i,o){if(i.length<5)return o.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return o.error("Expected an even number of arguments.");let c,h;o.expectedType&&"value"!==o.expectedType.kind&&(h=o.expectedType);const m={},g=[];for(let T=2;T<i.length-1;T+=2){let I=i[T];const A=i[T+1];Array.isArray(I)||(I=[I]);const M=o.concat(T);if(0===I.length)return M.error("Expected at least one branch label.");for(const L of I){if("number"!=typeof L&&"string"!=typeof L)return M.error("Branch labels must be numbers or strings.");if("number"==typeof L&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof L&&Math.floor(L)!==L)return M.error("Numeric branch labels must be integer values.");if(c){if(M.checkSubtype(c,wt(L)))return null}else c=wt(L);if(void 0!==m[String(L)])return M.error("Branch labels must be unique.");m[String(L)]=g.length}const F=o.parse(A,T,h);if(!F)return null;h=h||F.type,g.push(F)}const x=o.parse(i[1],1,Qn);if(!x)return null;const E=o.parse(i[i.length-1],i.length-1,h);return E?"value"!==x.type.kind&&o.concat(1).checkSubtype(c,x.type)?null:new fm(c,h,x,m,g,E):null}evaluate(i){const o=this.input.evaluate(i);return(Qp(wt(o),this.inputType)&&this.outputs[this.cases[o]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),c=[],h={};for(const g of o){const x=h[this.cases[g]];void 0===x?(h[this.cases[g]]=c.length,c.push([this.cases[g],[g]])):c[x][1].push(g)}const m=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,x]of c)i.push(1===x.length?m(x[0]):x.map(m)),i.push(this.outputs[g].serialize());return i.push(this.otherwise.serialize()),i}}class pm{constructor(i,o,c){this.type=i,this.branches=o,this.otherwise=c}static parse(i,o){if(i.length<4)return o.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return o.error("Expected an odd number of arguments.");let c;o.expectedType&&"value"!==o.expectedType.kind&&(c=o.expectedType);const h=[];for(let g=1;g<i.length-1;g+=2){const x=o.parse(i[g],g,Yn);if(!x)return null;const E=o.parse(i[g+1],g+1,c);if(!E)return null;h.push([x,E]),c=c||E.type}const m=o.parse(i[i.length-1],i.length-1,c);return m?new pm(c,h,m):null}evaluate(i){for(const[o,c]of this.branches)if(o.evaluate(i))return c.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[o,c]of this.branches)i(o),i(c);i(this.otherwise)}outputDefined(){return this.branches.every(([i,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(o=>{i.push(o.serialize())}),i}}class Zu{constructor(i,o,c,h){this.type=i,this.input=o,this.beginIndex=c,this.endIndex=h}static parse(i,o){if(i.length<=2||i.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=o.parse(i[1],1,Qn),h=o.parse(i[2],2,St);if(!c||!h)return null;if(!Lc(c.type,[yo(Qn),Gn,Qn]))return o.error(`Expected first argument to be of type array or string, but found ${Cr(c.type)} instead`);if(4===i.length){const m=o.parse(i[3],3,St);return m?new Zu(c.type,c,h,m):null}return new Zu(c.type,c,h)}evaluate(i){const o=this.input.evaluate(i),c=this.beginIndex.evaluate(i);if(!bf(o,["string","array"]))throw new Ar(`Expected first argument to be of type array or string, but found ${Cr(wt(o))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(i);return o.slice(c,h)}return o.slice(c)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class d_{constructor(i,o){this.type=yo(Gn),this.str=i,this.delimiter=o}static parse(i,o){if(3!==i.length)return o.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=o.parse(i[1],1,Gn),h=o.parse(i[2],2,Gn);return c&&h?new d_(c,h):void 0}evaluate(i){const o=this.str.evaluate(i),c=this.delimiter.evaluate(i);return o.split(c)}eachChild(i){i(this.str),i(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function h_(a,i){return"=="===a||"!="===a?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function Pv(a,i,o,c){return 0===c.compare(i,o)}function lh(a,i,o){const c="=="!==a&&"!="!==a;return class WR{constructor(m,g,x){this.type=Yn,this.lhs=m,this.rhs=g,this.collator=x,this.hasUntypedArgument="value"===m.type.kind||"value"===g.type.kind}static parse(m,g){if(3!==m.length&&4!==m.length)return g.error("Expected two or three arguments.");const x=m[0];let E=g.parse(m[1],1,Qn);if(!E)return null;if(!h_(x,E.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${Cr(E.type)}'.`);let T=g.parse(m[2],2,Qn);if(!T)return null;if(!h_(x,T.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${Cr(T.type)}'.`);if(E.type.kind!==T.type.kind&&"value"!==E.type.kind&&"value"!==T.type.kind)return g.error(`Cannot compare types '${Cr(E.type)}' and '${Cr(T.type)}'.`);c&&("value"===E.type.kind&&"value"!==T.type.kind?E=new Bt(T.type,[E]):"value"!==E.type.kind&&"value"===T.type.kind&&(T=new Bt(E.type,[T])));let I=null;if(4===m.length){if("string"!==E.type.kind&&"string"!==T.type.kind&&"value"!==E.type.kind&&"value"!==T.type.kind)return g.error("Cannot use collator to compare non-string types.");if(I=g.parse(m[3],3,Ht),!I)return null}return new WR(E,T,I)}evaluate(m){const g=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(c&&this.hasUntypedArgument){const E=wt(g),T=wt(x);if(E.kind!==T.kind||"string"!==E.kind&&"number"!==E.kind)throw new Ar(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${E.kind}, ${T.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const E=wt(g),T=wt(x);if("string"!==E.kind||"string"!==T.kind)return i(m,g,x)}return this.collator?o(m,g,x,this.collator.evaluate(m)):i(m,g,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[a];return this.eachChild(g=>{m.push(g.serialize())}),m}}}const Rv=lh("==",function(a,i,o){return i===o},Pv),Ov=lh("!=",function(a,i,o){return i!==o},function(a,i,o,c){return!Pv(0,i,o,c)}),f_=lh("<",function(a,i,o){return i<o},function(a,i,o,c){return c.compare(i,o)<0}),p_=lh(">",function(a,i,o){return i>o},function(a,i,o,c){return c.compare(i,o)>0}),sb=lh("<=",function(a,i,o){return i<=o},function(a,i,o,c){return c.compare(i,o)<=0}),mm=lh(">=",function(a,i,o){return i>=o},function(a,i,o,c){return c.compare(i,o)>=0});class m_{constructor(i,o,c,h,m,g){this.type=Gn,this.number=i,this.locale=o,this.currency=c,this.unit=h,this.minFractionDigits=m,this.maxFractionDigits=g}static parse(i,o){if(3!==i.length)return o.error("Expected two arguments.");const c=o.parse(i[1],1,St);if(!c)return null;const h=i[2];if("object"!=typeof h||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=o.parseObjectValue(h.locale,2,"locale",Gn),!m))return null;let g=null;if(h.currency&&(g=o.parseObjectValue(h.currency,2,"currency",Gn),!g))return null;let x=null;if(h.unit&&(x=o.parseObjectValue(h.unit,2,"unit",Gn),!x))return null;let E=null;if(h["min-fraction-digits"]&&(E=o.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",St),!E))return null;let T=null;return h["max-fraction-digits"]&&(T=o.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",St),!T)?null:new m_(c,m,g,x,E,T)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class ll{constructor(i){this.type=St,this.input=i}static parse(i,o){if(2!==i.length)return o.error(`Expected 1 argument, but found ${i.length-1} instead.`);const c=o.parse(i[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?o.error(`Expected argument of type string or array, but found ${Cr(c.type)} instead.`):new ll(c):null}evaluate(i){const o=this.input.evaluate(i);if("string"==typeof o||Array.isArray(o))return o.length;throw new Ar(`Expected value to be of type string or array, but found ${Cr(wt(o))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(o=>{i.push(o.serialize())}),i}}function cl(a){return function(){a=1831565813+(a|=0)|0;let i=Math.imul(a^a>>>15,1|a);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const ch={"==":Rv,"!=":Ov,">":p_,"<":f_,">=":mm,"<=":sb,array:Bt,at:Pf,"at-interpolated":c_,boolean:Bt,case:pm,coalesce:dm,collator:xo,format:gt,image:zc,in:u_,"index-of":hm,interpolate:cs,"interpolate-hcl":cs,"interpolate-lab":cs,length:ll,let:ah,literal:Vt,match:fm,number:Bt,"number-format":m_,object:Bt,slice:Zu,step:ol,string:Bt,"to-boolean":ws,"to-color":ws,"to-number":ws,"to-string":ws,var:Ql,within:bo,distance:Js,config:as,split:d_};function g_(a,[i,o,c,h]){i=i.evaluate(a),o=o.evaluate(a),c=c.evaluate(a);const m=h?h.evaluate(a):1,g=Nc(i,o,c,m);if(g)throw new Ar(g);return new Jn(i/255,o/255,c/255,m)}function Eo(a,[i,o,c,h]){i=i.evaluate(a),o=o.evaluate(a),c=c.evaluate(a);const m=h?h.evaluate(a):1,g=(I=o,A=c,M=m,"number"==typeof(T=i)&&T>=0&&T<=360?"number"==typeof I&&I>=0&&I<=100&&"number"==typeof A&&A>=0&&A<=100?void 0===M||"number"==typeof M&&M>=0&&M<=1?null:`Invalid hsla value [${[T,I,A,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof M?[T,I,A,M]:[T,I,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof M?[T,I,A,M]:[T,I,A]).join(", ")}]: 'h' must be between 0 and 360.`);var T,I,A,M;if(g)throw new Ar(g);const x=`hsla(${i}, ${o}%, ${c}%, ${m})`,E=Jn.parse(x);if(!E)throw new Ar(`Failed to parse HSLA color: ${x}`);return E}function uh(a,i){return a in i}function us(a,i){const o=i[a];return void 0===o?null:o}function ul(a){return{type:a}}function Rf(a){return{result:"success",value:a}}function dl(a){return{result:"error",value:a}}function hl(a,i){return!!a&&!!a.parameters&&a.parameters.indexOf(i)>-1}function Xu(a){return"data-driven"===a["property-type"]}function gm(a){return hl(a.expression,"measure-light")}function Of(a){return hl(a.expression,"zoom")}function Yu(a){return!!a.expression&&a.expression.interpolated}function dh(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function _m(a){return a}function kf(a,i){const o="color"===i.type,c=a.stops&&"object"==typeof a.stops[0][0],h=c||!(c||void 0!==a.property),m=a.type||(Yu(i)?"exponential":"interval");if(o&&((a=Rc({},a)).stops&&(a.stops=a.stops.map(T=>[T[0],Jn.parse(T[1])])),a.default=Jn.parse(a.default?a.default:i.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!Wu[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let g,x,E;if("exponential"===m)g=ym;else if("interval"===m)g=qc;else if("categorical"===m){g=$c,x=Object.create(null);for(const T of a.stops)x[T[0]]=T[1];E=typeof a.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);g=kv}if(c){const T={},I=[];for(let F=0;F<a.stops.length;F++){const L=a.stops[F],V=L[0].zoom;void 0===T[V]&&(T[V]={zoom:V,type:a.type,property:a.property,default:a.default,stops:[]},I.push(V)),T[V].stops.push([L[0].value,L[1]])}const A=[];for(const F of I)A.push([T[F].zoom,kf(T[F],i)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:cs.interpolationFactor.bind(void 0,M),zoomStops:A.map(F=>F[0]),evaluate:({zoom:F},L)=>ym({stops:A,base:a.base},i,F).evaluate(F,L)}}if(h){const T="exponential"===m?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:cs.interpolationFactor.bind(void 0,T),zoomStops:a.stops.map(I=>I[0]),evaluate:({zoom:I})=>g(a,i,I,x,E)}}return{kind:"source",evaluate(T,I){const A=I&&I.properties?I.properties[a.property]:void 0;return void 0===A?za(a.default,i.default):g(a,i,A,x,E)}}}function za(a,i,o){return void 0!==a?a:void 0!==i?i:void 0!==o?o:void 0}function $c(a,i,o,c,h){return za(typeof o===h?c[o]:void 0,a.default,i.default)}function qc(a,i,o){if("number"!==$n(o))return za(a.default,i.default);const c=a.stops.length;if(1===c||o<=a.stops[0][0])return a.stops[0][1];if(o>=a.stops[c-1][0])return a.stops[c-1][1];const h=Qs(a.stops.map(m=>m[0]),o);return a.stops[h][1]}function ym(a,i,o){const c=void 0!==a.base?a.base:1;if("number"!==$n(o))return za(a.default,i.default);const h=a.stops.length;if(1===h||o<=a.stops[0][0])return a.stops[0][1];if(o>=a.stops[h-1][0])return a.stops[h-1][1];const m=Qs(a.stops.map(I=>I[0]),o),g=function(I,A,M,F){const L=F-M,V=I-M;return 0===L?0:1===A?V/L:(Math.pow(A,V)-1)/(Math.pow(A,L)-1)}(o,c,a.stops[m][0],a.stops[m+1][0]),x=a.stops[m][1],E=a.stops[m+1][1];let T=Uu[i.type]||_m;if(a.colorSpace&&"rgb"!==a.colorSpace){const I=Wu[a.colorSpace];T=(A,M)=>I.reverse(I.interpolate(I.forward(A),I.forward(M),g))}return"function"==typeof x.evaluate?{evaluate(...I){const A=x.evaluate.apply(void 0,I),M=E.evaluate.apply(void 0,I);if(void 0!==A&&void 0!==M)return T(A,M,g)}}:T(x,E,g)}function kv(a,i,o){return"color"===i.type?o=Jn.parse(o):"formatted"===i.type?o=Kr.fromString(o.toString()):"resolvedImage"===i.type?o=vo.build(o.toString()):$n(o)===i.type||"enum"===i.type&&i.values[o]||(o=void 0),za(o,a.default,i.default)}Qr.register(ch,{error:[{kind:"error"},[Gn],(a,[i])=>{throw new Ar(i.evaluate(a))}],typeof:[Gn,[Qn],(a,[i])=>Cr(wt(i.evaluate(a)))],"to-rgba":[yo(St,4),[yi],(a,[i])=>i.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[yo(St,4),[yi],(a,[i])=>i.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[yi,[St,St,St],g_],rgba:[yi,[St,St,St,St],g_],hsl:[yi,[St,St,St],Eo],hsla:[yi,[St,St,St,St],Eo],has:{type:Yn,overloads:[[[Gn],(a,[i])=>uh(i.evaluate(a),a.properties())],[[Gn,$l],(a,[i,o])=>uh(i.evaluate(a),o.evaluate(a))]]},get:{type:Qn,overloads:[[[Gn],(a,[i])=>us(i.evaluate(a),a.properties())],[[Gn,$l],(a,[i,o])=>us(i.evaluate(a),o.evaluate(a))]]},"feature-state":[Qn,[Gn],(a,[i])=>us(i.evaluate(a),a.featureState||{})],properties:[$l,[],a=>a.properties()],"geometry-type":[Gn,[],a=>a.geometryType()],worldview:[Gn,[],a=>a.globals.worldview||""],id:[Qn,[],a=>a.id()],zoom:[St,[],a=>a.globals.zoom],pitch:[St,[],a=>a.globals.pitch||0],"distance-from-center":[St,[],a=>a.distanceFromCenter()],"measure-light":[St,[Gn],(a,[i])=>a.measureLight(i.evaluate(a))],"heatmap-density":[St,[],a=>a.globals.heatmapDensity||0],"line-progress":[St,[],a=>a.globals.lineProgress||0],"raster-value":[St,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[St,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[St,[],a=>a.globals.skyRadialProgress||0],accumulated:[Qn,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[St,ul(St),(a,i)=>{let o=0;for(const c of i)o+=c.evaluate(a);return o}],"*":[St,ul(St),(a,i)=>{let o=1;for(const c of i)o*=c.evaluate(a);return o}],"-":{type:St,overloads:[[[St,St],(a,[i,o])=>i.evaluate(a)-o.evaluate(a)],[[St],(a,[i])=>-i.evaluate(a)]]},"/":[St,[St,St],(a,[i,o])=>i.evaluate(a)/o.evaluate(a)],"%":[St,[St,St],(a,[i,o])=>i.evaluate(a)%o.evaluate(a)],ln2:[St,[],()=>Math.LN2],pi:[St,[],()=>Math.PI],e:[St,[],()=>Math.E],"^":[St,[St,St],(a,[i,o])=>Math.pow(i.evaluate(a),o.evaluate(a))],sqrt:[St,[St],(a,[i])=>Math.sqrt(i.evaluate(a))],log10:[St,[St],(a,[i])=>Math.log(i.evaluate(a))/Math.LN10],ln:[St,[St],(a,[i])=>Math.log(i.evaluate(a))],log2:[St,[St],(a,[i])=>Math.log(i.evaluate(a))/Math.LN2],sin:[St,[St],(a,[i])=>Math.sin(i.evaluate(a))],cos:[St,[St],(a,[i])=>Math.cos(i.evaluate(a))],tan:[St,[St],(a,[i])=>Math.tan(i.evaluate(a))],asin:[St,[St],(a,[i])=>Math.asin(i.evaluate(a))],acos:[St,[St],(a,[i])=>Math.acos(i.evaluate(a))],atan:[St,[St],(a,[i])=>Math.atan(i.evaluate(a))],min:[St,ul(St),(a,i)=>Math.min(...i.map(o=>o.evaluate(a)))],max:[St,ul(St),(a,i)=>Math.max(...i.map(o=>o.evaluate(a)))],abs:[St,[St],(a,[i])=>Math.abs(i.evaluate(a))],round:[St,[St],(a,[i])=>{const o=i.evaluate(a);return o<0?-Math.round(-o):Math.round(o)}],floor:[St,[St],(a,[i])=>Math.floor(i.evaluate(a))],ceil:[St,[St],(a,[i])=>Math.ceil(i.evaluate(a))],"filter-==":[Yn,[Gn,Qn],(a,[i,o])=>a.properties()[i.value]===o.value],"filter-id-==":[Yn,[Qn],(a,[i])=>a.id()===i.value],"filter-type-==":[Yn,[Gn],(a,[i])=>a.geometryType()===i.value],"filter-<":[Yn,[Gn,Qn],(a,[i,o])=>{const c=a.properties()[i.value],h=o.value;return typeof c==typeof h&&c<h}],"filter-id-<":[Yn,[Qn],(a,[i])=>{const o=a.id(),c=i.value;return typeof o==typeof c&&o<c}],"filter->":[Yn,[Gn,Qn],(a,[i,o])=>{const c=a.properties()[i.value],h=o.value;return typeof c==typeof h&&c>h}],"filter-id->":[Yn,[Qn],(a,[i])=>{const o=a.id(),c=i.value;return typeof o==typeof c&&o>c}],"filter-<=":[Yn,[Gn,Qn],(a,[i,o])=>{const c=a.properties()[i.value],h=o.value;return typeof c==typeof h&&c<=h}],"filter-id-<=":[Yn,[Qn],(a,[i])=>{const o=a.id(),c=i.value;return typeof o==typeof c&&o<=c}],"filter->=":[Yn,[Gn,Qn],(a,[i,o])=>{const c=a.properties()[i.value],h=o.value;return typeof c==typeof h&&c>=h}],"filter-id->=":[Yn,[Qn],(a,[i])=>{const o=a.id(),c=i.value;return typeof o==typeof c&&o>=c}],"filter-has":[Yn,[Qn],(a,[i])=>i.value in a.properties()],"filter-has-id":[Yn,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Yn,[yo(Gn)],(a,[i])=>i.value.indexOf(a.geometryType())>=0],"filter-id-in":[Yn,[yo(Qn)],(a,[i])=>i.value.indexOf(a.id())>=0],"filter-in-small":[Yn,[Gn,yo(Qn)],(a,[i,o])=>o.value.indexOf(a.properties()[i.value])>=0],"filter-in-large":[Yn,[Gn,yo(Qn)],(a,[i,o])=>function(c,h,m,g){for(;m<=g;){const x=m+g>>1;if(h[x]===c)return!0;h[x]>c?g=x-1:m=x+1}return!1}(a.properties()[i.value],o.value,0,o.value.length-1)],all:{type:Yn,overloads:[[[Yn,Yn],(a,[i,o])=>i.evaluate(a)&&o.evaluate(a)],[ul(Yn),(a,i)=>{for(const o of i)if(!o.evaluate(a))return!1;return!0}]]},any:{type:Yn,overloads:[[[Yn,Yn],(a,[i,o])=>i.evaluate(a)||o.evaluate(a)],[ul(Yn),(a,i)=>{for(const o of i)if(o.evaluate(a))return!0;return!1}]]},"!":[Yn,[Yn],(a,[i])=>!i.evaluate(a)],"is-supported-script":[Yn,[Gn],(a,[i])=>{const o=a.globals&&a.globals.isSupportedScript;return!o||o(i.evaluate(a))}],upcase:[Gn,[Gn],(a,[i])=>i.evaluate(a).toUpperCase()],downcase:[Gn,[Gn],(a,[i])=>i.evaluate(a).toLowerCase()],concat:[Gn,ul(Qn),(a,i)=>i.map(o=>Vs(o.evaluate(a))).join("")],"resolved-locale":[Gn,[Ht],(a,[i])=>i.evaluate(a).resolvedLocale()],random:[St,[St,St,Qn],(a,i)=>{const[o,c,h]=i.map(g=>g.evaluate(a));if(o>c||o===c)return o;let m;if("string"==typeof h)m=function(g){let x=0;if(0===g.length)return x;for(let E=0;E<g.length;E++)x=(x<<5)-x+g.charCodeAt(E),x|=0;return x}(h);else{if("number"!=typeof h)throw new Ar(`Invalid seed input: ${h}`);m=h}return o+cl(m)()*(c-o)}]});class __{constructor(i,o,c,h){var m;this.expression=i,this._warningHistory={},this._evaluator=new Qd(c,h),this._defaultValue=o?"color"===(m=o).type&&(dh(m.default)||Array.isArray(m.default))?new Jn(0,0,0,0):"color"===m.type?Jn.parse(m.default)||null:void 0===m.default?null:m.default:null,this._enumValues=o&&"enum"===o.type?o.values:null,this.configDependencies=oh(i)}evaluateWithoutErrorHandling(i,o,c,h,m,g,x,E){return this._evaluator.globals=i,this._evaluator.feature=o,this._evaluator.featureState=c,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(i,o,c,h,m,g,x,E){this._evaluator.globals=i,this._evaluator.feature=o||null,this._evaluator.featureState=c||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null;try{const T=this.expression.evaluate(this._evaluator);if(null==T||"number"==typeof T&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Ar(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${T.message}`)),this._defaultValue}}}function y_(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in ch}function Wc(a,i,o,c){const h=new sh(ch,[],i?function(g){const x={color:yi,string:Gn,number:St,enum:Gn,boolean:Yn,formatted:kc,resolvedImage:Fc};return"array"===g.type?yo(x[g.value]||Qn,g.length):x[g.type]}(i):void 0,void 0,void 0,o,c),m=h.parse(a,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return m?Rf(new __(m,i,o,c)):dl(h.errors)}class Ff{constructor(i,o,c,h){this.kind=i,this._styleExpression=o,this.isLightConstant=c,this.isLineProgressConstant=h,this.isStateDependent="constant"!==i&&!Jl(o.expression),this.configDependencies=oh(o.expression)}evaluateWithoutErrorHandling(i,o,c,h,m,g){return this._styleExpression.evaluateWithoutErrorHandling(i,o,c,h,m,g)}evaluate(i,o,c,h,m,g){return this._styleExpression.evaluate(i,o,c,h,m,g)}}class Zc{constructor(i,o,c,h,m,g){this.kind=i,this.zoomStops=c,this._styleExpression=o,this.isStateDependent="camera"!==i&&!Jl(o.expression),this.isLightConstant=m,this.isLineProgressConstant=g,this.configDependencies=oh(o.expression),this.interpolationType=h}evaluateWithoutErrorHandling(i,o,c,h,m,g){return this._styleExpression.evaluateWithoutErrorHandling(i,o,c,h,m,g)}evaluate(i,o,c,h,m,g){return this._styleExpression.evaluate(i,o,c,h,m,g)}interpolationFactor(i,o,c){return this.interpolationType?cs.interpolationFactor(this.interpolationType,i,o,c):0}}function Lf(a,i,o,c){if("error"===(a=Wc(a,i,o,c)).result)return a;const h=a.value.expression,m=kn(h);if(!m&&!Xu(i))return dl([new Hn("","data expressions not supported")]);const g=ga(h,["zoom","pitch","distance-from-center"]);if(!g&&!Of(i))return dl([new Hn("","zoom expressions not supported")]);const x=ga(h,["measure-light"]);if(!x&&!gm(i))return dl([new Hn("","measure-light expression not supported")]);const E=ga(h,["line-progress"]);if(!E&&!hl(i.expression,"line-progress"))return dl([new Hn("","line-progress expression not supported")]);const T=i.expression&&i.expression.relaxZoomRestriction,I=hh(h);return I||g||T?I instanceof Hn?dl([I]):I instanceof cs&&!Yu(i)?dl([new Hn("",'"interpolate" expressions cannot be used with this property')]):Rf(I?new Zc(m&&E?"camera":"composite",a.value,I.labels,I instanceof cs?I.interpolation:void 0,x,E):new Ff(m&&E?"constant":"source",a.value,x,E)):dl([new Hn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class fl{constructor(i,o){this._parameters=i,this._specification=o,Rc(this,kf(this._parameters,this._specification))}static deserialize(i){return new fl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function hh(a){let i=null;if(a instanceof ah)i=hh(a.result);else if(a instanceof dm){for(const o of a.args)if(i=hh(o),i)break}else(a instanceof ol||a instanceof cs)&&a.input instanceof Qr&&"zoom"===a.input.name&&(i=a);return i instanceof Hn||a.eachChild(o=>{const c=hh(o);c instanceof Hn?i=c:i&&c&&i!==c&&(i=new Hn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var fh,Fv,nc=Ud(function(){if(Fv)return fh;Fv=1,fh=i;var a=3;function i(o,c,h){var m=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var g=new Int32Array(this.arrayBuffer);o=g[0],this.d=(c=g[1])+2*(h=g[2]);for(var x=0;x<this.d*this.d;x++){var E=g[a+x],T=g[a+x+1];m.push(E===T?null:g.subarray(E,T))}var I=g[a+m.length+1];this.keys=g.subarray(g[a+m.length],I),this.bboxes=g.subarray(I),this.insert=this._insertReadonly}else{this.d=c+2*h;for(var A=0;A<this.d*this.d;A++)m.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=o,this.padding=h,this.scale=c/o,this.uid=0;var M=h/c*o;this.min=-M,this.max=o+M}return i.prototype.insert=function(o,c,h,m,g){this._forEachCell(c,h,m,g,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(c),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(g)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(o,c,h,m,g,x){this.cells[g].push(x)},i.prototype.query=function(o,c,h,m,g){var x=this.min,E=this.max;if(o<=x&&c<=x&&E<=h&&E<=m&&!g)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(o,c,h,m,this._queryCell,T,{},g),T},i.prototype._queryCell=function(o,c,h,m,g,x,E,T){var I=this.cells[g];if(null!==I)for(var A=this.keys,M=this.bboxes,F=0;F<I.length;F++){var L=I[F];if(void 0===E[L]){var V=4*L;(T?T(M[V+0],M[V+1],M[V+2],M[V+3]):o<=M[V+2]&&c<=M[V+3]&&h>=M[V+0]&&m>=M[V+1])?(E[L]=!0,x.push(A[L])):E[L]=!1}}},i.prototype._forEachCell=function(o,c,h,m,g,x,E,T){for(var I=this._convertToCellCoord(o),A=this._convertToCellCoord(c),M=this._convertToCellCoord(h),F=this._convertToCellCoord(m),L=I;L<=M;L++)for(var V=A;V<=F;V++){var j=this.d*V+L;if((!T||T(this._convertFromCellCoord(L),this._convertFromCellCoord(V),this._convertFromCellCoord(L+1),this._convertFromCellCoord(V+1)))&&g.call(this,o,c,h,m,j,x,E,T))return}},i.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},i.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,c=a+this.cells.length+1+1,h=0,m=0;m<this.cells.length;m++)h+=this.cells[m].length;var g=new Int32Array(c+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var x=c,E=0;E<o.length;E++){var T=o[E];g[a+E]=x,g.set(T,x),x+=T.length}return g[a+o.length]=x,g.set(this.keys,x),g[a+o.length+1]=x+=this.keys.length,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer},fh}());const Ku={};function Et(a,i,o={}){Object.defineProperty(a,"_classRegistryKey",{value:i,writable:!1}),Ku[i]={klass:a,omit:o.omit||[]}}Et(Object,"Object"),nc.serialize=function(a,i){const o=a.toArrayBuffer();return i&&i.add(o),{buffer:o}},nc.deserialize=function(a){return new nc(a.buffer)},Object.defineProperty(nc,"name",{value:"Grid"}),Et(nc,"Grid"),delete Qe.prototype.constructor,typeof DOMMatrix<"u"&&Et(DOMMatrix,"DOMMatrix"),Et(Jn,"Color"),Et(Error,"Error"),Et(Kr,"Formatted"),Et(em,"FormattedSection"),Et(On,"AJAXError"),Et(vo,"ResolvedImage"),Et(fl,"StylePropertyFunction"),Et(__,"StyleExpression",{omit:["_evaluator"]}),Et(Kt,"ImageId"),Et(pa,"ImageVariant"),Et(Zc,"ZoomDependentExpression"),Et(Ff,"ZoomConstantExpression"),Et(Qr,"CompoundExpression",{omit:["_evaluate"]});for(const a in ch)Ku[ch[a]._classRegistryKey]||Et(ch[a],`Expression${a}`);function Nf(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function ph(a){return self.ImageBitmap&&a instanceof ImageBitmap}function pl(a,i){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Nf(a)||ph(a))return i&&i.add(a),a;if(ArrayBuffer.isView(a))return i&&i.add(a.buffer),a;if(a instanceof ImageData)return i&&i.add(a.data.buffer),a;if(Array.isArray(a)){const o=[];for(const c of a)o.push(pl(c,i));return o}if(a instanceof Map){const o={$name:"Map",entries:[]};for(const[c,h]of a.entries())o.entries.push(pl(c),pl(h,i));return o}if(a instanceof Set){const o={$name:"Set"};let c=0;for(const h of a.values())o[++c]=pl(h);return o}if(a instanceof DOMMatrix){const o={$name:"DOMMatrix"},c=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of c)o[h]=a[h];return o}if("bigint"==typeof a)return{$name:"BigInt",value:a.toString()};if("object"==typeof a){const o=a.constructor,c=o._classRegistryKey;if(!c)throw new Error(`Can't serialize object of unregistered class "${o.name}".`);const h=o.serialize?o.serialize(a,i):{};if(!o.serialize){for(const m in a)a.hasOwnProperty(m)&&(Ku[c].omit.indexOf(m)>=0||(h[m]=pl(a[m],i)));a instanceof Error&&(h.message=a.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(h.$name=c),h}throw new Error("can't serialize object of type "+typeof a)}function qo(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Nf(a)||ph(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(qo);if("object"==typeof a){const i=a.$name||"Object";if("Map"===i){const h=a.entries||[],m=new Map;for(let g=0;g<h.length;g+=2)m.set(qo(h[g]),qo(h[g+1]));return m}if("Set"===i){const h=new Set;for(const m of Object.keys(a))"$name"!==m&&h.add(qo(a[m]));return h}if("DOMMatrix"===i){let h;return h=a.is2D?[a.a,a.b,a.c,a.d,a.e,a.f]:[a.m11,a.m12,a.m13,a.m14,a.m21,a.m22,a.m23,a.m24,a.m31,a.m32,a.m33,a.m34,a.m41,a.m42,a.m43,a.m44],new DOMMatrix(h)}if("BigInt"===i)return BigInt(a.value);const{klass:o}=Ku[i];if(!o)throw new Error(`Can't deserialize unregistered class "${i}".`);if(o.deserialize)return o.deserialize(a);const c=Object.create(o.prototype);for(const h of Object.keys(a))"$name"!==h&&(c[h]=qo(a[h]));return c}throw new Error("can't deserialize object of type "+typeof a)}const jt={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function zf(a){for(const i of a)if(Bf(i.charCodeAt(0)))return!0;return!1}function Lv(a){for(const i of a)if(!ab(i.charCodeAt(0)))return!1;return!0}function ab(a){return!(jt.Arabic(a)||jt["Arabic Supplement"](a)||jt["Arabic Extended-A"](a)||jt["Arabic Presentation Forms-A"](a)||jt["Arabic Presentation Forms-B"](a))}function Bf(a){return!(746!==a&&747!==a&&(a<4352||!(jt["Bopomofo Extended"](a)||jt.Bopomofo(a)||jt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||jt["CJK Compatibility Ideographs"](a)||jt["CJK Compatibility"](a)||jt["CJK Radicals Supplement"](a)||jt["CJK Strokes"](a)||!(!jt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||jt["CJK Unified Ideographs Extension A"](a)||jt["CJK Unified Ideographs"](a)||jt["Enclosed CJK Letters and Months"](a)||jt["Hangul Compatibility Jamo"](a)||jt["Hangul Jamo Extended-A"](a)||jt["Hangul Jamo Extended-B"](a)||jt["Hangul Jamo"](a)||jt["Hangul Syllables"](a)||jt.Hiragana(a)||jt["Ideographic Description Characters"](a)||jt.Kanbun(a)||jt["Kangxi Radicals"](a)||jt["Katakana Phonetic Extensions"](a)||jt.Katakana(a)&&12540!==a||!(!jt["Halfwidth and Fullwidth Forms"](a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!jt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||jt["Unified Canadian Aboriginal Syllabics"](a)||jt["Unified Canadian Aboriginal Syllabics Extended"](a)||jt["Vertical Forms"](a)||jt["Yijing Hexagram Symbols"](a)||jt["Yi Syllables"](a)||jt["Yi Radicals"](a))))}function ta(a){return!(Bf(a)||(i=a,jt["Latin-1 Supplement"](i)&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||jt["General Punctuation"](i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||jt["Letterlike Symbols"](i)||jt["Number Forms"](i)||jt["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||jt["Control Pictures"](i)&&9251!==i||jt["Optical Character Recognition"](i)||jt["Enclosed Alphanumerics"](i)||jt["Geometric Shapes"](i)||jt["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||jt["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||jt["CJK Symbols and Punctuation"](i)||jt.Katakana(i)||jt["Private Use Area"](i)||jt["CJK Compatibility Forms"](i)||jt["Small Form Variants"](i)||jt["Halfwidth and Fullwidth Forms"](i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i}function vm(a){return jt.Arabic(a)||jt["Arabic Supplement"](a)||jt["Arabic Extended-A"](a)||jt["Arabic Presentation Forms-A"](a)||jt["Arabic Presentation Forms-B"](a)}function Vf(a){return a>=1424&&a<=2303||jt["Arabic Presentation Forms-A"](a)||jt["Arabic Presentation Forms-B"](a)}function Nv(a,i){return!(!i&&Vf(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||jt.Khmer(a))}function x_(a){for(const i of a)if(Vf(i.charCodeAt(0)))return!0;return!1}const ds={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let xm=null,To=ds.unavailable,ic=null;const _a=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(To=ds.error),xm&&xm(a)};function jf(){Uf.fire(new Yr("pluginStateChange",{pluginStatus:To,pluginURL:ic}))}const Uf=new zu,hr=function(){return To},Hf=function(){if(To!==ds.deferred||!ic)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");To=ds.loading,jf(),ic&&Ic({url:ic},a=>{a?_a(a):(To=ds.loaded,jf())})},Gs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>To===ds.loaded||null!=Gs.applyArabicShaping,isLoading:()=>To===ds.loading,setState(a){To=a.pluginStatus,ic=a.pluginURL},isParsing:()=>To===ds.parsing,isParsed:()=>To===ds.parsed,getPluginURL:()=>ic};class Tn{constructor(i,o){this.zoom=i,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness,this.worldview=o.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(o,c){for(const h of o)if(!Nv(h.charCodeAt(0),c))return!1;return!0}(i,Gs.isLoaded())}}class mh{constructor(i,o,c,h){this.property=i,this.value=o,this.expression=function(m,g,x,E){if(dh(m))return new fl(m,g);if(y_(m)||Array.isArray(m)&&m.length>0){const T=Lf(m,g,x,E);if("error"===T.result)throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));return T.value}{let T=m;return"string"==typeof m&&"color"===g.type&&(T=Jn.parse(m)),{kind:"constant",configDependencies:new Set,evaluate:()=>T}}}(void 0===o?i.specification.default:o,i.specification,c,h)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,o,c){return this.property.possiblyEvaluate(this,i,o,c)}}class gh{constructor(i,o,c){this.property=i,this.value=new mh(i,void 0,o,c)}transitioned(i,o){return new Ts(this.property,this.value,o,Ie({},i.transition,this.transition),i.now)}untransitioned(){return new Ts(this.property,this.value,null,{},0)}}class Ba{constructor(i,o,c){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=o,this._options=c,this.configDependencies=new Set}getValue(i){return mn(this._values[i].value.value)}setValue(i,o){this._values.hasOwnProperty(i)||(this._values[i]=new gh(this._values[i].property,this._scope,this._options)),this._values[i].value=new mh(this._values[i].property,null===o?void 0:mn(o),this._scope,this._options),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]))}setTransitionOrValue(i,o){o&&(this._options=o);const c=this._properties.properties;if(i)for(const h in i){const m=i[h];if(h.endsWith("-transition")){const g=h.slice(0,-11);c[g]&&this.setTransition(g,m)}else c.hasOwnProperty(h)&&this.setValue(h,m)}}getTransition(i){return mn(this._values[i].transition)}setTransition(i,o){this._values.hasOwnProperty(i)||(this._values[i]=new gh(this._values[i].property)),this._values[i].transition=mn(o)||void 0}serialize(){const i={};for(const o of Object.keys(this._values)){const c=this.getValue(o);void 0!==c&&(i[o]=c);const h=this.getTransition(o);void 0!==h&&(i[`${o}-transition`]=h)}return i}transitioned(i,o){const c=new b_(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].transitioned(i,o._values[h]);return c}untransitioned(){const i=new b_(this._properties);for(const o of Object.keys(this._values))i._values[o]=this._values[o].untransitioned();return i}}class Ts{constructor(i,o,c,h,m){const g=h.delay||0,x=h.duration||0;m=m||0,this.property=i,this.value=o,this.begin=m+g,this.end=this.begin+x,i.specification.transition&&(h.delay||h.duration)&&(this.prior=c)}possiblyEvaluate(i,o,c){const h=i.now||0,m=this.value.possiblyEvaluate(i,o,c),g=this.prior;if(g){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return g.possiblyEvaluate(i,o,c);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(i,o,c),m,X(x))}}return m}}class b_{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,o,c){const h=new Co(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(i,o,c);return h}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class rc{constructor(i,o,c){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=o,this._options=c,this.configDependencies=new Set}getValue(i){return mn(this._values[i].value)}setValue(i,o){this._values[i]=new mh(this._values[i].property,null===o?void 0:mn(o),this._scope,this._options),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]))}serialize(){const i={};for(const o of Object.keys(this._values)){const c=this.getValue(o);void 0!==c&&(i[o]=c)}return i}possiblyEvaluate(i,o,c){const h=new Co(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(i,o,c);return h}}class Xc{constructor(i,o,c){this.property=i,this.value=o,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,o,c,h){return this.property.evaluate(this.value,this.parameters,i,o,c,h)}}class Co{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class it{constructor(i){this.specification=i}possiblyEvaluate(i,o){return i.expression.evaluate(o)}interpolate(i,o,c){const h=Uu[this.specification.type];return h?h(i,o,c):i}}class _t{constructor(i,o){this.specification=i,this.overrides=o}possiblyEvaluate(i,o,c,h){return new Xc(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(o,null,{},c,h)}:i.expression,o)}interpolate(i,o,c){if("constant"!==i.value.kind||"constant"!==o.value.kind)return i;if(void 0===i.value.value||void 0===o.value.value)return new Xc(this,{kind:"constant",value:void 0},i.parameters);const h=Uu[this.specification.type];return h?new Xc(this,{kind:"constant",value:h(i.value.value,o.value.value,c)},i.parameters):i}evaluate(i,o,c,h,m,g){return"constant"===i.kind?i.value:i.evaluate(o,c,h,m,g)}}class Yc{constructor(i){this.specification=i}possiblyEvaluate(i,o,c,h){return!!i.expression.evaluate(o,null,{},c,h)}interpolate(){return!1}}class Ji{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new Tn(0,{});for(const c in i){const h=i[c];h.specification.overridable&&this.overridableProperties.push(c);const m=this.defaultPropertyValues[c]=new mh(h,void 0),g=this.defaultTransitionablePropertyValues[c]=new gh(h);this.defaultTransitioningPropertyValues[c]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=m.possiblyEvaluate(o)}}}Et(_t,"DataDrivenProperty"),Et(it,"DataConstantProperty"),Et(Yc,"ColorRampProperty");var Se=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"expression"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function w_(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Sn(a){if(Array.isArray(a))return a.map(Sn);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const i={};for(const o in a)i[o]=Sn(a[o]);return i}return w_(a)}function Ju(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const i of a.slice(1))if(!Ju(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function _h(a,i="",o=null,c="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ju(a)||(a=$f(a));const h=a;let m=!0;try{m=function(I){if(!Qu(I))return I;let A=Sn(I);return Gf(A),A=bm(A),A}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(h,null,2)}\n        `)}let g=null,x=null;if("background"!==c&&"sky"!==c&&"slot"!==c){x=Se[`filter_${c}`];const I=Wc(m,x,i,o);if("error"===I.result)throw new Error(I.value.map(A=>`${A.key}: ${A.message}`).join(", "));g=(A,M,F)=>I.value.evaluate(A,M,{},F)}let E=null,T=null;if(m!==h){const I=Wc(h,x,i,o);if("error"===I.result)throw new Error(I.value.map(A=>`${A.key}: ${A.message}`).join(", "));E=(A,M,F,L,V)=>I.value.evaluate(A,M,{},F,void 0,void 0,L,V),T=!kn(I.value.expression)}return{filter:g,dynamicFilter:E||void 0,needGeometry:wm(m),needFeature:!!T}}function bm(a){if(!Array.isArray(a))return a;const i=function(o){if(ya.has(o[0]))for(let c=1;c<o.length;c++)if(Qu(o[c]))return!0;return o}(a);return!0===i?i:i.map(o=>bm(o))}function Gf(a){let i=!1;const o=[];if("case"===a[0]){for(let c=1;c<a.length-1;c+=2)i=i||Qu(a[c]),o.push(a[c+1]);o.push(a[a.length-1])}else if("match"===a[0]){i=i||Qu(a[1]);for(let c=2;c<a.length-1;c+=2)o.push(a[c+1]);o.push(a[a.length-1])}else if("step"===a[0]){i=i||Qu(a[1]);for(let c=1;c<a.length-1;c+=2)o.push(a[c+1])}i&&(a.length=0,a.push("any",...o));for(let c=1;c<a.length;c++)Gf(a[c])}function Qu(a){if(!Array.isArray(a))return!1;if("pitch"===(i=a[0])||"distance-from-center"===i)return!0;var i;for(let o=1;o<a.length;o++)if(Qu(a[o]))return!0;return!1}const ya=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ed(a,i){return a<i?-1:a>i?1:0}function wm(a){if(!Array.isArray(a))return!1;if("within"===a[0]||"distance"===a[0])return!0;for(let i=1;i<a.length;i++)if(wm(a[i]))return!0;return!1}function $f(a){if(!a)return!0;const i=a[0];return a.length<=1?"any"!==i:"=="===i?Em(a[1],a[2],"=="):"!="===i?Mt(Em(a[1],a[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Em(a[1],a[2],i):"any"===i?(o=a.slice(1),["any"].concat(o.map($f))):"all"===i?["all"].concat(a.slice(1).map($f)):"none"===i?["all"].concat(a.slice(1).map($f).map(Mt)):"in"===i?E_(a[1],a.slice(2)):"!in"===i?Mt(E_(a[1],a.slice(2))):"has"===i?T_(a[1]):"!has"!==i||Mt(T_(a[1]));var o}function Em(a,i,o){switch(a){case"$type":return[`filter-type-${o}`,i];case"$id":return[`filter-id-${o}`,i];default:return[`filter-${o}`,a,i]}}function E_(a,i){if(0===i.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(o=>typeof o!=typeof i[0])?["filter-in-large",a,["literal",i.sort(ed)]]:["filter-in-small",a,["literal",i]]}}function T_(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Mt(a){return["!",a]}function td(a,i){return i?`${a}\x1f${i}`:a}const C_="-transition",Lo=new Set(["fill","line","background","hillshade","raster"]);class So extends zu{constructor(i,o,c,h,m){if(super(),this.id=i.id,this.fqid=td(this.id,c),this.type=i.type,this.scope=c,this.lut=h,this.options=m,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==i.type){if(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type&&"background"!==i.type&&"sky"!==i.type&&"slot"!==i.type){this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter;const g=Wc(this.filter,Se[`filter_${i.type}`]);"error"!==g.result&&(this.configDependencies=new Set([...this.configDependencies,...g.value.configDependencies]))}if(i.slot&&(this.slot=i.slot),o.layout&&(this._unevaluatedLayout=new rc(o.layout,this.scope,m),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),o.paint){this._transitionablePaint=new Ba(o.paint,this.scope,m);for(const g in i.paint)this.setPaintProperty(g,i.paint[g]);for(const g in i.layout)this.setLayoutProperty(g,i.layout[g]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Co(o.paint)}}}onAdd(i){}onRemove(i){}isDraped(i){return!this.is3D(!0)&&Lo.has(this.type)}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,o){if("custom"===this.type&&"visibility"===i)return void(this.visibility=o);const c=this._unevaluatedLayout;c._properties.properties[i]&&(c.setValue(i,o),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),"visibility"===i&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(i){return i.endsWith(C_)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,o){const c=this._transitionablePaint,h=c._properties.properties;if(i.endsWith(C_)){const A=i.slice(0,-11);return h[A]&&c.setTransition(A,o||void 0),!1}if(!h[i])return!1;const m=c._values[i],g=m.value.isDataDriven(),x=m.value;c.setValue(i,o),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(i);const E=c._values[i].value,T=E.isDataDriven(),I=i.endsWith("pattern")||"line-dasharray"===i;return T||g||I||this._handleOverridablePaintPropertyUpdate(i,x,E)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,o,c){return null}_handleOverridablePaintPropertyUpdate(i,o,c){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,o)}serialize(){return bn({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(i,o)=>!(void 0===i||"layout"===o&&!Object.keys(i).length||"paint"===o&&!Object.keys(i).length))}is3D(i){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const i in this.paint._values){const o=this.paint.get(i);if(o instanceof Xc&&Xu(o.property.specification)&&("source"===o.value.kind||"composite"===o.value.kind)&&o.value.isStateDependent)return!0}return!1}compileFilter(i){this._filterCompiled||(this._featureFilter=_h(this.filter,this.scope,i),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&("shadow"===i.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(i){}queryIntersectsFeature(i,o,c,h,m,g,x,E,T){}}const yh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Cs{constructor(i,o){this._structArray=i,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class wi{constructor(){this.capacity=-1,this.resize(0)}static serialize(i,o){return i._trim(),o&&o.add(i.arrayBuffer),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const o=Object.create(this.prototype);return o.arrayBuffer=i.arrayBuffer,o.length=i.length,o.capacity=i.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function En(a,i=1){let o=0,c=0;return{members:a.map(h=>{const m=yh[h.type].BYTES_PER_ELEMENT,g=o=Tm(o,Math.max(i,m)),x=h.components||1;return c=Math.max(c,m),o+=m*x,{name:h.name,type:h.type,components:x,offset:g}}),size:Tm(o,Math.max(c,i)),alignment:i}}function Tm(a,i){return Math.ceil(a/i)*i}class Ss extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o){const c=this.length;return this.resize(c+1),this.emplace(c,i,o)}emplace(i,o,c){const h=2*i;return this.int16[h+0]=o,this.int16[h+1]=c,i}}Ss.prototype.bytesPerElement=4,Et(Ss,"StructArrayLayout2i4");class Kc extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,c){const h=this.length;return this.resize(h+1),this.emplace(h,i,o,c)}emplace(i,o,c,h){const m=3*i;return this.int16[m+0]=o,this.int16[m+1]=c,this.int16[m+2]=h,i}}Kc.prototype.bytesPerElement=6,Et(Kc,"StructArrayLayout3i6");class to extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,c,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,o,c,h)}emplace(i,o,c,h,m){const g=4*i;return this.int16[g+0]=o,this.int16[g+1]=c,this.int16[g+2]=h,this.int16[g+3]=m,i}}to.prototype.bytesPerElement=8,Et(to,"StructArrayLayout4i8");class hs extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.float32[1*i+0]=o,i}}hs.prototype.bytesPerElement=4,Et(hs,"StructArrayLayout1f4");class qf extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c){const h=this.length;return this.resize(h+1),this.emplace(h,i,o,c)}emplace(i,o,c,h){const m=4*i,g=2*i;return this.int16[m+0]=o,this.int16[m+1]=c,this.float32[g+1]=h,i}}qf.prototype.bytesPerElement=8,Et(qf,"StructArrayLayout2i1f8");class oc extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,c){const h=this.length;return this.resize(h+1),this.emplace(h,i,o,c)}emplace(i,o,c,h){const m=4*i;return this.int16[m+0]=o,this.int16[m+1]=c,this.int16[m+2]=h,i}}oc.prototype.bytesPerElement=8,Et(oc,"StructArrayLayout3i8");class na extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,c,h,m)}emplace(i,o,c,h,m,g){const x=5*i;return this.int16[x+0]=o,this.int16[x+1]=c,this.int16[x+2]=h,this.int16[x+3]=m,this.int16[x+4]=g,i}}na.prototype.bytesPerElement=10,Et(na,"StructArrayLayout5i10");class Wf extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g,x){const E=this.length;return this.resize(E+1),this.emplace(E,i,o,c,h,m,g,x)}emplace(i,o,c,h,m,g,x,E){const T=6*i,I=12*i,A=3*i;return this.int16[T+0]=o,this.int16[T+1]=c,this.uint8[I+4]=h,this.uint8[I+5]=m,this.uint8[I+6]=g,this.uint8[I+7]=x,this.float32[A+2]=E,i}}Wf.prototype.bytesPerElement=12,Et(Wf,"StructArrayLayout2i4ub1f12");class Ds extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c){const h=this.length;return this.resize(h+1),this.emplace(h,i,o,c)}emplace(i,o,c,h){const m=3*i;return this.float32[m+0]=o,this.float32[m+1]=c,this.float32[m+2]=h,i}}Ds.prototype.bytesPerElement=12,Et(Ds,"StructArrayLayout3f12");class sc extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,c,h,m)}emplace(i,o,c,h,m,g){const x=6*i,E=3*i;return this.uint16[x+0]=o,this.uint16[x+1]=c,this.uint16[x+2]=h,this.uint16[x+3]=m,this.float32[E+2]=g,i}}sc.prototype.bytesPerElement=12,Et(sc,"StructArrayLayout4ui1f12");class nd extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,c,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,o,c,h)}emplace(i,o,c,h,m){const g=4*i;return this.uint16[g+0]=o,this.uint16[g+1]=c,this.uint16[g+2]=h,this.uint16[g+3]=m,i}}nd.prototype.bytesPerElement=8,Et(nd,"StructArrayLayout4ui8");class id extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,c,h,m,g)}emplace(i,o,c,h,m,g,x){const E=6*i;return this.int16[E+0]=o,this.int16[E+1]=c,this.int16[E+2]=h,this.int16[E+3]=m,this.int16[E+4]=g,this.int16[E+5]=x,i}}id.prototype.bytesPerElement=12,Et(id,"StructArrayLayout6i12");class rd extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g,x,E,T,I,A,M){const F=this.length;return this.resize(F+1),this.emplace(F,i,o,c,h,m,g,x,E,T,I,A,M)}emplace(i,o,c,h,m,g,x,E,T,I,A,M,F){const L=12*i;return this.int16[L+0]=o,this.int16[L+1]=c,this.int16[L+2]=h,this.int16[L+3]=m,this.uint16[L+4]=g,this.uint16[L+5]=x,this.uint16[L+6]=E,this.uint16[L+7]=T,this.int16[L+8]=I,this.int16[L+9]=A,this.int16[L+10]=M,this.int16[L+11]=F,i}}rd.prototype.bytesPerElement=24,Et(rd,"StructArrayLayout4i4ui4i24");class Jc extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,c,h,m,g)}emplace(i,o,c,h,m,g,x){const E=10*i,T=5*i;return this.int16[E+0]=o,this.int16[E+1]=c,this.int16[E+2]=h,this.float32[T+2]=m,this.float32[T+3]=g,this.float32[T+4]=x,i}}Jc.prototype.bytesPerElement=20,Et(Jc,"StructArrayLayout3i3f20");class Va extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,o,c,h)}emplace(i,o,c,h,m){const g=4*i;return this.float32[g+0]=o,this.float32[g+1]=c,this.float32[g+2]=h,this.float32[g+3]=m,i}}Va.prototype.bytesPerElement=16,Et(Va,"StructArrayLayout4f16");class Cm extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint32[1*i+0]=o,i}}Cm.prototype.bytesPerElement=4,Et(Cm,"StructArrayLayout1ul4");class va extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o){const c=this.length;return this.resize(c+1),this.emplace(c,i,o)}emplace(i,o,c){const h=2*i;return this.uint16[h+0]=o,this.uint16[h+1]=c,i}}va.prototype.bytesPerElement=4,Et(va,"StructArrayLayout2ui4");class vh extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g,x,E,T,I,A,M,F){const L=this.length;return this.resize(L+1),this.emplace(L,i,o,c,h,m,g,x,E,T,I,A,M,F)}emplace(i,o,c,h,m,g,x,E,T,I,A,M,F,L){const V=20*i,j=10*i;return this.int16[V+0]=o,this.int16[V+1]=c,this.int16[V+2]=h,this.int16[V+3]=m,this.int16[V+4]=g,this.float32[j+3]=x,this.float32[j+4]=E,this.float32[j+5]=T,this.float32[j+6]=I,this.int16[V+14]=A,this.uint32[j+8]=M,this.uint16[V+18]=F,this.uint16[V+19]=L,i}}vh.prototype.bytesPerElement=40,Et(vh,"StructArrayLayout5i4f1i1ul2ui40");class xh extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g,x){const E=this.length;return this.resize(E+1),this.emplace(E,i,o,c,h,m,g,x)}emplace(i,o,c,h,m,g,x,E){const T=8*i;return this.int16[T+0]=o,this.int16[T+1]=c,this.int16[T+2]=h,this.int16[T+4]=m,this.int16[T+5]=g,this.int16[T+6]=x,this.int16[T+7]=E,i}}xh.prototype.bytesPerElement=16,Et(xh,"StructArrayLayout3i2i2i16");class Qc extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,c,h,m)}emplace(i,o,c,h,m,g){const x=4*i,E=8*i;return this.float32[x+0]=o,this.float32[x+1]=c,this.float32[x+2]=h,this.int16[E+6]=m,this.int16[E+7]=g,i}}Qc.prototype.bytesPerElement=16,Et(Qc,"StructArrayLayout2f1f2i16");class eu extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,c,h,m,g)}emplace(i,o,c,h,m,g,x){const E=20*i,T=5*i;return this.uint8[E+0]=o,this.uint8[E+1]=c,this.float32[T+1]=h,this.float32[T+2]=m,this.float32[T+3]=g,this.float32[T+4]=x,i}}eu.prototype.bytesPerElement=20,Et(eu,"StructArrayLayout2ub4f20");class Pi extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,c){const h=this.length;return this.resize(h+1),this.emplace(h,i,o,c)}emplace(i,o,c,h){const m=3*i;return this.uint16[m+0]=o,this.uint16[m+1]=c,this.uint16[m+2]=h,i}}Pi.prototype.bytesPerElement=6,Et(Pi,"StructArrayLayout3ui6");class ac extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g,x,E,T,I,A,M,F,L,V,j,W,Q,J,te,me){const he=this.length;return this.resize(he+1),this.emplace(he,i,o,c,h,m,g,x,E,T,I,A,M,F,L,V,j,W,Q,J,te,me)}emplace(i,o,c,h,m,g,x,E,T,I,A,M,F,L,V,j,W,Q,J,te,me,he){const fe=30*i,be=15*i,Ee=60*i;return this.int16[fe+0]=o,this.int16[fe+1]=c,this.int16[fe+2]=h,this.float32[be+2]=m,this.float32[be+3]=g,this.uint16[fe+8]=x,this.uint16[fe+9]=E,this.uint32[be+5]=T,this.uint32[be+6]=I,this.uint32[be+7]=A,this.uint16[fe+16]=M,this.uint16[fe+17]=F,this.uint16[fe+18]=L,this.float32[be+10]=V,this.float32[be+11]=j,this.uint8[Ee+48]=W,this.uint8[Ee+49]=Q,this.uint8[Ee+50]=J,this.uint32[be+13]=te,this.int16[fe+28]=me,this.uint8[Ee+58]=he,i}}ac.prototype.bytesPerElement=60,Et(ac,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Sm extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g,x,E,T,I,A,M,F,L,V,j,W,Q,J,te,me,he,fe,be,Ee,je,De,He,ot,$e,Ke,nt,Be){const Je=this.length;return this.resize(Je+1),this.emplace(Je,i,o,c,h,m,g,x,E,T,I,A,M,F,L,V,j,W,Q,J,te,me,he,fe,be,Ee,je,De,He,ot,$e,Ke,nt,Be)}emplace(i,o,c,h,m,g,x,E,T,I,A,M,F,L,V,j,W,Q,J,te,me,he,fe,be,Ee,je,De,He,ot,$e,Ke,nt,Be,Je){const Ae=20*i,Ve=40*i,at=80*i;return this.float32[Ae+0]=o,this.float32[Ae+1]=c,this.int16[Ve+4]=h,this.int16[Ve+5]=m,this.int16[Ve+6]=g,this.int16[Ve+7]=x,this.int16[Ve+8]=E,this.int16[Ve+9]=T,this.int16[Ve+10]=I,this.int16[Ve+11]=A,this.int16[Ve+12]=M,this.uint16[Ve+13]=F,this.uint16[Ve+14]=L,this.uint16[Ve+15]=V,this.uint16[Ve+16]=j,this.uint16[Ve+17]=W,this.uint16[Ve+18]=Q,this.uint16[Ve+19]=J,this.uint16[Ve+20]=te,this.uint16[Ve+21]=me,this.uint16[Ve+22]=he,this.uint16[Ve+23]=fe,this.uint16[Ve+24]=be,this.uint16[Ve+25]=Ee,this.uint16[Ve+26]=je,this.uint16[Ve+27]=De,this.uint32[Ae+14]=He,this.float32[Ae+15]=ot,this.float32[Ae+16]=$e,this.float32[Ae+17]=Ke,this.float32[Ae+18]=nt,this.uint8[at+76]=Be,this.uint16[Ve+39]=Je,i}}Sm.prototype.bytesPerElement=80,Et(Sm,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Dm extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,i,o,c,h,m,g)}emplace(i,o,c,h,m,g,x){const E=6*i;return this.float32[E+0]=o,this.float32[E+1]=c,this.float32[E+2]=h,this.float32[E+3]=m,this.float32[E+4]=g,this.float32[E+5]=x,i}}Dm.prototype.bytesPerElement=24,Et(Dm,"StructArrayLayout6f24");class $r extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m){const g=this.length;return this.resize(g+1),this.emplace(g,i,o,c,h,m)}emplace(i,o,c,h,m,g){const x=5*i;return this.float32[x+0]=o,this.float32[x+1]=c,this.float32[x+2]=h,this.float32[x+3]=m,this.float32[x+4]=g,i}}$r.prototype.bytesPerElement=20,Et($r,"StructArrayLayout5f20");class ml extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g,x){const E=this.length;return this.resize(E+1),this.emplace(E,i,o,c,h,m,g,x)}emplace(i,o,c,h,m,g,x,E){const T=7*i;return this.float32[T+0]=o,this.float32[T+1]=c,this.float32[T+2]=h,this.float32[T+3]=m,this.float32[T+4]=g,this.float32[T+5]=x,this.float32[T+6]=E,i}}ml.prototype.bytesPerElement=28,Et(ml,"StructArrayLayout7f28");class yr extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g,x,E,T,I,A){const M=this.length;return this.resize(M+1),this.emplace(M,i,o,c,h,m,g,x,E,T,I,A)}emplace(i,o,c,h,m,g,x,E,T,I,A,M){const F=11*i;return this.float32[F+0]=o,this.float32[F+1]=c,this.float32[F+2]=h,this.float32[F+3]=m,this.float32[F+4]=g,this.float32[F+5]=x,this.float32[F+6]=E,this.float32[F+7]=T,this.float32[F+8]=I,this.float32[F+9]=A,this.float32[F+10]=M,i}}yr.prototype.bytesPerElement=44,Et(yr,"StructArrayLayout11f44");class Im extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g,x,E,T){const I=this.length;return this.resize(I+1),this.emplace(I,i,o,c,h,m,g,x,E,T)}emplace(i,o,c,h,m,g,x,E,T,I){const A=9*i;return this.float32[A+0]=o,this.float32[A+1]=c,this.float32[A+2]=h,this.float32[A+3]=m,this.float32[A+4]=g,this.float32[A+5]=x,this.float32[A+6]=E,this.float32[A+7]=T,this.float32[A+8]=I,i}}Im.prototype.bytesPerElement=36,Et(Im,"StructArrayLayout9f36");class lc extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o){const c=this.length;return this.resize(c+1),this.emplace(c,i,o)}emplace(i,o,c){const h=2*i;return this.float32[h+0]=o,this.float32[h+1]=c,i}}lc.prototype.bytesPerElement=8,Et(lc,"StructArrayLayout2f8");class Am extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,o,c,h){const m=this.length;return this.resize(m+1),this.emplace(m,i,o,c,h)}emplace(i,o,c,h,m){const g=6*i;return this.uint32[3*i+0]=o,this.uint16[g+2]=c,this.uint16[g+3]=h,this.uint16[g+4]=m,i}}Am.prototype.bytesPerElement=12,Et(Am,"StructArrayLayout1ul3ui12");class Mm extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint16[1*i+0]=o,i}}Mm.prototype.bytesPerElement=2,Et(Mm,"StructArrayLayout1ui2");class bh extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g,x,E,T,I,A,M,F,L,V,j){const W=this.length;return this.resize(W+1),this.emplace(W,i,o,c,h,m,g,x,E,T,I,A,M,F,L,V,j)}emplace(i,o,c,h,m,g,x,E,T,I,A,M,F,L,V,j,W){const Q=16*i;return this.float32[Q+0]=o,this.float32[Q+1]=c,this.float32[Q+2]=h,this.float32[Q+3]=m,this.float32[Q+4]=g,this.float32[Q+5]=x,this.float32[Q+6]=E,this.float32[Q+7]=T,this.float32[Q+8]=I,this.float32[Q+9]=A,this.float32[Q+10]=M,this.float32[Q+11]=F,this.float32[Q+12]=L,this.float32[Q+13]=V,this.float32[Q+14]=j,this.float32[Q+15]=W,i}}bh.prototype.bytesPerElement=64,Et(bh,"StructArrayLayout16f64");class tu extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,o,c,h,m,g,x){const E=this.length;return this.resize(E+1),this.emplace(E,i,o,c,h,m,g,x)}emplace(i,o,c,h,m,g,x,E){const T=10*i,I=5*i;return this.uint16[T+0]=o,this.uint16[T+1]=c,this.uint16[T+2]=h,this.uint16[T+3]=m,this.float32[I+2]=g,this.float32[I+3]=x,this.float32[I+4]=E,i}}tu.prototype.bytesPerElement=20,Et(tu,"StructArrayLayout4ui3f20");class od extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.int16[1*i+0]=o,i}}od.prototype.bytesPerElement=2,Et(od,"StructArrayLayout1i2");class xa extends wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const o=this.length;return this.resize(o+1),this.emplace(o,i)}emplace(i,o){return this.uint8[1*i+0]=o,i}}xa.prototype.bytesPerElement=1,Et(xa,"StructArrayLayout1ub1");class Pm extends Cs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Pm.prototype.size=40;class wh extends vh{get(i){return new Pm(this,i)}}Et(wh,"CollisionBoxArray");class nu extends Cs{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}nu.prototype.size=60;class cc extends ac{get(i){return new nu(this,i)}}Et(cc,"PlacedSymbolArray");class Eh extends Cs{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Eh.prototype.size=80;class Rm extends Sm{get(i){return new Eh(this,i)}}Et(Rm,"SymbolInstanceArray");class Zf extends hs{getoffsetX(i){return this.float32[1*i+0]}}Et(Zf,"GlyphOffsetArray");class S_ extends Ss{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Et(S_,"SymbolLineVertexArray");class gl extends Cs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}gl.prototype.size=12;class sd extends Am{get(i){return new gl(this,i)}}Et(sd,"FeatureIndexArray");class D_ extends va{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Et(D_,"FillExtrusionCentroidArray");class zv extends Cs{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}zv.prototype.size=6;class Xf extends Kc{get(i){return new zv(this,i)}}Et(Xf,"FillExtrusionWallArray");const Bv=En([{name:"a_pos",components:2,type:"Int16"}],4),Vv=En([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),jv=En([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Wi{constructor(i=[]){this.segments=i}_prepareSegment(i,o,c,h){let m=this.segments[this.segments.length-1];return i>Wi.MAX_VERTEX_ARRAY_LENGTH&&_n(`Max vertices per segment is ${Wi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!m||m.vertexLength+i>Wi.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:o,primitiveOffset:c,vertexLength:0,primitiveLength:0},void 0!==h&&(m.sortKey=h),this.segments.push(m)),m}prepareSegment(i,o,c,h){return this._prepareSegment(i,o.length,c.length,h)}get(){return this.segments}destroy(){for(const i of this.segments)for(const o in i.vaos)i.vaos[o].destroy()}static simpleSegment(i,o,c,h){return new Wi([{vertexOffset:i,primitiveOffset:o,vertexLength:c,primitiveLength:h,vaos:{},sortKey:0}])}}function Uv(a,i){return 256*(a=se(Math.floor(a),0,255))+se(Math.floor(i),0,255)}Wi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Et(Wi,"SegmentVector");const Om=En([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),iu=En([{name:"a_pattern_b",components:4,type:"Uint16"}]),Hv=En([{name:"a_dash",components:4,type:"Uint16"}]);class _l{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,o,c,h){this.ids.push(ru(i)),this.positions.push(o,c,h)}eachPosition(i,o){const c=ru(i);let h=0,m=this.ids.length-1;for(;h<m;){const g=h+m>>1;this.ids[g]>=c?m=g:h=g+1}for(;this.ids[h]===c;)o(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(i,o){const c=new Float64Array(i.ids),h=new Uint32Array(i.positions);return ad(c,h,0,c.length-1),o&&(o.add(c.buffer),o.add(h.buffer)),{ids:c,positions:h}}static deserialize(i){const o=new _l;let c;o.ids=i.ids,o.positions=i.positions;for(const h of o.ids)h!==c&&o.uniqueIds.push(h),c=h;return o.indexed=!0,o}}function ru(a){const i=+a;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:Xd(String(a))}function ad(a,i,o,c){for(;o<c;){const h=a[o+c>>1];let m=o-1,g=c+1;for(;;){do{m++}while(a[m]<h);do{g--}while(a[g]>h);if(m>=g)break;km(a,m,g),km(i,3*m,3*g),km(i,3*m+1,3*g+1),km(i,3*m+2,3*g+2)}g-o<c-g?(ad(a,i,o,g),o=g+1):(ad(a,i,g+1,c),c=g)}}function km(a,i,o){const c=a[i];a[i]=a[o],a[o]=c}Et(_l,"FeaturePositionMap");class $s{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,o),this.initialized=!0),!!this.location}set(i,o,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Th extends $s{constructor(i){super(i),this.current=0}set(i,o,c){this.fetchUniformLocation(i,o)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class vr extends $s{constructor(i){super(i),this.current=0}set(i,o,c){this.fetchUniformLocation(i,o)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class lo extends $s{constructor(i){super(i),this.current=[0,0]}set(i,o,c){this.fetchUniformLocation(i,o)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class ld extends $s{constructor(i){super(i),this.current=[0,0,0]}set(i,o,c){this.fetchUniformLocation(i,o)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class uc extends $s{constructor(i){super(i),this.current=[0,0,0,0]}set(i,o,c){this.fetchUniformLocation(i,o)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class Ch extends $s{constructor(i){super(i),this.current=Jn.transparent.toPremultipliedRenderColor(null)}set(i,o,c){this.fetchUniformLocation(i,o)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const Fm=new Float32Array(16);class dc extends $s{constructor(i){super(i),this.current=Fm}set(i,o,c){if(this.fetchUniformLocation(i,o)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let h=1;h<16;h++)if(c[h]!==this.current[h]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const Lm=new Float32Array(9),I_=new Float32Array(4);class Yf extends $s{constructor(i){super(i),this.current=I_}set(i,o,c){if(this.fetchUniformLocation(i,o))for(let h=0;h<4;h++)if(c[h]!==this.current[h]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}function Kf(a){return[Uv(255*a.r,255*a.g),Uv(255*a.b,255*a.a)]}class cd{constructor(i,o,c,h){this.value=i,this.uniformNames=o.map(m=>`u_${m}`),this.type=c,this.context=h}setUniform(i,o,c,h,m){const g=h.constantOr(this.value);o.set(i,m,g instanceof Jn?g.toPremultipliedRenderColor(this.lutExpression&&"none"===this.lutExpression.value?null:this.context.lut):g)}getBinding(i,o){return"color"===this.type?new Ch(i):new vr(i)}}class ou{constructor(i,o){this.uniformNames=o.map(c=>`u_${c}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(i,o){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br),this.patternTransition=o?o.tl.concat(o.br):this.pattern}setUniform(i,o,c,h,m){let g=null;"u_pattern"!==m&&"u_dash"!==m||(g=this.pattern),"u_pattern_b"===m&&(g=this.patternTransition),"u_pixel_ratio"===m&&(g=this.pixelRatio),g&&o.set(i,m,g)}getBinding(i,o){return"u_pattern"===o||"u_pattern_b"===o||"u_dash"===o?new uc(i):new vr(i)}}class yl{constructor(i,o,c,h){this.expression=i,this.type=c,this.maxValue=0,this.paintVertexAttributes=o.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(i,o,c,h,m,g,x,E){const T=this.paintVertexArray.length,I="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate(new Tn(0,{brightness:g,worldview:E}),o,{},m,h,x):"constant"===this.expression.kind&&this.expression.value,A=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new Tn(0,{brightness:g,worldview:E}),o,{},m,h,x):this.lutExpression.value);this.paintVertexArray.resize(i),this._setPaintValue(T,i,I,A?null:this.context.lut)}updatePaintArray(i,o,c,h,m,g,x,E){const T="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate({zoom:0,brightness:x,worldview:E},c,h,void 0,m):"constant"===this.expression.kind&&this.expression.value,I=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new Tn(0,{brightness:x,worldview:E}),c,h,void 0,m):this.lutExpression.value);this._setPaintValue(i,o,T,I?null:this.context.lut)}_setPaintValue(i,o,c,h){if("color"===this.type){const m=Kf(c.toPremultipliedRenderColor(h));for(let g=i;g<o;g++)this.paintVertexArray.emplace(g,m[0],m[1])}else{for(let m=i;m<o;m++)this.paintVertexArray.emplace(m,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&"constant"!==this.lutExpression.kind&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||"constant"!==this.expression.kind&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fs{constructor(i,o,c,h,m,g){this.expression=i,this.uniformNames=o.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=h,this.context=m,this.maxValue=0,this.paintVertexAttributes=o.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,o,c,h,m,g,x,E){const T=this.expression.evaluate(new Tn(this.context.zoom,{brightness:g,worldview:E}),o,{},m,h,x),I=this.expression.evaluate(new Tn(this.context.zoom+1,{brightness:g,worldview:E}),o,{},m,h,x),A=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new Tn(0,{brightness:g,worldview:E}),o,{},m,h,x):this.lutExpression.value),M=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(M,i,T,I,A?null:this.context.lut)}updatePaintArray(i,o,c,h,m,g,x,E){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:E},c,h,void 0,m),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:E},c,h,void 0,m),A=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new Tn(0,{brightness:x,worldview:E}),c,h,void 0,m):this.lutExpression.value);this._setPaintValue(i,o,T,I,A?null:this.context.lut)}_setPaintValue(i,o,c,h,m){if("color"===this.type){const g=Kf(c.toPremultipliedRenderColor(m)),x=Kf(c.toPremultipliedRenderColor(m));for(let E=i;E<o;E++)this.paintVertexArray.emplace(E,g[0],g[1],x[0],x[1])}else{for(let g=i;g<o;g++)this.paintVertexArray.emplace(g,c,h);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,o,c,h,m){const g=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,x=se(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);o.set(i,m,x)}getBinding(i,o){return new vr(i)}}class co{constructor(i,o,c,h,m){this.expression=i,this.layerId=m,this.paintVertexAttributes=("array"===c?Hv:Om).members;for(let g=0;g<o.length;++g);this.paintVertexArray=new h,this.paintTransitionVertexArray=new nd}populatePaintArray(i,o,c,h){const m=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(m,i,o.patterns&&o.patterns[this.layerId],c)}updatePaintArray(i,o,c,h,m,g,x){this._setPaintValues(i,o,c.patterns&&c.patterns[this.layerId],g)}_setPaintValues(i,o,c,h){if(!h||!c)return;const m=h[c[0]],g=h[c[1]];if(m){if(m){const{tl:x,br:E,pixelRatio:T}=m;for(let I=i;I<o;I++)this.paintVertexArray.emplace(I,x[0],x[1],E[0],E[1],T)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:E}=g;for(let T=i;T<o;T++)this.paintTransitionVertexArray.emplace(T,x[0],x[1],E[0],E[1])}}}upload(i){const o=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,o)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=i.createVertexBuffer(this.paintTransitionVertexArray,iu.members,o))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Wo{constructor(i,o,c=(()=>!0)){this.binders={},this._buffers=[],this.context=o;const h=[];for(const m in i.paint._values){const g=i.paint.get(m);if(m.endsWith("-use-theme")||!c(m)||!(g instanceof Xc&&Xu(g.property.specification)))continue;const x=Sh(m,i.type),E=g.value,T=g.property.specification.type,I=!!g.property.useIntegerZoom,A="line-dasharray"===m||m.endsWith("pattern"),M=i.paint.get(`${m}-use-theme`),F="line-dasharray"===m&&"constant"!==i.layout.get("line-cap").value.kind||M&&"constant"!==M.value.kind;if("constant"!==E.kind||F)if("source"===E.kind||F||A){const L=M_(m,T,"source");this.binders[m]=A?new co(E,x,T,L,i.id):new yl(E,x,T,L),h.push(`/a_${m}`)}else{const L=M_(m,T,"composite");this.binders[m]=new fs(E,x,T,I,o,L),h.push(`/z_${m}`)}else this.binders[m]=A?new ou(E.value,x):new cd(E.value,x,T,o),h.push(`/u_${m}`);M&&(this.binders[m].lutExpression=M.value)}this.cacheKey=h.sort().join("")}getMaxValue(i){const o=this.binders[i];return o instanceof yl||o instanceof fs?o.maxValue:0}populatePaintArrays(i,o,c,h,m,g,x,E){for(const T in this.binders){const I=this.binders[T];I.context=this.context,(I instanceof yl||I instanceof fs||I instanceof co)&&I.populatePaintArray(i,o,c,h,m,g,x,E)}}setConstantPatternPositions(i,o){for(const c in this.binders){const h=this.binders[c];h instanceof ou&&h.setConstantPatternPositions(i,o)}}getPatternTransitionVertexBuffer(i){const o=this.binders[i];return o instanceof co?o.paintTransitionVertexBuffer:null}updatePaintArrays(i,o,c,h,m,g,x,E,T,I){let A=!1;const M=Object.keys(i),F=0!==M.length&&!E,L=F?M:o.uniqueIds;this.context.lut=m.lut;for(const V in this.binders){const j=this.binders[V];if(j.context=this.context,(j instanceof yl||j instanceof fs||j instanceof co)&&j.expression&&j.expression.kind&&"constant"!==j.expression.kind&&(!0===j.expression.isStateDependent||!1===j.expression.isLightConstant)){const W=m.paint.get(V);j.expression=W.value;for(const Q of L){const J=i[Q.toString()];o.eachPosition(Q,(te,me,he)=>{const fe=h.feature(te);j.updatePaintArray(me,he,fe,J,g,x,T,I)})}if(!F)for(const Q of c.uniqueIds){const J=i[Q.toString()];c.eachPosition(Q,(te,me,he)=>{const fe=h.feature(te);j.updatePaintArray(me,he,fe,J,g,x,T,I)})}A=!0}}return A}defines(){const i=[];for(const o in this.binders){const c=this.binders[o];(c instanceof cd||c instanceof ou)&&i.push(...c.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return i}getBinderAttributes(){const i=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof yl||c instanceof fs||c instanceof co)for(let h=0;h<c.paintVertexAttributes.length;h++)i.push(c.paintVertexAttributes[h].name);if(c instanceof co)for(let h=0;h<iu.members.length;h++)i.push(iu.members[h].name)}return i}getBinderUniforms(){const i=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof cd||c instanceof ou||c instanceof fs)for(const h of c.uniformNames)i.push(h)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const o=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof cd||h instanceof ou||h instanceof fs)for(const m of h.uniformNames)o.push({name:m,property:c,binding:h.getBinding(i,m)})}return o}setUniforms(i,o,c,h,m){for(const{name:g,property:x,binding:E}of c)this.binders[x].setUniform(i,E,m,h.get(x),g)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const o=this.binders[i];(o instanceof yl||o instanceof fs||o instanceof co)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer),o instanceof co&&o.paintTransitionVertexBuffer&&this._buffers.push(o.paintTransitionVertexBuffer)}}upload(i){for(const o in this.binders){const c=this.binders[o];(c instanceof yl||c instanceof fs||c instanceof co)&&c.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const o=this.binders[i];(o instanceof yl||o instanceof fs||o instanceof co)&&o.destroy()}}}class Is{constructor(i,o,c=(()=>!0)){this.programConfigurations={};for(const h of i)this.programConfigurations[h.id]=new Wo(h,o,c);this.needsUpload=!1,this._featureMap=new _l,this._featureMapWithoutIds=new _l,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,o,c,h,m,g,x,E,T){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(i,o,h,m,g,x,E,T);void 0!==o.id?this._featureMap.add(o.id,c,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,o,c,h,m,g,x,E){for(const T of c)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,o,T,h,m,g,x||0,E)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const A_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Sh(a,i){return A_[a]||[a.replace(`${i}-`,"").replace(/-/g,"_")]}const Gv={"line-pattern":{source:sc,composite:sc},"fill-pattern":{source:sc,composite:sc},"fill-extrusion-pattern":{source:sc,composite:sc},"line-dasharray":{source:nd,composite:nd}},ps={color:{source:lc,composite:Va},number:{source:hs,composite:lc}};function M_(a,i,o){const c=Gv[a];return c&&c[o]||ps[i][o]}Et(cd,"ConstantBinder"),Et(ou,"PatternConstantBinder"),Et(yl,"SourceExpressionBinder"),Et(co,"PatternCompositeBinder"),Et(fs,"CompositeExpressionBinder"),Et(Wo,"ProgramConfiguration",{omit:["_buffers"]}),Et(Is,"ProgramConfigurationSet");const Zi=ft/Math.PI/2,Jf=5,f=6,r=16383,l=64,p=[l,32,16],y=-Zi,v=Zi;function b(a,i,o,c=Zi){return o=Rn(o),[a*Math.sin(o)*c,-i*c,a*Math.cos(o)*c]}function C(a,i,o){return b(Math.cos(Rn(a)),Math.sin(Rn(a)),i,o)}const D=6371008.8,R=2*Math.PI*D;class O{constructor(i,o){if(isNaN(i)||isNaN(o))throw new Error(`Invalid LngLat object: (${i}, ${o})`);if(this.lng=+i,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new O(Fe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const o=Math.PI/180,c=this.lat*o,h=i.lat*o,m=Math.sin(c)*Math.sin(h)+Math.cos(c)*Math.cos(h)*Math.cos((i.lng-this.lng)*o);return D*Math.acos(Math.min(m,1))}toBounds(i=0){const o=360*i/40075017,c=o/Math.cos(Math.PI/180*this.lat);return new N({lng:this.lng-c,lat:this.lat-o},{lng:this.lng+c,lat:this.lat+o})}toEcef(i){return C(this.lat,this.lng,Zi+i*Zi/D)}static convert(i){if(i instanceof O)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new O(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new O(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class N{constructor(i,o){if(i)if(o)this.setSouthWest(i).setNorthEast(o);else if(4===i.length){const c=i;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{const c=i;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(i){return this._ne=i instanceof O?new O(i.lng,i.lat):O.convert(i),this}setSouthWest(i){return this._sw=i instanceof O?new O(i.lng,i.lat):O.convert(i),this}extend(i){const o=this._sw,c=this._ne;let h,m;if(i instanceof O)h=i,m=i;else{if(!(i instanceof N))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(N.convert(i)):this.extend(O.convert(i)):"object"==typeof i&&null!==i&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(O.convert(i)):this;if(h=i._sw,m=i._ne,!h||!m)return this}return o||c?(o.lng=Math.min(h.lng,o.lng),o.lat=Math.min(h.lat,o.lat),c.lng=Math.max(m.lng,c.lng),c.lat=Math.max(m.lat,c.lat)):(this._sw=new O(h.lng,h.lat),this._ne=new O(m.lng,m.lat)),this}getCenter(){return new O((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new O(this.getWest(),this.getNorth())}getSouthEast(){return new O(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:o,lat:c}=O.convert(i);let h=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&h}static convert(i){if(i)return i instanceof N?i:new N(i)}}const k=0,B=25.5;function H(a){return R*Math.cos(a*Math.PI/180)}function U(a){return(180+a)/360}function q(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function $(a,i){return a/H(i)}function K(a){return 360*a-180}function ee(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function ne(a,i){return a*H(ee(i))}const le=85.051129;function de(a){return Math.cos(Rn(se(a,-le,le)))}function pe(a,i){const o=se(i,k,B),c=Math.pow(2,o);return de(a)*R/(512*c)}function ae(a){return 1/Math.cos(a*Math.PI/180)}function ce(a,i=0){const o=Math.exp(Math.PI*(1-(a.y+i/ft)/(1<<a.z)*2));return 80150034*o/(o*o+1)/ft/(1<<a.z)}class ue{constructor(i,o,c=0){this.x=+i,this.y=+o,this.z=+c}static fromLngLat(i,o=0){const c=O.convert(i);return new ue(U(c.lng),q(c.lat),$(o,c.lat))}toLngLat(){return new O(K(this.x),ee(this.y))}toAltitude(){return ne(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/R*ae(ee(this.y))}}function Me(a,i,o,c,h,m,g,x,E){const T=(i+c)/2,I=(o+h)/2,A=new Qe(T,I);x(A),function(M,F,L,V,j,W){const Q=L-j,J=V-W;return Math.abs((V-F)*Q-(L-M)*J)/Math.hypot(Q,J)}(A.x,A.y,m.x,m.y,g.x,g.y)>=E?(Me(a,i,o,T,I,m,A,x,E),Me(a,T,I,c,h,A,g,x,E)):a.push(g)}function ve(a,i,o){let c=a[0],h=c.x,m=c.y;i(c);const g=[c];for(let x=1;x<a.length;x++){const E=a[x],{x:T,y:I}=E;i(E),Me(g,h,m,T,I,c,E,i,o),h=T,m=I,c=E}return g}function Ue(a,i,o,c){if(c(i,o)){const h=i.add(o)._mult(.5);Ue(a,i,h,c),Ue(a,h,o,c)}else a.push(o)}function ke(a,i){let o=a[0];const c=[o];for(let h=1;h<a.length;h++){const m=a[h];Ue(c,o,m,i),o=m}return c}const Ge=Math.pow(2,14)-1,rt=-Ge-1;function Ce(a,i){const o=Math.round(a.x*i),c=Math.round(a.y*i);return a.x=se(o,rt,Ge),a.y=se(c,rt,Ge),(o<a.x||o>a.x+1||c<a.y||c>a.y+1)&&_n("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function _e(a,i,o){const c=a.loadGeometry(),h=a.extent,m=ft/h;if(i&&o&&o.projection.isReprojectedInTileSpace){const g=1<<i.z,{scale:x,x:E,y:T,projection:I}=o,A=M=>{const F=K((i.x+M.x/h)/g),L=ee((i.y+M.y/h)/g),V=I.project(F,L);M.x=(V.x*x-E)*h,M.y=(V.y*x-T)*h};for(let M=0;M<c.length;M++)if(1!==a.type)c[M]=ve(c[M],A,1);else{const F=[];for(const L of c[M])L.x<0||L.x>=h||L.y<0||L.y>=h||(A(L),F.push(L));c[M]=F}}for(const g of c)for(const x of g)Ce(x,m);return c}function Ne(a,i){return{type:a.type,id:a.id,properties:a.properties,geometry:i?_e(a):[]}}class Re{constructor(i,o,c,h,m){this.properties={},this.extent=c,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=h,this._values=m,i.readFields(We,this,o)}loadGeometry(){const i=this._pbf;i.pos=this._geometry;const o=i.readVarint()+i.pos,c=[];let h,m=1,g=0,x=0,E=0;for(;i.pos<o;){if(g<=0){const T=i.readVarint();m=7&T,g=T>>3}if(g--,1===m||2===m)x+=i.readSVarint(),E+=i.readSVarint(),1===m&&(h&&c.push(h),h=[]),h&&h.push(new Qe(x,E));else{if(7!==m)throw new Error(`unknown command ${m}`);h&&h.push(h[0].clone())}}return h&&c.push(h),c}bbox(){const i=this._pbf;i.pos=this._geometry;const o=i.readVarint()+i.pos;let c=1,h=0,m=0,g=0,x=1/0,E=-1/0,T=1/0,I=-1/0;for(;i.pos<o;){if(h<=0){const A=i.readVarint();c=7&A,h=A>>3}if(h--,1===c||2===c)m+=i.readSVarint(),g+=i.readSVarint(),m<x&&(x=m),m>E&&(E=m),g<T&&(T=g),g>I&&(I=g);else if(7!==c)throw new Error(`unknown command ${c}`)}return[x,T,E,I]}toGeoJSON(i,o,c){const h=this.extent*Math.pow(2,c),m=this.extent*i,g=this.extent*o,x=this.loadGeometry();function E(M){return[360*(M.x+m)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(M.y+g)/h)*Math.PI))-90]}function T(M){return M.map(E)}let I;if(1===this.type){const M=[];for(const L of x)M.push(L[0]);const F=T(M);I=1===M.length?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(2===this.type){const M=x.map(T);I=1===M.length?{type:"LineString",coordinates:M[0]}:{type:"MultiLineString",coordinates:M}}else{if(3!==this.type)throw new Error("unknown feature type");{const M=function(L){const V=L.length;if(V<=1)return[L];const j=[];let W,Q;for(let J=0;J<V;J++){const te=Ze(L[J]);0!==te&&(void 0===Q&&(Q=te<0),Q===te<0?(W&&j.push(W),W=[L[J]]):W&&W.push(L[J]))}return W&&j.push(W),j}(x),F=[];for(const L of M)F.push(L.map(T));I=1===F.length?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}const A={type:"Feature",geometry:I,properties:this.properties};return null!=this.id&&(A.id=this.id),A}}function We(a,i,o){1===a?i.id=o.readVarint():2===a?function(c,h){const m=c.readVarint()+c.pos;for(;c.pos<m;){const g=h._keys[c.readVarint()],x=h._values[c.readVarint()];h.properties[g]=x}}(o,i):3===a?i.type=o.readVarint():4===a&&(i._geometry=o.pos)}function Ze(a){let i=0;for(let o,c,h=0,m=a.length,g=m-1;h<m;g=h++)o=a[h],c=a[g],i+=(c.x-o.x)*(o.y+c.y);return i}Re.types=["Unknown","Point","LineString","Polygon"];class Ye{constructor(i,o){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(dt,this,o),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];const o=this._pbf.readVarint()+this._pbf.pos;return new Re(this._pbf,o,this.extent,this._keys,this._values)}}function dt(a,i,o){15===a?i.version=o.readVarint():1===a?i.name=o.readString():5===a?i.extent=o.readVarint():2===a?i._features.push(o.pos):3===a?i._keys.push(o.readString()):4===a&&i._values.push(function(c){let h=null;const m=c.readVarint()+c.pos;for(;c.pos<m;){const g=c.readVarint()>>3;h=1===g?c.readString():2===g?c.readFloat():3===g?c.readDouble():4===g?c.readVarint64():5===g?c.readVarint():6===g?c.readSVarint():7===g?c.readBoolean():null}if(null==h)throw new Error("unknown feature value");return h}(o))}class Pt{constructor(i,o){this.layers=i.readFields(Ft,{},o)}}function Ft(a,i,o){if(3===a){const c=new Ye(o,o.readVarint()+o.pos);c.length&&(i[c.name]=c)}}const vt="3d_elevation_id";class Rt{constructor(){this._valid=!1}reset(i){return this.feature=i,this._valid=!0,this._geometry=i.loadGeometry(),0!==this._geometry.length&&0!==this._geometry[0].length||(this._valid=!1),this}geometry(i,o){return this._valid&&i(o(this._geometry)),this}require(i,o,c){return this.get(i,!0,o,c)}optional(i,o,c){return this.get(i,!1,o,c)}success(){return this._valid}get(i,o,c,h){const m=this.feature.properties.hasOwnProperty(i)?+this.feature.properties[i]:void 0;return this._valid&&void 0!==m&&!Number.isNaN(m)?c(h?h(m):m):o&&(this._valid=!1),this}}class Xt{constructor(i,o){this.featureFunc=i,this.vertexFunc=o}parseFeature(i,o,c){return this.featureFunc(i,o,c)}parseVertex(i,o,c){return this.vertexFunc(i,o,c)}}const tn=new Xt((a,i,o)=>a.reset(i).require(vt,c=>{o.id=c}).optional("fixed_height_relative",c=>{o.constantHeight=c},Dn.decodeRelativeHeight).geometry(c=>{o.bounds=c},Ef).success(),(a,i,o)=>a.reset(i).require(vt,c=>{o.id=c}).require("elevation_idx",c=>{o.idx=c}).require("extent",c=>{o.extent=c}).require("height_relative",c=>{o.height=c},Dn.decodeRelativeHeight).geometry(c=>{o.position=c},Dn.getPoint).success()),gn=new Xt((a,i,o)=>a.reset(i).require(vt,c=>{o.id=c}).optional("fixed_height",c=>{o.constantHeight=c},Dn.decodeMetricHeight).geometry(c=>{o.bounds=c},Ef).success(),(a,i,o)=>a.reset(i).require(vt,c=>{o.id=c}).require("elevation_idx",c=>{o.idx=c}).require("extent",c=>{o.extent=c}).require("height",c=>{o.height=c},Dn.decodeMetricHeight).geometry(c=>{o.position=c},Dn.getPoint).success());class Dn{static getPoint(i){return Zr(i[0][0].x,i[0][0].y)}static decodeRelativeHeight(i){return 1e-4*i*5}static decodeMetricHeight(i){return 1e-4*i}static parse(i){const o=[],c=[],h=i.length,m=new Rt;for(let x=0;x<h;x++){const E=i.feature(x),T=E.properties.version,I=(g=T)?"1.0.1"===g?gn:void 0:tn;if(void 0===I){_n(`Unknown elevation feature version number ${T||"(unknown)"}`);continue}const A=E.properties.hasOwnProperty("type")?E.properties.type:void 0;if(A)if("Point"===Re.types[E.type]&&"curve_point"===A){const M={};I.parseVertex(m,E,M)&&o.push(M)}else if("Polygon"===Re.types[E.type]&&"curve_meta"===A){const M={};I.parseFeature(m,E,M)&&c.push(M)}}var g;return{vertices:o,features:c}}}class Jt{constructor(i,o){this.pos=i,this.dir=o}intersectsPlane(i,o,c){const h=Ci(o,this.dir);if(Math.abs(h)<1e-6)return!1;const m=((i[0]-this.pos[0])*o[0]+(i[1]-this.pos[1])*o[1])/h;return c[0]=this.pos[0]+this.dir[0]*m,c[1]=this.pos[1]+this.dir[1]*m,!0}}class Mn{constructor(i,o){this.pos=i,this.dir=o}intersectsPlane(i,o,c){const h=ar(o,this.dir);if(Math.abs(h)<1e-6)return!1;const m=((i[0]-this.pos[0])*o[0]+(i[1]-this.pos[1])*o[1]+(i[2]-this.pos[2])*o[2])/h;return c[0]=this.pos[0]+this.dir[0]*m,c[1]=this.pos[1]+this.dir[1]*m,c[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(i,o,c){if(V=(F=this.pos)[0],j=F[1],W=F[2],Q=(L=i)[0],J=L[1],te=L[2],Math.abs(V-Q)<=tr*Math.max(1,Math.abs(V),Math.abs(Q))&&Math.abs(j-J)<=tr*Math.max(1,Math.abs(j),Math.abs(J))&&Math.abs(W-te)<=tr*Math.max(1,Math.abs(W),Math.abs(te))||0===o)return c[0]=c[1]=c[2]=0,!1;var F,L,V,j,W,Q,J,te;const[h,m,g]=this.dir,x=this.pos[0]-i[0],E=this.pos[1]-i[1],T=this.pos[2]-i[2],I=h*h+m*m+g*g,A=2*(x*h+E*m+T*g),M=A*A-4*I*(x*x+E*E+T*T-o*o);if(M<0){const F=Math.max(-A/2,0),L=x+h*F,V=E+m*F,j=T+g*F,W=Math.hypot(L,V,j);return c[0]=L*o/W,c[1]=V*o/W,c[2]=j*o/W,!1}{const F=(-A-Math.sqrt(M))/(2*I);if(F<0){const L=Math.hypot(x,E,T);return c[0]=x*o/L,c[1]=E*o/L,c[2]=T*o/L,!1}return c[0]=x+h*F,c[1]=E+m*F,c[2]=T+g*F,!0}}}class Fn{constructor(i,o,c,h,m){this.TL=i,this.TR=o,this.BR=c,this.BL=h,this.horizon=m}static fromInvProjectionMatrix(i,o,c){const h=[-1,1,1],m=[1,1,1],g=[1,-1,1],x=[-1,-1,1],E=lr(h,h,i),T=lr(m,m,i),I=lr(g,g,i),A=lr(x,x,i);return new Fn(E,T,I,A,o/c)}}function ni(a,i,o){let c=1/0,h=-1/0;const m=[];for(const g of a){cr(m,g,i);const x=ar(m,o);c=Math.min(c,x),h=Math.max(h,x)}return[c,h]}function dn(a,i){let o=!0;for(let c=0;c<a.planes.length;c++){const h=a.planes[c];let m=0;for(let g=0;g<i.length;g++)m+=ar(h,i[g])+h[3]>=0;if(0===m)return 0;m!==i.length&&(o=!1)}return o?2:1}function Ln(a,i){for(const o of a.projections){const c=ni(i,a.points[0],o.axis);if(o.projection[1]<c[0]||o.projection[0]>c[1])return 0}return 1}function zn(a,i){let o=0;const c=[0,0,0,0];for(let g=0;g<a.length;g++)c[0]=a[g][0],c[1]=a[g][1],c[2]=a[g][2],c[3]=1,(h=c)[0]*(m=i)[0]+h[1]*m[1]+h[2]*m[2]+h[3]*m[3]>=0&&o++;var h,m;return o}class In{constructor(i,o){this.points=i||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=an.fromPoints(this.points),this.projections=[],this.frustumEdges=[cr([],this.points[2],this.points[3]),cr([],this.points[0],this.points[3]),cr([],this.points[4],this.points[0]),cr([],this.points[5],this.points[1]),cr([],this.points[6],this.points[2]),cr([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const h=[0,-c[2],c[1]],m=[c[2],0,-c[0]];this.projections.push({axis:h,projection:ni(this.points,this.points[0],h)}),this.projections.push({axis:m,projection:ni(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(i,o,c,h){const m=Math.pow(2,c),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const I=bs([],T,i),A=1/I[3]/o*m;return(M=I)[0]=(F=I)[0]*(L=[A,A,h?1/I[3]:A,A])[0],M[1]=F[1]*L[1],M[2]=F[2]*L[2],M[3]=F[3]*L[3],M;var M,F,L}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const I=Mi([],gi([],cr([],g[T[0]],g[T[1]]),cr([],g[T[2]],g[T[1]]))),A=-ar(I,g[T[1]]);return I.concat(A)}),E=[];for(let T=0;T<g.length;T++)E.push([g[T][0],g[T][1],g[T][2]]);return new In(E,x)}intersectsPrecise(i,o,c){for(let h=0;h<o.length;h++)if(!zn(i,o[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!zn(i,this.planes[h]))return 0;for(const h of c)for(const m of this.frustumEdges){const g=gi([],h,m),x=go(g);if(0===x)continue;Fi(g,g,1/x);const E=ni(this.points,this.points[0],g),T=ni(i,this.points[0],g);if(E[0]>T[1]||T[0]>E[1])return 0}return 1}containsPoint(i){for(const o of this.planes){const c=o[3];if(ar([o[0],o[1],o[2]],i)+c<0)return!1}return!0}}class an{static fromPoints(i){const o=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const h of i)Aa(o,o,h),Vi(c,c,h);return new an(o,c)}static fromTileIdAndHeight(i,o,c){const h=1<<i.canonical.z,m=i.canonical.x,g=i.canonical.y;return new an([m/h,g/h,o],[(m+1)/h,(g+1)/h,c])}static applyTransform(i,o){const c=i.getCorners();for(let h=0;h<c.length;++h)lr(c[h],c[h],o);return an.fromPoints(c)}static applyTransformFast(i,o){const c=[o[12],o[13],o[14]],h=[...c];for(let m=0;m<3;m++)for(let g=0;g<3;g++){const x=o[4*g+m],E=x*i.min[g],T=x*i.max[g];c[m]+=Math.min(E,T),h[m]+=Math.max(E,T)}return new an(c,h)}static projectAabbCorners(i,o){const c=i.getCorners();for(let h=0;h<c.length;++h)lr(c[h],c[h],o);return c}constructor(i,o){this.min=i,this.max=o,this.center=Fi([],ki([],this.min,this.max),.5)}quadrant(i){const o=[i%2==0,i<2],c=Wa(this.min),h=Wa(this.max);for(let m=0;m<o.length;m++)c[m]=o[m]?this.min[m]:this.center[m],h[m]=o[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new an(c,h)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,o=this.max;return[[i[0],i[1],i[2]],[o[0],i[1],i[2]],[o[0],o[1],i[2]],[i[0],o[1],i[2]],[i[0],i[1],o[2]],[o[0],i[1],o[2]],[o[0],o[1],o[2]],[i[0],o[1],o[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?dn(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?dn(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,o){return o||this.intersects(i)?Ln(i,this.getCorners()):0}intersectsPreciseFlat(i,o){return o||this.intersectsFlat(i)?Ln(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let o=0;o<3;++o)if(this.min[o]>i.max[o]||i.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],i.min[o]),this.max[o]=Math.max(this.max[o],i.max[o])}encapsulatePoint(i){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],i[o]),this.max[o]=Math.max(this.max[o],i[o])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}Et(an,"Aabb");class ii{constructor(i,o){this.feature=i,this.metersToTile=o,this.index=0}get(){const i=this.feature.vertices[this.index],o=this.feature.vertexProps[this.index].dir,c=o[1],h=-o[0],m=(i.extent+1)*this.metersToTile;return[new Qe(Math.trunc(i.position[0]+c*m),Math.trunc(i.position[1]+h*m)),new Qe(Math.trunc(i.position[0]-c*m),Math.trunc(i.position[1]-h*m))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class qn{constructor(i,o,c,h,m,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=i,this.heightRange={min:c,max:c},this.safeArea=o,this.constantHeight=c,null==this.constantHeight&&(null!=this.constantHeight||0!==h.length)){this.vertices=h,this.edges=m,this.edges=this.edges.filter(x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((E=this.vertices[x.a].position)[0]===(T=this.vertices[x.b].position)[0]&&E[1]===T[1]);var E,T}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:Zr(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const E=this.vertices[x.a].position,T=this.vertices[x.b].position,I=Ja(Po(),T,E),A=Ul(I),M=Qa(Po(),I,1/A);this.edgeProps.push({vec:I,dir:M,len:A});const F=this.vertexProps[x.a].dir,L=this.vertexProps[x.b].dir;Ka(F,F,M),Ka(L,L,M)}for(const x of this.vertexProps)0===x.dir[0]&&0===x.dir[1]||Pu(x.dir,x.dir);this.tessellate(g)}}pointElevation(i){if(null!=this.constantHeight)return this.constantHeight;const o=this.getClosestEdge(i);if(null==o)return 0;const[c,h]=o;return Nt(this.vertices[this.edges[c].a].height,this.vertices[this.edges[c].b].height,h)}computeSlopeNormal(i,o){const c=this.getClosestEdge(i);if(!c)return gr(0,0,1);const h=c[0],m=this.edges[h],g=this.edgeProps[h].vec,x=gr(g[0],g[1],(this.vertices[m.b].height-this.vertices[m.a].height)*o),E=gr(x[1],-x[0],0);gi(E,E,x);const T=go(E);return T>0?Fi(E,E,1/T):gr(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(i){if(0===this.edges.length)return;let o=0,c=Number.POSITIVE_INFINITY,h=0;const m=Zr(i.x,i.y);for(let g=0;g<this.edges.length;g++){const x=this.edges[g],E=this.edgeProps[g].dir,T=new Jt(m,this.edgeProps[g].dir),I=this.vertices[x.a].position,A=this.vertices[x.b].position,M=Po(),F=Po(),L=T.intersectsPlane(I,this.vertexProps[x.a].dir,M),V=T.intersectsPlane(A,this.vertexProps[x.b].dir,F);if(!L||!V)continue;const j=Ja(Po(),F,M),W=Ja(Po(),m,M),Q=Ci(j,j),J=Q>0?Ci(W,j)/Q:0,te=se(J,0,1),me=Math.abs((J-te)*this.edgeProps[g].len),he=Ja(Po(),m,I),fe=me+Math.abs(Ci(he,Zr(E[1],-E[0])));fe<c&&(o=g,c=fe,h=te)}return[o,h]}tessellate(i){for(let o=this.edges.length-1;o>=0;--o){const c=this.edges[o].a,h=this.edges[o].b,{position:m,height:g,extent:x}=this.vertices[c],{position:E,height:T,extent:I}=this.vertices[h],A=this.vertexProps[c].dir,M=this.vertexProps[h].dir,F=gr(m[0]/i,m[1]/i,g),L=gr(E[0]/i,E[1]/i,T),V=gr(A[1],-A[0],0);Fi(V,V,x);const j=gr(M[1],-M[0],0);if(Fi(j,j,I),this.distSqLines(gr(F[0]+.5*V[0],F[1]+.5*V[1],F[2]+.5*V[2]),gr(L[0]-.5*j[0],L[1]-.5*j[1],L[2]-.5*j[2]),gr(F[0]-.5*V[0],F[1]-.5*V[1],F[2]-.5*V[2]),gr(L[0]+.5*j[0],L[1]+.5*j[1],L[2]+.5*j[2]))<=.0025000000000000005)continue;const W=this.vertices.length,Q=Ka(Po(),m,E);this.vertices.push({position:Qa(Q,Q,.5),height:.5*(g+T),extent:.5*(x+I)});const J=Ka(Po(),A,M);this.vertexProps.push({dir:Pu(J,J)}),this.edges.splice(o,1),this.edgeProps.splice(o,1),this.edges.push({a:c,b:W}),this.edges.push({a:W,b:h});const te=Ja(Po(),this.vertices[W].position,m),me=Ul(te),he={vec:te,dir:Qa(Po(),te,1/me),len:me};this.edgeProps.push(he),this.edgeProps.push(he)}}distSqLines(i,o,c,h){const m=oo(Un(),o,i),g=oo(Un(),h,c),x=oo(Un(),i,c),E=ar(m,m),T=ar(m,g),I=ar(m,x),A=ar(g,g),M=ar(g,x),F=E*A-T*T;if(0===F){const j=ar(x,g)/ar(g,g);return Iu(nr(Un(),c,h,j),i)}const L=(T*M-I*A)/F,V=(E*M-T*I)/F;return Iu(nr(Un(),i,o,L),nr(Un(),c,h,V))}}class Ni{static parseFrom(i,o){const c=Dn.parse(i);if(!c)return[];let{vertices:h,features:m}=c;const g=1/ce(o);m.sort((I,A)=>I.id-A.id),h.sort((I,A)=>I.id-A.id||I.idx-A.idx),h=h.filter((I,A,M)=>A===M.findIndex(F=>F.id===I.id&&F.idx===I.idx));const x=new Array;let E=0;const T=h.length;for(const I of m){if(I.constantHeight){x.push(new qn(I.id,I.bounds,I.constantHeight));continue}for(;E!==T&&h[E].id<I.id;)E++;if(E===T||h[E].id!==I.id)continue;const A=new Array,M=new Array,F=E;for(;E!==T&&h[E].id===I.id;){const L=h[E];if(A.push({position:L.position,height:L.height,extent:L.extent}),E!==F&&h[E-1].idx===L.idx-1){const V=E-F;M.push({a:V-1,b:V})}E++}x.push(new qn(I.id,I.bounds,void 0,A,M,g))}return x}static getElevationFeature(i,o){if(!o)return;const c=+i.properties[vt];return Number.isNaN(c)?void 0:o.find(h=>h.id===c)}}class Pn{constructor(i,o){this.zScale=1,this.xOffset=0,this.yOffset=0,i.equals(o)||(this.zScale=Math.pow(2,o.z-i.z),this.xOffset=(i.x*this.zScale-o.x)*ft,this.yOffset=(i.y*this.zScale-o.y)*ft)}constantElevation(i,o){if(null!=i.constantHeight)return this.computeBiasedHeight(i.constantHeight,o)}pointElevation(i,o,c){return this.constantElevation(o,c)??(i.x=i.x*this.zScale+this.xOffset,i.y=i.y*this.zScale+this.yOffset,this.computeBiasedHeight(o.pointElevation(i),c))}computeBiasedHeight(i,o){return o<=0?i:i+o*we(0,o,i>=0?i:Math.abs(.5*i))}}Et(qn,"ElevationFeature");class Zn{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Ss,this.indexArray=new Pi,this.segments=new Wi,this.programConfigurations=new Is(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,"none"!==this.elevationMode&&(this.elevatedLayoutVertexArray=new hs),this.worldview=i.worldview}updateFootprints(i,o){}populate(i,o,c,h){const m=this.layers[0],g=[];let x=null;"circle"===m.type&&(x=m.layout.get("circle-sort-key"));for(const{feature:T,id:I,index:A,sourceLayerIndex:M}of i){const F=this.layers[0]._featureFilter.needGeometry,L=Ne(T,F);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom,{worldview:this.worldview}),L,c))continue;const V=x?x.evaluate(L,{},c):void 0,j={id:I,properties:T.properties,type:T.type,sourceLayerIndex:M,index:A,geometry:F?L.geometry:_e(T,c,h),patterns:{},sortKey:V};g.push(j)}x&&g.sort((T,I)=>T.sortKey-I.sortKey);let E=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new id,E=h.projection);for(const T of g){const{geometry:I,index:A,sourceLayerIndex:M}=T,F=i[A].feature;this.addFeature(T,I,A,o.availableImages,c,E,o.brightness,o.elevationFeatures),o.featureIndex.insert(F,I,A,M,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(i,o,c,h,m,g,x){this.programConfigurations.updatePaintArrays(i,o,m,c,h,g,x,this.worldview)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Bv.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,jv.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,Vv.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(i,o,c,h,m,g,x,E){let T;"none"!==this.elevationMode&&(T=Ni.getElevationFeature(i,E));for(const I of o)for(const A of I){const M=A.x,F=A.y;if(M<0||M>=ft||F<0||F>=ft)continue;if(g){const j=g.projectTilePoint(M,F,m),W=g.upVector(m,M,F);this.addGlobeExtVertex(j,W),this.addGlobeExtVertex(j,W),this.addGlobeExtVertex(j,W),this.addGlobeExtVertex(j,W)}const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),V=L.vertexLength;if(this.addCircleVertex(M,F,-1,-1),this.addCircleVertex(M,F,1,-1),this.addCircleVertex(M,F,1,1),this.addCircleVertex(M,F,-1,1),"none"!==this.elevationMode){const j=T?T.pointElevation(new Qe(M,F)):0;this.hasElevation=this.hasElevation||0!==j;for(let W=0;W<4;W++)this.elevatedLayoutVertexArray.emplaceBack(j)}this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+2,V+3),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,{},h,m,x,void 0,this.worldview)}addCircleVertex(i,o,c,h){this.layoutVertexArray.emplaceBack(2*i+(c+1)/2,2*o+(h+1)/2)}addGlobeExtVertex(i,o){this.globeExtVertexArray.emplaceBack(i.x,i.y,i.z,16384*o[0],16384*o[1],16384*o[2])}}function hi(a,i){for(let o=0;o<a.length;o++)if(Do(i,a[o]))return!0;for(let o=0;o<i.length;o++)if(Do(a,i[o]))return!0;return!!qr(a,i)}function xr(a,i,o){return!!Do(a,i)||!!uo(i,a,o)}function fr(a,i){if(1===a.length)return ra(i,a[0]);for(let o=0;o<i.length;o++){const c=i[o];for(let h=0;h<c.length;h++)if(Do(a,c[h]))return!0}for(let o=0;o<a.length;o++)if(ra(i,a[o]))return!0;for(let o=0;o<i.length;o++)if(qr(a,i[o]))return!0;return!1}function or(a,i,o){if(a.length>1){if(qr(a,i))return!0;for(let c=0;c<i.length;c++)if(uo(i[c],a,o))return!0}for(let c=0;c<a.length;c++)if(uo(a[c],i,o))return!0;return!1}function qr(a,i){if(0===a.length||0===i.length)return!1;for(let o=0;o<a.length-1;o++){const c=a[o],h=a[o+1];for(let m=0;m<i.length-1;m++)if(ba(c,h,i[m],i[m+1]))return!0}return!1}function ba(a,i,o,c){return ir(a,o,c)!==ir(i,o,c)&&ir(a,i,o)!==ir(a,i,c)}function No(a,i,o){return(a.x-o.x)*(i.y-o.y)-(a.y-o.y)*(i.x-o.x)}function qs(a,i,o,c){const h=No(a,i,c),m=No(a,i,o);if(Math.sign(h)===Math.sign(m))return;const g=No(o,c,a),x=g+m-h;return Math.sign(g)!==Math.sign(x)?[g/(g-x),m/(m-h)]:void 0}function uo(a,i,o){const c=o*o;if(1===i.length)return a.distSqr(i[0])<c;for(let h=1;h<i.length;h++)if(ia(a,i[h-1],i[h])<c)return!0;return!1}function ia(a,i,o){const c=i.distSqr(o);if(0===c)return a.distSqr(i);const h=((a.x-i.x)*(o.x-i.x)+(a.y-i.y)*(o.y-i.y))/c;return a.distSqr(h<0?i:h>1?o:o.sub(i)._mult(h)._add(i))}function ra(a,i){let o,c,h,m=!1;for(let g=0;g<a.length;g++){o=a[g];for(let x=0,E=o.length-1;x<o.length;E=x++)c=o[x],h=o[E],c.y>i.y!=h.y>i.y&&i.x<(h.x-c.x)*(i.y-c.y)/(h.y-c.y)+c.x&&(m=!m)}return m}function Do(a,i){let o=!1;for(let c=0,h=a.length-1;c<a.length;h=c++){const m=a[c],g=a[h];m.y>i.y!=g.y>i.y&&i.x<(g.x-m.x)*(i.y-m.y)/(g.y-m.y)+m.x&&(o=!o)}return o}function Qi(a,i,o,c,h){for(const g of a)if(i<=g.x&&o<=g.y&&c>=g.x&&h>=g.y)return!0;const m=[new Qe(i,o),new Qe(i,h),new Qe(c,h),new Qe(c,o)];if(a.length>2)for(const g of m)if(Do(a,g))return!0;for(let g=0;g<a.length-1;g++)if(rr(a[g],a[g+1],m))return!0;return!1}function rr(a,i,o){const c=o[0],h=o[2];if(a.x<c.x&&i.x<c.x||a.x>h.x&&i.x>h.x||a.y<c.y&&i.y<c.y||a.y>h.y&&i.y>h.y)return!1;const m=ir(a,i,o[0]);return m!==ir(a,i,o[1])||m!==ir(a,i,o[2])||m!==ir(a,i,o[3])}function Ei(a,i,o,c,h,m){let g=i.y-a.y,x=a.x-i.x;if(m=m||0){const E=g*g+x*x;if(0===E)return!0;const T=Math.sqrt(E);g/=T,x/=T}return!((o.x-a.x)*g+(o.y-a.y)*x-m<0||(c.x-a.x)*g+(c.y-a.y)*x-m<0||(h.x-a.x)*g+(h.y-a.y)*x-m<0)}function Sr(a,i,o,c,h,m,g){return!(Ei(a,i,c,h,m,g)||Ei(i,o,c,h,m,g)||Ei(o,a,c,h,m,g)||Ei(c,h,a,i,o,g)||Ei(h,m,a,i,o,g)||Ei(m,c,a,i,o,g))}function ho(a,i,o){const c=i.paint.get(a).value;return"constant"===c.kind?c.value:o.programConfigurations.get(i.id).getMaxValue(a)}function pr(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function oa(a,i,o,c,h){if(!i[0]&&!i[1])return a;const m=Qe.convert(i)._mult(h);"viewport"===o&&m._rotate(-c);const g=[];for(let x=0;x<a.length;x++)g.push(a[x].sub(m));return g}function ud(a,i,o,c){const h=Qe.convert(a)._mult(c);return"viewport"===i&&h._rotate(-o),h}let su,dd;function vl(a,i,o){var c=2*Math.PI*6378137/256/Math.pow(2,o);return[a*c-2*Math.PI*6378137/2,i*c-2*Math.PI*6378137/2]}Et(Zn,"CircleBucket",{omit:["layers"]});class Zo{constructor(i,o,c){this.z=i,this.x=o,this.y=c,this.key=As(0,i,i,o,c)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}isChildOf(i){const o=this.z-i.z;return 0===i.z||i.z<this.z&&i.x===this.x>>o&&i.y===this.y>>o}url(i,o){const c=(g=this.y,x=this.z,E=vl(256*(m=this.x),256*(g=Math.pow(2,x)-g-1),x),T=vl(256*(m+1),256*(g+1),x),E[0]+","+E[1]+","+T[0]+","+T[1]),h=function(m,g,x){let E,T="";for(let I=m;I>0;I--)E=1<<I-1,T+=(g&E?1:0)+(x&E?2:0);return T}(this.z,this.x,this.y);var m,g,x,E,T;return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===o?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class wa{constructor(i,o){this.wrap=i,this.canonical=o,this.key=As(i,o.z,o.z,o.x,o.y)}}class Mr{constructor(i,o,c,h,m){this.overscaledZ=i,this.wrap=o,this.canonical=new Zo(c,+h,+m),this.key=0===o&&i===c?this.canonical.key:As(o,i,c,h,m)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const o=this.canonical.z-i;return i>this.canonical.z?new Mr(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Mr(i,this.wrap,i,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(i,o=!0){if(this.overscaledZ===i&&o)return this.key;if(i>this.canonical.z)return As(this.wrap*+o,i,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-i;return As(this.wrap*+o,i,i,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const o=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>o&&i.canonical.y===this.canonical.y>>o}children(i){if(this.overscaledZ>=i)return[new Mr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,c=2*this.canonical.x,h=2*this.canonical.y;return[new Mr(o,this.wrap,o,c,h),new Mr(o,this.wrap,o,c+1,h),new Mr(o,this.wrap,o,c,h+1),new Mr(o,this.wrap,o,c+1,h+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Mr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Mr(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new wa(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function As(a,i,o,c,h){const m=1<<Math.min(o,22);let g=m*(h%m)+c%m;return a&&o<22&&(g+=m*m*((a<0?-2*a-1:2*a)%(1<<2*(22-o)))),16*(32*g+o)+(i-o)}const sa=[a=>{let i=a.canonical.x-1,o=a.wrap;return i<0&&(i=(1<<a.canonical.z)-1,o--),new Mr(a.overscaledZ,o,a.canonical.z,i,a.canonical.y)},a=>{let i=a.canonical.x+1,o=a.wrap;return i===1<<a.canonical.z&&(i=0,o++),new Mr(a.overscaledZ,o,a.canonical.z,i,a.canonical.y)},a=>new Mr(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(0===a.canonical.y?1<<a.canonical.z:a.canonical.y)-1),a=>new Mr(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];Et(Zo,"CanonicalTileID"),Et(Mr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const lb=En([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Nm}=lb,P_=En([{name:"a_pos_3",components:3,type:"Int16"}]);var zm=En([{name:"a_pos",type:"Int16",components:2}]);function xl(a){return a*Zi/D}const SE=[new an([y,y,y],[v,v,v]),new an([y,y,y],[0,0,v]),new an([0,y,y],[v,0,v]),new an([y,0,y],[0,v,v]),new an([0,0,y],[v,v,v])];function cb(a,i,o,c=!0){const h=Fi([],a._camera.position,a.worldSize),m=[i,o,1,1];bs(m,m,a.pixelMatrixInverse),Za(m,m,1/m[3]);const g=Mi([],cr([],m,h)),x=a.globeMatrix,E=[x[12],x[13],x[14]],T=cr([],E,h),I=go(T),A=Mi([],T),M=a.worldSize/(2*Math.PI),F=ar(A,g),L=Math.asin(M/I);if(L<Math.acos(F)){if(!c)return null;const je=[],De=[];Fi(je,g,I/F),Mi(De,cr(De,je,T)),Mi(g,ki(g,T,Fi(g,De,Math.tan(L)*I)))}const V=[];new Mn(h,g).closestPointOnSphere(E,M,V);const j=Mi([],ji(x,0)),W=Mi([],ji(x,1)),Q=Mi([],ji(x,2)),J=ar(j,V),te=ar(W,V),me=ar(Q,V),he=Pe(Math.asin(-te/M));let fe=Pe(Math.atan2(J,me));fe=a.center.lng+function(je,De){const He=(De-je+180)%360-180;return He<-180?He+360:He}(a.center.lng,fe);const be=U(fe),Ee=se(q(he),0,1);return new ue(be,Ee)}class DE{constructor(i,o,c){this.a=cr([],i,c),this.b=cr([],o,c),this.center=c;const h=Mi([],this.a),m=Mi([],this.b);this.angle=Math.acos(ar(h,m))}}function R_(a,i){if(0===a.angle)return null;let o;return o=0===a.a[i]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[i]/a.a[i]/Math.sin(a.angle)-1/Math.tan(a.angle)),o<0||o>1?null:function(c,h,m,g){const x=Math.sin(m);return c*(Math.sin((1-g)*m)/x)+h*(Math.sin(g*m)/x)}(a.a[i],a.b[i],a.angle,se(o,0,1))+a.center[i]}function ja(a){if(a.z<=1)return SE[a.z+2*a.y+a.x];const i=$v(Bm(a));return an.fromPoints(i)}function au(a,i,o){return Fi(a,a,1-o),Ho(a,a,i,o)}function ub(a,i,o){for(const c of a)lr(c,c,i),Fi(c,c,o)}function db(a,i,o,c){const h=i/a.worldSize,m=a.globeMatrix;if(o.z<=1){const Ee=ja(o).getCorners();return ub(Ee,m,h),an.fromPoints(Ee)}const g=Bm(o,c),x=$v(g,Zi+xl(a._tileCoverLift));ub(x,m,h);const E=Number.MAX_VALUE,T=[-E,-E,-E],I=[E,E,E];if(g.contains(a.center)){for(const De of x)Aa(I,I,De),Vi(T,T,De);T[2]=0;const Ee=a.point,je=[Ee.x*h,Ee.y*h,0];return Aa(I,I,je),Vi(T,T,je),new an(I,T)}if(a._tileCoverLift>0){for(const Ee of x)Aa(I,I,Ee),Vi(T,T,Ee);return new an(I,T)}const A=[m[12]*h,m[13]*h,m[14]*h],M=g.getCenter(),F=se(a.center.lat,-le,le),L=se(M.lat,-le,le),V=U(a.center.lng),j=q(F);let W=V-U(M.lng);const Q=j-q(L);W>.5?W-=1:W<-.5&&(W+=1);let J=0;Math.abs(W)>Math.abs(Q)?J=W>=0?1:3:(J=Q>=0?0:2,Ho(A,A,[m[4]*h,m[5]*h,m[6]*h],-Math.sin(Rn(Q>=0?g.getSouth():g.getNorth()))*Zi));const te=x[J],me=x[(J+1)%4],he=new DE(te,me,A),fe=[R_(he,0)||te[0],R_(he,1)||te[1],R_(he,2)||te[2]],be=lu(a.zoom);if(be>0){const Ee=function({x:De,y:He,z:ot},$e,Ke,nt,Be){const Je=1/(1<<ot);let Ae=De*Je,Ve=Ae+Je,at=He*Je,et=at+Je,kt=0;const Dt=(Ae+Ve)/2-nt;return Dt>.5?kt=-1:Dt<-.5&&(kt=1),Ae=((Ae+kt)*$e-(nt*=$e))*Ke+nt,Ve=((Ve+kt)*$e-nt)*Ke+nt,at=(at*$e-(Be*=$e))*Ke+Be,et=(et*$e-Be)*Ke+Be,[[Ae,et,0],[Ve,et,0],[Ve,at,0],[Ae,at,0]]}(o,i,a._pixelsPerMercatorPixel,V,j);for(let De=0;De<x.length;De++)au(x[De],Ee[De],be);const je=ki([],Ee[J],Ee[(J+1)%4]);Fi(je,je,.5),au(fe,je,be)}for(const Ee of x)Aa(I,I,Ee),Vi(T,T,Ee);return I[2]=Math.min(te[2],me[2]),Aa(I,I,fe),Vi(T,T,fe),new an(I,T)}function Bm({x:a,y:i,z:o},c=!1){const h=1/(1<<o),m=new O(K(a*h),i===(1<<o)-1&&c?-90:ee((i+1)*h)),g=new O(K((a+1)*h),0===i&&c?90:ee(i*h));return new N(m,g)}function $v(a,i=Zi){const o=Rn(a.getNorth()),c=Rn(a.getSouth()),h=Math.cos(o),m=Math.cos(c),g=Math.sin(o),x=Math.sin(c),E=a.getWest(),T=a.getEast();return[b(m,x,E,i),b(m,x,T,i),b(h,g,T,i),b(h,g,E,i)]}function Vm(a,i,o,c){const h=1<<o.z,m=(a/ft+o.x)/h;return C(ee((i/ft+o.y)/h),K(m),c)}function ms({min:a,max:i}){return r/Math.max(i[0]-a[0],i[1]-a[1],i[2]-a[2])}const O_=new Float64Array(16);function jm(a){const i=ms(a),o=Bl(O_,[i,i,i]);return Uo(o,o,Gi([],a.min))}function Um(a){const i=(c=a.min,(o=O_)[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=c[0],o[13]=c[1],o[14]=c[2],o[15]=1,o);var o,c;const h=1/ms(a);return ro(i,i,[h,h,h])}function Xo(a){const i=ft/(2*Math.PI);return a/(2*Math.PI)/i}function Qf(a,i){return ft/(512*Math.pow(2,a))*ms(ja(i))}function qv(a,i,o,c,h){const m=Xo(o),g=[a,i,-o/(2*Math.PI)],x=pn(new Float64Array(16));return Uo(x,x,g),ro(x,x,[m,m,m]),vs(x,x,Rn(-h)),Zs(x,x,Rn(-c)),x}function lu(a){return we(Jf,f,a)}function hb(a,i){const o=C(i.lat,i.lng);return g=(h=oo([],function(L){const V=C(L._center.lat,L._center.lng);let j=gi([],gr(0,1,0),V);const W=da([],-L.angle,V);j=lr(j,j,W),da(W,-L._pitch,j);const Q=Mi([],V);return Fi(Q,Q,xl(L.cameraToCenterDistance/L.pixelsPerMeter)),lr(Q,Q,W),ki([],V,Q)}(a),o))[0],x=h[1],E=h[2],T=(m=o)[0],I=m[1],A=m[2],F=(M=Math.sqrt(g*g+x*x+E*E)*Math.sqrt(T*T+I*I+A*A))&&ar(h,m)/M,Math.acos(Math.min(Math.max(F,-1),1));var h,m,g,x,E,T,I,A,M,F}function k_(a,i){return hb(a,i)>Math.PI/2*1.01}const fb=Rn(85),pb=Math.cos(fb),IE=Math.sin(fb),mb=Nl(),gb=a=>{const i=[];return"map"===a.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===a.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i};function _b(a,i,o,c,h,m,g,x,E){if(m&&a.queryGeometry.isAboveHorizon)return!1;m&&(E*=a.pixelToTileUnitsFactor);const T=a.tileID.canonical,I=o.projection.upVectorScale(T,o.center.lat,o.worldSize).metersToTile;for(const A of i)for(const M of A){const F=M.add(x),L=h&&o.elevation?o.elevation.exaggeration()*h.getElevationAt(F.x,F.y,!0):0,V=o.projection.projectTilePoint(F.x,F.y,T);if(L>0){const J=o.projection.upVector(T,F.x,F.y);V.x+=J[0]*I*L,V.y+=J[1]*I*L,V.z+=J[2]*I*L}const j=m?F:Wv(V.x,V.y,V.z,c),W=m?a.tilespaceRays.map(J=>Hm(J,L)):a.queryGeometry.screenGeometry,Q=bs([],[V.x,V.y,V.z,1],c);if(!g&&m?E*=Q[3]/o.cameraToCenterDistance:g&&!m&&(E*=o.cameraToCenterDistance/Q[3]),m){const J=ee((M.y/ft+T.y)/(1<<T.z));E/=o.projection.pixelsPerMeter(J,1)/$(1,J)}if(xr(W,j,E))return!0}return!1}function Wv(a,i,o,c){const h=bs([],[a,i,o,1],c);return new Qe(h[0]/h[3],h[1]/h[3])}const F_=gr(0,0,0),AE=gr(0,0,1);function Hm(a,i){const o=Un();return F_[2]=i,a.intersectsPlane(F_,AE,o),new Qe(o[0],o[1])}class yb extends Zn{}let vb,Zv,Xv,Yv;function Dh(a,{width:i,height:o},c,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==i*o*c)throw new RangeError("mismatched image size")}else h=new Uint8Array(i*o*c);return a.width=i,a.height=o,a.data=h,a}function Gm(a,i,o){const{width:c,height:h}=i;c===a.width&&h===a.height||(L_(a,i,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,c),height:Math.min(a.height,h)},o,null),a.width=c,a.height=h,a.data=i.data)}function L_(a,i,o,c,h,m,g,x){if(0===h.width||0===h.height)return i;if(h.width>a.width||h.height>a.height||o.x>a.width-h.width||o.y>a.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>i.width||h.height>i.height||c.x>i.width-h.width||c.y>i.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const E=a.data,T=i.data,I=4===m&&x;for(let A=0;A<h.height;A++){const M=((o.y+A)*a.width+o.x)*m,F=((c.y+A)*i.width+c.x)*m;if(I)for(let L=0;L<h.width;L++){const V=M+L*m+3,j=F+L*m;T[j+0]=255,T[j+1]=255,T[j+2]=255,T[j+3]=E[V]}else if(g)for(let L=0;L<h.width;L++){const V=M+L*m,j=F+L*m,W=new Jn(E[V+0]/255,E[V+1]/255,E[V+2]/255,E[V+3]).toNonPremultipliedRenderColor(g).toArray();T[j+0]=W[0],T[j+1]=W[1],T[j+2]=W[2],T[j+3]=W[3]}else for(let L=0;L<h.width*m;L++)T[F+L]=E[M+L]}return i}Et(yb,"HeatmapBucket",{omit:["layers"]});class hc{constructor(i,o){Dh(this,i,1,o)}resize(i){Gm(this,new hc(i),1)}clone(){return new hc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,o,c,h,m){L_(i,o,c,h,m,1,null)}}class Wr{constructor(i,o){Dh(this,i,4,o)}resize(i){Gm(this,new Wr(i),4)}replace(i,o){o?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Wr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,o,c,h,m,g,x){L_(i,o,c,h,m,4,g,x)}}class xb{constructor(i,o){this.width=i.width,this.height=i.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}function $m(a){const i={},o=a.resolution||256,c=a.clips?a.clips.length:1,h=a.image||new Wr({width:o,height:c}),m=(g,x,E)=>{i[a.evaluationKey]=E;const T=a.expression.evaluate(i),I=T?T.toNonPremultipliedRenderColor(null):null;I&&(h.data[g+x+0]=Math.floor(255*I.r),h.data[g+x+1]=Math.floor(255*I.g),h.data[g+x+2]=Math.floor(255*I.b),h.data[g+x+3]=Math.floor(255*I.a))};if(a.clips)for(let g=0,x=0;g<c;++g,x+=4*o)for(let E=0,T=0;E<o;E++,T+=4){const I=E/(o-1),{start:A,end:M}=a.clips[g];m(x,T,A*(1-I)+M*I)}else for(let g=0,x=0;g<o;g++,x+=4)m(0,x,g/(o-1));return h}Et(hc,"AlphaImage"),Et(Wr,"RGBAImage");const ME=En([{name:"a_pos",components:2,type:"Int16"}],4),PE=En([{name:"a_road_z_offset",components:1,type:"Float32"}],4),RE=En([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),OE=En([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Ih(a,i,o=2){const c=i&&i.length,h=c?i[0]*o:a.length;let m=qm(a,0,h,o,!0);const g=[];if(!m||m.next===m.prev)return g;let x,E,T;if(c&&(m=function(I,A,M,F){const L=[];for(let V=0,j=A.length;V<j;V++){const W=qm(I,A[V]*F,V<j-1?A[V+1]*F:I.length,F,!1);W===W.next&&(W.steiner=!0),L.push(ND(W))}L.sort(Mh);for(let V=0;V<L.length;V++)M=wb(L[V],M);return M}(a,i,m,o)),a.length>80*o){x=a[0],E=a[1];let I=x,A=E;for(let M=o;M<h;M+=o){const F=a[M],L=a[M+1];F<x&&(x=F),L<E&&(E=L),F>I&&(I=F),L>A&&(A=L)}T=Math.max(I-x,A-E),T=0!==T?32767/T:0}return Ah(m,g,o,x,E,T,0),g}function qm(a,i,o,c,h){let m;if(h===function(g,x,E,T){let I=0;for(let A=x,M=E-T;A<E;A+=T)I+=(g[M]-g[A])*(g[A+1]+g[M+1]),M=A;return I}(a,i,o,c)>0)for(let g=i;g<o;g+=c)m=z_(g/c|0,a[g],a[g+1],m);else for(let g=o-c;g>=i;g-=c)m=z_(g/c|0,a[g],a[g+1],m);return m&&Ph(m,m.next)&&(hd(m),m=m.next),m}function cu(a,i){if(!a)return a;i||(i=a);let o,c=a;do{if(o=!1,c.steiner||!Ph(c,c.next)&&0!==jr(c.prev,c,c.next))c=c.next;else{if(hd(c),c=i=c.prev,c===c.next)break;o=!0}}while(o||c!==i);return i}function Ah(a,i,o,c,h,m,g){if(!a)return;!g&&m&&function(E,T,I,A){let M=E;do{0===M.z&&(M.z=Jv(M.x,M.y,T,I,A)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next}while(M!==E);M.prevZ.nextZ=null,M.prevZ=null,function(F){let L,V=1;do{let j,W=F;F=null;let Q=null;for(L=0;W;){L++;let J=W,te=0;for(let he=0;he<V&&(te++,J=J.nextZ,J);he++);let me=V;for(;te>0||me>0&&J;)0!==te&&(0===me||!J||W.z<=J.z)?(j=W,W=W.nextZ,te--):(j=J,J=J.nextZ,me--),Q?Q.nextZ=j:F=j,j.prevZ=Q,Q=j;W=J}Q.nextZ=null,V*=2}while(L>1)}(M)}(a,c,h,m);let x=a;for(;a.prev!==a.next;){const E=a.prev,T=a.next;if(m?FE(a,c,h,m):kE(a))i.push(E.i,a.i,T.i),hd(a),a=T.next,x=T.next;else if((a=T)===x){g?1===g?Ah(a=Kv(cu(a),i),i,o,c,h,m,2):2===g&&bb(a,i,o,c,h,m):Ah(cu(a),i,o,c,h,m,1);break}}}function kE(a){const i=a.prev,o=a,c=a.next;if(jr(i,o,c)>=0)return!1;const h=i.x,m=o.x,g=c.x,x=i.y,E=o.y,T=c.y,I=Math.min(h,m,g),A=Math.min(x,E,T),M=Math.max(h,m,g),F=Math.max(x,E,T);let L=c.next;for(;L!==i;){if(L.x>=I&&L.x<=M&&L.y>=A&&L.y<=F&&Zm(h,x,m,E,g,T,L.x,L.y)&&jr(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function FE(a,i,o,c){const h=a.prev,m=a,g=a.next;if(jr(h,m,g)>=0)return!1;const x=h.x,E=m.x,T=g.x,I=h.y,A=m.y,M=g.y,F=Math.min(x,E,T),L=Math.min(I,A,M),V=Math.max(x,E,T),j=Math.max(I,A,M),W=Jv(F,L,i,o,c),Q=Jv(V,j,i,o,c);let J=a.prevZ,te=a.nextZ;for(;J&&J.z>=W&&te&&te.z<=Q;){if(J.x>=F&&J.x<=V&&J.y>=L&&J.y<=j&&J!==h&&J!==g&&Zm(x,I,E,A,T,M,J.x,J.y)&&jr(J.prev,J,J.next)>=0||(J=J.prevZ,te.x>=F&&te.x<=V&&te.y>=L&&te.y<=j&&te!==h&&te!==g&&Zm(x,I,E,A,T,M,te.x,te.y)&&jr(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;J&&J.z>=W;){if(J.x>=F&&J.x<=V&&J.y>=L&&J.y<=j&&J!==h&&J!==g&&Zm(x,I,E,A,T,M,J.x,J.y)&&jr(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;te&&te.z<=Q;){if(te.x>=F&&te.x<=V&&te.y>=L&&te.y<=j&&te!==h&&te!==g&&Zm(x,I,E,A,T,M,te.x,te.y)&&jr(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function Kv(a,i){let o=a;do{const c=o.prev,h=o.next.next;!Ph(c,h)&&N_(c,o,o.next,h)&&uu(c,h)&&uu(h,c)&&(i.push(c.i,o.i,h.i),hd(o),hd(o.next),o=a=h),o=o.next}while(o!==a);return cu(o)}function bb(a,i,o,c,h,m){let g=a;do{let x=g.next.next;for(;x!==g.prev;){if(g.i!==x.i&&Tb(g,x)){let E=Qv(g,x);return g=cu(g,g.next),E=cu(E,E.next),Ah(g,i,o,c,h,m,0),void Ah(E,i,o,c,h,m,0)}x=x.next}g=g.next}while(g!==a)}function Mh(a,i){let o=a.x-i.x;return 0===o&&(o=a.y-i.y,0===o)&&(o=(a.next.y-a.y)/(a.next.x-a.x)-(i.next.y-i.y)/(i.next.x-i.x)),o}function wb(a,i){const o=function(h,m){let g=m;const x=h.x,E=h.y;let T,I=-1/0;if(Ph(h,g))return g;do{if(Ph(h,g.next))return g.next;if(E<=g.y&&E>=g.next.y&&g.next.y!==g.y){const V=g.x+(E-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(V<=x&&V>I&&(I=V,T=g.x<g.next.x?g:g.next,V===x))return T}g=g.next}while(g!==m);if(!T)return null;const A=T,M=T.x,F=T.y;let L=1/0;g=T;do{if(x>=g.x&&g.x>=M&&x!==g.x&&Wm(E<F?x:I,E,M,F,E<F?I:x,E,g.x,g.y)){const V=Math.abs(E-g.y)/(x-g.x);uu(g,h)&&(V<L||V===L&&(g.x>T.x||g.x===T.x&&Eb(T,g)))&&(T=g,L=V)}g=g.next}while(g!==A);return T}(a,i);if(!o)return i;const c=Qv(o,a);return cu(c,c.next),cu(o,o.next)}function Eb(a,i){return jr(a.prev,a,i.prev)<0&&jr(i.next,a,a.next)<0}function Jv(a,i,o,c,h){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-o)*h|0)|a<<8))|a<<4))|a<<2))|a<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-c)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function ND(a){let i=a,o=a;do{(i.x<o.x||i.x===o.x&&i.y<o.y)&&(o=i),i=i.next}while(i!==a);return o}function Wm(a,i,o,c,h,m,g,x){return(h-g)*(i-x)>=(a-g)*(m-x)&&(a-g)*(c-x)>=(o-g)*(i-x)&&(o-g)*(m-x)>=(h-g)*(c-x)}function Zm(a,i,o,c,h,m,g,x){return!(a===g&&i===x)&&Wm(a,i,o,c,h,m,g,x)}function Tb(a,i){return a.next.i!==i.i&&a.prev.i!==i.i&&!function(o,c){let h=o;do{if(h.i!==o.i&&h.next.i!==o.i&&h.i!==c.i&&h.next.i!==c.i&&N_(h,h.next,o,c))return!0;h=h.next}while(h!==o);return!1}(a,i)&&(uu(a,i)&&uu(i,a)&&function(o,c){let h=o,m=!1;const g=(o.x+c.x)/2,x=(o.y+c.y)/2;do{h.y>x!=h.next.y>x&&h.next.y!==h.y&&g<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next}while(h!==o);return m}(a,i)&&(jr(a.prev,a,i.prev)||jr(a,i.prev,i))||Ph(a,i)&&jr(a.prev,a,a.next)>0&&jr(i.prev,i,i.next)>0)}function jr(a,i,o){return(i.y-a.y)*(o.x-i.x)-(i.x-a.x)*(o.y-i.y)}function Ph(a,i){return a.x===i.x&&a.y===i.y}function N_(a,i,o,c){const h=Rh(jr(a,i,o)),m=Rh(jr(a,i,c)),g=Rh(jr(o,c,a)),x=Rh(jr(o,c,i));return h!==m&&g!==x||!(0!==h||!Xm(a,o,i))||!(0!==m||!Xm(a,c,i))||!(0!==g||!Xm(o,a,c))||!(0!==x||!Xm(o,i,c))}function Xm(a,i,o){return i.x<=Math.max(a.x,o.x)&&i.x>=Math.min(a.x,o.x)&&i.y<=Math.max(a.y,o.y)&&i.y>=Math.min(a.y,o.y)}function Rh(a){return a>0?1:a<0?-1:0}function uu(a,i){return jr(a.prev,a,a.next)<0?jr(a,i,a.next)>=0&&jr(a,a.prev,i)>=0:jr(a,i,a.prev)<0||jr(a,a.next,i)<0}function Qv(a,i){const o=B_(a.i,a.x,a.y),c=B_(i.i,i.x,i.y),h=a.next,m=i.prev;return a.next=i,i.prev=a,o.next=h,h.prev=o,c.next=o,o.prev=c,m.next=c,c.prev=m,c}function z_(a,i,o,c){const h=B_(a,i,o);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function hd(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function B_(a,i,o){return{i:a,x:i,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Oh(a,i){const o=a.length;if(o<=1)return[a];const c=[];let h,m;for(let g=0;g<o;g++){const x=Ir(a[g]);0!==x&&(a[g].area=Math.abs(x),void 0===m&&(m=x<0),m===x<0?(h&&c.push(h),h=[a[g]]):h.push(a[g]))}if(h&&c.push(h),i>1)for(let g=0;g<c.length;g++)c[g].length<=i||(eo(c[g],i,1,c[g].length-1,Ym),c[g]=c[g].slice(0,i));return c}function Ym(a,i){return i.area-a.area}function Cb(a,i,o=1){if(!a)return null;const c="string"==typeof a?vo.from(a).getPrimary():a.getPrimary(),h="string"==typeof a?null:a.getSecondary();for(const m of[c,h]){if(!m)continue;const g=m.id.toString();i.has(g)||i.set(g,[]),m.scaleSelf(o),i.get(g).push(m)}return{primary:c.toString(),secondary:h?h.toString():null}}function V_(a,i,o,c){const h=c.patternDependencies;let m=!1;for(const g of i){const x=g.paint.get(`${a}-pattern`);x.isConstant()||(m=!0),Cb(x.constantOr(null),h,o)&&(m=!0)}return m}function e0(a,i,o,c,h,m){const g=m.patternDependencies;for(const x of i){const E=x.paint.get(`${a}-pattern`).value;if("constant"!==E.kind){let T=E.evaluate({zoom:c},o,{},m.availableImages);T=T&&T.name?T.name:T;const I=Cb(T,g,h);if(!I)continue;const{primary:A,secondary:M}=I;A&&(o.patterns[x.id]=[A,M].filter(Boolean))}}return o}class Sb{constructor(){this.polygons=new Map}add(i,...o){this.polygons.has(i)?this.polygons.get(i).push(...o):this.polygons.set(i,o)}merge(i){for(const[o,c]of i.polygons)this.add(o,...c)}}class kh{constructor(){this.portals=[]}static evaluate(i){if(0===i.length)return new kh;let o=[];for(const T of i)o.push(...T.portals);if(0===o.length)return new kh;const c=(T,I)=>T<=0&&I<=0||T>=ft&&I>=ft;for(const T of o){const I=T.va,A=T.vb;(c(I.x,A.x)||c(I.y,A.y))&&(T.type="border")}const h=o.filter(T=>"unevaluated"!==T.type),m=o.filter(T=>"unevaluated"===T.type);if(0===m.length)return new kh;m.sort((T,I)=>T.hash===I.hash?T.isTunnel===I.isTunnel?0:T.isTunnel?-1:1:T.hash<I.hash?1:-1),o=h.concat(m);let g=h.length,x=g,E=g;do{if(x++,x===o.length||o[g].hash!==o[x].hash){if(x-g==2){E<g&&(o[E]=o[g],o[g]=null);const T=o[E],I=o[x-1];T.type=T.isTunnel!==I.isTunnel?"tunnel":"polygon",T.connection={a:T.connection.a,b:I.connection.a},E++}g=x}}while(g!==o.length);return o.splice(E),o.sort((T,I)=>T.hash<I.hash?1:-1),{portals:o}}}Et(kh,"ElevationPortalGraph"),Et(Sb,"ElevationPolygons");class Db{constructor(i,o,c){this.outPositions=i,this.outNormals=o,this.outIndices=c,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(i,o,c){let h=i[2];null!=c&&(h*=c);const m=this.getVec3Bits(i)<<96n|this.getVec3Bits(o),g=this.vertexLookup.get(m);if(null!=g)return g;const x=this.outPositions.length;this.vertexLookup.set(m,x);const E=Math.trunc(16384*o[0]),T=Math.trunc(16384*o[1]),I=Math.trunc(16384*o[2]);return this.outPositions.emplaceBack(i[0],i[1],h),this.outNormals.emplaceBack(E,T,I),x}addTriangle(i,o,c){this.outIndices.emplaceBack(i,o,c)}addTriangles(i,o,c){if(0===i.length)return;const h=1===c.length,m=Un(),g=Un();for(let x=0;x<i.length;x+=3){const E=o[i[x+0]],T=o[i[x+1]],I=o[i[x+2]],A=h?c[0]:c[i[x+1]],M=h?c[0]:c[i[x+2]];_r(m,E.x,E.y,h?c[0]:c[i[x+0]]);const F=this.addVertex(m,g);_r(m,T.x,T.y,A);const L=this.addVertex(m,g);_r(m,I.x,I.y,M);const V=this.addVertex(m,g);this.outIndices.emplaceBack(F,L,V)}}addQuad(i,o,c,h,m,g){const x=this.addVertex(i,m,g),E=this.addVertex(o,m,g),T=this.addVertex(c,m,g),I=this.addVertex(h,m,g);this.addTriangle(x,E,T),this.addTriangle(T,I,x)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(i){return this.view.setFloat32(0,i),BigInt(this.view.getUint32(0))}getVec3Bits(i){return this.getBits(i[0])<<64n|this.getBits(i[1])<<32n|this.getBits(i[2])}}class Ms{constructor(i,o,c,h){this.unevaluatedPortals=new kh,this.portalPolygons=new Sb,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new qf,this.vertexNormals=new oc,this.indexArray=new Pi,this.tileToMeters=ce(i),this.bridgeProgramConfigurations=new Is(o,{zoom:c,lut:h},m=>"fill-tunnel-structure-color"!==m),this.tunnelProgramConfigurations=new Is(o,{zoom:c,lut:h},m=>"fill-bridge-guard-rail-color"!==m)}addVertices(i,o){const c=this.unevalVertices.length;for(let h=0;h<i.length;h++)this.unevalVertices.push(i[h]),this.unevalHeights.push(o[h]);return c}addTriangles(i,o,c){const h=c?this.unevalTunnelTriangles:this.unevalTriangles;for(const m of i)h.push(m+o)}addRenderableRing(i,o,c,h,m,g){const x=[new Qe(m.min.x,m.min.y),new Qe(m.max.x,m.min.y),new Qe(m.max.x,m.max.y),new Qe(m.min.x,m.max.y)];for(let E=0;E<c-1;E++){const T=o+E,I=T+1,A=this.unevalVertices[T],M=this.unevalVertices[I];if(!(A.x>=m.min.x&&A.x<=m.max.x&&A.y>=m.min.y&&A.y<=m.max.y||M.x>=m.min.x&&M.x<=m.max.x&&M.y>=m.min.y&&M.y<=m.max.y||rr(A,M,x))||this.isOnBorder(A.x,M.x)||this.isOnBorder(A.y,M.y))continue;const F=Ms.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[I]);let L,V=this.vertexHashLookup.get(Ms.computePosHash(A));null!=V?L=V.next:(V=this.vertexHashLookup.get(Ms.computePosHash(M)),L=null!=V?V.prev:F),this.unevalEdges.push({polygonIdx:i,a:T,b:I,hash:F,portalHash:L,isTunnel:h,type:"unevaluated",featureInfo:g})}}addPortalCandidates(i,o,c,h,m){if(0===o.length)return;this.portalPolygons.add(i,{geometry:o,zLevel:m});const g=o[0];this.vertexHashLookup.clear();let x=Ms.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let E=0;E<g.length-1;E++){const T=g[E+0],I=g[E+1],A=Zr(I.x-T.x,I.y-T.y),M=Ul(A);if(0===M)continue;let F="unevaluated";const L=h.pointElevation(T),V=h.pointElevation(I);Math.abs(L)<.01&&Math.abs(V)<.01?F="entrance":(this.isOnBorder(T.x,I.x)||this.isOnBorder(T.y,I.y))&&(F="border");const j=Ms.computeEdgeHash(T,I);this.unevaluatedPortals.portals.push({connection:{a:i,b:void 0},va:T,vb:I,vab:A,length:M,hash:j,isTunnel:c,type:F});const W=Ms.computePosHash(T);this.vertexHashLookup.set(W,{prev:x,next:j}),x=j}}construct(i){if(0===this.unevalVertices.length)return;const o=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),c=M=>{M.primitiveLength=this.indexArray.length-M.primitiveOffset},h=new Db(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(i.portals,this.unevalEdges);const m=o(),g=o(),x=o(),E=(M,F)=>{M.sort((V,j)=>V.type===F&&j.type!==F?-1:V.type!==F&&j.type===F?1:0);const L=M.findIndex(V=>V.type!==F);return L>=0?L:M.length};let T=0;this.unevalEdges.length>0&&(T=E(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},this.tileToMeters)),c(x);const I=o(),A=o();if(this.unevalEdges.length>0){const M=this.unevalEdges.splice(T),F=E(M,"tunnel")+T;this.unevalEdges.push(...M),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},{min:T,max:F})}c(I),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),c(A),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),c(g),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),c(m),this.maskSegments=Wi.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.depthSegments=Wi.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=Wi.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=Wi.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.shadowCasterSegments=Wi.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}update(i,o,c,h,m,g,x,E){this.bridgeProgramConfigurations.updatePaintArrays(i,o,m,c,h,g,x,E),this.tunnelProgramConfigurations.updatePaintArrays(i,o,m,c,h,g,x,E)}upload(i){this.vertexBuffer||0===this.vertexPositions.length||0===this.vertexNormals.length||0===this.indexArray.length||(this.vertexBuffer=i.createVertexBuffer(this.vertexPositions,RE.members),this.vertexBufferNormal=i.createVertexBuffer(this.vertexNormals,OE.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(i),this.tunnelProgramConfigurations.upload(i))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(i,o,c,h,m){const g=(x,E)=>{for(let T=0;T<E.length-1;T++){const I=E[T].featureIndex,A=E[T+1].vertexStart,M=i.feature(I);x.populatePaintArrays(A,M,I,{},c,o,h,void 0,m)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(i,o,c,h,m){const g=new Map;for(let x=h;x<m;x++){const E=c[x],T=E.a,I=E.b,A=Ms.computePosHash(i[T]),M=Ms.computePosHash(i[I]);let F=g.get(A);F||(F={},g.set(A,F));let L=g.get(M);L||(L={},g.set(M,L)),o[T]<=0&&o[I]<=0||(F.to=I,L.from=T)}return g}isTerminalVertex(i,o){const c=Ms.computePosHash(this.unevalVertices[i]),h=o.get(c);return!h||!h.from||!h.to}constructBridgeStructures(i,o,c,h,m,g){i.clearVertexLookup();const x=this.computeVertexConnections(o,c,h,m.min,m.max),E=1/g,T=.5*E,I=(Ke,nt)=>_r(Ke,o[nt].x,o[nt].y,c[nt]*E),A=Un(),M=Un(),F=Un(),L=Un(),V=Un(),j=(Ke,nt)=>{const Be=x.get(Ms.computePosHash(o[nt])),Je=Be.from,Ae=Be.to;if(!Je||!Ae)return;I(A,Je),I(M,nt),I(F,Ae),zd(L),xs(A,M)||(cr(V,M,A),Mi(L,V)),xs(F,M)||(cr(V,F,M),ki(L,L,Mi(V,V)));const Ve=Vl(L);return Ve>0?Fi(Ke,L,1/Ve):void 0};let W=Number.POSITIVE_INFINITY;this.sortSubarray(h,m.min,m.max,(Ke,nt)=>Ke.featureInfo.featureIndex-nt.featureInfo.featureIndex);const Q=Un(),J=Un(),te=Un(),me=Un(),he=Un(),fe=Un(),be=Un(),Ee=Un(),je=Un(),De=[Un(),Un(),Un(),Un()],He=[Un(),Un(),Un(),Un()],ot=[{coord:new Qe(0,0),height:0},{coord:new Qe(0,0),height:0}],$e=(Ke,nt)=>Ke>nt;for(let Ke=m.min;Ke<m.max;Ke++){const nt=h[Ke];if(!nt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(ot,o,c,nt,$e))continue;const[Be,Je]=ot;if(_r(Q,Be.coord.x,Be.coord.y,E*Be.height),_r(J,Je.coord.x,Je.coord.y,E*Je.height),xs(Q,J))continue;cr(te,J,Q),Mi(te,te);const Ae=j(Ee,nt.a)||te,Ve=j(je,nt.b)||te;_r(me,Ae[1],-Ae[0],0),Mi(me,me),_r(he,Ve[1],-Ve[0],0),Mi(he,he),gi(Ee,me,Ae),Mi(fe,Ee),gi(Ee,he,Ve),Mi(be,Ee),ki(De[0],Q,Fi(Ee,cr(Ee,me,fe),T)),ki(De[1],Q,Fi(Ee,ki(Ee,me,fe),T)),ki(De[2],Q,Fi(Ee,fe,T)),De[3]=Q,ki(He[0],J,Fi(Ee,cr(Ee,he,be),T)),ki(He[1],J,Fi(Ee,ki(Ee,he,be),T)),ki(He[2],J,Fi(Ee,be,T)),He[3]=J,W=this.addFeatureSection(nt.featureInfo.featureIndex,W,this.bridgeFeatureSections,i);const at=i.addVertex(De[0],me,g),et=i.addVertex(De[1],me,g),kt=i.addVertex(He[0],he,g),Dt=i.addVertex(He[1],he,g);i.addTriangle(at,et,kt),i.addTriangle(et,Dt,kt);const Xe=i.addVertex(De[1],fe,g),tt=i.addVertex(De[2],fe,g),At=i.addVertex(He[1],be,g),yt=i.addVertex(He[2],be,g);i.addTriangle(Xe,tt,At),i.addTriangle(tt,yt,At),Gi(me,me),Gi(he,he);const pt=i.addVertex(De[2],me,g),xt=i.addVertex(De[3],me,g),zt=i.addVertex(He[2],he,g),Zt=i.addVertex(He[3],he,g);i.addTriangle(pt,xt,zt),i.addTriangle(xt,Zt,zt);const on=this.isTerminalVertex(nt.a,x),Qt=this.isTerminalVertex(nt.b,x);Be.height<.01&&on&&i.addQuad(De[3],De[2],De[1],De[0],Gi(Ae,Ae),g),Je.height<.01&&Qt&&i.addQuad(He[0],He[1],He[2],He[3],Ve,g)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}constructTunnelStructures(i,o,c,h,m,g){i.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const E=(W,Q)=>W.featureInfo.featureIndex-Q.featureInfo.featureIndex;this.sortSubarray(h,m.min,m.max,E),this.sortSubarray(h,g.min,g.max,E);const T=W=>Mi(W,W),I=[{coord:new Qe(0,0),height:0},{coord:new Qe(0,0),height:0}],A=(W,Q)=>W<Q,M=Un(),F=Un(),L=Un(),V=Un(),j=Un();for(let W=m.min;W<m.max;W++){if(!this.prepareEdgePoints(I,o,c,h[W],A))continue;const[Q,J]=I,te=T(_r(j,-(J.coord.y-Q.coord.y),J.coord.x-Q.coord.x,0));x=this.addFeatureSection(h[W].featureInfo.featureIndex,x,this.tunnelFeatureSections,i),i.addQuad(_r(M,Q.coord.x,Q.coord.y,Q.height),_r(F,J.coord.x,J.coord.y,J.height),_r(L,J.coord.x,J.coord.y,h[W].isTunnel?-.1:0),_r(V,Q.coord.x,Q.coord.y,h[W].isTunnel?-.1:0),te)}for(let W=g.min;W<g.max;W++){const Q=h[W];Q.isTunnel&&([Q.a,Q.b]=[Q.b,Q.a]);const J=o[Q.a],te=o[Q.b],me=T(_r(j,-(te.y-J.y),te.x-J.x,0));x=this.addFeatureSection(Q.featureInfo.featureIndex,x,this.tunnelFeatureSections,i),i.addQuad(_r(M,te.x,te.y,0),_r(F,J.x,J.y,0),_r(L,J.x,J.y,c[Q.a]+4),_r(V,te.x,te.y,c[Q.b]+4),me),i.addQuad(_r(M,J.x,J.y,0),_r(F,te.x,te.y,0),_r(L,te.x,te.y,c[Q.b]+4),_r(V,J.x,J.y,c[Q.a]+4),me)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}setElevatedPoint(i,o,c,h){i.coord.x=o,i.coord.y=c,i.height=h}prepareEdgePoints(i,o,c,h,m){let g=o[h.a].x,x=o[h.a].y,E=o[h.b].x,T=o[h.b].y,I=c[h.a],A=c[h.b];const M=m(I,0),F=m(A,0);if(M&&F)return this.setElevatedPoint(i[0],g,x,I),this.setElevatedPoint(i[1],E,T,A),!0;if(!M&&!F)return!1;if(M){if(!F){const L=A/(A-I);E=Nt(E,g,L),T=Nt(T,x,L),A=Nt(A,I,L)}}else{const L=I/(I-A);g=Nt(g,E,L),x=Nt(x,T,L),I=Nt(I,A,L)}return this.setElevatedPoint(i[0],g,x,I),this.setElevatedPoint(i[1],E,T,A),!0}prepareEdges(i,o){if(0===o.length)return;o.sort((x,E)=>x.hash===E.hash?E.polygonIdx-x.polygonIdx:E.hash>x.hash?1:-1);let c=0,h=0,m=0,g=o[c].polygonIdx;do{h++,(h===o.length||o[c].hash!==o[h].hash)&&((h-c==1||o[h-1].polygonIdx!==g)&&(m<c&&(o[m]=o[c],o[c]=null),o[m].type="none",m++),c=h,c!==o.length&&(g=o[c].polygonIdx))}while(c!==o.length);if(o.splice(m),0!==o.length&&0!==i.length){o.sort((T,I)=>T.portalHash<I.portalHash?1:-1);let x=0,E=0;for(;x!==o.length&&E!==i.length;){const T=o[x],I=i[E];T.portalHash>I.hash?x++:I.hash>T.portalHash?E++:(T.type=I.type,x++)}}}isOnBorder(i,o){return i<=0&&o<=0||i>=ft&&o>=ft}addFeatureSection(i,o,c,h){return i!==o&&(o=i,c.push({featureIndex:i,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),o}sortSubarray(i,o,c,h){const m=i.slice(o,c);m.sort(h),i.splice(o,m.length,...m)}static computeEdgeHash(i,o){return(i.y===o.y&&i.x>o.x||i.y>o.y)&&([i,o]=[o,i]),BigInt(Ms.computePosHash(i))<<32n|BigInt(Ms.computePosHash(o))}static computePosHash(i){return((65535&i.x)<<16|65535&i.y)>>>0}}var Km,j_={exports:{}},Fh=(Km||(Km=1,function(o){function c(ie,re){return ie>re?1:ie<re?-1:0}var h=function(ie,re){void 0===ie&&(ie=c),void 0===re&&(re=!1),this._compare=ie,this._root=null,this._size=0,this._noDuplicates=!!re},m={size:{configurable:!0}};function g(ie,re,Le,ct,ht){var mt=ht-ct;if(mt>0){var It=ct+Math.floor(mt/2),Gt={key:re[It],data:Le[It],parent:ie};return Gt.left=g(Gt,re,Le,ct,It),Gt.right=g(Gt,re,Le,It+1,ht),Gt}return null}function x(ie,re,Le,ct,ht){if(!(Le>=ct)){for(var mt=ie[Le+ct>>1],It=Le-1,Gt=ct+1;;){do{It++}while(ht(ie[It],mt)<0);do{Gt--}while(ht(ie[Gt],mt)>0);if(It>=Gt)break;var wn=ie[It];ie[It]=ie[Gt],ie[Gt]=wn,wn=re[It],re[It]=re[Gt],re[Gt]=wn}x(ie,re,Le,Gt,ht),x(ie,re,Gt+1,ct,ht)}}h.prototype.rotateLeft=function(ie){var re=ie.right;re&&(ie.right=re.left,re.left&&(re.left.parent=ie),re.parent=ie.parent),ie.parent?ie===ie.parent.left?ie.parent.left=re:ie.parent.right=re:this._root=re,re&&(re.left=ie),ie.parent=re},h.prototype.rotateRight=function(ie){var re=ie.left;re&&(ie.left=re.right,re.right&&(re.right.parent=ie),re.parent=ie.parent),ie.parent?ie===ie.parent.left?ie.parent.left=re:ie.parent.right=re:this._root=re,re&&(re.right=ie),ie.parent=re},h.prototype._splay=function(ie){for(;ie.parent;){var re=ie.parent;re.parent?re.left===ie&&re.parent.left===re?(this.rotateRight(re.parent),this.rotateRight(re)):re.right===ie&&re.parent.right===re?(this.rotateLeft(re.parent),this.rotateLeft(re)):re.left===ie&&re.parent.right===re?(this.rotateRight(re),this.rotateLeft(re)):(this.rotateLeft(re),this.rotateRight(re)):re.left===ie?this.rotateRight(re):this.rotateLeft(re)}},h.prototype.splay=function(ie){for(var re,Le,ct,ht,mt;ie.parent;)(Le=(re=ie.parent).parent)&&Le.parent?((ct=Le.parent).left===Le?ct.left=ie:ct.right=ie,ie.parent=ct):(ie.parent=null,this._root=ie),ht=ie.left,mt=ie.right,ie===re.left?(Le&&(Le.left===re?(re.right?(Le.left=re.right,Le.left.parent=Le):Le.left=null,re.right=Le,Le.parent=re):(ht?(Le.right=ht,ht.parent=Le):Le.right=null,ie.left=Le,Le.parent=ie)),mt?(re.left=mt,mt.parent=re):re.left=null,ie.right=re,re.parent=ie):(Le&&(Le.right===re?(re.left?(Le.right=re.left,Le.right.parent=Le):Le.right=null,re.left=Le,Le.parent=re):(mt?(Le.left=mt,mt.parent=Le):Le.left=null,ie.right=Le,Le.parent=ie)),ht?(re.right=ht,ht.parent=re):re.right=null,ie.left=re,re.parent=ie)},h.prototype.replace=function(ie,re){ie.parent?ie===ie.parent.left?ie.parent.left=re:ie.parent.right=re:this._root=re,re&&(re.parent=ie.parent)},h.prototype.minNode=function(ie){if(void 0===ie&&(ie=this._root),ie)for(;ie.left;)ie=ie.left;return ie},h.prototype.maxNode=function(ie){if(void 0===ie&&(ie=this._root),ie)for(;ie.right;)ie=ie.right;return ie},h.prototype.insert=function(ie,re){var Le=this._root,ct=null,ht=this._compare;if(this._noDuplicates)for(;Le;){if(ct=Le,0===ht(Le.key,ie))return;Le=ht(Le.key,ie)<0?Le.right:Le.left}else for(;Le;)ct=Le,Le=ht(Le.key,ie)<0?Le.right:Le.left;return Le={key:ie,data:re,left:null,right:null,parent:ct},ct?ht(ct.key,Le.key)<0?ct.right=Le:ct.left=Le:this._root=Le,this.splay(Le),this._size++,Le},h.prototype.find=function(ie){for(var re=this._root,Le=this._compare;re;){var ct=Le(re.key,ie);if(ct<0)re=re.right;else{if(!(ct>0))return re;re=re.left}}return null},h.prototype.contains=function(ie){for(var re=this._root,Le=this._compare;re;){var ct=Le(ie,re.key);if(0===ct)return!0;re=ct<0?re.left:re.right}return!1},h.prototype.remove=function(ie){var re=this.find(ie);if(!re)return!1;if(this.splay(re),re.left)if(re.right){var Le=this.minNode(re.right);Le.parent!==re&&(this.replace(Le,Le.right),Le.right=re.right,Le.right.parent=Le),this.replace(re,Le),Le.left=re.left,Le.left.parent=Le}else this.replace(re,re.left);else this.replace(re,re.right);return this._size--,!0},h.prototype.removeNode=function(ie){if(!ie)return!1;if(this.splay(ie),ie.left)if(ie.right){var re=this.minNode(ie.right);re.parent!==ie&&(this.replace(re,re.right),re.right=ie.right,re.right.parent=re),this.replace(ie,re),re.left=ie.left,re.left.parent=re}else this.replace(ie,ie.left);else this.replace(ie,ie.right);return this._size--,!0},h.prototype.erase=function(ie){var re=this.find(ie);if(re){this.splay(re);var Le=re.left,ct=re.right,ht=null;Le&&(Le.parent=null,ht=this.maxNode(Le),this.splay(ht),this._root=ht),ct&&(Le?ht.right=ct:this._root=ct,ct.parent=ht),this._size--}},h.prototype.pop=function(){var ie=this._root,re=null;if(ie){for(;ie.left;)ie=ie.left;re={key:ie.key,data:ie.data},this.remove(ie.key)}return re},h.prototype.next=function(ie){var re=ie;if(re)if(re.right)for(re=re.right;re&&re.left;)re=re.left;else for(re=ie.parent;re&&re.right===ie;)ie=re,re=re.parent;return re},h.prototype.prev=function(ie){var re=ie;if(re)if(re.left)for(re=re.left;re&&re.right;)re=re.right;else for(re=ie.parent;re&&re.left===ie;)ie=re,re=re.parent;return re},h.prototype.forEach=function(ie){for(var re=this._root,Le=[],ct=!1,ht=0;!ct;)re?(Le.push(re),re=re.left):Le.length>0?(ie(re=Le.pop(),ht++),re=re.right):ct=!0;return this},h.prototype.range=function(ie,re,Le,ct){for(var ht=[],mt=this._compare,It=this._root;0!==ht.length||It;)if(It)ht.push(It),It=It.left;else{if(mt((It=ht.pop()).key,re)>0)break;if(mt(It.key,ie)>=0&&Le.call(ct,It))return this;It=It.right}return this},h.prototype.keys=function(){for(var ie=this._root,re=[],Le=[],ct=!1;!ct;)ie?(re.push(ie),ie=ie.left):re.length>0?(ie=re.pop(),Le.push(ie.key),ie=ie.right):ct=!0;return Le},h.prototype.values=function(){for(var ie=this._root,re=[],Le=[],ct=!1;!ct;)ie?(re.push(ie),ie=ie.left):re.length>0?(ie=re.pop(),Le.push(ie.data),ie=ie.right):ct=!0;return Le},h.prototype.at=function(ie){for(var re=this._root,Le=[],ct=!1,ht=0;!ct;)if(re)Le.push(re),re=re.left;else if(Le.length>0){if(re=Le.pop(),ht===ie)return re;ht++,re=re.right}else ct=!0;return null},h.prototype.load=function(ie,re,Le){if(void 0===ie&&(ie=[]),void 0===re&&(re=[]),void 0===Le&&(Le=!1),0!==this._size)throw new Error("bulk-load: tree is not empty");var ct=ie.length;return Le&&x(ie,re,0,ct-1,this._compare),this._root=g(null,ie,re,0,ct),this._size=ct,this},h.prototype.min=function(){var ie=this.minNode(this._root);return ie?ie.key:null},h.prototype.max=function(){var ie=this.maxNode(this._root);return ie?ie.key:null},h.prototype.isEmpty=function(){return null===this._root},m.size.get=function(){return this._size},h.createTree=function(ie,re,Le,ct,ht){return new h(Le,ht).load(ie,re,ct)},Object.defineProperties(h.prototype,m);var E=0,T=1,I=2,A=3,M=0,F=1,L=2,V=3;function j(ie,re,Le){null===re?(ie.inOut=!1,ie.otherInOut=!0):(ie.isSubject===re.isSubject?(ie.inOut=!re.inOut,ie.otherInOut=re.otherInOut):(ie.inOut=!re.otherInOut,ie.otherInOut=re.isVertical()?!re.inOut:re.inOut),re&&(ie.prevInResult=!W(re,Le)||re.isVertical()?re.prevInResult:re));var ct=W(ie,Le);ie.resultTransition=ct?function(ht,mt){var It,Gt=!ht.inOut,wn=!ht.otherInOut;switch(mt){case M:It=Gt&&wn;break;case F:It=Gt||wn;break;case V:It=Gt^wn;break;case L:It=ht.isSubject?Gt&&!wn:wn&&!Gt}return It?1:-1}(ie,Le):0}function W(ie,re){switch(ie.type){case E:switch(re){case M:return!ie.otherInOut;case F:return ie.otherInOut;case L:return ie.isSubject&&ie.otherInOut||!ie.isSubject&&!ie.otherInOut;case V:return!0}break;case I:return re===M||re===F;case A:return re===L;case T:return!1}return!1}var Q=function(ie,re,Le,ct,ht){this.left=re,this.point=ie,this.otherEvent=Le,this.isSubject=ct,this.type=ht||E,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},J={inResult:{configurable:!0}};function te(ie,re){return ie[0]===re[0]&&ie[1]===re[1]}Q.prototype.isBelow=function(ie){var re=this.point,Le=this.otherEvent.point;return this.left?(re[0]-ie[0])*(Le[1]-ie[1])-(Le[0]-ie[0])*(re[1]-ie[1])>0:(Le[0]-ie[0])*(re[1]-ie[1])-(re[0]-ie[0])*(Le[1]-ie[1])>0},Q.prototype.isAbove=function(ie){return!this.isBelow(ie)},Q.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},J.inResult.get=function(){return 0!==this.resultTransition},Q.prototype.clone=function(){var ie=new Q(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ie.contourId=this.contourId,ie.resultTransition=this.resultTransition,ie.prevInResult=this.prevInResult,ie.isExteriorRing=this.isExteriorRing,ie.inOut=this.inOut,ie.otherInOut=this.otherInOut,ie},Object.defineProperties(Q.prototype,J);var me=11102230246251565e-32,he=134217729,fe=(3+8*me)*me;function be(ie,re,Le,ct,ht){var mt,It,Gt,wn,$t=re[0],fn=ct[0],li=0,Xi=0;fn>$t==fn>-$t?(mt=$t,$t=re[++li]):(mt=fn,fn=ct[++Xi]);var nn=0;if(li<ie&&Xi<Le)for(fn>$t==fn>-$t?(Gt=mt-((It=$t+mt)-$t),$t=re[++li]):(Gt=mt-((It=fn+mt)-fn),fn=ct[++Xi]),mt=It,0!==Gt&&(ht[nn++]=Gt);li<ie&&Xi<Le;)fn>$t==fn>-$t?(Gt=mt-((It=mt+$t)-(wn=It-mt))+($t-wn),$t=re[++li]):(Gt=mt-((It=mt+fn)-(wn=It-mt))+(fn-wn),fn=ct[++Xi]),mt=It,0!==Gt&&(ht[nn++]=Gt);for(;li<ie;)Gt=mt-((It=mt+$t)-(wn=It-mt))+($t-wn),$t=re[++li],mt=It,0!==Gt&&(ht[nn++]=Gt);for(;Xi<Le;)Gt=mt-((It=mt+fn)-(wn=It-mt))+(fn-wn),fn=ct[++Xi],mt=It,0!==Gt&&(ht[nn++]=Gt);return 0===mt&&0!==nn||(ht[nn++]=mt),nn}function Ee(ie){return new Float64Array(ie)}var je=33306690738754716e-32,De=22204460492503146e-32,He=11093356479670487e-47,ot=Ee(4),$e=Ee(8),Ke=Ee(12),nt=Ee(16),Be=Ee(4);function Je(ie,re,Le){var ct=function(ht,mt,It,Gt,wn,$t){var fn=(mt-$t)*(It-wn),li=(ht-wn)*(Gt-$t),Xi=fn-li;if(0===fn||0===li||fn>0!=li>0)return Xi;var nn=Math.abs(fn+li);return Math.abs(Xi)>=je*nn?Xi:-function(Ri,ci,jn,Xn,Oi,pi,vi){var oi,cn,si,Bi,Ut,An,Ai,er,mi,Lr,fi,Rr,Bo,po,no,ys,xc,mr,Dr=Ri-Oi,Io=jn-Oi,Jo=ci-pi,Vo=Xn-pi;ot[0]=(no=(er=Dr-(Ai=(An=he*Dr)-(An-Dr)))*(Lr=Vo-(mi=(An=he*Vo)-(An-Vo)))-((po=Dr*Vo)-Ai*mi-er*mi-Ai*Lr))-((fi=no-(xc=(er=Jo-(Ai=(An=he*Jo)-(An-Jo)))*(Lr=Io-(mi=(An=he*Io)-(An-Io)))-((ys=Jo*Io)-Ai*mi-er*mi-Ai*Lr)))+(Ut=no-fi))+(Ut-xc),ot[1]=(Bo=po-((Rr=po+fi)-(Ut=Rr-po))+(fi-Ut))-((fi=Bo-ys)+(Ut=Bo-fi))+(Ut-ys),ot[2]=Rr-((mr=Rr+fi)-(Ut=mr-Rr))+(fi-Ut),ot[3]=mr;var wu=function(tI,h1){for(var rC=h1[0],f1=1;f1<4;f1++)rC+=h1[f1];return rC}(0,ot),Lp=De*vi;if(wu>=Lp||-wu>=Lp||(oi=Ri-(Dr+(Ut=Ri-Dr))+(Ut-Oi),si=jn-(Io+(Ut=jn-Io))+(Ut-Oi),cn=ci-(Jo+(Ut=ci-Jo))+(Ut-pi),Bi=Xn-(Vo+(Ut=Xn-Vo))+(Ut-pi),0===oi&&0===cn&&0===si&&0===Bi)||(Lp=He*vi+fe*Math.abs(wu),(wu+=Dr*Bi+Vo*oi-(Jo*si+Io*cn))>=Lp||-wu>=Lp))return wu;Be[0]=(no=(er=oi-(Ai=(An=he*oi)-(An-oi)))*(Lr=Vo-(mi=(An=he*Vo)-(An-Vo)))-((po=oi*Vo)-Ai*mi-er*mi-Ai*Lr))-((fi=no-(xc=(er=cn-(Ai=(An=he*cn)-(An-cn)))*(Lr=Io-(mi=(An=he*Io)-(An-Io)))-((ys=cn*Io)-Ai*mi-er*mi-Ai*Lr)))+(Ut=no-fi))+(Ut-xc),Be[1]=(Bo=po-((Rr=po+fi)-(Ut=Rr-po))+(fi-Ut))-((fi=Bo-ys)+(Ut=Bo-fi))+(Ut-ys),Be[2]=Rr-((mr=Rr+fi)-(Ut=mr-Rr))+(fi-Ut),Be[3]=mr;var u1=be(4,ot,4,Be,$e);Be[0]=(no=(er=Dr-(Ai=(An=he*Dr)-(An-Dr)))*(Lr=Bi-(mi=(An=he*Bi)-(An-Bi)))-((po=Dr*Bi)-Ai*mi-er*mi-Ai*Lr))-((fi=no-(xc=(er=Jo-(Ai=(An=he*Jo)-(An-Jo)))*(Lr=si-(mi=(An=he*si)-(An-si)))-((ys=Jo*si)-Ai*mi-er*mi-Ai*Lr)))+(Ut=no-fi))+(Ut-xc),Be[1]=(Bo=po-((Rr=po+fi)-(Ut=Rr-po))+(fi-Ut))-((fi=Bo-ys)+(Ut=Bo-fi))+(Ut-ys),Be[2]=Rr-((mr=Rr+fi)-(Ut=mr-Rr))+(fi-Ut),Be[3]=mr;var iC=be(u1,$e,4,Be,Ke);Be[0]=(no=(er=oi-(Ai=(An=he*oi)-(An-oi)))*(Lr=Bi-(mi=(An=he*Bi)-(An-Bi)))-((po=oi*Bi)-Ai*mi-er*mi-Ai*Lr))-((fi=no-(xc=(er=cn-(Ai=(An=he*cn)-(An-cn)))*(Lr=si-(mi=(An=he*si)-(An-si)))-((ys=cn*si)-Ai*mi-er*mi-Ai*Lr)))+(Ut=no-fi))+(Ut-xc),Be[1]=(Bo=po-((Rr=po+fi)-(Ut=Rr-po))+(fi-Ut))-((fi=Bo-ys)+(Ut=Bo-fi))+(Ut-ys),Be[2]=Rr-((mr=Rr+fi)-(Ut=mr-Rr))+(fi-Ut),Be[3]=mr;var d1=be(iC,Ke,4,Be,nt);return nt[d1-1]}(ht,mt,It,Gt,wn,$t,nn)}(ie[0],ie[1],re[0],re[1],Le[0],Le[1]);return ct>0?-1:ct<0?1:0}function Ae(ie,re){var ht,mt,Le=ie.point,ct=re.point;return Le[0]>ct[0]?1:Le[0]<ct[0]?-1:Le[1]!==ct[1]?Le[1]>ct[1]?1:-1:(ht=ie).left!==(mt=re).left?ht.left?1:-1:0!==Je(Le,ht.otherEvent.point,mt.otherEvent.point)?ht.isBelow(mt.otherEvent.point)?-1:1:!ht.isSubject&&mt.isSubject?1:-1}function Ve(ie,re,Le){var ct=new Q(re,!1,ie,ie.isSubject),ht=new Q(re,!0,ie.otherEvent,ie.isSubject);return te(ie.point,ie.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ie),ct.contourId=ht.contourId=ie.contourId,Ae(ht,ie.otherEvent)>0&&(ie.otherEvent.left=!0,ht.left=!1),ie.otherEvent.otherEvent=ht,ie.otherEvent=ct,Le.push(ht),Le.push(ct),Le}function at(ie,re){return ie[0]*re[1]-ie[1]*re[0]}function et(ie,re){return ie[0]*re[0]+ie[1]*re[1]}function kt(ie,re,Le){var ct=function(wn,$t,fn,li,Xi){var nn=[$t[0]-wn[0],$t[1]-wn[1]],Ri=[li[0]-fn[0],li[1]-fn[1]];function ci(An,Ai,er){return[An[0]+Ai*er[0],An[1]+Ai*er[1]]}var jn=[fn[0]-wn[0],fn[1]-wn[1]],Xn=at(nn,Ri),Oi=Xn*Xn,pi=et(nn,nn);if(Oi>0){var vi=at(jn,Ri)/Xn;if(vi<0||vi>1)return null;var oi=at(jn,nn)/Xn;return oi<0||oi>1?null:0===vi||1===vi?[ci(wn,vi,nn)]:0===oi||1===oi?[ci(fn,oi,Ri)]:[ci(wn,vi,nn)]}if((Oi=(Xn=at(jn,nn))*Xn)>0)return null;var cn=et(nn,jn)/pi,si=cn+et(nn,Ri)/pi,Bi=Math.min(cn,si),Ut=Math.max(cn,si);return Bi<=1&&Ut>=0?1===Bi?[ci(wn,Bi>0?Bi:0,nn)]:0===Ut?[ci(wn,Ut<1?Ut:1,nn)]:[ci(wn,Bi>0?Bi:0,nn),ci(wn,Ut<1?Ut:1,nn)]:null}(ie.point,ie.otherEvent.point,re.point,re.otherEvent.point),ht=ct?ct.length:0;if(0===ht||1===ht&&(te(ie.point,re.point)||te(ie.otherEvent.point,re.otherEvent.point))||2===ht&&ie.isSubject===re.isSubject)return 0;if(1===ht)return te(ie.point,ct[0])||te(ie.otherEvent.point,ct[0])||Ve(ie,ct[0],Le),te(re.point,ct[0])||te(re.otherEvent.point,ct[0])||Ve(re,ct[0],Le),1;var mt=[],It=!1,Gt=!1;return te(ie.point,re.point)?It=!0:1===Ae(ie,re)?mt.push(re,ie):mt.push(ie,re),te(ie.otherEvent.point,re.otherEvent.point)?Gt=!0:1===Ae(ie.otherEvent,re.otherEvent)?mt.push(re.otherEvent,ie.otherEvent):mt.push(ie.otherEvent,re.otherEvent),It&&Gt||It?(re.type=T,ie.type=re.inOut===ie.inOut?I:A,It&&!Gt&&Ve(mt[1].otherEvent,mt[0].point,Le),2):Gt?(Ve(mt[0],mt[1].point,Le),3):mt[0]!==mt[3].otherEvent?(Ve(mt[0],mt[1].point,Le),Ve(mt[1],mt[2].point,Le),3):(Ve(mt[0],mt[1].point,Le),Ve(mt[3].otherEvent,mt[2].point,Le),3)}function Dt(ie,re){if(ie===re)return 0;if(0!==Je(ie.point,ie.otherEvent.point,re.point)||0!==Je(ie.point,ie.otherEvent.point,re.otherEvent.point))return te(ie.point,re.point)?ie.isBelow(re.otherEvent.point)?-1:1:ie.point[0]===re.point[0]?ie.point[1]<re.point[1]?-1:1:1===Ae(ie,re)?re.isAbove(ie.point)?-1:1:ie.isBelow(re.point)?-1:1;if(ie.isSubject!==re.isSubject)return ie.isSubject?-1:1;var Le=ie.point,ct=re.point;return Le[0]===ct[0]&&Le[1]===ct[1]?(Le=ie.otherEvent.point)[0]===(ct=re.otherEvent.point)[0]&&Le[1]===ct[1]?0:ie.contourId>re.contourId?1:-1:1===Ae(ie,re)?1:-1}var Xe=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function tt(ie,re,Le,ct){var ht,mt=ie+1,It=re[ie].point,Gt=re.length;for(mt<Gt&&(ht=re[mt].point);mt<Gt&&ht[0]===It[0]&&ht[1]===It[1];){if(!Le[mt])return mt;++mt<Gt&&(ht=re[mt].point)}for(mt=ie-1;Le[mt]&&mt>ct;)mt--;return mt}Xe.prototype.isExterior=function(){return null==this.holeOf};var At=pt,yt=pt;function pt(ie,re){if(!(this instanceof pt))return new pt(ie,re);if(this.data=ie||[],this.length=this.data.length,this.compare=re||xt,this.length>0)for(var Le=(this.length>>1)-1;Le>=0;Le--)this._down(Le)}function xt(ie,re){return ie<re?-1:ie>re?1:0}pt.prototype={push:function(ie){this.data.push(ie),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var ie=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ie}},peek:function(){return this.data[0]},_up:function(ie){for(var re=this.data,Le=this.compare,ct=re[ie];ie>0;){var ht=ie-1>>1,mt=re[ht];if(Le(ct,mt)>=0)break;re[ie]=mt,ie=ht}re[ie]=ct},_down:function(ie){for(var re=this.data,Le=this.compare,ct=this.length>>1,ht=re[ie];ie<ct;){var mt=1+(ie<<1),It=mt+1,Gt=re[mt];if(It<this.length&&Le(re[It],Gt)<0&&(mt=It,Gt=re[It]),Le(Gt,ht)>=0)break;re[ie]=Gt,ie=mt}re[ie]=ht}},At.default=yt;var zt=Math.max,Zt=Math.min,on=0;function Qt(ie,re,Le,ct,ht,mt){var It,Gt,wn,$t,fn,li;for(It=0,Gt=ie.length-1;It<Gt;It++)if($t=ie[It+1],fn=new Q(wn=ie[It],!1,void 0,re),li=new Q($t,!1,fn,re),fn.otherEvent=li,wn[0]!==$t[0]||wn[1]!==$t[1]){fn.contourId=li.contourId=Le,mt||(fn.isExteriorRing=!1,li.isExteriorRing=!1),Ae(fn,li)>0?li.left=!0:fn.left=!0;var Xi=wn[0],nn=wn[1];ht[0]=Zt(ht[0],Xi),ht[1]=Zt(ht[1],nn),ht[2]=zt(ht[2],Xi),ht[3]=zt(ht[3],nn),ct.push(fn),ct.push(li)}}var vn=[];function hn(ie,re,Le){"number"==typeof ie[0][0][0]&&(ie=[ie]),"number"==typeof re[0][0][0]&&(re=[re]);var nn,Ri,ci,jn,ct=(ci=Le,jn=null,(nn=ie).length*(Ri=re).length==0&&(ci===M?jn=vn:ci===L?jn=nn:ci!==F&&ci!==V||(jn=0===nn.length?Ri:nn)),jn);if(ct)return ct===vn?null:ct;var ht=[1/0,1/0,-1/0,-1/0],mt=[1/0,1/0,-1/0,-1/0],It=function(nn,Ri,ci,jn,Xn){var Oi,pi,vi,oi,cn,si,Bi=new At(null,Ae);for(vi=0,oi=nn.length;vi<oi;vi++)for(cn=0,si=(Oi=nn[vi]).length;cn<si;cn++)(pi=0===cn)&&on++,Qt(Oi[cn],!0,on,Bi,ci,pi);for(vi=0,oi=Ri.length;vi<oi;vi++)for(cn=0,si=(Oi=Ri[vi]).length;cn<si;cn++)pi=0===cn,Xn===L&&(pi=!1),pi&&on++,Qt(Oi[cn],!1,on,Bi,jn,pi);return Bi}(ie,re,ht,mt,Le);if(ct=function(nn,Ri,ci,jn,Xn){var Oi=null;return(ci[0]>jn[2]||jn[0]>ci[2]||ci[1]>jn[3]||jn[1]>ci[3])&&(Xn===M?Oi=vn:Xn===L?Oi=nn:Xn!==F&&Xn!==V||(Oi=nn.concat(Ri))),Oi}(ie,re,ht,mt,Le))return ct===vn?null:ct;for(var Gt=function(nn){var Ri,ci,jn=function(vi){var oi,cn,si,Bi,Ut=[];for(cn=0,si=vi.length;cn<si;cn++)((oi=vi[cn]).left&&oi.inResult||!oi.left&&oi.otherEvent.inResult)&&Ut.push(oi);for(var An=!1;!An;)for(An=!0,cn=0,si=Ut.length;cn<si;cn++)cn+1<si&&1===Ae(Ut[cn],Ut[cn+1])&&(Bi=Ut[cn],Ut[cn]=Ut[cn+1],Ut[cn+1]=Bi,An=!1);for(cn=0,si=Ut.length;cn<si;cn++)(oi=Ut[cn]).otherPos=cn;for(cn=0,si=Ut.length;cn<si;cn++)(oi=Ut[cn]).left||(Bi=oi.otherPos,oi.otherPos=oi.otherEvent.otherPos,oi.otherEvent.otherPos=Bi);return Ut}(nn),Xn={},Oi=[],pi=function(){if(!Xn[Ri]){var vi=Oi.length,oi=function(Ut,An,Ai){var er=new Xe;if(null!=Ut.prevInResult){var mi=Ut.prevInResult,Lr=mi.outputContourId;if(mi.resultTransition>0){var fi=An[Lr];if(null!=fi.holeOf){var Rr=fi.holeOf;An[Rr].holeIds.push(Ai),er.holeOf=Rr,er.depth=An[Lr].depth}else An[Lr].holeIds.push(Ai),er.holeOf=Lr,er.depth=An[Lr].depth+1}else er.holeOf=null,er.depth=An[Lr].depth}else er.holeOf=null,er.depth=0;return er}(jn[Ri],Oi,vi),cn=function(Ut){Xn[Ut]=!0,Ut<jn.length&&jn[Ut]&&(jn[Ut].outputContourId=vi)},si=Ri,Bi=Ri;for(oi.points.push(jn[Ri].point);cn(si),cn(si=jn[si].otherPos),oi.points.push(jn[si].point),!((si=tt(si,jn,Xn,Bi))==Bi||si>=jn.length)&&jn[si];);Oi.push(oi)}};for(Ri=0,ci=jn.length;Ri<ci;Ri++)pi();return Oi}(function(nn,Ri,ci,jn,Xn,Oi){for(var pi,vi,oi,cn=new h(Dt),si=[],Bi=Math.min(jn[2],Xn[2]);0!==nn.length;){var Ut=nn.pop();if(si.push(Ut),Oi===M&&Ut.point[0]>Bi||Oi===L&&Ut.point[0]>jn[2])break;if(Ut.left){vi=pi=cn.insert(Ut),pi=pi!==(oi=cn.minNode())?cn.prev(pi):null,vi=cn.next(vi);var An=pi?pi.key:null;if(j(Ut,An,Oi),vi&&2===kt(Ut,vi.key,nn)&&(j(Ut,An,Oi),j(vi.key,Ut,Oi)),pi&&2===kt(pi.key,Ut,nn)){var Ai=pi;j(An,(Ai=Ai!==oi?cn.prev(Ai):null)?Ai.key:null,Oi),j(Ut,An,Oi)}}else vi=pi=cn.find(Ut=Ut.otherEvent),pi&&vi&&(pi=pi!==oi?cn.prev(pi):null,vi=cn.next(vi),cn.remove(Ut),vi&&pi&&kt(pi.key,vi.key,nn))}return si}(It,0,0,ht,mt,Le)),wn=[],$t=0;$t<Gt.length;$t++){var fn=Gt[$t];if(fn.isExterior()){for(var li=[fn.points],Xi=0;Xi<fn.holeIds.length;Xi++)li.push(Gt[fn.holeIds[Xi]].points);wn.push(li)}}return wn}var ri={UNION:F,DIFFERENCE:L,INTERSECTION:M,XOR:V};o.diff=function(ie,re){return hn(ie,re,L)},o.intersection=function(ie,re){return hn(ie,re,M)},o.operations=ri,o.union=function(ie,re){return hn(ie,re,F)},o.xor=function(ie,re){return hn(ie,re,V)},Object.defineProperty(o,"__esModule",{value:!0})}(j_.exports)),j_.exports);function U_(a,i,o,c){const h=[],m=0===c?(g,x,E,T,I,A)=>{g.push(new Qe(A,E+(A-x)/(T-x)*(I-E)))}:(g,x,E,T,I,A)=>{g.push(new Qe(x+(A-E)/(I-E)*(T-x),A))};for(const g of a){const x=[];for(const E of g){if(E.length<=2)continue;const T=[];for(let M=0;M<E.length-1;M++){const F=E[M].x,L=E[M].y,V=E[M+1].x,j=E[M+1].y,W=0===c?F:L,Q=0===c?V:j;W<i?Q>i&&m(T,F,L,V,j,i):W>o?Q<o&&m(T,F,L,V,j,o):T.push(E[M]),Q<i&&W>=i&&m(T,F,L,V,j,i),Q>o&&W<=o&&m(T,F,L,V,j,o)}let I=E[E.length-1];const A=0===c?I.x:I.y;A>=i&&A<=o&&T.push(I),T.length&&(I=T[T.length-1],T[0].x===I.x&&T[0].y===I.y||T.push(T[0]),x.push(T))}x.length&&h.push(x)}return h}function LE(a,i){const o=t0(a),c=t0([i]),h=Fh.intersection(o,c);return null==h?[]:H_(h)}function zD(a,i){let c=t0(a,65536);for(;i.valid();i.next()){const[h,m]=i.get(),g=65536*h.x,x=65536*h.y,E=65536*m.x,T=65536*m.y,I=E-g,A=T-x,M=Math.hypot(I,A),F=Math.trunc(A/M*3),L=-Math.trunc(I/M*3);c=Fh.diff(c,[[[g,x],[E,T],[E+F,T+L],[g+F,x+L],[g,x]]])}return H_(c,1/65536)}function t0(a,i=1){return[a.map(o=>o.map(c=>[c.x*i,c.y*i]))]}function H_(a,i=1){return a.map(o=>o.map((c,h)=>{const m=c.map(g=>new Qe(g[0]*i,g[1]*i).round());return h>0&&m.reverse(),m}))}class n0{constructor(i,o){this.layoutVertexArray=new Ss,this.indexArray=new Pi,this.lineIndexArray=new va,this.triangleSegments=new Wi,this.lineSegments=new Wi,this.programConfigurations=new Is(i.layers,{zoom:i.zoom,lut:i.lut}),this.uploaded=!1,o&&(this.elevatedLayoutVertexArray=new hs)}update(i,o,c,h,m,g,x,E){this.programConfigurations.updatePaintArrays(i,o,m,c,h,g,x,E)}isEmpty(){return 0===this.layoutVertexArray.length}needsUpload(){return this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ME.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.lineIndexBuffer=i.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,PE.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(i,o,c,h,m,g,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,o,c,h,m,g,void 0,x)}}class fd{constructor(i){this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=i.lut,this.bufferData=new n0(i,!1),this.elevationBufferData=new n0(i,!0),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=i.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=i.sourceLayerIndex,this.worldview=i.worldview}updateFootprints(i,o){}populate(i,o,c,h){this.hasPattern=V_("fill",this.layers,this.pixelRatio,o);const m=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:x,id:E,index:T,sourceLayerIndex:I}of i){const A=this.layers[0]._featureFilter.needGeometry,M=Ne(x,A);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom,{worldview:this.worldview}),M,c))continue;const F=m?m.evaluate(M,{},c,o.availableImages):void 0,L={id:E,properties:x.properties,type:x.type,sourceLayerIndex:I,index:T,geometry:A?M.geometry:_e(x,c,h),patterns:{},sortKey:F};g.push(L)}m&&g.sort((x,E)=>x.sortKey-E.sortKey);for(const x of g){const{geometry:E,index:T,sourceLayerIndex:I}=x;if(this.hasPattern){const A=e0("fill",this.layers,x,this.zoom,this.pixelRatio,o);this.patternFeatures.push(A)}else this.addFeature(x,E,T,c,{},o.availableImages,o.brightness,o.elevationFeatures);o.featureIndex.insert(i[T].feature,E,T,I,this.index)}}update(i,o,c,h,m,g,x){this.bufferData.update(i,o,c,h,m,g,x,this.worldview),this.elevationBufferData.update(i,o,c,h,m,g,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(i,o,c,h,m,g,x,this.worldview)}addFeatures(i,o,c,h,m,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,o,c,h,g,i.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(i){this.bufferData.upload(i),this.elevationBufferData.upload(i),this.elevatedStructures&&this.elevatedStructures.upload(i)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(i,o,c,h,m,g=[],x,E){const T=Oh(o,500);"none"!==this.elevationMode?this.addElevatedRoadFeature(i,T,h,c,E):this.addGeometry(T,this.bufferData),this.bufferData.populatePaintArrays(i,c,m,g,h,x,this.worldview),this.elevationBufferData.populatePaintArrays(i,c,m,g,h,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(i,o,c,h,m){this.elevatedStructures&&(this.elevatedStructures.construct(i),this.elevatedStructures.populatePaintArrays(o,c,h,m,this.worldview))}addElevatedRoadFeature(i,o,c,h,m){const g=new Array,x=Ni.getElevationFeature(i,m);if(!x)return void this.addGeometry(o,this.bufferData);{const T=this.clipPolygonsToTile(o,1);T.length>0&&g.push({polygons:T,elevationFeature:x,elevationTileID:c})}const E={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(i,{},c),featureIndex:h};for(const T of g)if(T.elevationFeature){if("hd-road-base"===this.elevationMode){this.elevatedStructures||(this.elevatedStructures=new Ms(T.elevationTileID,this.layers,this.zoom,this.lut));const A=T.elevationFeature.isTunnel();let M=0;i.properties.hasOwnProperty("level")&&(M=+i.properties.level);for(const F of T.polygons)this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,F,A,T.elevationFeature,M)}null==T.elevationFeature.constantHeight&&(T.polygons=this.prepareElevatedPolygons(T.polygons,T.elevationFeature,T.elevationTileID));const I=new Pn(c,T.elevationTileID);this.addElevatedGeometry(T.polygons,I,T.elevationFeature,"hd-road-base"===this.elevationMode?0:.05,h,E)}}addElevatedGeometry(i,o,c,h,m,g){const x={elevation:c,elevationSampler:o,bias:h,index:m,featureInfo:g},[E,T]=this.addGeometry(i,this.elevationBufferData,x);null==this.elevationBufferData.heightRange?this.elevationBufferData.heightRange={min:E,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,E),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(i,o,c){let h=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,g=null;c&&(g=c.elevationSampler.constantElevation(c.elevation,c.bias),null!=g&&(h=g,m=g));const x=(E,T,I)=>{if(null!=c)if(T.push(E),null!=g)o.elevatedLayoutVertexArray.emplaceBack(g),I.push(g);else{const A=c.elevationSampler.pointElevation(E,c.elevation,c.bias);o.elevatedLayoutVertexArray.emplaceBack(A),I.push(A),h=Math.min(h,A),m=Math.max(m,A)}};for(const E of i){let T=0;for(const J of E)T+=J.length;const I=o.triangleSegments.prepareSegment(T,o.layoutVertexArray,o.indexArray),A=I.vertexLength,M=[],F=[],L=[],V=[],j=[],W=o.layoutVertexArray.length;for(const J of E){if(0===J.length)continue;J!==E[0]&&F.push(M.length/2);const te=o.lineSegments.prepareSegment(J.length,o.layoutVertexArray,o.lineIndexArray),me=te.vertexLength;c&&j.push(o.layoutVertexArray.length-W),x(J[0],L,V),o.layoutVertexArray.emplaceBack(J[0].x,J[0].y),o.lineIndexArray.emplaceBack(me+J.length-1,me),M.push(J[0].x),M.push(J[0].y);for(let he=1;he<J.length;he++)x(J[he],L,V),o.layoutVertexArray.emplaceBack(J[he].x,J[he].y),o.lineIndexArray.emplaceBack(me+he-1,me+he),M.push(J[he].x),M.push(J[he].y);te.vertexLength+=J.length,te.primitiveLength+=J.length}const Q=Ih(M,F);for(let J=0;J<Q.length;J+=3)o.indexArray.emplaceBack(A+Q[J],A+Q[J+1],A+Q[J+2]);if(Q.length>0&&c&&"hd-road-base"===this.elevationMode){const J=c.elevation.isTunnel(),te=c.elevation.safeArea,me=this.elevatedStructures.addVertices(L,V);this.elevatedStructures.addTriangles(Q,me,J);const he=j.length;if(he>0){for(let fe=0;fe<he-1;fe++)this.elevatedStructures.addRenderableRing(c.index,j[fe]+me,j[fe+1]-j[fe],J,te,c.featureInfo);this.elevatedStructures.addRenderableRing(c.index,j[he-1]+me,L.length-j[he-1],J,te,c.featureInfo)}}I.vertexLength+=T,I.primitiveLength+=Q.length/3}return[h,m]}prepareElevatedPolygons(i,o,c){const h=1/ce(c),m=[];for(const g of i){const x=zD(g,new ii(o,h));m.push(...x)}return m}clipPolygonsToTile(i,o){const c=-o,h=-o,m=ft+o,g=ft+o;let x=0;const E=[],T=[];for(;x<i.length;x++){const M=i[x],F=Ef(M);(F.min.x>=c&&F.max.x<=m&&F.min.y>=h&&F.max.y<=g?E:T).push(M)}if(E.length===i.length)return i;const I=[new Qe(c,h),new Qe(m,h),new Qe(m,g),new Qe(c,g),new Qe(c,h)],A=E;for(const M of T)A.push(...LE(M,I));return A}}let Jm,G_,r0,o0;Et(fd,"FillBucket",{omit:["layers","patternFeatures"]}),Et(n0,"FillBufferData"),Et(Ms,"ElevatedStructures");class Qm{constructor(i,o,c,h){if(this.triangleCount=o.length/3,this.min=new Qe(0,0),this.max=new Qe(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===i.length)return;const[m,g]=[i[0].clone(),i[0].clone()];for(let A=1;A<i.length;++A){const M=i[A];m.x=Math.min(m.x,M.x),m.y=Math.min(m.y,M.y),g.x=Math.max(g.x,M.x),g.y=Math.max(g.y,M.y)}if(h){const A=Math.ceil(Math.max(g.x-m.x,g.y-m.y)/h);c=Math.max(c,A)}if(0===c)return;this.min=m,this.max=g;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const E=Math.max(x.x,x.y)/c;this.cellsX=Math.max(1,Math.ceil(x.x/E)),this.cellsY=Math.max(1,Math.ceil(x.y/E)),this.xScale=1/E,this.yScale=1/E;const T=[];for(let A=0;A<this.triangleCount;A++){const M=i[o[3*A+0]].sub(this.min),F=i[o[3*A+1]].sub(this.min),L=i[o[3*A+2]].sub(this.min),V=bl(Math.floor(Math.min(M.x,F.x,L.x)),this.xScale,this.cellsX),j=bl(Math.floor(Math.max(M.x,F.x,L.x)),this.xScale,this.cellsX),W=bl(Math.floor(Math.min(M.y,F.y,L.y)),this.yScale,this.cellsY),Q=bl(Math.floor(Math.max(M.y,F.y,L.y)),this.yScale,this.cellsY),J=new Qe(0,0),te=new Qe(0,0),me=new Qe(0,0),he=new Qe(0,0);for(let fe=W;fe<=Q;++fe){J.y=te.y=fe*E,me.y=he.y=(fe+1)*E;for(let be=V;be<=j;++be)J.x=me.x=be*E,te.x=he.x=(be+1)*E,(Sr(M,F,L,J,te,he)||Sr(M,F,L,J,he,me))&&T.push({cellIdx:fe*this.cellsX+be,triIdx:A})}}if(0===T.length)return;T.sort((A,M)=>A.cellIdx-M.cellIdx||A.triIdx-M.triIdx);let I=0;for(;I<T.length;){const A=T[I].cellIdx,M={start:this.payload.length,len:0};for(;I<T.length&&T[I].cellIdx===A;)++M.len,this.payload.push(T[I++].triIdx);this.cells[A]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,o){if(0===this.triangleCount||0===this.cells.length||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const c=bl(i.x-this.min.x,this.xScale,this.cellsX),h=bl(i.y-this.min.y,this.yScale,this.cellsY),m=this.cells[h*this.cellsX+c];if(m){this._lazyInitLookup();for(let g=0;g<m.len;g++){const x=this.payload[m.start+g],E=Math.floor(x/8),T=1<<x%8;if(!(this.lookup[E]&T)&&(this.lookup[E]|=T,o.push(x),o.length===this.triangleCount))return}}}query(i,o,c){if(0===this.triangleCount||0===this.cells.length||i.x>this.max.x||this.min.x>o.x||i.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const h=bl(i.x-this.min.x,this.xScale,this.cellsX),m=bl(o.x-this.min.x,this.xScale,this.cellsX),g=bl(i.y-this.min.y,this.yScale,this.cellsY),x=bl(o.y-this.min.y,this.yScale,this.cellsY);for(let E=g;E<=x;E++)for(let T=h;T<=m;T++){const I=this.cells[E*this.cellsX+T];if(I)for(let A=0;A<I.len;A++){const M=this.payload[I.start+A],F=Math.floor(M/8),L=1<<M%8;if(!(this.lookup[F]&L)&&(this.lookup[F]|=L,c.push(M),c.length===this.triangleCount))return}}}}function bl(a,i,o){return Math.max(0,Math.min(o-1,Math.floor(a*i)))}Et(Qm,"TriangleGridIndex");class Ib{constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[],this.worldview=i.worldview}updateFootprints(i,o){for(const c of this.footprints)o.push({footprint:c,id:i})}populate(i,o,c,h){const m=[];for(const{feature:g,id:x,index:E,sourceLayerIndex:T}of i){const I=this.layers[0]._featureFilter.needGeometry,A=Ne(g,I);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom,{worldview:this.worldview}),A,c))continue;const M={id:x,properties:g.properties,type:g.type,sourceLayerIndex:T,index:E,geometry:I?A.geometry:_e(g,c,h),patterns:{}};m.push(M)}for(const g of m){const{geometry:x,index:E,sourceLayerIndex:T}=g;this.addFeature(g,x,E,c,{},o.availableImages,o.brightness),o.featureIndex.insert(i[E].feature,x,E,T,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(i){}update(i,o,c,h,m,g,x){}destroy(){}addFeature(i,o,c,h,m,g=[],x){for(const E of Oh(o,2)){const T=[],I=[],A=[],M=new Qe(1/0,1/0),F=new Qe(-1/0,-1/0);for(const j of E)if(0!==j.length){j!==E[0]&&A.push(I.length/2);for(let W=0;W<j.length;W++)I.push(j[W].x),I.push(j[W].y),T.push(j[W]),M.x=Math.min(M.x,j[W].x),M.y=Math.min(M.y,j[W].y),F.x=Math.max(F.x,j[W].x),F.y=Math.max(F.y,j[W].y)}const L=Ih(I,A),V=new Qm(T,L,8,256);this.footprints.push({vertices:T,indices:L,grid:V,min:M,max:F})}}}Et(Ib,"ClipBucket",{omit:["layers"]});const NE=En([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),zE=En([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),BE=En([{name:"a_centroid_pos",components:2,type:"Uint16"}]),VE=En([{name:"a_join_normal_inside",components:3,type:"Int16"}]),pd=En([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),eg=En([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:jE}=NE,$_=Number.MAX_SAFE_INTEGER,UE=$_-1;function HE(a,i,o,c){return a.order<i||a.order===$_||!(a.clipMask&o)||(h=c,0!==(m=a.clipScope).length&&void 0===m.find(g=>g===h));var h,m}function s0(a,i){return a.x-i.x||a.y-i.y}function GE(a,i){return 0===s0(a.min,i.min)&&0===s0(a.max,i.max)}function q_(a,i){return!(a.min.x>i.max.x||a.max.x<i.min.x||a.min.y>i.max.y||a.max.y<i.min.y)}function W_(a,i){if(a.length!==i.length)return!1;for(let o=0;o<a.length;o++)if(a[o].sourceId!==i[o].sourceId||!GE(a[o],i[o])||a[o].order!==i[o].order||a[o].clipMask!==i[o].clipMask||!el(a[o].clipScope,i[o].clipScope))return!1;return!0}function Ab(a,i,o){const c=1/ft,h=1/(1<<o.canonical.z),m=(i.x*c+o.canonical.x)*h+o.wrap,g=(i.y*c+o.canonical.y)*h;return{min:new Qe((a.x*c+o.canonical.x)*h+o.wrap,(a.y*c+o.canonical.y)*h),max:new Qe(m,g)}}function $E(a,i,o){const c=1<<o.canonical.z,h=((i.x-o.wrap)*c-o.canonical.x)*ft,m=(i.y*c-o.canonical.y)*ft;return{min:new Qe(((a.x-o.wrap)*c-o.canonical.x)*ft,(a.y*c-o.canonical.y)*ft),max:new Qe(h,m)}}function a0(a,i,o,c,h,m,g){const x=a.indices,E=a.vertices,T=[];for(let I=c;I<c+h;I+=3){const A=i[o[I+0]+m],M=i[o[I+1]+m],F=i[o[I+2]+m],L=Math.min(A.x,M.x,F.x),V=Math.max(A.x,M.x,F.x),j=Math.min(A.y,M.y,F.y),W=Math.max(A.y,M.y,F.y);T.length=0,a.grid.query(new Qe(L,j),new Qe(V,W),T);for(let Q=0;Q<T.length;Q++){const J=T[Q];if(Sr(E[x[3*J+0]],E[x[3*J+1]],E[x[3*J+2]],A,M,F,g))return!0}}return!1}function Z_(a,i,o,c){if(!a||!o)return!1;let h=a.vertices;if(!i.canonical.equals(c.canonical)||i.wrap!==c.wrap){if(o.vertices.length<a.vertices.length)return Z_(o,c,a,i);const m=i.canonical,g=c.canonical,x=Math.pow(2,g.z-m.z);h=a.vertices.map(E=>new Qe((E.x+m.x*ft)*x-g.x*ft,(E.y+m.y*ft)*x-g.y*ft))}return a0(o,h,a.indices,0,a.indices.length,0,0)}function fc(a,i,o,c){const h=Math.pow(2,c.z-o.z);return new Qe((a+o.x*ft)*h-c.x*ft,(i+o.y*ft)*h-c.y*ft)}function Lh(a,i){const o=[];i.grid.queryPoint(a,o);const c=i.indices,h=i.vertices;for(let m=0;m<o.length;m++){const g=o[m];if(Do([h[c[3*g+0]],h[c[3*g+1]],h[c[3*g+2]]],a))return!0}return!1}const X_=[new Qe(0,0),new Qe(ft,0),new Qe(ft,ft),new Qe(0,ft)];function l0(a,i){const o=[];let c=[];if(!i||a.length<2)return[a];if(2===a.length)return rr(a[0],a[1],X_)?[a]:[];for(let h=0;h<a.length+2;h++){const m=a[h%a.length],g=a[(h+1)%a.length],x=rr(0===h?a[a.length-1]:a[(h-1)%a.length],m,X_),E=rr(m,g,X_),T=x||E;T&&c.push(m),T&&E||c.length>0&&(c.length>1&&o.push(c),c=[])}return c.length>1&&o.push(c),o}const Y_=Re.types,BD=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],VD=["fill-extrusion-flood-light-ground-radius"],jD=Math.pow(2,13),c0=Math.pow(2,15)-1,K_=new Qe(0,1),Nh=2147483648;function J_(a,i,o,c,h,m,g,x){a.emplaceBack((i<<1)+g,(o<<1)+m,(Math.floor(c*jD)<<1)+h,Math.round(x))}function ep(a,i,o){a.emplaceBack(i.x*ft,i.y*ft,o?1:0)}function Q_(a,i,o,c,h,m){a.emplaceBack(i.x,i.y,(o.x<<1)+c,(o.y<<1)+h,m)}function tg(a,i,o){a.emplaceBack(i.x,i.y,i.z,16384*o[0],16384*o[1],16384*o[2])}class Mb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Pb{constructor(){this.centroidXY=new Qe(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Qe(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Qe(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Qe(this.max.x-this.min.x,this.max.y-this.min.y)}}class u0{constructor(){this.acc=new Qe(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,o){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=o.x,i.min.y=i.max.y=o.y)}appendEdge(i,o,c){this.accCount++,this.acc._add(o);let h=!!this.borders;o.x<i.min.x?(i.min.x=o.x,h=!0):o.x>i.max.x&&(i.max.x=o.x,h=!0),o.y<i.min.y?(i.min.y=o.y,h=!0):o.y>i.max.y&&(i.max.y=o.y,h=!0),((0===o.x||o.x===ft)&&o.x===c.x)!=((0===o.y||o.y===ft)&&o.y===c.y)&&this.processBorderOverlap(o,c),h&&this.checkBorderIntersection(o,c)}checkBorderIntersection(i,o){o.x<0!=i.x<0&&this.addBorderIntersection(0,Nt(o.y,i.y,(0-o.x)/(i.x-o.x))),o.x>ft!=i.x>ft&&this.addBorderIntersection(1,Nt(o.y,i.y,(ft-o.x)/(i.x-o.x))),o.y<0!=i.y<0&&this.addBorderIntersection(2,Nt(o.x,i.x,(0-o.y)/(i.y-o.y))),o.y>ft!=i.y>ft&&this.addBorderIntersection(3,Nt(o.x,i.x,(ft-o.y)/(i.y-o.y)))}addBorderIntersection(i,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[i];o<c[0]&&(c[0]=o),o>c[1]&&(c[1]=o)}processBorderOverlap(i,o){if(i.x===o.x){if(i.y===o.y)return;const c=0===i.x?0:1;this.addBorderIntersection(c,o.y),this.addBorderIntersection(c,i.y)}else{const c=0===i.y?2:3;this.addBorderIntersection(c,o.x),this.addBorderIntersection(c,i.x)}}centroid(){return 0===this.accCount?new Qe(0,0):new Qe(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,o)=>i+ +(o[0]!==Number.MAX_VALUE),0):0}}function ng(a,i){const o=a.add(i)._unit(),c=se(a.x*o.x+a.y*o.y,-1,1);var h,m,g;return h=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(h)))/4*c0*((m=a).x*(g=i).y-m.y*g.x<0?-1:1)}const qE=[a=>a.x<0,a=>a.x>ft,a=>a.y<0,a=>a.y>ft];function d0(a,i,o,c){const h=[4];if(0===c)return h;o._mult(c);const m=a.sub(o),g=i.sub(o),x=[a,i,m,g];for(let E=0;E<4;E++)for(const T of x)if(qE[E](T)){h.push(E);break}return h}class h0{constructor(i){this.vertexArray=new na,this.indexArray=new Pi,this.programConfigurations=new Is(i.layers,{zoom:i.zoom,lut:i.lut},o=>VD.includes(o)),this._segments=new Wi,this.hiddenByLandmarkVertexArray=new xa,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Wi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(i,o,c,h=!1){const m=i.length;if(m>2){let g=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let E;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const T=i[0],I=i[1];E=ng(T.sub(i[m-1])._perp()._unit(),I.sub(T)._perp()._unit())}for(let T=0;T<m;T++){const I=T===m-1?0:T+1,A=i[T],M=i[I],F=i[I===m-1?0:I+1],L=M.sub(A)._perp()._unit(),V=ng(L,F.sub(M)._perp()._unit()),j=E,W=V;if(ey(A,M,o)||h&&Ob(A,o)&&Ob(M,o)){E=V;continue}const Q=x.vertexLength;Q_(this.vertexArray,A,M,1,1,j),Q_(this.vertexArray,A,M,1,0,j),Q_(this.vertexArray,A,M,0,1,W),Q_(this.vertexArray,A,M,0,0,W),x.vertexLength+=4;const J=d0(A,M,L,c);for(const te of J)this._segmentToGroundQuads[g].push({id:Q,region:te}),this._segmentToRegionTriCounts[g][te]+=2,x.primitiveLength+=2;E=V}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),o=i.length;for(let c=0;c<o;c++)this._segmentToGroundQuads[c].sort((h,m)=>h.region-m.region);for(let c=0;c<o;c++){const h=this._segmentToGroundQuads[c],m=i[c],g=this._segmentToRegionTriCounts[c];g.reduce((E,T)=>E+T,0);let x=0;for(let E=0;E<=4;E++){const T=g[E];if(0!==T){let I=this.regionSegments[E];I||(I=this.regionSegments[E]=new Wi);const A={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+x,vertexLength:m.vertexLength,primitiveLength:T};I.get().push(A)}x+=T}for(let E=0;E<h.length;E++){const T=h[E].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,o,c,h,m,g,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,o,c,h,m,g,void 0,x)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,zE.members),this.indexBuffer=i.createIndexBuffer(this.indexArray))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,o,c,h,m,g,x,E){this.hasData()&&this.programConfigurations.updatePaintArrays(i,o,c,h,m,g,x,E)}updateHiddenByLandmark(i){this.updateHiddenByLandmarkRange(i.groundVertexArrayOffset,i.groundVertexCount,!!(i.flags&Nh))}updateHiddenByLandmarkRange(i,o,c){if(!this.hasData())return;const h=o+i;if(0!==o){for(let m=i;m<h;++m)this.hiddenByLandmarkVertexArray.emplace(m,c?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,pd.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const o=this.regionSegments[i];o&&o.destroy()}}}}class du{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.pixelRatio=i.pixelRatio,this.layerIds=this.layers.map(o=>o.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Pi,this.footprintVertices=new Ss,this.footprintSegments=[],this.layoutVertexArray=new to,this.centroidVertexArray=new D_,this.wallVertexArray=new Xf,this.indexArray=new Pi,this.programConfigurations=new Is(i.layers,{zoom:i.zoom,lut:i.lut},o=>BD.includes(o)),this.segments=new Wi,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new h0(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=i.worldview}updateFootprints(i,o){}populate(i,o,c,h){this.features=[],this.hasPattern=V_("fill-extrusion",this.layers,this.pixelRatio,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=ce(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:m,id:g,index:x,sourceLayerIndex:E}of i){const T=this.layers[0]._featureFilter.needGeometry,I=Ne(m,T);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom,{worldview:this.worldview}),I,c))continue;const A={id:g,sourceLayerIndex:E,index:x,geometry:T?I.geometry:_e(m,c,h),properties:m.properties,type:m.type,patterns:{}},M=this.layoutVertexArray.length,F="Polygon"===Y_[A.type];if(this.hasPattern)this.features.push({featureId:m.id,feature:e0("fill-extrusion",this.layers,A,this.zoom,this.pixelRatio,o)});else if(this.wallMode)for(const L of A.geometry)for(const V of l0(L,F))this.addFeature(m.id,A,[V],x,c,{},o.availableImages,h,o.brightness);else this.addFeature(m.id,A,A.geometry,x,c,{},o.availableImages,h,o.brightness);o.featureIndex.insert(m,A.geometry,x,E,this.index,M)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,o,c,h,m,g){for(const{featureId:x,feature:E}of this.features){const T="Polygon"===Y_[E.type],{geometry:I}=E;if(this.wallMode)for(const A of I)for(const M of l0(A,T))this.addFeature(x,E,[M],E.index,o,c,h,m,g);else this.addFeature(x,E,I,E.index,o,c,h,m,g)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(i,o,c,h,m,g,x){this.programConfigurations.updatePaintArrays(i,o,m,c,h,g,x,this.worldview),this.groundEffect.update(i,o,m,c,h,g,x,this.worldview)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,jE),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,VE.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,eg.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,BE.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,o,c,h,m,g,x,E,T){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(o,{})/this.tileToMeter,A=[new Qe(0,0),new Qe(ft,ft)],M=E.projection,F="globe"===M.name,L=this.wallMode||"Polygon"===Y_[o.type],V=new u0;V.centroidDataIndex=this.centroidData.length;const j=new Pb;j.buildingId=i,o.properties&&o.properties.hasOwnProperty("building_id")&&(j.buildingId=o.properties.building_id);const W=this.layers[0].paint.get("fill-extrusion-base").evaluate(o,{},m)<=0,Q=this.layers[0].paint.get("fill-extrusion-height").evaluate(o,{},m);let J;if(j.height=Q,j.vertexArrayOffset=this.layoutVertexArray.length,j.groundVertexArrayOffset=this.groundEffect.vertexArray.length,F&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new id),this.wallMode){if(F)return void _n("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==c.length)return;J=function(De){const He=De[0].x===De[De.length-1].x&&De[0].y===De[De.length-1].y;(function(tt){let At=0;const yt=tt.length;for(let pt=0;pt<yt;pt++)At+=(tt[(pt+1)%yt].x-tt[pt].x)*(tt[(pt+1)%yt].y+tt[pt].y);return At>=0})(De)||(De=De.reverse());const $e={geometry:[],joinNormals:[],indices:[]},Ke=[],nt=[],Be=[];let Je=De.length;for(;Je>=2&&De[Je-1].equals(De[Je-2]);)Je--;if(Je<(He?3:2))return $e;let Ae,Ve,at,et,kt,Dt=0;for(;Dt<Je-1&&De[Dt].equals(De[Dt+1]);)Dt++;He&&(Ae=De[Je-2],kt=De[Dt].sub(Ae)._unit()._perp());for(let tt=Dt;tt<Je;tt++){if(at=tt===Je-1?He?De[Dt+1]:void 0:De[tt+1],at&&De[tt].equals(at))continue;kt&&(et=kt),Ae&&(Ve=Ae),Ae=De[tt],kt=at?at.sub(Ae)._unit()._perp():et,et=et||kt;let At=et.add(kt);0===At.x&&0===At.y||At._unit();const yt=At.x*kt.x+At.y*kt.y,pt=0!==yt?1/yt:1/0,xt=et.x*kt.y-et.y*kt.x>0;let zt="miter";const Zt=2;"miter"===zt&&pt>Zt&&(zt="bevel"),"bevel"===zt&&(pt>100&&(zt="flipbevel"),pt<Zt&&(zt="miter"));const on=(Qt,vn,hn,ri)=>{const ie=new Qe(Qt.x,Qt.y),re=new Qe(Qt.x,Qt.y);ie.x+=vn.x*ri,ie.y+=vn.y*ri,re.x-=vn.x*Math.max(hn,1),re.y-=vn.y*Math.max(hn,1),Be.push(vn),Ke.push(ie),nt.push(re)};if("miter"===zt)At._mult(pt),on(Ae,At,0,0);else if("flipbevel"===zt)At=kt.mult(-1),on(Ae,At,0,0),on(Ae,At.mult(-1),0,0);else{const Qt=-Math.sqrt(pt*pt-1),vn=xt?Qt:0,hn=xt?0:Qt;Ve&&on(Ae,et,vn,hn),at&&on(Ae,kt,vn,hn)}}$e.geometry=[...Ke,...nt.reverse(),Ke[0]],$e.joinNormals=[...Be,...Be.reverse(),Be[Be.length-1]];const Xe=$e.geometry.length-1;for(let tt=0;tt<Xe/2;tt++)if(tt+1<Xe/2){let At=tt,yt=tt+1,pt=Xe-1-tt,xt=Xe-2-tt;At=0===At?Xe-1:At-1,yt=0===yt?Xe-1:yt-1,pt=0===pt?Xe-1:pt-1,xt=0===xt?Xe-1:xt-1,$e.indices.push(pt),$e.indices.push(yt),$e.indices.push(At),$e.indices.push(pt),$e.indices.push(xt),$e.indices.push(yt)}return $e}(c[0]),c=[J.geometry]}const te=(De,He)=>De<(He.length-1)/2||De===He.length-1,me=this.wallMode?[c]:Oh(c,500);for(let De=me.length-1;De>=0;De--){const He=me[De];(0===He.length||(he=He[0]).every(ot=>ot.x<=0)||he.every(ot=>ot.x>=ft)||he.every(ot=>ot.y<=0)||he.every(ot=>ot.y>=ft))&&me.splice(De,1)}var he;let fe;if(F)fe=Nb(me,A,m);else{fe=[];for(const De of me)fe.push({polygon:De,bounds:A})}const be=L?this.edgeRadius:0,Ee=be>0&&this.zoom<17,je=(De,He)=>{if(0===De.length)return!1;const ot=De[De.length-1];return He.x===ot.x&&He.y===ot.y};for(const{polygon:De,bounds:He}of fe){let ot=0,$e=0;for(const Je of De)L&&!Je[0].equals(Je[Je.length-1])&&Je.push(Je[0]),$e+=L?Je.length-1:Je.length;const Ke=this.segments.prepareSegment((L?5:4)*$e,this.layoutVertexArray,this.indexArray);j.footprintSegIdx<0&&(j.footprintSegIdx=this.footprintSegments.length),j.polygonSegIdx<0&&(j.polygonSegIdx=this.polygonSegments.length);const nt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Be=new Mb;if(Be.vertexOffset=this.footprintVertices.length,Be.indexOffset=3*this.footprintIndices.length,Be.ringIndices=[],L){const Je=[],Ae=[];ot=Ke.vertexLength;for(let at=0;at<De.length;at++){const et=De[at];et.length&&0!==at&&Ae.push(Je.length/2);const kt=[];let Dt,Xe;Dt=et[1].sub(et[0])._perp()._unit(),Be.ringIndices.push(et.length-1);for(let tt=1;tt<et.length;tt++){const At=et[tt],yt=et[tt===et.length-1?1:tt+1],pt=At.clone();if(be){Xe=yt.sub(At)._perp()._unit();const xt=Dt.add(Xe)._unit(),zt=be*Math.min(4,1/(Dt.x*xt.x+Dt.y*xt.y));pt.x+=zt*xt.x,pt.y+=zt*xt.y,pt.x=Math.round(pt.x),pt.y=Math.round(pt.y),Dt=Xe}if(!W||0!==be&&!Ee||je(kt,pt)||kt.push(pt),J_(this.layoutVertexArray,pt.x,pt.y,0,0,1,1,0),this.wallMode){const xt=te(tt,et);ep(this.wallVertexArray,J.joinNormals[tt],!xt)}Ke.vertexLength++,this.footprintVertices.emplaceBack(At.x,At.y),Je.push(At.x,At.y),F&&tg(this.layoutVertexExtArray,M.projectTilePoint(pt.x,pt.y,m),M.upVector(m,pt.x,pt.y))}W&&(0===be||Ee)&&(0!==kt.length&&je(kt,kt[0])&&kt.pop(),this.groundEffect.addData(kt,He,I))}const Ve=this.wallMode?J.indices:Ih(Je,Ae);for(let at=0;at<Ve.length;at+=3)this.footprintIndices.emplaceBack(Be.vertexOffset+Ve[at+0],Be.vertexOffset+Ve[at+1],Be.vertexOffset+Ve[at+2]),this.indexArray.emplaceBack(ot+Ve[at],ot+Ve[at+2],ot+Ve[at+1]),Ke.primitiveLength++;Be.indexCount+=Ve.length,Be.vertexCount+=this.footprintVertices.length-Be.vertexOffset}for(let Je=0;Je<De.length;Je++){const Ae=De[Je];V.startRing(j,Ae[0]);let Ve=Ae.length>4&&kb(Ae[Ae.length-2],Ae[0],Ae[1]),at=be?WE(Ae[Ae.length-2],Ae[0],Ae[1],be):0;const et=[];let kt,Dt,Xe;Dt=Ae[1].sub(Ae[0])._perp()._unit();let tt=!0;for(let At=1,yt=0;At<Ae.length;At++){let pt=Ae[At-1],xt=Ae[At];const zt=Ae[At===Ae.length-1?1:At+1];if(V.appendEdge(j,xt,pt),ey(xt,pt,He)){be&&(Dt=zt.sub(xt)._perp()._unit(),tt=!tt);continue}const Zt=xt.sub(pt)._perp(),on=Zt.x/(Math.abs(Zt.x)+Math.abs(Zt.y)),Qt=Zt.y>0?1:0,vn=pt.dist(xt);if(yt+vn>32768&&(yt=0),be){Xe=zt.sub(xt)._perp()._unit();let re=f0(pt,xt,zt,Rb(Dt,Xe),be);isNaN(re)&&(re=0);const Le=xt.sub(pt)._unit();pt=pt.add(Le.mult(at))._round(),xt=xt.add(Le.mult(-re))._round(),at=re,Dt=Xe,W&&this.zoom>=17&&(je(et,pt)||et.push(pt),je(et,xt)||et.push(xt))}const hn=Ke.vertexLength,ri=Ae.length>4&&kb(pt,xt,zt);let ie=Fb(yt,Ve,tt);if(J_(this.layoutVertexArray,pt.x,pt.y,on,Qt,0,0,ie),J_(this.layoutVertexArray,pt.x,pt.y,on,Qt,0,1,ie),this.wallMode){const re=te(At-1,Ae),Le=J.joinNormals[At-1];ep(this.wallVertexArray,Le,re),ep(this.wallVertexArray,Le,re)}if(yt+=vn,ie=Fb(yt,ri,!tt),Ve=ri,J_(this.layoutVertexArray,xt.x,xt.y,on,Qt,0,0,ie),J_(this.layoutVertexArray,xt.x,xt.y,on,Qt,0,1,ie),this.wallMode){const re=te(At,Ae),Le=J.joinNormals[At];ep(this.wallVertexArray,Le,re),ep(this.wallVertexArray,Le,re)}if(Ke.vertexLength+=4,this.indexArray.emplaceBack(hn+0,hn+1,hn+2),this.indexArray.emplaceBack(hn+1,hn+3,hn+2),Ke.primitiveLength+=2,be){const re=ot+(1===At?Ae.length-2:At-2),Le=1===At?ot:re+1;if(this.indexArray.emplaceBack(hn+1,re,hn+3),this.indexArray.emplaceBack(re,Le,hn+3),Ke.primitiveLength+=2,void 0===kt&&(kt=hn),!ey(zt,Ae[At],He)){const ct=At===Ae.length-1?kt:Ke.vertexLength;this.indexArray.emplaceBack(hn+2,hn+3,ct),this.indexArray.emplaceBack(hn+3,ct+1,ct),this.indexArray.emplaceBack(hn+3,Le,ct+1),Ke.primitiveLength+=3}tt=!tt}if(F){const re=this.layoutVertexExtArray,Le=M.projectTilePoint(pt.x,pt.y,m),ct=M.projectTilePoint(xt.x,xt.y,m),ht=M.upVector(m,pt.x,pt.y),mt=M.upVector(m,xt.x,xt.y);tg(re,Le,ht),tg(re,Le,ht),tg(re,ct,mt),tg(re,ct,mt)}}L&&(ot+=Ae.length-1),W&&be&&this.zoom>=17&&(0!==et.length&&je(et,et[0])&&et.pop(),this.groundEffect.addData(et,He,I,be>0))}this.footprintSegments.push(Be),nt.triangleCount=this.indexArray.length-nt.triangleArrayOffset,this.polygonSegments.push(nt),++j.footprintSegLen,++j.polygonSegLen}if(j.vertexCount=this.layoutVertexArray.length-j.vertexArrayOffset,j.groundVertexCount=this.groundEffect.vertexArray.length-j.groundVertexArrayOffset,0!==j.vertexCount){if(j.centroidXY=V.borders?K_:this.encodeCentroid(V,j),this.centroidData.push(j),V.borders){this.featuresOnBorder.push(V);const De=this.featuresOnBorder.length-1;for(let He=0;He<V.borders.length;He++)V.borders[He][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[He].push(De)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,h,g,x,m,T,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(o,h,g,x,m,T,this.worldview),this.maxHeight=Math.max(this.maxHeight,Q)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((o,c)=>this.featuresOnBorder[o].borders[i][0]-this.featuresOnBorder[c].borders[i][0])}splitToSubtiles(){const i=[];for(let x=0;x<this.centroidData.length;x++){const E=this.centroidData[x],T=+(E.min.y+E.max.y>ft),I=2*T+(+(E.min.x+E.max.x>ft)^T);for(let A=0;A<E.polygonSegLen;A++){const M=E.polygonSegIdx+A;i.push({centroidIdx:x,subtile:I,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const o=new Pi;i.sort((x,E)=>x.triangleSegmentIdx===E.triangleSegmentIdx?x.subtile-E.subtile:x.triangleSegmentIdx-E.triangleSegmentIdx);let c=0,h=0,m=0;for(const x of i){if(x.triangleSegmentIdx!==c)break;m++}const g=i.length;for(;h!==i.length;){c=i[h].triangleSegmentIdx;let x=0,E=h,T=h;for(let I=E;I<m&&i[I].subtile===x;I++)T++;for(;E!==m;){const I=i[E];x=I.subtile;const A=this.centroidData[I.centroidIdx].min.clone(),M=this.centroidData[I.centroidIdx].max.clone(),F={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let L=E;L<T;L++){const V=i[L],j=this.polygonSegments[V.polygonSegmentIdx],W=this.centroidData[V.centroidIdx].min,Q=this.centroidData[V.centroidIdx].max,J=this.indexArray.uint16;for(let te=j.triangleArrayOffset;te<j.triangleArrayOffset+j.triangleCount;te++)o.emplaceBack(J[3*te],J[3*te+1],J[3*te+2]);F.primitiveLength+=j.triangleCount,A.x=Math.min(A.x,W.x),A.y=Math.min(A.y,W.y),M.x=Math.max(M.x,Q.x),M.y=Math.max(M.y,Q.y)}F.primitiveLength>0&&this.triangleSubSegments.push({segment:F,min:A,max:M}),E=T;for(let L=E;L<m&&i[L].subtile===i[E].subtile;L++)T++}h=m;for(let I=h;I<g&&i[I].triangleSegmentIdx===i[h].triangleSegmentIdx;I++)m++}o._trim(),this.indexArray=o}getVisibleSegments(i,o,c){const h=new Wi;if(this.wallMode){for(const V of this.triangleSubSegments)h.segments.push(V.segment);return h}let m=0,g=0;const x=1<<i.canonical.z;if(o){const V=o.getMinMaxForTile(i);V&&(m=V.min,g=V.max)}g+=this.maxHeight;const E=i.toUnwrapped();let T;const I=[E.canonical.x/x+E.wrap,E.canonical.y/x],A=[(E.canonical.x+1)/x+E.wrap,(E.canonical.y+1)/x],M=(V,j,W)=>[V[0]*(1-W[0])+j[0]*W[0],V[1]*(1-W[1])+j[1]*W[1]],F=[],L=[];for(const V of this.triangleSubSegments){F[0]=V.min.x/ft,F[1]=V.min.y/ft,L[0]=V.max.x/ft,L[1]=V.max.y/ft;const j=M(I,A,F),W=M(I,A,L);if(0===new an([j[0],j[1],m],[W[0],W[1],g]).intersectsPrecise(c)){T&&(h.segments.push(T),T=void 0);continue}const Q=V.segment;T&&T.vertexOffset!==Q.vertexOffset&&(h.segments.push(T),T=void 0),T?(T.vertexLength+=Q.vertexLength,T.primitiveLength+=Q.primitiveLength):T={vertexOffset:Q.vertexOffset,primitiveLength:Q.primitiveLength,vertexLength:Q.vertexLength,primitiveOffset:Q.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&h.segments.push(T),h}encodeCentroid(i,o){const c=i.centroid(),h=o.span(),m=Math.min(7,Math.round(h.x*this.tileToMeter/10)),g=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Qe(se(c.x,1,ft-1)<<3|m,se(c.y,1,ft-1)<<3|g)}encodeBorderCentroid(i){if(!i.borders)return new Qe(0,0);const o=i.borders,c=Number.MAX_VALUE;if(o[0][0]!==c||o[1][0]!==c){const h=o[0][0]!==c?0:1;return new Qe(6|(o[0][0]!==c?0:65528),(o[h][0]+o[h][1])/2<<3|6)}{const h=o[2][0]!==c?2:3;return new Qe((o[h][0]+o[h][1])/2<<3|6,6|(o[2][0]!==c?0:65528))}}showCentroid(i){const o=this.centroidData[i.centroidDataIndex];o.flags&=2147483647,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const o=i.vertexArrayOffset,c=i.vertexCount+i.vertexArrayOffset,h=i.flags&Nh?K_:i.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==h.y||m!==h.x){for(let g=o;g<c;++g)this.centroidVertexArray.emplace(g,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,o,c){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const h=o.getReplacementRegionsForTile(i.toUnwrapped());if(W_(this.activeReplacements,h))return;if(this.activeReplacements=h,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const m=[];for(const g of this.activeReplacements){if(g.order<c)continue;const x=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-i.canonical.z));if(g.footprint.buildingId){const E=g.footprint.buildingId;for(const T of this.centroidData)T.buildingId===E&&(T.flags|=Nh)}else for(const E of this.centroidData)if(!(E.flags&Nh||g.min.x>E.max.x||E.min.x>g.max.x||g.min.y>E.max.y||E.min.y>g.max.y))for(let T=0;T<E.footprintSegLen;T++){const I=this.footprintSegments[E.footprintSegIdx+T];if(m.length=0,UD(this.footprintVertices,I.vertexOffset,I.vertexCount,g.footprintTileId.canonical,i.canonical,m),a0(g.footprint,m,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-x)){E.flags|=Nh;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,o,c){let h=!1;for(let m=0;m<c.footprintSegLen;m++){const g=this.footprintSegments[c.footprintSegIdx+m];let x=0;for(const E of g.ringIndices){for(let T=x,I=E+x-1;T<E+x;I=T++){const A=this.footprintVertices.int16[2*(T+g.vertexOffset)+0],M=this.footprintVertices.int16[2*(T+g.vertexOffset)+1],F=this.footprintVertices.int16[2*(I+g.vertexOffset)+1];M>o!=F>o&&i<(this.footprintVertices.int16[2*(I+g.vertexOffset)+0]-A)*(o-M)/(F-M)+A&&(h=!h)}x=E}}return h}getHeightAtTileCoord(i,o){let c=Number.NEGATIVE_INFINITY,h=!0;const m=4*(i+ft)*ft+(o+ft);if(this.partLookup.hasOwnProperty(m)){const g=this.partLookup[m];return g?{height:g.height,hidden:!!(g.flags&Nh)}:void 0}for(const g of this.centroidData)i>g.max.x||g.min.x>i||o>g.max.y||g.min.y>o||g.height<=c||this.footprintContainsPoint(i,o,g)&&(c=g.height,this.partLookup[m]=g,h=!!(g.flags&Nh));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:h};this.partLookup[m]=void 0}}function Rb(a,i){const o=a.add(i)._unit();return a.x*o.x+a.y*o.y}function WE(a,i,o,c){const h=i.sub(a)._perp()._unit(),m=o.sub(i)._perp()._unit();return f0(a,i,o,Rb(h,m),c)}function f0(a,i,o,c,h){const m=Math.sqrt(1-c*c);return Math.min(a.dist(i)/3,i.dist(o)/3,h*m/c)}function ey(a,i,o){return a.x<o[0].x&&i.x<o[0].x||a.x>o[1].x&&i.x>o[1].x||a.y<o[0].y&&i.y<o[0].y||a.y>o[1].y&&i.y>o[1].y}function Ob(a,i){return a.x<i[0].x||a.x>i[1].x||a.y<i[0].y||a.y>i[1].y}function kb(a,i,o){if(a.x<0||a.x>=ft||i.x<0||i.x>=ft||o.x<0||o.x>=ft)return!1;const c=o.sub(i),h=c.perp(),m=a.sub(i);return(c.x*m.x+c.y*m.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(m.x*m.x+m.y*m.y))>-.866&&h.x*m.x+h.y*m.y<0}function Fb(a,i,o){const c=i?2|a:-3&a;return o?1|c:-2&c}function Lb(){const a=Math.PI/32,i=Math.tan(a),o=D;return o*Math.sqrt(1+2*i*i)-o}function Nb(a,i,o){const c=1<<o.z,h=K(o.x/c),m=K((o.x+1)/c),g=ee(o.y/c),x=ee((o.y+1)/c);return function(E,T,I,A,M=0,F){const L=[];if(!E.length||!I||!A)return L;const V=(he,fe)=>{for(const be of he)L.push({polygon:be,bounds:fe})},j=Math.ceil(Math.log2(I)),W=Math.ceil(Math.log2(A)),Q=j-W,J=[];for(let he=0;he<Math.abs(Q);he++)J.push(Q>0?0:1);for(let he=0;he<Math.min(j,W);he++)J.push(0),J.push(1);let te=E;if(te=U_(te,T[0].y-M,T[1].y+M,1),te=U_(te,T[0].x-M,T[1].x+M,0),!te.length)return L;const me=[];for(J.length?me.push({polygons:te,bounds:T,depth:0}):V(te,T);me.length;){const he=me.pop(),fe=he.depth,be=J[fe],Ee=he.bounds[0],je=he.bounds[1],De=0===be?Ee.x:Ee.y,He=0===be?je.x:je.y,ot=F?F(be,De,He):.5*(De+He),$e=U_(he.polygons,De-M,ot+M,be),Ke=U_(he.polygons,ot-M,He+M,be);if($e.length){const nt=[Ee,new Qe(0===be?ot:je.x,1===be?ot:je.y)];J.length>fe+1?me.push({polygons:$e,bounds:nt,depth:fe+1}):V($e,nt)}if(Ke.length){const nt=[new Qe(0===be?ot:Ee.x,1===be?ot:Ee.y),je];J.length>fe+1?me.push({polygons:Ke,bounds:nt,depth:fe+1}):V(Ke,nt)}}return L}(a,i,Math.ceil((m-h)/11.25),Math.ceil((g-x)/11.25),1,(E,T,I)=>{if(0===E)return.5*(T+I);{const A=ee((o.y+T/ft)/c);return(q(.5*(ee((o.y+I/ft)/c)+A))*c-o.y)*ft}})}function UD(a,i,o,c,h,m){const g=Math.pow(2,c.z-h.z);for(let x=0;x<o;x++){let E=a.int16[2*(x+i)+0],T=a.int16[2*(x+i)+1];E=(E+h.x*ft)*g-c.x*ft,T=(T+h.y*ft)*g-c.y*ft,m.push(new Qe(E,T))}}let ZE,tp;Et(du,"FillExtrusionBucket",{omit:["layers","features"]}),Et(Pb,"PartData"),Et(Mb,"FootprintSegment"),Et(u0,"BorderCentroidData"),Et(h0,"GroundEffect");class pc extends Qe{constructor(i,o,c){super(i,o),this.z=c}}class p0 extends pc{constructor(i,o,c,h){super(i,o,c),this.w=h}}function m0(a,i,o,c){const h="x"===o?"y":"x",m=(c-a[o])/(i[o]-a[o]);a[h]=Math.round(a[h]+(i[h]-a[h])*m),a[o]=c,a.hasOwnProperty("z")&&(a.z=Nt(a.z,i.z,m)),a.hasOwnProperty("w")&&(a.w=Nt(a.w,i.w,m))}function ty(a,i,o,c){const h=o,m=c;for(const g of["x","y"]){let x=a,E=i;x[g]>=E[g]&&(x=i,E=a),x[g]<h&&E[g]>h&&m0(x,E,g,h),x[g]<m&&E[g]>m&&m0(E,x,g,m)}}function np(a,i,o,c,h,m){const g=[];for(let x=0;x<a.length;x++){const E=a[x];let T;const I=g.length;let A=0;for(let M=0;M<E.length-1;M++){let F=E[M],L=E[M+1],V=0;const j=A;let W,Q;m&&(V=Math.hypot(L.x-F.x,L.y-F.y),A+=V,W=F,Q=L),F.x<i&&L.x<i||(F.x<i?F=new Qe(i,F.y+(i-F.x)/(L.x-F.x)*(L.y-F.y))._round():L.x<i&&(L=new Qe(i,F.y+(i-F.x)/(L.x-F.x)*(L.y-F.y))._round()),F.y<o&&L.y<o||(F.y<o?F=new Qe(F.x+(o-F.y)/(L.y-F.y)*(L.x-F.x),o)._round():L.y<o&&(L=new Qe(F.x+(o-F.y)/(L.y-F.y)*(L.x-F.x),o)._round()),F.x>=c&&L.x>=c||(F.x>=c?F=new Qe(c,F.y+(c-F.x)/(L.x-F.x)*(L.y-F.y))._round():L.x>=c&&(L=new Qe(c,F.y+(c-F.x)/(L.x-F.x)*(L.y-F.y))._round()),F.y>=h&&L.y>=h||(F.y>=h?F=new Qe(F.x+(h-F.y)/(L.y-F.y)*(L.x-F.x),h)._round():L.y>=h&&(L=new Qe(F.x+(h-F.y)/(L.y-F.y)*(L.x-F.x),h)._round()),T&&F.equals(T[T.length-1])||(T=[F],g.push(T),m&&m.push({progress:{min:j+g0(W,Q,F)*V,max:1},parentIndex:x,prevPoint:W,nextPoint:Q})),T.push(L),m&&(m[m.length-1].progress.max=j+g0(W,Q,L)*V,m[m.length-1].nextPoint=Q)))))}if(m&&A>0)for(let M=I;M<g.length;M++)m[M].progress.min/=A,m[M].progress.max/=A}return g}function XE(a,i,o,c,h){if(a.length<2)return void c.push(a);const m=[];for(;i.valid();){const[T,I]=i.get();for(let A=0;A<a.length-1;A++){const M=a[A],F=a[A+1],L=qs(M,F,T,I);if(L){const[V]=L,j=new Qe(Nt(M.x,F.x,V),Nt(M.y,F.y,V));m.push({t:A+V,distance:0,point:j})}}i.next()}if(0===m.length)return void c.push(a);m.sort((T,I)=>T.t-I.t);let g=0,x=0,E=[];for(c.push(E);g!==a.length;){if(x===m.length){for(;g!==a.length;)0!==E.length&&E[E.length-1].equals(a[g])||E.push(a[g]),g++;break}m[x].t<=g?(0!==E.length&&E[E.length-1].equals(m[x].point)||E.push(m[x].point),Math.trunc(m[x].t),x++):(0!==E.length&&E[E.length-1].equals(a[g])||E.push(a[g]),g++)}}function g0(a,i,o){return a.x!==i.x?(o.x-a.x)/(i.x-a.x):a.y!==i.y?(o.y-a.y)/(i.y-a.y):0}function ip(a,i){return a.x*i.x+a.y*i.y}function ig(a,i){if(1===a.length){let o=0;const c=i[o++];let h;for(;!h||c.equals(h);)if(h=i[o++],!h)return 1/0;for(;o<i.length;o++){const m=i[o],g=a[0],x=h.sub(c),E=m.sub(c),T=g.sub(c),I=ip(x,x),A=ip(x,E),M=ip(E,E),F=ip(T,x),L=ip(T,E),V=I*M-A*A,j=(M*F-A*L)/V,W=(I*L-A*F)/V,Q=c.z*(1-j-W)+h.z*j+m.z*W;if(isFinite(Q))return Q}return 1/0}{let o=1/0;for(const c of i)o=Math.min(o,c.z);return o}}function YE(a,i,o,c,h,m,g,x){const E=g*h.getElevationAt(a,i,!0,!0),T=0!==m[0],I=T?0===m[1]?g*(m[0]/7-450):g*function(A,M,F){const L=Math.floor(M[0]/8),V=Math.floor(M[1]/8),j=10*(M[0]-8*L),W=10*(M[1]-8*V),Q=A.getElevationAt(L,V,!0,!0),J=A.getMeterToDEM(F),te=Math.floor(.5*(j*J-1)),me=Math.floor(.5*(W*J-1)),he=A.tileCoordToPixel(L,V),fe=2*te+1,be=2*me+1,Ee=(Je=fe,Ae=be,[(Ke=A).getElevationAtPixel(nt=he.x-te,Be=he.y-me,!0),Ke.getElevationAtPixel(nt+Ae,Be,!0),Ke.getElevationAtPixel(nt,Be+Ae,!0),Ke.getElevationAtPixel(nt+Je,Be+Ae,!0)]),je=Math.abs(Ee[0]-Ee[1]),De=Math.abs(Ee[2]-Ee[3]),He=Math.abs(Ee[0]-Ee[2])+Math.abs(Ee[1]-Ee[3]),ot=Math.min(.25,.5*J*(je+De)/fe),$e=Math.min(.25,.5*J*He/be);var Ke,nt,Be,Je,Ae;return Q+Math.max(ot*j,$e*W)}(h,m,x):E;return{base:E+(0===o?-1:o),top:T?Math.max(I+c,E+o+2):E+c}}class _0{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class KE{constructor(){this.tasks={},this.taskQueue=[],Wt(["process"],this),this.invoker=new _0(this.process),this.nextId=0}add(i,o){const c=this.nextId++,h=function({type:m,isSymbolTile:g,zoom:x}){return x=x||0,"message"===m?0:"maybePrepare"!==m||g?"parseTile"!==m||g?"parseTile"===m&&g?300-x:"maybePrepare"===m&&g?400-x:500:200-x:100-x}(o);if(0===h){try{i()}finally{}return null}return this.tasks[c]={fn:i,metadata:o,priority:h,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const o=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let i=null,o=1/0;for(let h=0;h<this.taskQueue.length;h++){const m=this.tasks[this.taskQueue[h]];m.priority<o&&(o=m.priority,i=h)}if(null===i)return null;const c=this.taskQueue[i];return this.taskQueue.splice(i,1),c}remove(){this.invoker.remove()}}class ny{constructor(i,o,c){this.target=i,this.parent=o,this.mapId=c,this.callbacks={},this.cancelCallbacks={},Wt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new KE}send(i,o,c,h,m=!1,g){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=g,this.callbacks[x]=c);const E=new Set;return this.target.postMessage({id:x,type:i,hasCallback:!!c,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:pl(o,E)},E),{cancel:()=>{c&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(i){const o=i.data;if(!o)return;const c=o.id;if(c&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const h=this.cancelCallbacks[c];delete this.cancelCallbacks[c],h&&h.cancel()}else if(o.mustQueue||di(self)){const h=this.callbacks[c],m=this.scheduler.add(()=>this.processTask(c,o),h&&h.metadata||{type:"message"});m&&(this.cancelCallbacks[c]=m)}else this.processTask(c,o)}processTask(i,o){if(delete this.cancelCallbacks[i],"<response>"===o.type){const c=this.callbacks[i];delete this.callbacks[i],c&&(o.error?c(qo(o.error)):c(null,qo(o.data)))}else{const c=new Set,h=o.hasCallback?(g,x)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:g?pl(g):null,data:pl(x,c)},c)}:()=>{},m=qo(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,m,h);else if(this.parent.getWorkerSource){const g=o.type.split("."),{source:x,scope:E}=m;this.parent.getWorkerSource(o.sourceMapId,g[0],x,E)[g[1]](m,h)}else h(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var rp={workerUrl:"",workerClass:null,workerParams:void 0};const iy="mapboxgl_preloaded_worker_pool";let zh,sp,mc=(()=>{class a{constructor(){this.active={}}acquire(o,c=a.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<c;)this.workers.push(null!=rp.workerClass?new rp.workerClass:new self.Worker(rp.workerUrl,rp.workerParams));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.workers&&0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[iy]}numActive(){return Object.keys(this.active).length}}return a.workerCount=2,a})();class op{constructor(i,o,c="Worker",h=mc.workerCount){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=qe();const m=this.workerPool.acquire(this.id,h);for(let g=0;g<m.length;g++){const x=new op.Actor(m[g],o,this.id);x.name=`${c} ${g}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,o,c){Te(this.actors,(h,m)=>{h.send(i,o,m)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ry(){return zh||(zh=new mc),zh}op.Actor=ny;class y0{constructor(i){this.module=i}createIntArray(i){const o=new Int32Array(i),c=this.module.malloc(o.length*o.BYTES_PER_ELEMENT);return this.module.heap32.set(o,c/o.BYTES_PER_ELEMENT),c}createFloatArray(i){const o=new Float32Array(i),c=this.module.malloc(o.length*o.BYTES_PER_ELEMENT);return this.module.heapF32.set(o,c/o.BYTES_PER_ELEMENT),c}createStringBuffer(i){const o=this.module.malloc(i.length+1);for(let c=0;c<i.length;++c)this.module.heapU8[o+c]=i.charCodeAt(c);return this.module.heapU8[o+i.length]=0,o}readStringBuffer(i){let o="";for(;0!==this.module.heapU8[i];)o+=String.fromCharCode(this.module.heapU8[i]),++i;return o}setStyle(i){const o=i.entranceColorRgb,c=i.facadeGlazingColorRgb,h=i.roofColorRgb,m=i.wallColorRgb,g=i.normalScale;this.module.setStyle(o[0],o[1],o[2],c[0],c[1],c[2],h[0],h[1],h[2],m[0],m[1],m[2],g[0],g[1],g[2],i.tileToMeters)}setAOOptions(i,o){this.module.setAOOptions(i?1:0,o)}setMetricOptions(i,o){this.module.setMetricOptions(i?1:0,o)}setStructuralOptions(i){this.module.setStructuralOptions(i?1:0)}setFacadeOptions(i,o){this.module.setFacadeOptions(i,o?1:0)}setFauxFacadeOptions(i,o,c){this.module.setFauxFacadeOptions(i?1:0,o?1:0,c)}setFacadeClassifierOptions(i){this.module.setFacadeClassifierOptions(i)}generateMesh(i,o){for(const x of i){const E=this.createStringBuffer(x.roofType),T=[0],I=[];for(const F of x.coordinates)if(Array.isArray(F)){for(const L of F)I.push(L.x),I.push(L.y);T.push(I.length)}const A=this.createIntArray(T),M=this.createFloatArray(I);this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,E,x.roofType.length,M,A,T.length-1),this.module.free(E),this.module.free(A),this.module.free(M)}for(const x of o){let E;E=x.entrances?JSON.parse(x.entrances):[];const T=this.createFloatArray(E),I=[];for(const M of x.coordinates)I.push(M.x),I.push(M.y);const A=this.createFloatArray(I);this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,T,E.length,A,I.length),this.module.free(T),this.module.free(A)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const c=this.module.getMeshCount(),h=new Array(c);for(let x=0;x<c;x++){const E=this.module.getPositionsPtr(x),T=this.module.getPositionsLength(x),I=new Float32Array(this.module.heapF32.buffer,E,T),A=this.module.getNormalsPtr(x),M=this.module.getNormalsLength(x),F=new Float32Array(this.module.heapF32.buffer,A,M),L=this.module.getColorsPtr(x),V=this.module.getColorsLength(x),j=new Uint8Array(this.module.heapU8.buffer,L,V),W=this.module.getAOPtr(x),Q=this.module.getAOLength(x),J=new Float32Array(this.module.heapF32.buffer,W,Q),te=this.module.getUVPtr(x),me=this.module.getUVLength(x),he=new Float32Array(this.module.heapF32.buffer,te,me),fe=this.module.getFauxFacadePtr(x),be=this.module.getFauxFacadeLength(x),Ee=new Uint8Array(this.module.heapU8.buffer,fe,be),je=this.module.getIndicesPtr(x),De=this.module.getIndicesLength(x),He=new Int32Array(this.module.heap32.buffer,je,De),ot=this.module.getBuildingPart(x),$e=this.readStringBuffer(ot);h[x]={positions:I,normals:F,colors:j,ao:J,uv:he,isFauxFacade:Ee,indices:He,buildingPart:$e}}const m=this.module.getRingCount(),g=[];for(let x=0;x<m;x++){const E=this.module.getRingPtr(x),T=this.module.getRingLength(x),I=new Float32Array(this.module.heapF32.buffer,E,T);g.push(I)}return{meshes:h,modifiedPolygonRings:g}}}let md,Ua,Ps,gd,v0,ap=null,Bh=null,Vh=null,oy=null;function zb(){return di(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Ua||so.DRACO_URL}function Bb(){if(di(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(gd)return gd;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return gd=WebAssembly.validate(a)?so.MESHOPT_SIMD_URL:so.MESHOPT_URL,gd}const jh={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},JE={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},lp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function hu(a,i,o){const c=o.json.bufferViews.length,h=o.buffers.length;i.bufferView=c,o.json.bufferViews[c]={buffer:h,byteLength:a.byteLength},o.buffers[h]=a}const Vb="KHR_draco_mesh_compression";function rg(a,i){const o=a.extensions&&a.extensions[Vb];if(!o)return;const c=new Ps.Decoder,h=sy(i,o.bufferView),m=new Ps.Mesh;if(!c.DecodeArrayToMesh(h,h.byteLength,m))throw new Error("Failed to decode Draco mesh");const g=i.json.accessors[a.indices],x=jh[g.componentType],E=g.count*x.BYTES_PER_ELEMENT,T=Ps._malloc(E);x===Uint16Array?c.GetTrianglesUInt16Array(m,E,T):c.GetTrianglesUInt32Array(m,E,T),hu(Ps.memory.buffer.slice(T,T+E),g,i),Ps._free(T);for(const I of Object.keys(o.attributes)){const A=c.GetAttributeByUniqueId(m,o.attributes[I]),M=i.json.accessors[a.attributes[I]],F=JE[M.componentType],L=M.count*lp[M.type]*jh[M.componentType].BYTES_PER_ELEMENT,V=Ps._malloc(L);c.GetAttributeDataArrayForAllPoints(m,A,Ps[F],L,V),hu(Ps.memory.buffer.slice(V,V+L),M,i),Ps._free(V)}c.destroy(),m.destroy(),delete a.extensions[Vb]}const cp="EXT_meshopt_compression";function QE(a,i){if(!a.extensions||!a.extensions[cp])return;const o=a.extensions[cp],c=new Uint8Array(i.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),h=new Uint8Array(o.count*o.byteStride);v0.decodeGltfBuffer(h,o.count,o.byteStride,c,o.mode,o.filter),a.buffer=i.buffers.length,a.byteOffset=0,i.buffers[a.buffer]=h.buffer,delete a.extensions[cp]}const eT=1179937895,tT=new TextDecoder("utf8");function og(a,i){return new URL(a,i).href}function nT(a,i,o,c){return fetch(og(a.uri,c)).then(h=>h.arrayBuffer()).then(h=>{i.buffers[o]=h})}function sy(a,i){const o=a.json.bufferViews[i];return new Uint8Array(a.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function b0(a,i,o,c){if(a.uri){const h=og(a.uri,c);return fetch(h).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{i.images[o]=m})}if(void 0!==a.bufferView){const h=sy(i,a.bufferView),m=new Blob([h],{type:a.mimeType});return createImageBitmap(m).then(g=>{i.images[o]=g})}}function Uh(a,i=0,o){const c={json:null,images:[],buffers:[]};if(new Uint32Array(a,i,1)[0]===eT){const I=new Uint32Array(a,i);let A=2;const M=(I[A++]>>2)-3,F=I[A++]>>2;if(A++,c.json=JSON.parse(tT.decode(I.subarray(A,A+F))),A+=F,A<M){const L=I[A++];A++;const V=i+(A<<2);c.buffers[0]=a.slice(V,V+L)}}else c.json=JSON.parse(tT.decode(new Uint8Array(a,i)));const{buffers:h,images:m,meshes:g,extensionsUsed:x,bufferViews:E}=c.json;let T=Promise.resolve();if(h){const I=[];for(let A=0;A<h.length;A++){const M=h[A];M.uri?I.push(nT(M,c,A,o)):c.buffers[A]||(c.buffers[A]=null)}T=Promise.all(I)}return T.then(()=>{const I=[],A=x&&x.includes(Vb),M=x&&x.includes(cp);if(A&&I.push(function(){if(!Ps)return md??(md=function(F){let L,V=null;function j(){L=new Uint8Array(V.buffer)}function W(){throw new Error("Unexpected Draco error.")}const Q={a:{a:W,d:function(J,te,me){return L.copyWithin(J,te,te+me)},c:function(J){const te=L.length,me=Math.max(J>>>0,Math.ceil(1.2*te)),he=Math.ceil((me-te)/65536);try{return V.grow(he),j(),!0}catch{return!1}},b:W}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(F,Q):F.then(J=>J.arrayBuffer()).then(J=>WebAssembly.instantiate(J,Q))).then(J=>{const{Rb:te,Qb:me,P:he,T:fe,X:be,Ja:Ee,La:je,Qa:De,Va:He,Wa:ot,eb:$e,jb:Ke,f:nt,e:Be,yb:Je,zb:Ae,Ab:Ve,Bb:at,Db:et,Gb:kt}=J.instance.exports;V=Be;const Dt=(()=>{let Xe=0,tt=0,At=0,yt=0;return pt=>{At&&(te(yt),te(Xe),tt+=At,At=Xe=0),Xe||(tt+=128,Xe=me(tt));const xt=pt.length+7&-8;let zt=Xe;xt>=tt&&(At=xt,zt=yt=me(xt));for(let Zt=0;Zt<pt.length;Zt++)L[zt+Zt]=pt[Zt];return zt}})();return j(),nt(),{memory:Be,_free:te,_malloc:me,Mesh:class{constructor(){this.ptr=he()}destroy(){fe(this.ptr)}},Decoder:class{constructor(){this.ptr=Ee()}destroy(){Ke(this.ptr)}DecodeArrayToMesh(Xe,tt,At){const yt=Dt(Xe),pt=je(this.ptr,yt,tt,At.ptr);return!!be(pt)}GetAttributeByUniqueId(Xe,tt){return{ptr:De(this.ptr,Xe.ptr,tt)}}GetTrianglesUInt16Array(Xe,tt,At){He(this.ptr,Xe.ptr,tt,At)}GetTrianglesUInt32Array(Xe,tt,At){ot(this.ptr,Xe.ptr,tt,At)}GetAttributeDataArrayForAllPoints(Xe,tt,At,yt,pt){$e(this.ptr,Xe.ptr,tt.ptr,At,yt,pt)}},DT_INT8:Je(),DT_UINT8:Ae(),DT_INT16:Ve(),DT_UINT16:at(),DT_UINT32:et(),DT_FLOAT32:kt()}})}(fetch(zb())),md.then(F=>{Ps=F,md=void 0}))}()),M&&I.push(function(){if(v0)return;const F=function(L){let V;const j=WebAssembly.instantiateStreaming(L,{}).then(J=>{V=J.instance,V.exports.__wasm_call_ctors()}),W={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Q={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:j,supported:!0,decodeGltfBuffer(J,te,me,he,fe,be){!function(Ee,je,De,He,ot,$e,Ke){const nt=Ee.exports.sbrk,Be=He+3&-4,Je=nt(Be*ot),Ae=nt($e.length),Ve=new Uint8Array(Ee.exports.memory.buffer);Ve.set($e,Ae);const at=je(Je,He,ot,Ae,$e.length);if(0===at&&Ke&&Ke(Je,Be,ot),De.set(Ve.subarray(Je,Je+He*ot)),nt(Je-nt(0)),0!==at)throw new Error(`Malformed buffer data: ${at}`)}(V,V.exports[Q[fe]],J,te,me,he,V.exports[W[be]])}}}(fetch(Bb()));return F.ready.then(()=>{v0=F})}()),m)for(let F=0;F<m.length;F++)I.push(b0(m[F],c,F,o));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(A&&g)for(const{primitives:F}of g)for(const L of F)rg(L,c);if(M&&g&&E)for(const F of E)QE(F,c);return c})})}function sg(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function ag(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Hh{constructor(i,o,c,h){this.context=i,this.format=c,this.useMipmap=h&&h.useMipmap,this.texture=i.gl.createTexture(),this.update(o,{premultiply:h&&h.premultiply})}update(i,o){const c=i&&i instanceof HTMLVideoElement&&0===i.width?i.videoWidth:i.width,h=i&&i instanceof HTMLVideoElement&&0===i.height?i.videoHeight:i.height,{context:m}=this,{gl:g}=m,{x,y:E}=o&&o.position?o.position:{x:0,y:0},T=x+c,I=E+h;!this.size||this.size[0]===T&&this.size[1]===I||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!o||!1!==o.premultiply));const A=i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap;if(!this.size&&T>0&&I>0){const M=this.useMipmap?Math.floor(Math.log2(Math.max(T,I)))+1:1;g.texStorage2D(g.TEXTURE_2D,M,this.format,T,I),this.size=[T,I]}if(this.size)if(A)g.texSubImage2D(g.TEXTURE_2D,0,x,E,sg(this.format),ag(this.format),i);else{const M=i.data;M&&g.texSubImage2D(g.TEXTURE_2D,0,x,E,c,h,sg(this.format),ag(this.format),M)}this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(i,o,c=!1){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),i!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!c?i===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),o!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(i,o,c,h,m){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),o!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,o),this.magFilter=o),i!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?i===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),c!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,c),this.wrapS=c),h!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,h),this.wrapT=h),m!==this.compareMode&&(m?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,m)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=m)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class _d{constructor(i,o){this.context=i,this.texture=o}bind(i,o){const{context:c}=this,{gl:h}=c;h.bindTexture(h.TEXTURE_2D,this.texture),i!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,i),this.minFilter=i),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrapS=o)}}const up=En([{name:"a_pos_3f",components:3,type:"Float32"}]),w0=En([{name:"a_color_3f",components:3,type:"Float32"}]),E0=En([{name:"a_color_4f",components:4,type:"Float32"}]),ay=En([{name:"a_uv_2f",components:2,type:"Float32"}]),HD=En([{name:"a_normal_3f",components:3,type:"Float32"}]),T0=En([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),lg=En([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function jb(a,i){const o=ly(a.projection,a.zoom,a.width,a.height),c=function(m,g,x,E,T){const I=new O(x.lng-180*yd,x.lat),A=new O(x.lng+180*yd,x.lat),M=m.project(I.lng,I.lat),F=m.project(A.lng,A.lat),L=-Math.atan2(F.y-M.y,F.x-M.x),V=ue.fromLngLat(x);V.y=se(V.y,-1+yd,1-yd);const j=V.toLngLat(),W=m.project(j.lng,j.lat),Q=ue.fromLngLat(j);Q.x+=yd;const J=Q.toLngLat(),te=m.project(J.lng,J.lat),me=S0(te.x-W.x,te.y-W.y,L),he=ue.fromLngLat(j);he.y+=yd;const fe=he.toLngLat(),be=m.project(fe.lng,fe.lat),Ee=S0(be.x-W.x,be.y-W.y,L),je=Math.abs(me.x)/Math.abs(Ee.y),De=pn([]);zl(De,De,-L*(1-(T?0:E)));const He=pn([]);return ro(He,He,[1,1-(1-je)*E,1]),He[4]=-Ee.x/Ee.y*E,zl(He,He,L),Hi(He,De,He),He}(a.projection,0,a.center,o,i),h=C0(a);return ro(c,c,[h,h,1]),c}function C0(a){const i=a.projection,o=ly(a.projection,a.zoom,a.width,a.height),c=cg(i,a.center),h=cg(i,O.convert(i.center));return Math.pow(2,c*o+(1-o)*h)}function ly(a,i,o,c,h=1/0){const m=a.range;if(!m)return 0;const g=Math.min(h,Math.max(o,c)),x=Math.log(g/1024)/Math.LN2;return we(m[0]+x,m[1]+x,i)}const yd=1/4e4;function cg(a,i){const o=se(i.lat,-le,le),c=new O(i.lng-180*yd,o),h=new O(i.lng+180*yd,o),m=a.project(c.lng,o),g=a.project(h.lng,o),x=ue.fromLngLat(c),E=ue.fromLngLat(h),T=g.x-m.x,I=g.y-m.y,A=E.x-x.x,M=E.y-x.y,F=Math.sqrt((A*A+M*M)/(T*T+I*I));return Math.log(F)/Math.LN2}function S0(a,i,o){const c=Math.cos(o),h=Math.sin(o);return{x:a*c-i*h,y:a*h+i*c}}function Ub(a,i,o){pn(a),zl(a,a,Rn(i[2])),vs(a,a,Rn(i[0])),Zs(a,a,Rn(i[1])),ro(a,a,o),Hi(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function cy(a,i,o,c,h,m,g,x){const E=[o[0]-i[0],o[1]-i[1],0],T=[c[0]-i[0],c[1]-i[1],0];if(go(E)<1e-12||go(T)<1e-12)return Pa(a);const I=gi([],E,T);Mi(I,I),oo(T,c,i),E[2]=(m-h)*x,T[2]=(g-h)*x;const A=E;return gi(A,E,T),Mi(A,A),Mu(a,I,A)}function Hb(a,i,o=!1){const c=lu(i.zoom),h=function(m,g,x){const E=g.worldSize,T=[m[12],m[13],m[14]],I=ee(T[1]/E),A=K(T[0]/E),M=pn([]),F=$(1,I)*E,L=$(1,0)*E*pe(I,g.zoom),V=1/Xo(E);let j=L*V;if(x){const te=ly(g.projection,g.zoom,g.width,g.height,1024);j=V*g.projection.pixelSpaceConversion(g.center.lat,E,te)}const W=C(I,A);ki(W,W,Fi([],Mi([],W),F*j*T[2]));const Q=function(te){const me=[te[0],te[1],te[2]];let he=[0,1,0];const fe=gi([],he,me);return gi(he,me,fe),0===mf(he)&&(he=[0,1,0],gi(fe,me,he)),Mi(fe,fe),Mi(he,he),Mi(me,me),[fe[0],fe[1],fe[2],0,he[0],he[1],he[2],0,me[0],me[1],me[2],0,te[0],te[1],te[2],1]}(W);ro(M,M,[j,j,j*F]),Uo(M,M,[-T[0],-T[1],-T[2]]);const J=Hi([],g.globeMatrix,Q);return Hi(J,J,M),Hi(J,J,m),J}(a,i,o);return c>0?function(g,x,E){const T=(L,V,j)=>{const W=go(L),Q=go(V),J=au(L,V,j);return Fi(J,J,1/go(J)*Nt(W,Q,j))},I=T([g[0],g[1],g[2]],[x[0],x[1],x[2]],E),A=T([g[4],g[5],g[6]],[x[4],x[5],x[6]],E),M=T([g[8],g[9],g[10]],[x[8],x[9],x[10]],E),F=au([g[12],g[13],g[14]],[x[12],x[13],x[14]],E);return[I[0],I[1],I[2],0,A[0],A[1],A[2],0,M[0],M[1],M[2],0,F[0],F[1],F[2],1]}(h,function(g,x){const E=x.worldSize,T=$(1,0)*E*pe(x.center.lat,x.zoom)/Xo(E),I=$(1,x.center.lat)*E,A=pn([]);return Zs(A,A,Rn(x.center.lng)),vs(A,A,Rn(x.center.lat)),Uo(A,A,[0,0,Zi]),ro(A,A,[T,T,T*I]),Uo(A,A,[x.point.x-.5*E,x.point.y-.5*E,0]),Hi(A,A,g),Hi(A,x.globeMatrix,A)}(a,i),c):h}function Gb(a,i,o,c){const h=an.projectAabbCorners(c,o);let m=Number.MAX_VALUE,g=-1;for(let T=0;T<h.length;++T){const I=h[T];I[0]=(.5*I[0]+.5)*i.width,I[1]=(.5-.5*I[1])*i.height,I[2]<m&&(g=T,m=I[2])}const x=T=>new Qe(h[T][0],h[T][1]);let E;switch(g){case 0:case 6:E=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:E=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:E=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:E=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(hi(a,E))return m}const vd={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function $b(a,i,o,c,h,m,g,x,E,T=!1){const I=o.zoom,A=o.project(c),M=pe(c.lat,I),F=1/M;pn(a),Uo(a,a,[A.x+g[0]*F,A.y+g[1]*F,g[2]]);let L=1,V=1;const j=o.worldSize;if(T){if("mercator"===o.projection.name){let te=0;o.elevation&&(te=o.elevation.getAtPointOrZero(new ue(A.x/j,A.y/j),0));const me=bs([],[A.x,A.y,te,1],o.projMatrix)[3]/o.cameraToCenterDistance;L=me,V=me*pe(o.center.lat,I)}else if("globe"===o.projection.name){const te=Hb(a,o),me=[0,0,0,1];bs(me,me,Hi([],o.projMatrix,te));const he=me[3]/o.cameraToCenterDistance,fe=lu(I),be=o.projection.pixelsPerMeter(c.lat,j)*pe(c.lat,I),Ee=o.projection.pixelsPerMeter(o.center.lat,j)*pe(o.center.lat,I);L=he/Nt(be,de(o.center.lat),fe),V=he*M/be,L*=Ee,V*=Ee}}else L=F;ro(a,a,[L,L,V]);const W=[...a],Q=i.orientation,J=[];if(Ub(J,[Q[0]+h[0],Q[1]+h[1],Q[2]+h[2]],m),Hi(a,W,J),x&&o.elevation){let te=0;const me=[];if(E&&o.elevation){te=function(fe,be,Ee,je,De){const He=be.elevation;if(!He)return 0;const ot=an.projectAabbCorners(Ee,je),$e=$(1,De.lat)*be.worldSize,Ke=function(tt,At){const yt=[0,0,1],pt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const xt of pt){const zt=tt[xt.corners[0]],Zt=tt[xt.corners[1]],on=tt[xt.corners[2]],Qt=[Zt[0]-zt[0],Zt[1]-zt[1],At*(Zt[2]-zt[2])],vn=gi(Qt,Qt,[on[0]-zt[0],on[1]-zt[1],At*(on[2]-zt[2])]);Mi(vn,vn),xt.dotProductWithUp=ar(vn,yt)}return pt.sort((xt,zt)=>xt.dotProductWithUp-zt.dotProductWithUp),pt[0].corners}(ot,$e),nt=ot[Ke[0]],Be=ot[Ke[1]],Je=ot[Ke[2]],Ae=ot[Ke[3]],Ve=He.getAtPointOrZero(new ue(nt[0]/be.worldSize,nt[1]/be.worldSize),0),at=He.getAtPointOrZero(new ue(Be[0]/be.worldSize,Be[1]/be.worldSize),0),et=He.getAtPointOrZero(new ue(Je[0]/be.worldSize,Je[1]/be.worldSize),0),kt=He.getAtPointOrZero(new ue(Ae[0]/be.worldSize,Ae[1]/be.worldSize),0),Dt=(Ve+kt)/2,Xe=(at+et)/2;return Dt>Xe?at<et?cy(fe,Be,Ae,nt,at,kt,Ve,$e):cy(fe,Je,nt,Ae,et,Ve,kt,$e):Ve<kt?cy(fe,nt,Be,Je,Ve,at,et,$e):cy(fe,Ae,Je,Be,kt,et,at,$e),Math.max(Dt,Xe)}(me,o,i.aabb,a,c);const he=Hi([],Ia([],me),J);Hi(a,W,he)}else te=o.elevation.getAtPointOrZero(new ue(A.x/j,A.y/j),0);0!==te&&(a[14]+=te)}}function dp(a,i,o=!1){a.uploaded||(a.gfxTexture=new Hh(i,a.image,o?i.gl.R8:i.gl.RGBA8,{useMipmap:a.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function D0(a,i,o){a.indexBuffer=i.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=i.createVertexBuffer(a.vertexArray,up.members,!1,!0),a.normalArray&&(a.normalBuffer=i.createVertexBuffer(a.normalArray,HD.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=i.createVertexBuffer(a.texcoordArray,ay.members,!1,!0)),a.colorArray&&(a.colorBuffer=i.createVertexBuffer(a.colorArray,(12===a.colorArray.bytesPerElement?w0:E0).members,!1,!0)),a.featureArray&&(a.pbrBuffer=i.createVertexBuffer(a.featureArray,lg.members,!0)),a.segments=Wi.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const c=a.material;c.pbrMetallicRoughness.baseColorTexture&&dp(c.pbrMetallicRoughness.baseColorTexture,i),c.pbrMetallicRoughness.metallicRoughnessTexture&&dp(c.pbrMetallicRoughness.metallicRoughnessTexture,i),c.normalTexture&&dp(c.normalTexture,i),c.occlusionTexture&&dp(c.occlusionTexture,i,o),c.emissionTexture&&dp(c.emissionTexture,i)}function hp(a,i,o){if(a.meshes)for(const c of a.meshes)D0(c,i,o);if(a.children)for(const c of a.children)hp(c,i,o)}function uy(a){if(a.meshes)for(const i of a.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(a.children)for(const i of a.children)uy(i)}function dy(a){if(a.meshes)for(const o of a.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((i=o.material).pbrMetallicRoughness.baseColorTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture&&i.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),i.pbrMetallicRoughness.metallicRoughnessTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&i.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),i.normalTexture&&i.normalTexture.gfxTexture&&i.normalTexture.gfxTexture.destroy(),i.emissionTexture&&i.emissionTexture.gfxTexture&&i.emissionTexture.gfxTexture.destroy(),i.occlusionTexture&&i.occlusionTexture.gfxTexture&&i.occlusionTexture.gfxTexture.destroy()));var i;if(a.children)for(const o of a.children)dy(o)}function Gh(a,i){const o=a.json.bufferViews[i.bufferView],c=jh[i.componentType];return new c(a.buffers[o.buffer],(i.byteOffset||0)+(o.byteOffset||0),i.count*(o.byteStride&&o.byteStride!==lp[i.type]*c.BYTES_PER_ELEMENT?o.byteStride/c.BYTES_PER_ELEMENT:lp[i.type]))}function hy(a,i,o,c){const h=jh[i.componentType],m=function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),g=a.json.bufferViews[i.bufferView],x=g.byteStride?g.byteStride/h.BYTES_PER_ELEMENT:lp[i.type],E=o.float32,T=E.length/o.capacity;for(let I=0,A=0;I<i.count*x;I+=x,A+=T)for(let M=0;M<T;M++)E[A+M]=c[I+M]*m;o._trim()}function GD(a,i,o){const c=a.indices,h=a.attributes,m={};m.indexArray=new Pi;const g=i.json.accessors[c],x=g.count/3;m.indexArray.reserve(x);const E=Gh(i,g);for(let M=0;M<x;M++)m.indexArray.emplaceBack(E[3*M],E[3*M+1],E[3*M+2]);m.indexArray._trim(),m.vertexArray=new Ds;const T=i.json.accessors[h.POSITION];m.vertexArray.reserve(T.count);const I=Gh(i,T);for(let M=0;M<T.count;M++)m.vertexArray.emplaceBack(I[3*M],I[3*M+1],I[3*M+2]);if(m.vertexArray._trim(),m.aabb=new an(T.min,T.max),m.centroid=function(M,F){const L=[0,0,0],V=M.length;if(V>0){for(let j=0;j<V;j++){const W=3*M[j];L[0]+=F[W],L[1]+=F[W+1],L[2]+=F[W+2]}L[0]/=V,L[1]/=V,L[2]/=V}return L}(E,I),void 0!==h.COLOR_0){const M=i.json.accessors[h.COLOR_0],F=lp[M.type],L=Gh(i,M);m.colorArray=3===F?new Ds:new Va,m.colorArray.resize(M.count),hy(i,M,m.colorArray,L)}if(void 0!==h.NORMAL){m.normalArray=new Ds;const M=i.json.accessors[h.NORMAL];m.normalArray.resize(M.count);const F=Gh(i,M);hy(i,M,m.normalArray,F)}if(void 0!==h.TEXCOORD_0&&o.length>0){m.texcoordArray=new lc;const M=i.json.accessors[h.TEXCOORD_0];m.texcoordArray.resize(M.count);const F=Gh(i,M);hy(i,M,m.texcoordArray,F)}if(void 0!==h._FEATURE_ID_RGBA4444){const M=i.json.accessors[h._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Gh(i,M))}void 0!==h._FEATURE_RGBA4444&&(m.featureData=new Uint32Array(Gh(i,i.json.accessors[h._FEATURE_RGBA4444]).buffer));const A=a.material;return m.material=function(M,F){const{emissiveFactor:L=[0,0,0],alphaMode:V="OPAQUE",alphaCutoff:j=.5,normalTexture:W,occlusionTexture:Q,emissiveTexture:J,doubleSided:te}=M,{baseColorFactor:me=[1,1,1,1],metallicFactor:he=1,roughnessFactor:fe=1,baseColorTexture:be,metallicRoughnessTexture:Ee}=M.pbrMetallicRoughness||{},je=Q?F[Q.index]:void 0;if(Q&&Q.extensions&&Q.extensions.KHR_texture_transform&&je){const De=Q.extensions.KHR_texture_transform;je.offsetScale=[De.offset[0],De.offset[1],De.scale[0],De.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Jn(...me),metallicFactor:he,roughnessFactor:fe,baseColorTexture:be?F[be.index]:void 0,metallicRoughnessTexture:Ee?F[Ee.index]:void 0},doubleSided:te,emissiveFactor:new Jn(...L),alphaMode:V,alphaCutoff:j,normalTexture:W?F[W.index]:void 0,occlusionTexture:je,emissionTexture:J?F[J.index]:void 0,defined:void 0===M.defined}}(void 0!==A?i.json.materials[A]:{defined:!1},o),m}function qb(a,i,o){const{matrix:c,rotation:h,translation:m,scale:g,mesh:x,extras:E,children:T}=a,I={};if(I.matrix=c||(F=m||[0,0,0],he=(V=(M=h||[0,0,0,1])[0])*(J=V+V),fe=V*(te=(j=M[1])+j),be=V*(me=(W=M[2])+W),je=j*me,He=(Q=M[3])*J,ot=Q*te,$e=Q*me,nt=(L=g||[1,1,1])[1],Be=L[2],(A=[])[0]=(1-((Ee=j*te)+(De=W*me)))*(Ke=L[0]),A[1]=(fe+$e)*Ke,A[2]=(be-ot)*Ke,A[3]=0,A[4]=(fe-$e)*nt,A[5]=(1-(he+De))*nt,A[6]=(je+He)*nt,A[7]=0,A[8]=(be+ot)*Be,A[9]=(je-He)*Be,A[10]=(1-(he+Ee))*Be,A[11]=0,A[12]=F[0],A[13]=F[1],A[14]=F[2],A[15]=1,A),void 0!==x){I.meshes=o[x];const A=I.anchor=[0,0];for(const M of I.meshes){const{min:F,max:L}=M.aabb;A[0]+=F[0]+L[0],A[1]+=F[1]+L[1]}A[0]=Math.floor(A[0]/I.meshes.length/2),A[1]=Math.floor(A[1]/I.meshes.length/2)}var A,M,F,L,V,j,W,Q,J,te,me,he,fe,be,Ee,je,De,He,ot,$e,Ke,nt,Be;if(E&&(E.id&&(I.id=E.id),E.lights&&(I.lights=function(A){if(!A.length)return[];const M=function(W){const Q=atob(W),J=new Uint8Array(Q.length);for(let te=0;te<Q.length;te++)J[te]=Q.codePointAt(te);return J}(A),F=[],L=M.length/24,V=new Uint16Array(M.buffer),j=new Float32Array(M.buffer);for(let W=0;W<L;W++){const Q=V[2*W*6]/30,J=V[2*W*6+1]/30,te=V[2*W*6+10]/100,me=j[6*W+1],he=j[6*W+2],fe=j[6*W+3],be=j[6*W+4],Ee=fe-me,je=be-he,De=Math.hypot(Ee,je);F.push({pos:[me+.5*Ee,he+.5*je,J],normal:[je/De,-Ee/De,0],width:De,height:Q,depth:te,points:[me,he,fe,be]})}return F}(E.lights))),T){const A=[];for(const M of T)A.push(qb(i.json.nodes[M],i,o));I.children=A}return I}function fp(a){if(0===a.vertices.length||0===a.indices.length)return null;const i=new Qm(a.vertices,a.indices,8,256),[o,c]=[i.min.clone(),i.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:i,min:o,max:c}}function iT(a){if(!a.extras||!a.extras.ground)return null;const i=a.extras.ground;if(!i||!Array.isArray(i)||0===i.length)return null;const o=i[0];if(!o||!Array.isArray(o)||0===o.length)return null;const c=[];for(const g of o){if(!Array.isArray(g)||2!==g.length)continue;const x=g[0],E=g[1];"number"==typeof x&&"number"==typeof E&&c.push(new Qe(x,E))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let h=0;for(let g=0;g<c.length;g++){const x=c[g],E=c[(g+1)%c.length],T=c[(g+2)%c.length];h+=(x.x-E.x)*(T.y-E.y)-(T.x-E.x)*(x.y-E.y)}h>0&&c.reverse();const m=Ih(c.flatMap(g=>[g.x,g.y]),[]);return 0===m.length?null:{vertices:c,indices:m}}function pp(a,i){const o=[],c=[];let h=0;const m=[];for(const g of a){h=o.length;const x=g.vertexArray.float32,E=g.indexArray.uint16;for(let T=0;T<g.vertexArray.length;T++)m[0]=x[3*T+0],m[1]=x[3*T+1],m[2]=x[3*T+2],lr(m,m,i),o.push(new Qe(m[0],m[1]));for(let T=0;T<3*g.indexArray.length;T++)c.push(E[T]+h)}if(c.length%3!=0)return null;for(let g=0;g<c.length;g+=3){const x=o[c[g+0]],E=o[c[g+1]],T=o[c[g+2]];(x.x-E.x)*(T.y-E.y)-(T.x-E.x)*(x.y-E.y)>0&&([c[g+1],c[g+2]]=[c[g+2],c[g+1]])}return{vertices:o,indices:c}}function Yo(a){const o=function(E,T){const I=[];for(const A of E.json.meshes){const M=[];for(const F of A.primitives)M.push(GD(F,E,T));I.push(M)}return I}(a,function(E,T){const I=[],A=WebGL2RenderingContext;if(E.json.textures)for(const M of E.json.textures){const F={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};void 0!==M.sampler&&Object.assign(F,E.json.samplers[M.sampler]),I.push({image:T[M.source],sampler:F,uploaded:!1})}return I}(a,a.images)),{scenes:c,scene:h,nodes:m}=a.json,g=c?c[h||0].nodes:m,x=[];for(const E of g)x.push(qb(m[E],a,o));return function(E,T,I){const A={},M=new Set;for(let F=0;F<E.length;F++){const L=I[T[F]];if(!L.extras)continue;const V=L.extras["mapbox:footprint:version"],j=L.extras["mapbox:footprint:id"];(V||j)&&M.add(F),"1.0.0"===V&&j&&(A[j]=F)}for(let F=0;F<E.length;F++){if(M.has(F))continue;const L=E[F],V=I[T[F]];if(!V.extras)continue;let j=null;L.id in A&&(j=pp(E[A[L.id]].meshes,L.matrix)),j||(j=iT(V)),j&&(L.footprint=fp(j))}if(M.size>0){const F=Array.from(M.values()).sort((L,V)=>L-V);for(let L=F.length-1;L>=0;L--)E.splice(F[L],1)}}(x,g,a.json.nodes),x}function rT(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const i=a.vertexArray.float32,o=a.aabb.min[0]-1,c=a.aabb.min[1]-1,h=64/(a.aabb.max[0]-o+2),m=64/(a.aabb.max[1]-c+2);for(let g=0;g<i.length;g+=3){const x=i[g+2],E=(i[g+0]-o)*h|0,T=(i[g+1]-c)*m|0;x>a.heightmap[64*T+E]&&(a.heightmap[64*T+E]=x)}}function mp(a,i,o,c,h){o.reserve(o.length+4*a.length),c.reserve(c.length+10*a.length),h.reserve(h.length+10*a.length);let m=c.length;for(const g of a){const x=Math.min(10,Math.max(4,1.3*g.height))*i,E=[-g.normal[1],g.normal[0],0],T=Math.min(.29,.1*g.width/g.depth),I=g.width-2*g.depth*i*(T+.01),A=Ho([],g.pos,E,I/2),M=Ho([],g.pos,E,-I/2),F=[A[0],A[1],A[2]+g.height],L=[M[0],M[1],M[2]+g.height],V=Ho([],g.normal,E,T);Fi(V,V,x);const j=Ho([],g.normal,E,-T);Fi(j,j,x),ki(V,A,V),ki(j,M,j),A[2]+=.1,M[2]+=.1,c.emplaceBack(V[0],V[1],V[2]),c.emplaceBack(j[0],j[1],j[2]),c.emplaceBack(A[0],A[1],A[2]),c.emplaceBack(M[0],M[1],M[2]),c.emplaceBack(F[0],F[1],F[2]),c.emplaceBack(L[0],L[1],L[2]),c.emplaceBack(A[0],A[1],A[2]),c.emplaceBack(M[0],M[1],M[2]),c.emplaceBack(V[0],V[1],V[2]),c.emplaceBack(j[0],j[1],j[2]);const W=I/x/2;h.emplaceBack(-W-T,-1,W,.8),h.emplaceBack(W+T,-1,W,.8),h.emplaceBack(-W,0,W,1.3),h.emplaceBack(W,0,W,1.3),h.emplaceBack(W+T,-.8,W,.7),h.emplaceBack(W+T,-.8,W,.7),h.emplaceBack(0,0,W,1.3),h.emplaceBack(0,0,W,1.3),h.emplaceBack(W+T,-1.2,W,.8),h.emplaceBack(W+T,-1.2,W,.8),o.emplaceBack(6+m,4+m,8+m),o.emplaceBack(7+m,9+m,5+m),o.emplaceBack(0+m,1+m,2+m),o.emplaceBack(1+m,3+m,2+m),m+=10}}function $h(a,i){const o={};o.indexArray=new Pi,o.vertexArray=new Ds,o.colorArray=new Va,mp(a,i,o.indexArray,o.vertexArray,o.colorArray);const c={defined:!0};c.emissiveFactor=Jn.black;const h={};return h.baseColorFactor=Jn.white,c.pbrMetallicRoughness=h,o.material=c,o.aabb=new an([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}const Wb=En([{name:"a_pos_3f",components:3,type:"Float32"}]),oT=En([{name:"a_normal_3",components:3,type:"Int16"}]),qh=En([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),sT=En([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),fy=Re.types;function I0(a,i){const o=ft+i;for(const c of a)for(const h of c)if(h.x<-i||h.x>o||h.y<-i||h.y>o)return!1;return!0}class A0{constructor(i){this.layoutAOArray=[],this.indexArrayForConflationUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.footprintLookup={},this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=i.index,this.hasPattern=!1,this.worldview=i.worldview,this.layoutVertexArray=new Ds,this.layoutNormalArray=new Kc,this.layoutColorArray=new va,this.indexArray=new Pi,this.indexArrayForConflation=new Pi,this.entranceBloom={layoutVertexArray:new Ds,layoutVertexBuffer:null,layoutAttenuationArray:new Va,layoutAttenuationBuffer:null,layoutColorArray:new va,layoutColorBuffer:null,indexArray:new Pi,indexArrayForConflation:new Pi,indexBuffer:null,segmentsBucket:new Wi},this.programConfigurations=new Is(i.layers,{zoom:i.zoom,lut:i.lut}),this.segmentsBucket=new Wi,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=i.projection,this.groundEffect=new h0(i)}get segments(){return this.segmentsBucket}get bloomGeometry(){return this.entranceBloom}updateFootprints(i,o){for(const c of this.footprints)o.push({footprint:c,id:i})}prepare(){return function(){if(null!=oy||null!=Vh)return null;if(null!=Bh)return Bh;const i=fetch(so.BUILDING_GEN_URL);return Bh=function(o){let c,h,m,g;function x(){c=new Uint8Array(g.buffer),h=new Int32Array(g.buffer),m=new Float32Array(g.buffer)}function E(){throw new Error("Unexpected BuildingGen error.")}const T=()=>{},I={a:{a:E,f:function(A){const M=c.length,F=Math.max(A>>>0,Math.ceil(1.2*M)),L=Math.ceil((F-M)/65536);try{return g.grow(L),x(),!0}catch{return!1}},g:E,b:T,c:T,d:T,e:T}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(o,I):o.then(A=>A.arrayBuffer()).then(A=>WebAssembly.instantiate(A,I))).then(A=>{const M=A.instance.exports;return(0,M.g)(),g=M.f,x(),new y0({setStyle:M.h,setAOOptions:M.i,setMetricOptions:M.j,setStructuralOptions:M.k,setFacadeOptions:M.l,setFauxFacadeOptions:M.m,setFacadeClassifierOptions:M.n,addFeature:M.o,addFacade:M.p,generateMesh:M.q,getLastError:M.r,getMeshCount:M.s,getPositionsPtr:M.t,getPositionsLength:M.u,getNormalsPtr:M.v,getNormalsLength:M.w,getColorsPtr:M.x,getColorsLength:M.y,getAOPtr:M.z,getAOLength:M.A,getUVPtr:M.B,getUVLength:M.C,getFauxFacadePtr:M.D,getFauxFacadeLength:M.E,getIndicesPtr:M.F,getIndicesLength:M.G,getBuildingPart:M.H,getRingCount:M.I,getRingPtr:M.J,getRingLength:M.K,free:M.L,malloc:M.M,heapU8:c,heap32:h,heapF32:m})})}(i).then(o=>(Bh=null,oy=o,oy)).catch(o=>{_n("Could not load building-gen"),Bh=null,Vh=o}),Bh}()}populate(i,o,c,h){const m=function x0(){return oy}();if(!m)return;const g=ce(c);this.tileToMeter=g,this.brightness=o.brightness,m.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,g],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:g,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),m.setAOOptions(!1,.3),m.setMetricOptions(!1,16),m.setStructuralOptions(!0),m.setFacadeOptions(4,!0),m.setFauxFacadeOptions(!1,!1,1),m.setFacadeClassifierOptions(3);const x=new Map;for(const{feature:E}of i){if("LineString"!==fy[E.type])continue;const T=this.layers[0]._featureFilter.needGeometry,I=Ne(E,T);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom),I,c))continue;const A=T?I.geometry:_e(E,c,h),M=[];for(const j of A)for(const W of j)M.push({x:W.x,y:W.y});const F={coordinates:M,crossPerc:E.properties.cross_perc,distanceToRoad:E.properties.distance_to_road,entrances:E.properties.entrances,sourceId:0},L=E.properties.source_id;let V=x.get(L);V||(V=[],x.set(L,V)),V.push(F)}this.maxHeight=0;for(const{feature:E,index:T}of i){if("LineString"===fy[E.type])continue;const I=this.layers[0]._featureFilter.needGeometry,A=Ne(E,I);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom),A,c))continue;const M=I?A.geometry:_e(E,c,h),F=Oh(M,500);if(!I0(M,163))continue;const L=this.layers[0],V=L.layout.get("building-base").evaluate(E,{},c),j=L.layout.get("building-height").evaluate(E,{},c),W=L.layout.get("building-roof-shape").evaluate(E,{},c),Q=L.paint.get("building-ambient-occlusion-intensity"),J=L.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if("flat"===W)continue;const te=E.properties.source_id;let me;me=x.has(te)?x.get(te):[];const he=[],fe=new Qe(1/0,1/0),be=new Qe(-1/0,-1/0);for(const Xe of F)if(Xe.length>0){const tt=[];for(const At of Xe){const yt=[];for(let pt=At.length-1;pt>=0;pt--){const xt=At[pt];yt.push({x:xt.x,y:xt.y}),fe.x=Math.min(fe.x,xt.x),fe.y=Math.min(fe.y,xt.y),be.x=Math.max(be.x,xt.x),be.y=Math.max(be.y,xt.y)}tt.push(yt)}he.push({id:E.id,height:j,minHeight:V,sourceId:0,roofType:W,coordinates:tt})}const Ee=m.generateMesh(he,me);if("string"==typeof Ee||0===Ee.meshes.length||0===Ee.modifiedPolygonRings.length)continue;let je=0;for(const Xe of Ee.meshes)je+=Xe.positions.length/3;const De=this.segmentsBucket.prepareSegment(je,this.layoutVertexArray,this.indexArray),He=[];let ot=null,$e=0,Ke=-1;const nt=this.indexArray.length;let Be=0;for(const Xe of Ee.meshes){const tt=this.layoutVertexArray.length;if("entrance"===Xe.buildingPart){const yt=new Array;for(let Zt=0;Zt<Xe.indices.length;Zt+=12){const on=Xe.positions[Zt+0],Qt=Xe.positions[Zt+1],vn=Xe.positions[Zt+3],hn=Xe.positions[Zt+4],ri=Xe.positions[Zt+2],ie=Xe.positions[Zt+8]-ri,re=1,Le=vn-on,ct=hn-Qt,ht=Math.hypot(Le,ct);yt.push({pos:[on+.5*Le,Qt+.5*ct,ri],normal:[ct/ht,-Le/ht,0],width:ht,height:ie,depth:re,points:[on,Qt,vn,hn]})}const pt=this.entranceBloom.segmentsBucket.prepareSegment(10*yt.length,this.entranceBloom.layoutVertexArray,this.entranceBloom.indexArray),xt=this.entranceBloom.layoutVertexArray.length;$e=this.entranceBloom.indexArray.length,mp(yt,.5/this.tileToMeter,this.entranceBloom.indexArray,this.entranceBloom.layoutVertexArray,this.entranceBloom.layoutAttenuationArray);const zt=this.entranceBloom.layoutVertexArray.length-xt;Ke=this.entranceBloom.indexArray.length-$e;for(let Zt=0;Zt<zt;Zt++)this.entranceBloom.layoutColorArray.emplaceBack(65535,65535);pt.vertexLength+=zt,pt.primitiveLength+=Ke,ot={part:Xe.buildingPart,vertexOffset:xt,vertexLength:zt}}for(let yt=0;yt<Xe.positions.length;yt+=3)Be=Math.max(Be,Xe.positions[yt+2]),this.layoutVertexArray.emplaceBack(Xe.positions[yt],Xe.positions[yt+1],Xe.positions[yt+2]);for(let yt=0;yt<Xe.normals.length;yt+=3)this.layoutNormalArray.emplaceBack(32767*Xe.normals[yt+0],32767*Xe.normals[yt+1],32767*Xe.normals[yt+2]);for(let yt=0;yt<Xe.ao.length;yt++)this.layoutAOArray.push(Xe.ao[yt]);for(let yt=0;yt<Xe.colors.length;yt+=3){const pt=1+(Xe.ao[yt/3]-1)*Q;this.layoutColorArray.emplaceBack(Xe.colors[yt]*pt<<8|Xe.colors[yt+1]*pt,Xe.colors[yt+2]*pt<<8)}const At=De.vertexLength;for(let yt=0;yt<Xe.indices.length;yt+=3)this.indexArray.emplaceBack(At+Xe.indices[yt],At+Xe.indices[yt+1],At+Xe.indices[yt+2]);De.vertexLength+=Xe.positions.length/3,De.primitiveLength+=Xe.indices.length/3,("roof"===Xe.buildingPart||"wall"===Xe.buildingPart||"facade_glazing"===Xe.buildingPart||"entrance"===Xe.buildingPart)&&He.push({part:Xe.buildingPart,vertexOffset:tt,vertexLength:Xe.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Be),this.buildingFeatures.push({feature:A,segment:De,parts:He,buildingBloom:ot});const Je=this.indexArray.length-nt,Ae=[],Ve=[],at=new Qe(1/0,1/0),et=new Qe(-1/0,-1/0),kt=this.groundEffect.vertexArray.length;for(const Xe of Ee.modifiedPolygonRings){const tt=[],At=new Qe(1/0,1/0),yt=new Qe(-1/0,-1/0);for(let pt=0;pt<Xe.length;pt+=2){const xt=Xe.length-pt-2;At.x=Math.min(At.x,Xe[xt]),At.y=Math.min(At.y,Xe[xt+1]),yt.x=Math.max(yt.x,Xe[xt]),yt.y=Math.max(yt.y,Xe[xt+1]);const zt=new Qe(Xe[xt],Xe[xt+1]);tt.push(zt),Ae.push(zt.x,zt.y),Ve.push(zt.clone())}at.x=Math.min(at.x,At.x),at.y=Math.min(at.y,At.y),et.x=Math.max(et.x,yt.x),et.y=Math.max(et.y,yt.y),this.groundEffect.addData(tt,[At,yt],J)}const Dt=this.groundEffect.vertexArray.length-kt;(fe.x<0||be.x>ft||fe.y<0||be.y>ft)&&this.featuresOnBorder.push({featureId:E.id,footprintIndex:this.footprints.length});{const Xe=Ih(Ae,null,2),tt=new Qm(Ve,Xe,8,256);let At=E.id;E.properties&&E.properties.hasOwnProperty("building_id")&&(At=E.properties.building_id),this.footprints.push({vertices:Ve,indices:Xe,grid:tt,min:at,max:et,buildingId:At,hiddenFlags:0,indicesOffset:nt,indicesLength:Je,bloomIndicesOffset:$e,bloomIndicesLength:Ke,groundEffectVertexOffset:kt,groundEffectVertexLength:Dt,segment:De,height:Be})}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,E,T,{},o.availableImages,c,o.brightness),this.groundEffect.addPaintPropertiesData(E,T,{},o.availableImages,c,o.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0])}update(i,o,c,h,m,g,x){this.programConfigurations.updatePaintArrays(i,o,m,c,h,g,x),this.groundEffect.update(i,o,m,c,h,g,x)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Wb.members),this.layoutNormalBuffer=i.createVertexBuffer(this.layoutNormalArray,oT.members),this.entranceBloom.layoutVertexBuffer=i.createVertexBuffer(this.entranceBloom.layoutVertexArray,Wb.members),this.entranceBloom.layoutAttenuationBuffer=i.createVertexBuffer(this.entranceBloom.layoutAttenuationArray,sT.members),this.uploadUpdatedColorBuffer(i),this.uploadUpdatedIndexBuffer(i),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutNormalBuffer.destroy(),this.layoutColorBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segmentsBucket.destroy(),this.entranceBloom.layoutVertexBuffer.destroy(),this.entranceBloom.layoutColorBuffer.destroy(),this.entranceBloom.layoutAttenuationBuffer.destroy(),this.entranceBloom.indexBuffer.destroy(),this.entranceBloom.segmentsBucket.destroy())}updateFootprintHiddenFlags(i,o,c=!0){let h=!1;const m=c?o:0,g=0|(c?-1:~o);0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of i){const E=this.footprints[x],T=E.hiddenFlags&g|m;E.hiddenFlags!==T&&(E.hiddenFlags=T,h=!0,this.groundEffect.updateHiddenByLandmarkRange(E.groundEffectVertexOffset,E.groundEffectVertexLength,0!==E.hiddenFlags))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(i){if(this.groundEffect.uploadHiddenByLandmark(i),!this.indexArrayForConflationUploaded&&0!==this.indexArray.length){this.indexArrayForConflation.resize(this.indexArray.length),this.indexArrayForConflation.uint16.set(this.indexArray.uint16),this.entranceBloom.indexArrayForConflation.resize(this.entranceBloom.indexArray.length),this.entranceBloom.indexArrayForConflation.uint16.set(this.entranceBloom.indexArray.uint16);for(const o of this.footprints){const c=o.indicesOffset+o.indicesLength;if(0!==o.hiddenFlags){for(let m=o.indicesOffset;m<c;m++)this.indexArrayForConflation.uint16[3*m+0]=0,this.indexArrayForConflation.uint16[3*m+1]=0,this.indexArrayForConflation.uint16[3*m+2]=0;const h=o.bloomIndicesOffset+o.bloomIndicesLength;for(let m=o.bloomIndicesOffset;m<h;m++)this.entranceBloom.indexArrayForConflation.uint16[3*m+0]=0,this.entranceBloom.indexArrayForConflation.uint16[3*m+1]=0,this.entranceBloom.indexArrayForConflation.uint16[3*m+2]=0}}this.indexBuffer?this.indexBuffer.updateData(this.indexArrayForConflation):this.indexBuffer=i.createIndexBuffer(this.indexArrayForConflation,!0),this.entranceBloom.indexBuffer?this.entranceBloom.indexBuffer.updateData(this.entranceBloom.indexArrayForConflation):this.entranceBloom.indexBuffer=i.createIndexBuffer(this.entranceBloom.indexArrayForConflation,!0),this.indexArrayForConflationUploaded=!0}}uploadUpdatedColorBuffer(i){this.layoutColorBuffer?this.layoutColorBuffer.updateData(this.layoutColorArray):this.layoutColorBuffer=i.createVertexBuffer(this.layoutColorArray,qh.members,!0),this.entranceBloom.layoutColorBuffer?this.entranceBloom.layoutColorBuffer.updateData(this.entranceBloom.layoutColorArray):this.entranceBloom.layoutColorBuffer=i.createVertexBuffer(this.entranceBloom.layoutColorArray,qh.members,!0)}evaluate(i){const o=i.paint.get("building-ambient-occlusion-intensity");for(const c of this.buildingFeatures){const h=c.feature;h.properties["building-part"]="roof";const m=i.paint.get("building-color").evaluate(h,{},this.canonical),g=i.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);h.properties["building-part"]="wall";const x=i.paint.get("building-color").evaluate(h,{},this.canonical),E=i.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);h.properties["building-part"]="window";const T=i.paint.get("building-color").evaluate(h,{},this.canonical),I=i.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);h.properties["building-part"]="door";const A=i.paint.get("building-color").evaluate(h,{},this.canonical),M=i.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);for(const L of c.parts){let V,j=m;"roof"===L.part?(j=m,V=g):"wall"===L.part?(j=x,V=E):"facade_glazing"===L.part?(j=T,V=I):"entrance"===L.part&&(j=A,V=M),V=se(V,0,1);for(let W=0;W<L.vertexLength;W++){const Q=L.vertexOffset+W,J=1+(this.layoutAOArray[Q]-1)*o;this.layoutColorArray.emplace(Q,j.r*J*255<<8|j.g*J*255,j.b*J*255<<8|255*V)}}const F=c.buildingBloom;if(F)for(let L=0;L<F.vertexLength;L++)this.bloomGeometry.layoutColorArray.emplace(F.vertexOffset+L,255*A.r<<8|255*A.g,255*A.b<<8|51*M)}}needsEvaluation(i,o){const c=i.transform.projectionOptions,h=i.style.getBrightness();return!(this.uploaded&&c.name===this.projection.name&&this.brightness===h||(this.projection=c,this.brightness=h,0))}updateReplacement(i,o,c){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const h=o.getReplacementRegionsForTile(i.toUnwrapped());if(W_(this.activeReplacements,h))return;this.activeReplacements=h;for(const g of this.footprints)g.hiddenFlags&=-2;const m=[];for(const g of this.activeReplacements){if(g.order<=UE)continue;const x=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-i.canonical.z));for(const E of this.footprints)E.min.x>g.max.x||E.max.x<g.min.x||E.min.y>g.max.y||E.max.y<g.min.y||(m.length=0,aT(E.vertices,0,E.vertices.length,g.footprintTileId.canonical,i.canonical,m),a0(g.footprint,m,E.indices,0,E.indices.length,0,-x)&&(E.hiddenFlags|=1))}0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const g of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,0!==g.hiddenFlags);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(i,o){let c=Number.NEGATIVE_INFINITY,h=!0;const m=4*(i+ft)*ft+(o+ft);if(this.footprintLookup.hasOwnProperty(m)){const x=this.footprintLookup[m];return x?{height:x.height,hidden:0!==x.hiddenFlags}:void 0}const g=new Qe(i,o);for(const x of this.footprints)i>x.max.x||x.min.x>i||o>x.max.y||x.min.y>o||x.height<=c||Lh(g,x)&&(c=x.height,this.footprintLookup[m]=x,h=0!==x.hiddenFlags);if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:h};this.footprintLookup[m]=void 0}}function aT(a,i,o,c,h,m){const g=Math.pow(2,c.z-h.z);for(let x=0;x<o;x++){let E=a[x+i].x,T=a[x+i].y;E=(E+h.x*ft)*g-c.x*ft,T=(T+h.y*ft)*g-c.y*ft,m.push(new Qe(E,T))}}let Xb,M0;Et(A0,"BuildingBucket",{omit:["layers"]});const lT=En([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Yb=En([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:cT}=lT,uT=En([{name:"a_packed",components:3,type:"Float32"}]),{members:$D}=uT,Kb=En([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Jb}=Kb;class Ko{constructor(i,o){this.width=i,this.height=o,this.nextRow=0,this.image=new hc({width:i,height:o}),this.positions={},this.uploaded=!1}getDash(i,o){const c=this.getKey(i,o);return this.positions[c]}trim(){const i=this.width,o=this.height=Lt(this.nextRow);this.image.resize({width:i,height:o})}getKey(i,o){return i.join(",")+o}getDashRanges(i,o,c){const h=[];let m=i.length%2==1?-i[i.length-1]*c:0,g=i[0]*c,x=!0;h.push({left:m,right:g,isDash:x,zeroLength:0===i[0]});let E=i[0];for(let T=1;T<i.length;T++){x=!x;const I=i[T];m=E*c,E+=I,g=E*c,h.push({left:m,right:g,isDash:x,zeroLength:0===I})}return h}addRoundDash(i,o,c){const h=o/2;for(let m=-c;m<=c;m++){const g=this.width*(this.nextRow+c+m);let x=0,E=i[x];for(let T=0;T<this.width;T++){T/E.right>1&&(E=i[++x]);const I=Math.abs(T-E.left),A=Math.abs(T-E.right),M=Math.min(I,A);let F;const L=m/c*(h+1);if(E.isDash){const V=h-Math.abs(L);F=Math.sqrt(M*M+V*V)}else F=h-Math.sqrt(M*M+L*L);this.image.data[g+T]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(i,o){for(let E=i.length-1;E>=0;--E){const T=i[E],I=i[E+1];T.zeroLength?i.splice(E,1):I&&I.isDash===T.isDash&&(I.left=T.left,i.splice(E,1))}const c=i[0],h=i[i.length-1];c.isDash===h.isDash&&(c.left=h.left-this.width,h.right=c.right+this.width);const m=this.width*this.nextRow;let g=0,x=i[g];for(let E=0;E<this.width;E++){E/x.right>1&&(x=i[++g]);const T=Math.abs(E-x.left),I=Math.abs(E-x.right),A=Math.min(T,I);this.image.data[m+E]=Math.max(0,Math.min(255,(x.isDash?A:-A)+o+128))}}addDash(i,o){const c=this.getKey(i,o);if(this.positions[c])return this.positions[c];const h="round"===o,m=h?7:0,g=2*m+1;if(this.nextRow+g>this.height)return _n("LineAtlas out of space"),null;0===i.length&&i.push(1);let x=0;for(let I=0;I<i.length;I++)i[I]<0&&(_n("Negative value is found in line dasharray, replacing values with 0"),i[I]=0),x+=i[I];if(0!==x){const I=this.width/x,A=this.getDashRanges(i,this.width,I);h?this.addRoundDash(A,I,m):this.addRegularDash(A,"square"===o?.5*I:0)}const E=this.nextRow+m;this.nextRow+=g;const T={tl:[E,m],br:[x,0]};return this.positions[c]=T,T}}Et(Ko,"LineAtlas");const Qb=Re.types,qD=Math.cos(Math.PI/180*37.5),P0=Math.cos(Math.PI/180*5);class wl{constructor(i){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=i.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=i.overscaling,this.pixelRatio=i.pixelRatio,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Wf,this.layoutVertexArray2=new Ds,this.patternVertexArray=new Ds,this.indexArray=new Pi,this.programConfigurations=new Is(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new Wi,this.maxLineLength=0,this.zOffsetVertexArray=new Ds,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:ft/64,this.worldview=i.worldview}updateFootprints(i,o){}populate(i,o,c,h){this.hasPattern=V_("line",this.layers,this.pixelRatio,o);const m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=ce(c);const g=this.layers[0].layout.get("line-elevation-reference");if("hd-road-markup"===g)this.elevationType="road";else{const M=this.layers[0].layout.get("line-z-offset"),F=M.isConstant()&&!M.constantOr(0);this.elevationType="sea"!==g&&"ground"!==g&&F?"none":"offset","offset"===this.elevationType&&"none"===g&&_n(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope="offset"===this.elevationType&&void 0!==x;const E=[];for(const{feature:M,id:F,index:L,sourceLayerIndex:V}of i){const j=this.layers[0]._featureFilter.needGeometry,W=Ne(M,j);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom,{worldview:this.worldview}),W,c))continue;const Q=m?m.evaluate(W,{},c):void 0,J={id:F,properties:M.properties,type:M.type,sourceLayerIndex:V,index:L,geometry:j?W.geometry:_e(M,c,h),patterns:{},sortKey:Q};E.push(J)}m&&E.sort((M,F)=>M.sortKey-F.sortKey);const{lineAtlas:T,featureIndex:I}=o,A=this.addConstantDashes(T);for(const M of E){const{geometry:F,index:L,sourceLayerIndex:V}=M;if(A&&this.addFeatureDashes(M,T),this.hasPattern){const j=e0("line",this.layers,M,this.zoom,this.pixelRatio,o);this.patternFeatures.push(j)}else this.addFeature(M,F,L,c,T.positions,o.availableImages,o.brightness,o.elevationFeatures);I.insert(i[L].feature,F,L,V,this.index)}}addConstantDashes(i){let o=!1;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==m.kind)o=!0;else{const g=m.value,x=h.value;if(!x)continue;i.addDash(x,g)}}return o}addFeatureDashes(i,o){const c=this.zoom;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===g.kind)continue;let x,E;if("constant"===m.kind){if(x=m.value,!x)continue}else x=m.evaluate({zoom:c},i);E="constant"===g.kind?g.value:g.evaluate({zoom:c},i),o.addDash(x,E),i.patterns[h.id]=[o.getKey(x,E)]}}update(i,o,c,h,m,g,x,E){this.programConfigurations.updatePaintArrays(i,o,m,c,h,g,x,E)}addFeatures(i,o,c,h,m,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,o,c,h,g)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,$D)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,Jb)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,Yb.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,cT),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,o,c,h,m,g,x,E){const T=this.layers[0].layout,I=T.get("line-join").evaluate(i,{}),A=T.get("line-cap").evaluate(i,{}),M=T.get("line-miter-limit"),F=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(i),this.lineFeature=i,this.zOffsetValue=T.get("line-z-offset").value;const L=this.layers[0].paint.get("line-width").value;if("constant"!==L.kind&&!1===L.isLineProgressConstant&&(this.variableWidthValue=L),"road"===this.elevationType){const V=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(i,o,h,E,I,A,M,F)){const[j,W]=this.clipRuntimeLinesToTile(o,1);for(let Q=0;Q<j.length;Q++){const J=j[Q],te=W[Q],me={progress:{min:te.progress.min,max:te.progress.max},nextDir:this.computeSegNextDir(te,J),prevDir:this.computeSegPrevDir(te,J)};this.addLine(J,i,h,I,A,M,F,me)}this.fillNonElevatedRoadSegment(V)}}else for(const V of o)this.addLine(V,i,h,I,A,M,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,m,g,h,x,void 0,this.worldview)}computeSegNextDir(i,o){return i.nextPoint.sub(o.at(-2)).unit()}computeSegPrevDir(i,o){return o[1].sub(i.prevPoint).unit()}clipLinesToTile(i,o){return np(i,-o,-o,ft+o,ft+o)}clipRuntimeLinesToTile(i,o){const c=[];return[np(i,-o,-o,ft+o,ft+o,c),c]}addElevatedRoadFeature(i,o,c,h,m,g,x,E){const T=[],I=Ni.getElevationFeature(i,h);if(I){const A=this.clipLinesToTile(o,1),M=this.prepareElevatedLines(A,I,c);for(const F of M)T.push({geometry:F,elevation:I,elevationTileID:c,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(0===T.length)return!1;for(const A of T){const M=this.layoutVertexArray.length;this.addLine(A.geometry,i,c,m,g,x,E);const F=new Pn(c,A.elevationTileID);if(A.elevation)for(let L=M;L<this.layoutVertexArray.length;L++){const V=new Qe(this.layoutVertexArray.int16[6*L]>>1,this.layoutVertexArray.int16[6*L+1]>>1),j=F.pointElevation(V,A.elevation,.05);this.updateHeightRange(j),this.zOffsetVertexArray.emplaceBack(j,0,0)}else this.fillNonElevatedRoadSegment(M)}return!0}prepareElevatedLines(i,o,c){if(null!=o.constantHeight)return i;const h=[],m=1/ce(c);for(const g of i)XE(g,new ii(o,m),0,h);return h}fillNonElevatedRoadSegment(i){for(let o=i;o<this.layoutVertexArray.length;o++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(i){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,i),this.heightRange.max=Math.max(this.heightRange.max,i)):this.heightRange={min:i,max:i}}addLine(i,o,c,h,m,g,x,E){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const T="none"===h;this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const I=E&&E.progress.min>0,A=E&&E.progress.max<1;if(this.lineClips){let be={min:this.lineClips.start,max:this.lineClips.end},Ee=1;if(E){const He=this.lineClips.end-this.lineClips.start;be={min:Hd((ot=E.progress).min,$e={min:0,max:1},Ke=be),max:Hd(ot.max,$e,Ke)},He>0&&(Ee=(be.max-be.min)/He)}const je=+o.properties.mapbox_clip_feature_len,De=+o.properties.mapbox_clip_seg_len;if(Number.isNaN(je)||Number.isNaN(De)){for(let ot=0;ot<i.length-1;ot++)this.totalDistance+=i[ot].dist(i[ot+1]);const He=this.totalDistance/(be.max-be.min);this.totalFeatureLength=Number.isFinite(He)?He:0,this.lineClips.start=be.min,this.lineClips.end=be.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=je,this.distance=De*Ee,this.lineClips.start=be.min,this.lineClips.end=be.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}var ot,$e,Ke;const M="Polygon"===Qb[o.type];let F=i.length;for(;F>=2&&i[F-1].equals(i[F-2]);)F--;let L=0;for(;L<F-1&&i[L].equals(i[L+1]);)L++;if(F<(M?3:2))return;"bevel"===h&&(g=1.05);const V=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray);let j,W,Q,J,te,me,he,fe;E&&E.prevDir&&(me=E.prevDir.perp()),E&&E.nextDir&&(he=E.nextDir.perp()),this.e1=this.e2=-1,M&&(j=i[F-2],te=i[L].sub(j)._unit()._perp());for(let be=L;be<F;be++){if(Q=be===F-1?M?i[L+1]:void 0:i[be+1],Q&&i[be].equals(Q))continue;te&&(J=te),j&&(W=j),j=i[be],fe=this.evaluateLineProgressFeatures(W?W.dist(j):0),te=Q?Q.sub(j)._unit()._perp():J,J=J||te;const Ee=W&&Q;let je=Ee?h:M||T?"butt":m;const De=J.x*te.x+J.y*te.y;if(T){const Ae=function(Ve){if(Ve.patternJoinNone){const at=Ve.segmentPoints.length/2,et=Ve.lineSoFar-Ve.segmentStart;for(let kt=0;kt<at;++kt){const Dt=Ve.segmentPoints[2*kt+1],Xe=Math.round(Ve.segmentPoints[2*kt])+.5+.25*Dt;Ve.patternVertexArray.emplaceBack(Xe,et,Ve.segmentStart),Ve.patternVertexArray.emplaceBack(Xe,et,Ve.segmentStart)}Ve.segmentPoints.length=0}Ve.e1=Ve.e2=-1};if(Ee&&De<P0){this.updateDistance(W,j),this.addCurrentVertex(j,J,1,1,V,fe),Ae(this),this.addCurrentVertex(j,te,-1,-1,V,fe);continue}if(W){if(!Q){this.updateDistance(W,j),this.addCurrentVertex(j,J,1,1,V,fe),Ae(this);continue}je="miter"}}let He=J.add(te);0===He.x&&0===He.y||He._unit();const ot=He.x*te.x+He.y*te.y,$e=0!==ot?1/ot:1/0,Ke=2*Math.sqrt(2-2*ot),nt=ot<qD&&W&&Q,Be=J.x*te.y-J.y*te.x>0,Je=this.overscaling<=16?15*ft/(512*this.overscaling):0;if(Ee&&"round"===je)if($e<x)je="miter";else if($e<=2){const Ae=gp(j,-10,ft+10);je="offset"===this.elevationType&&(Ae||this.hasCrossSlope)?"miter":"fakeround"}if("miter"===je&&$e>g&&(je="bevel"),"bevel"===je&&($e>2&&(je="flipbevel"),$e<g&&(je="miter")),W&&!("miter"===je&&nt)&&this.updateDistance(W,j),"miter"===je)if(nt){const Ae=j.dist(W);if(Ae>2*Je){const at=j.sub(j.sub(W)._mult(Je/Ae)._round());this.updateDistance(W,at),this.addCurrentVertex(at,J,0,0,V,fe),W=at}this.updateDistance(W,j),He._mult($e),this.addCurrentVertex(j,He,0,0,V,fe);const Ve=j.dist(Q);if(Ve>2*Je){const at=j.add(Q.sub(j)._mult(Je/Ve)._round());this.updateDistance(j,at),this.addCurrentVertex(at,te,0,0,V,fe),j=at}}else He._mult($e),this.addCurrentVertex(j,He,0,0,V,fe);else if("flipbevel"===je){if($e>100)He=te.mult(-1);else{const Ae=$e*J.add(te).mag()/J.sub(te).mag();He._perp()._mult(Ae*(Be?-1:1))}this.addCurrentVertex(j,He,0,0,V,fe),this.addCurrentVertex(j,He.mult(-1),0,0,V,fe)}else if("bevel"===je||"fakeround"===je){null!=fe&&W&&this.addCurrentVertex(j,he||J,-1,-1,V,fe);const Ae=j.dist(W)<=2*Je&&"bevel"!==je,Ve=He.mult(Be?1:-1);Ve._mult($e);const at=te.mult(Be?-1:1),et=J.mult(Be?-1:1),kt=this.evaluateLineProgressFeatures(this.distance);if(null==fe&&(this.addHalfVertex(j,Ve.x,Ve.y,!1,!Be,0,V,kt),Ae||this.addHalfVertex(j,Ve.x+2*et.x,Ve.y+2*et.y,!1,Be,0,V,kt)),"fakeround"===je){const Dt=Math.round(180*Ke/Math.PI/20);this.addHalfVertex(j,et.x,et.y,!1,Be,0,V,kt);for(let Xe=0;Xe<Dt;Xe++){let tt=Xe/Dt;if(.5!==tt){const yt=tt-.5;tt+=tt*yt*(tt-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*yt*yt+(.848013+De*(.215638*De-1.06021)))}const At=at.sub(et)._mult(tt)._add(et)._unit();this.addHalfVertex(j,At.x,At.y,!1,Be,0,V,kt)}this.addHalfVertex(j,at.x,at.y,!1,Be,0,V,kt)}Ae||null!=fe||this.addHalfVertex(j,Ve.x+2*at.x,Ve.y+2*at.y,!1,Be,0,V,kt),null!=fe&&Q&&this.addCurrentVertex(j,me||te,1,1,V,fe)}else if("butt"===je)this.addCurrentVertex(j,He,0,0,V,fe);else if("square"===je){if(!W){const Ae=I?0:-1;this.addCurrentVertex(j,He,Ae,Ae,V,fe)}if(this.addCurrentVertex(j,He,0,0,V,fe),W){const Ae=A?0:1;this.addCurrentVertex(j,He,Ae,Ae,V,fe)}}else if("round"===je){if(W){const Ae=!Ee&&he?he:J;this.addCurrentVertex(j,Ae,0,0,V,fe),!Ee&&A||this.addCurrentVertex(j,Ae,1,1,V,fe,!0)}if(Q){const Ae=!Ee&&me?me:te;!Ee&&I||this.addCurrentVertex(j,Ae,-1,-1,V,fe,!0),this.addCurrentVertex(j,Ae,0,0,V,fe)}}}}addVerticesTo(i,o,c,h,m,g,x,E,T,I){const A=(o.w-i.w)/this.tessellationStep|0;let M=0;const F=this.scaledDistance;if(A>1){this.lineSoFar=i.w;const V=(o.x-i.x)/A,j=(o.y-i.y)/A,W=(o.z-i.z)/A,Q=(o.w-i.w)/A;for(let J=1;J<A;++J){i.x+=V,i.y+=j,i.z+=W,this.lineSoFar+=Q,M+=Q;const te=this.evaluateLineProgressFeatures(this.prevDistance+M);this.scaledDistance=(this.prevDistance+M)/this.totalDistance,this.addHalfVertex(i,c,h,I,!1,x,T,te),this.addHalfVertex(i,m,g,I,!0,-E,T,te)}}this.lineSoFar=o.w,this.scaledDistance=F;const L=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(o,c,h,I,!1,x,T,L),this.addHalfVertex(o,m,g,I,!0,-E,T,L)}evaluateLineProgressFeatures(i){if(!this.variableWidthValue&&"offset"!==this.elevationType)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+i)/this.totalFeatureLength):_n(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let o=0;return this.variableWidthValue&&"constant"!==this.variableWidthValue.kind&&(o=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),"offset"!==this.elevationType?{zOffset:0,variableWidth:o}:"constant"===this.zOffsetValue.kind?{zOffset:this.zOffsetValue.value,variableWidth:o}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:o}}addCurrentVertex(i,o,c,h,m,g,x=!1){const E=o.x+o.y*c,T=o.y-o.x*c,I=o.y*h-o.x,A=-o.y-o.x*h;if(null!=g){const M="offset"===this.elevationType,F=-10,L=ft+10,V=g.zOffset,j=new p0(i.x,i.y,V,this.lineSoFar),W=!!M&&gp(i,F,L),Q=this.lineSoFar,J=this.distance;if(this.currentVertex)if(W){const te=this.currentVertexIsOutside,me=this.currentVertex,he=new p0(i.x,i.y,V,this.lineSoFar);if(ty(me,he,F,L),!gp(he,F,L)){if(te){this.e1=this.e2=-1,this.distance-=me.dist(j),this.lineSoFar=me.w;const fe=this.evaluateLineProgressFeatures(me.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(me,E,T,x,!1,c,m,fe),this.addHalfVertex(me,I,A,x,!0,-h,m,fe),this.prevDistance=this.distance}this.distance=this.prevDistance+me.dist(he),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(me,he,E,T,I,A,c,h,m,x),this.distance=J,this.scaledDistance=this.distance/this.totalDistance}}else{const te=this.currentVertex;if(this.currentVertexIsOutside){ty(te,j,F,L),this.e1=this.e2=-1,this.distance-=te.dist(j),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=te.w;const me=this.evaluateLineProgressFeatures(te.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(te,E,T,x,!1,c,m,me),this.addHalfVertex(te,I,A,x,!0,-h,m,me),this.prevDistance=this.distance,this.distance=J,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(te,j,E,T,I,A,c,h,m,x)}else W||(this.addHalfVertex(i,E,T,x,!1,c,m,g),this.addHalfVertex(i,I,A,x,!0,-h,m,g));this.currentVertex=j,this.currentVertexIsOutside=W,this.lineSoFar=Q}else this.addHalfVertex(i,E,T,x,!1,c,m,g),this.addHalfVertex(i,I,A,x,!0,-h,m,g)}addHalfVertex({x:i,y:o},c,h,m,g,x,E,T){if(this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((i<<1)+(m?1:0),(o<<1)+(g?1:0),Math.round(63*c)+128,Math.round(63*h)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const A=Nt(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,A)}const I=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),E.primitiveLength++),g?this.e2=I:this.e1=I,null!=T&&this.zOffsetVertexArray.emplaceBack(T.zOffset,T.variableWidth,T.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(i,o){this.prevDistance=this.distance,this.distance+=i.dist(o),this.updateScaledDistance()}}function gp(a,i,o){return a.x<i||a.x>o||a.y<i||a.y>o}let ew,tw;function nw(a,i,o){return i*(ft/(a.tileSize*Math.pow(2,o-a.tileID.overscaledZ)))}Et(wl,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const py=(a,i,o)=>(1-o)*a+o*i;function fo(a,i){return 1/nw(a,1,i.tileZoom)}function R0(a,i,o,c){return a.translatePosMatrix(c||i.tileID.projMatrix,i,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const iw=a=>{const i=[];dT(a)&&i.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const o=a.paint.get("line-trim-offset");0===o[0]&&0===o[1]||i.push("RENDER_LINE_TRIM_OFFSET"),0!==a.paint.get("line-border-width").constantOr(1)&&i.push("RENDER_LINE_BORDER");const c="none"===a.layout.get("line-join").constantOr("miter"),h=!!a.paint.get("line-pattern").constantOr(1);return c&&h&&i.push("LINE_JOIN_NONE"),i};function dT(a){const i=a.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}let Ti;const rw=()=>Ti||(Ti={layout:ew||(ew=new Ji({"line-cap":new _t(Se.layout_line["line-cap"]),"line-join":new _t(Se.layout_line["line-join"]),"line-miter-limit":new it(Se.layout_line["line-miter-limit"]),"line-round-limit":new it(Se.layout_line["line-round-limit"]),"line-sort-key":new _t(Se.layout_line["line-sort-key"]),"line-z-offset":new _t(Se.layout_line["line-z-offset"]),"line-elevation-reference":new it(Se.layout_line["line-elevation-reference"]),"line-cross-slope":new it(Se.layout_line["line-cross-slope"]),visibility:new it(Se.layout_line.visibility),"line-width-unit":new it(Se.layout_line["line-width-unit"])})),paint:tw||(tw=new Ji({"line-opacity":new _t(Se.paint_line["line-opacity"]),"line-color":new _t(Se.paint_line["line-color"]),"line-translate":new it(Se.paint_line["line-translate"]),"line-translate-anchor":new it(Se.paint_line["line-translate-anchor"]),"line-width":new _t(Se.paint_line["line-width"]),"line-gap-width":new _t(Se.paint_line["line-gap-width"]),"line-offset":new _t(Se.paint_line["line-offset"]),"line-blur":new _t(Se.paint_line["line-blur"]),"line-dasharray":new _t(Se.paint_line["line-dasharray"]),"line-pattern":new _t(Se.paint_line["line-pattern"]),"line-pattern-cross-fade":new it(Se.paint_line["line-pattern-cross-fade"]),"line-gradient":new Yc(Se.paint_line["line-gradient"]),"line-trim-offset":new it(Se.paint_line["line-trim-offset"]),"line-trim-fade-range":new it(Se.paint_line["line-trim-fade-range"]),"line-trim-color":new it(Se.paint_line["line-trim-color"]),"line-emissive-strength":new it(Se.paint_line["line-emissive-strength"]),"line-border-width":new _t(Se.paint_line["line-border-width"]),"line-border-color":new _t(Se.paint_line["line-border-color"]),"line-occlusion-opacity":new it(Se.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"})}))},Ti);class O0 extends _t{possiblyEvaluate(i,o){return o=new Tn(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition,worldview:o.worldview}),super.possiblyEvaluate(i,o)}evaluate(i,o,c,h){return o=Ie({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(i,o,c,h)}}let ug;function ow(a,i){return i>0?i+2*a:a}const k0=En([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sw=En([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),aw=En([{name:"a_projected_pos",components:4,type:"Float32"}],4);En([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const hT=En([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),lw=En([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),cw=En([{name:"a_texb",components:2,type:"Uint16"}]),fT=En([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),pT=En([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);En([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const uw=En([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),dw=En([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);En([{name:"triangle",components:3,type:"Uint16"}]),En([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),En([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),En([{type:"Float32",name:"offsetX"}]),En([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Pr=24;function fu(a,i,o){return a.sections.forEach(c=>{c.text=function(h,m,g){const x=m.layout.get("text-transform").evaluate(g,{});return"uppercase"===x?h=h.toLocaleUpperCase():"lowercase"===x&&(h=h.toLocaleLowerCase()),Gs.applyArabicShaping&&(h=Gs.applyArabicShaping(h)),h}(c.text,i,o)}),a}const _c={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function mT(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function gT(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}const my=4294967296,F0=1/my,gy=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let xd=class{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,i,o=this.length){for(;this.pos<o;){const c=this.readVarint(),h=c>>3,m=this.pos;this.type=7&c,a(h,i,this),this.pos===m&&this.skip(c)}return i}readMessage(a,i){return this.readFields(a,i,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*my;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*my;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const i=this.buf;let o,c;return c=i[this.pos++],o=127&c,c<128?o:(c=i[this.pos++],o|=(127&c)<<7,c<128?o:(c=i[this.pos++],o|=(127&c)<<14,c<128?o:(c=i[this.pos++],o|=(127&c)<<21,c<128?o:(c=i[this.pos],o|=(15&c)<<28,function(h,m,g){const x=g.buf;let E,T;if(T=x[g.pos++],E=(112&T)>>4,T<128||(T=x[g.pos++],E|=(127&T)<<3,T<128)||(T=x[g.pos++],E|=(127&T)<<10,T<128)||(T=x[g.pos++],E|=(127&T)<<17,T<128)||(T=x[g.pos++],E|=(127&T)<<24,T<128)||(T=x[g.pos++],E|=(1&T)<<31,T<128))return function pu(a,i,o){return o?4294967296*i+(a>>>0):4294967296*(i>>>0)+(a>>>0)}(h,E,m);throw new Error("Expected varint not more than 10 bytes")}(o,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,i=this.pos;return this.pos=a,a-i>=12&&gy?gy.decode(this.buf.subarray(i,a)):function(o,c,h){let m="",g=c;for(;g<h;){const x=o[g];let E,T,I,A=null,M=x>239?4:x>223?3:x>191?2:1;if(g+M>h)break;1===M?x<128&&(A=x):2===M?(E=o[g+1],128==(192&E)&&(A=(31&x)<<6|63&E,A<=127&&(A=null))):3===M?(E=o[g+1],T=o[g+2],128==(192&E)&&128==(192&T)&&(A=(15&x)<<12|(63&E)<<6|63&T,(A<=2047||A>=55296&&A<=57343)&&(A=null))):4===M&&(E=o[g+1],T=o[g+2],I=o[g+3],128==(192&E)&&128==(192&T)&&128==(192&I)&&(A=(15&x)<<18|(63&E)<<12|(63&T)<<6|63&I,(A<=65535||A>=1114112)&&(A=null))),null===A?(A=65533,M=1):A>65535&&(A-=65536,m+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),m+=String.fromCharCode(A),g+=M}return m}(this.buf,i,a)}readBytes(){const a=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,a);return this.pos=a,i}readPackedVarint(a=[],i){const o=this.readPackedEnd();for(;this.pos<o;)a.push(this.readVarint(i));return a}readPackedSVarint(a=[]){const i=this.readPackedEnd();for(;this.pos<i;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const i=this.readPackedEnd();for(;this.pos<i;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const i=this.readPackedEnd();for(;this.pos<i;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const i=this.readPackedEnd();for(;this.pos<i;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const i=this.readPackedEnd();for(;this.pos<i;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const i=this.readPackedEnd();for(;this.pos<i;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const i=this.readPackedEnd();for(;this.pos<i;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const i=this.readPackedEnd();for(;this.pos<i;)a.push(this.readSFixed64());return a}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(a){const i=7&a;if(0===i)for(;this.buf[this.pos++]>127;);else if(2===i)this.pos=this.readVarint()+this.pos;else if(5===i)this.pos+=4;else{if(1!==i)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(a,i){this.writeVarint(a<<3|i)}realloc(a){let i=this.length||16;for(;i<this.pos+a;)i*=2;if(i!==this.length){const o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*F0),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*F0),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?function(i,o){let c,h;if(i>=0?(c=i%4294967296|0,h=i/4294967296|0):(c=~(-i%4294967296),h=~(-i/4294967296),4294967295^c?c=c+1|0:(c=0,h=h+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");var m,x;o.realloc(10),m=c,(x=o).buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7),function(m,g){const x=(7&m)<<4;g.buf[g.pos++]|=x|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(h,o)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const i=this.pos;this.pos=function(c,h,m){for(let g,x,E=0;E<h.length;E++){if(g=h.charCodeAt(E),g>55295&&g<57344){if(!x){g>56319||E+1===h.length?(c[m++]=239,c[m++]=191,c[m++]=189):x=g;continue}if(g<56320){c[m++]=239,c[m++]=191,c[m++]=189,x=g;continue}g=x-55296<<10|g-56320|65536,x=null}else x&&(c[m++]=239,c[m++]=191,c[m++]=189,x=null);g<128?c[m++]=g:(g<2048?c[m++]=g>>6|192:(g<65536?c[m++]=g>>12|224:(c[m++]=g>>18|240,c[m++]=g>>12&63|128),c[m++]=g>>6&63|128),c[m++]=63&g|128)}return m}(this.buf,a,this.pos);const o=this.pos-i;o>=128&&L0(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const i=a.length;this.writeVarint(i),this.realloc(i);for(let o=0;o<i;o++)this.buf[this.pos++]=a[o]}writeRawMessage(a,i){this.pos++;const o=this.pos;a(i,this);const c=this.pos-o;c>=128&&L0(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c}writeMessage(a,i,o){this.writeTag(a,2),this.writeRawMessage(i,o)}writePackedVarint(a,i){i.length&&this.writeMessage(a,hw,i)}writePackedSVarint(a,i){i.length&&this.writeMessage(a,_T,i)}writePackedBoolean(a,i){i.length&&this.writeMessage(a,xT,i)}writePackedFloat(a,i){i.length&&this.writeMessage(a,yT,i)}writePackedDouble(a,i){i.length&&this.writeMessage(a,vT,i)}writePackedFixed32(a,i){i.length&&this.writeMessage(a,fw,i)}writePackedSFixed32(a,i){i.length&&this.writeMessage(a,WD,i)}writePackedFixed64(a,i){i.length&&this.writeMessage(a,bT,i)}writePackedSFixed64(a,i){i.length&&this.writeMessage(a,ZD,i)}writeBytesField(a,i){this.writeTag(a,2),this.writeBytes(i)}writeFixed32Field(a,i){this.writeTag(a,5),this.writeFixed32(i)}writeSFixed32Field(a,i){this.writeTag(a,5),this.writeSFixed32(i)}writeFixed64Field(a,i){this.writeTag(a,1),this.writeFixed64(i)}writeSFixed64Field(a,i){this.writeTag(a,1),this.writeSFixed64(i)}writeVarintField(a,i){this.writeTag(a,0),this.writeVarint(i)}writeSVarintField(a,i){this.writeTag(a,0),this.writeSVarint(i)}writeStringField(a,i){this.writeTag(a,2),this.writeString(i)}writeFloatField(a,i){this.writeTag(a,5),this.writeFloat(i)}writeDoubleField(a,i){this.writeTag(a,1),this.writeDouble(i)}writeBooleanField(a,i){this.writeVarintField(a,+i)}};function L0(a,i,o){const c=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));o.realloc(c);for(let h=o.pos-1;h>=a;h--)o.buf[h+c]=o.buf[h]}function hw(a,i){for(let o=0;o<a.length;o++)i.writeVarint(a[o])}function _T(a,i){for(let o=0;o<a.length;o++)i.writeSVarint(a[o])}function yT(a,i){for(let o=0;o<a.length;o++)i.writeFloat(a[o])}function vT(a,i){for(let o=0;o<a.length;o++)i.writeDouble(a[o])}function xT(a,i){for(let o=0;o<a.length;o++)i.writeBoolean(a[o])}function fw(a,i){for(let o=0;o<a.length;o++)i.writeFixed32(a[o])}function WD(a,i){for(let o=0;o<a.length;o++)i.writeSFixed32(a[o])}function bT(a,i){for(let o=0;o<a.length;o++)i.writeFixed64(a[o])}function ZD(a,i){for(let o=0;o<a.length;o++)i.writeSFixed64(a[o])}const pw=3;function mw(a,i,o){i.glyphs=[],1===a&&o.readMessage(gw,i)}function gw(a,i,o){if(3===a){const{id:c,bitmap:h,width:m,height:g,left:x,top:E,advance:T}=o.readMessage(XD,{});i.glyphs.push({id:c,bitmap:new hc({width:m+2*pw,height:g+2*pw},h),metrics:{width:m,height:g,left:x,top:E,advance:T}})}else 4===a?i.ascender=o.readSVarint():5===a&&(i.descender=o.readSVarint())}function XD(a,i,o){1===a?i.id=o.readVarint():2===a?i.bitmap=o.readBytes():3===a?i.width=o.readVarint():4===a?i.height=o.readVarint():5===a?i.left=o.readSVarint():6===a?i.top=o.readSVarint():7===a&&(i.advance=o.readVarint())}const dg=pw,Rs={horizontal:1,vertical:2,horizontalOnly:3};class _p{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(i,o){const c=new _p;return c.scale=i||1,c.fontStack=o,c}static forImage(i){const o=new _p;return o.image=i,o}}class yp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,o,c){const h=new yp;for(let m=0;m<i.sections.length;m++){const g=i.sections[m];g.image?h.addImageSection(g,c):h.addTextSection(g,o)}return h}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(o,c){let h="";for(let m=0;m<o.length;m++){const g=o.charCodeAt(m+1)||null,x=o.charCodeAt(m-1)||null;h+=!c&&(g&&ta(g)&&!_c[o[m+1]]||x&&ta(x)&&!_c[o[m-1]])||!_c[o[m]]?o[m]:_c[o[m]]}return h}(this.text,i)}trim(){let i=0;for(let c=0;c<this.text.length&&hg[this.text.charCodeAt(c)];c++)i++;let o=this.text.length;for(let c=this.text.length-1;c>=0&&c>=i&&hg[this.text.charCodeAt(c)];c--)o--;this.text=this.text.substring(i,o),this.sectionIndex=this.sectionIndex.slice(i,o)}substring(i,o){const c=new yp;return c.text=this.text.substring(i,o),c.sectionIndex=this.sectionIndex.slice(i,o),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,o)=>Math.max(i,this.sections[o].scale),0)}addTextSection(i,o){this.text+=i.text,this.sections.push(_p.forText(i.scale,i.fontStack||o));const c=this.sections.length-1;for(let h=0;h<i.text.length;++h)this.sectionIndex.push(c)}addImageSection(i,o){const c=i.image?i.image.getPrimary():null;if(!c)return void _n("Can't add FormattedSection with an empty image.");c.scaleSelf(o);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(_p.forImage(c)),this.sectionIndex.push(this.sections.length-1)):_n("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _y(a,i,o,c,h,m,g,x,E,T,I,A,M,F,L,V=1){const j=yp.fromFeature(a,h,V);A===Rs.vertical&&j.verticalizePunctuation(M);let W=[];const Q=function(fe,be,Ee,je,De,He){if(!fe)return[];const ot=[],$e=function(Je,Ae,Ve,at,et,kt){let Dt=0;for(let Xe=0;Xe<Je.length();Xe++){const tt=Je.getSection(Xe);Dt+=fg(Je.getCodePoint(Xe),tt,at,et,Ae,kt)}return Dt/Math.max(1,Math.ceil(Dt/Ve))}(fe,be,Ee,je,De,He),Ke=fe.text.indexOf("\u200b")>=0;let nt=0;for(let Je=0;Je<fe.length();Je++){const Ae=fe.getSection(Je),Ve=fe.getCodePoint(Je);if(hg[Ve]||(nt+=fg(Ve,Ae,je,De,be,He)),Je<fe.length()-1){const at=!((Be=Ve)<11904||!(jt["Bopomofo Extended"](Be)||jt.Bopomofo(Be)||jt["CJK Compatibility Forms"](Be)||jt["CJK Compatibility Ideographs"](Be)||jt["CJK Compatibility"](Be)||jt["CJK Radicals Supplement"](Be)||jt["CJK Strokes"](Be)||jt["CJK Symbols and Punctuation"](Be)||jt["CJK Unified Ideographs Extension A"](Be)||jt["CJK Unified Ideographs"](Be)||jt["Enclosed CJK Letters and Months"](Be)||jt["Halfwidth and Fullwidth Forms"](Be)||jt.Hiragana(Be)||jt["Ideographic Description Characters"](Be)||jt["Kangxi Radicals"](Be)||jt["Katakana Phonetic Extensions"](Be)||jt.Katakana(Be)||jt["Vertical Forms"](Be)||jt["Yi Radicals"](Be)||jt["Yi Syllables"](Be)));(ai[Ve]||at||Ae.image)&&ot.push(z0(Je+1,nt,$e,ot,Tt(Ve,fe.getCodePoint(Je+1),at&&Ke),!1))}}var Be;return _w(z0(fe.length(),nt,$e,ot,0,!0))}(j,T,m,i,c,F),{processBidirectionalText:J,processStyledBidirectionalText:te}=Gs;if(J&&1===j.sections.length){const fe=J(j.toString(),Q);for(const be of fe){const Ee=new yp;Ee.text=be,Ee.sections=j.sections;for(let je=0;je<be.length;je++)Ee.sectionIndex.push(0);W.push(Ee)}}else if(te){const fe=te(j.text,j.sectionIndex,Q);for(const be of fe){const Ee=new yp;Ee.text=be[0],Ee.sectionIndex=be[1],Ee.sections=j.sections,W.push(Ee)}}else W=function(fe,be){const Ee=[],je=fe.text;let De=0;for(const He of be)Ee.push(fe.substring(De,He)),De=He;return De<je.length&&Ee.push(fe.substring(De,je.length)),Ee}(j,Q);const me=[],he={positionedLines:me,text:j.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(fe,be,Ee,je,De,He,ot,$e,Ke,nt,Be,Je){let Ae=0,Ve=0,at=0;const et="right"===$e?1:"left"===$e?0:.5;let kt=!1;for(const pt of De){const xt=pt.getSections();for(const zt of xt){if(zt.image)continue;const Zt=be[zt.fontStack];if(Zt&&(kt=void 0!==Zt.ascender&&void 0!==Zt.descender,!kt))break}if(!kt)break}let Dt=0;for(const pt of De){pt.trim();const xt=pt.getMaxScale(),zt=(xt-1)*Pr,Zt={positionedGlyphs:[],lineOffset:0};fe.positionedLines[Dt]=Zt;const on=Zt.positionedGlyphs;let Qt=0;if(!pt.length()){Ve+=He,++Dt;continue}let vn=0,hn=0;for(let ie=0;ie<pt.length();ie++){const re=pt.getSection(ie),Le=pt.getSectionIndex(ie),ct=pt.getCodePoint(ie);let ht=re.scale,mt=null,It=null,Gt=null,wn=Pr,$t=0,fn=Ke;fn===Rs.vertical&&(12312===(Xe=ct)||12313===Xe||12316===Xe||12540===Xe||12448===Xe)&&(fn=Rs.horizontal);const li=!(fn===Rs.horizontal||!Be&&!Bf(ct)||Be&&(hg[ct]||vm(ct)));if(re.image){const Xi=je.get(re.image.toString());if(!Xi)continue;Gt=re.image,fe.iconsInText=fe.iconsInText||!0,It=Xi.paddedRect;const nn=Xi.displaySize;ht=ht*Pr/Je,mt={width:nn[0],height:nn[1],left:0,top:-dg,advance:li?nn[1]:nn[0],localGlyph:!1},$t=kt?-mt.height*ht:xt*Pr-17-nn[1]*ht,wn=mt.advance;const Ri=(li?nn[0]:nn[1])*ht-Pr*xt;Ri>0&&Ri>Qt&&(Qt=Ri)}else{const Xi=Ee[re.fontStack];if(!Xi)continue;Xi[ct]&&(It=Xi[ct]);const nn=be[re.fontStack];if(!nn)continue;const Ri=nn.glyphs[ct];if(!Ri)continue;if(mt=Ri.metrics,wn=8203!==ct?Pr:0,kt){const ci=void 0!==nn.ascender?Math.abs(nn.ascender):0,jn=void 0!==nn.descender?Math.abs(nn.descender):0,Xn=(ci+jn)*ht;vn<Xn&&(vn=Xn,hn=(ci-jn)/2*ht),$t=-ci*ht}else $t=(xt-ht)*Pr-17}li?(fe.verticalizable=!0,on.push({glyph:ct,image:Gt,x:Ae,y:Ve+$t,vertical:li,scale:ht,localGlyph:mt.localGlyph,fontStack:re.fontStack,sectionIndex:Le,metrics:mt,rect:It}),Ae+=wn*ht+nt):(on.push({glyph:ct,image:Gt,x:Ae,y:Ve+$t,vertical:li,scale:ht,localGlyph:mt.localGlyph,fontStack:re.fontStack,sectionIndex:Le,metrics:mt,rect:It}),Ae+=mt.advance*ht+nt)}0!==on.length&&(at=Math.max(Ae-nt,at),kt?Wh(on,et,Qt,hn,He*xt/2):Wh(on,et,Qt,0,He/2)),Ae=0;const ri=He*xt+Qt;Zt.lineOffset=Math.max(Qt,zt),Ve+=ri,++Dt}var Xe;const tt=Ve,{horizontalAlign:At,verticalAlign:yt}=vp(ot);(function(pt,xt,zt,Zt,on,Qt){const vn=(xt-zt)*on,hn=-Qt*Zt;for(const ri of pt)for(const ie of ri.positionedGlyphs)ie.x+=vn,ie.y+=hn})(fe.positionedLines,et,At,yt,at,tt),fe.top+=-yt*tt,fe.bottom=fe.top+tt,fe.left+=-At*at,fe.right=fe.left+at,fe.hasBaseline=kt}(he,i,o,c,W,g,x,E,A,T,M,L),!function(fe){for(const be of fe)if(0!==be.positionedGlyphs.length)return!1;return!0}(me))return he}const hg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ai={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function fg(a,i,o,c,h,m){if(i.image){const g=c.get(i.image.toString());return g?g.displaySize[0]*i.scale*Pr/m+h:0}{const g=o[i.fontStack],x=g&&g.glyphs[a];return x?x.metrics.advance*i.scale+h:0}}function N0(a,i,o,c){const h=Math.pow(a-i,2);return c?a<i?h/2:2*h:h+Math.abs(o)*o}function Tt(a,i,o){let c=0;return 10===a&&(c-=1e4),o&&(c+=150),40!==a&&65288!==a||(c+=50),41!==i&&65289!==i||(c+=50),c}function z0(a,i,o,c,h,m){let g=null,x=N0(i,o,h,m);for(const E of c){const T=N0(i-E.x,o,h,m)+E.badness;T<=x&&(g=E,x=T)}return{index:a,x:i,priorBreak:g,badness:x}}function _w(a){return a?_w(a.priorBreak).concat(a.index):[]}function vp(a){let i=.5,o=.5;switch(a){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:i,verticalAlign:o}}function Wh(a,i,o,c,h){if(!(i||o||c||h))return;const m=a.length-1,g=a[m],x=(g.x+g.metrics.advance*g.scale)*i;for(let E=0;E<=m;E++)a[E].x-=x,a[E].y+=o+c+h}function yy(a){return void 0!==a.imagePrimary&&void 0!==a.top&&void 0!==a.bottom&&void 0!==a.left&&void 0!==a.right}function pg(a,i,o,c){const{horizontalAlign:h,verticalAlign:m}=vp(c),g=o[0]-a.displaySize[0]*h,x=o[1]-a.displaySize[1]*m;return{imagePrimary:a,imageSecondary:i,top:x,bottom:x+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function B0(a,i,o,c,h,m){const g=a.imagePrimary;let x;if(g.content){const j=g.content,W=g.pixelRatio||1;x=[j[0]/W,j[1]/W,g.displaySize[0]-j[2]/W,g.displaySize[1]-j[3]/W]}const E=i.left*m,T=i.right*m;let I,A,M,F;"width"===o||"both"===o?(F=h[0]+E-c[3],A=h[0]+T+c[1]):(F=h[0]+(E+T-g.displaySize[0])/2,A=F+g.displaySize[0]);const L=i.top*m,V=i.bottom*m;return"height"===o||"both"===o?(I=h[1]+L-c[0],M=h[1]+V+c[2]):(I=h[1]+(L+V-g.displaySize[1])/2,M=I+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:I,right:A,bottom:M,left:F,collisionPadding:x}}function vy(a){return!a.imagePrimary.stretchX}function xy(a){return!a.imagePrimary.stretchY}function by(a){return{width:a.right-a.left,height:a.bottom-a.top}}const El=128;function wy(a,i,o){const{expression:c}=i;if("constant"===c.kind)return{kind:"constant",layoutSize:c.evaluate(new Tn(a+1,{worldview:o}))};if("source"===c.kind)return{kind:"source"};{const{zoomStops:h,interpolationType:m}=c;let g=0;for(;g<h.length&&h[g]<=a;)g++;g=Math.max(0,g-1);let x=g;for(;x<h.length&&h[x]<a+1;)x++;x=Math.min(h.length-1,x);const E=h[g],T=h[x];return"composite"===c.kind?{kind:"composite",minZoom:E,maxZoom:T,interpolationType:m}:{kind:"camera",minZoom:E,maxZoom:T,minSize:c.evaluate(new Tn(E,{worldview:o})),maxSize:c.evaluate(new Tn(T,{worldview:o})),interpolationType:m}}}function V0(a,{uSize:i,uSizeT:o},{lowerSize:c,upperSize:h}){return"source"===a.kind?c/El:"composite"===a.kind?Nt(c/El,h/El,o):i}function mg(a,i,o=1){let c=0,h=0;if("constant"===a.kind)h=a.layoutSize*o;else if("source"!==a.kind){const{interpolationType:m,minZoom:g,maxZoom:x}=a,E=m?se(cs.interpolationFactor(m,i,g,x),0,1):0;"camera"===a.kind?h=Nt(a.minSize,a.maxSize,E)*o:c=E*o}return{uSizeT:c,uSize:h}}class mu extends Qe{constructor(i,o,c,h,m){super(i,o),this.angle=h,this.z=c,void 0!==m&&(this.segment=m)}clone(){return new mu(this.x,this.y,this.z,this.angle,this.segment)}}function j0(a,i,o,c,h){if(void 0===i.segment)return!0;let m=i,g=i.segment+1,x=0;for(;x>-o/2;){if(g--,g<0)return!1;x-=a[g].dist(m),m=a[g]}x+=a[g].dist(a[g+1]),g++;const E=[];let T=0;for(;x<o/2;){const I=a[g],A=a[g+1];if(!A)return!1;let M=a[g-1].angleTo(I)-I.angleTo(A);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:M}),T+=M;x-E[0].distance>c;)T-=E.shift().angleDelta;if(T>h)return!1;g++,x+=I.dist(A)}return!0}function yw(a){let i=0;for(let o=0;o<a.length-1;o++)i+=a[o].dist(a[o+1]);return i}function vw(a,i,o){return a?.6*i*o:0}function xw(a,i){return Math.max(a?a.right-a.left:0,i?i.right-i.left:0)}function wT(a,i,o,c,h,m){const g=vw(o,h,m),x=xw(o,c)*m;let E=0;const T=yw(a)/2;for(let I=0;I<a.length-1;I++){const A=a[I],M=a[I+1],F=A.dist(M);if(E+F>T){const L=(T-E)/F,V=Nt(A.x,M.x,L),j=Nt(A.y,M.y,L),W=new mu(V,j,0,M.angleTo(A),I);return!g||j0(a,W,x,g,i)?W:void 0}E+=F}}function bw(a,i,o,c,h,m,g,x,E){const T=vw(c,m,g),I=xw(c,h),A=I*g,M=0===a[0].x||a[0].x===E||0===a[0].y||a[0].y===E;return i-A<i/4&&(i=A+i/4),U0(a,M?i/2*x%i:(I/2+2*m)*g*x%i,i,T,o,A,M,!1,E)}function U0(a,i,o,c,h,m,g,x,E){const T=m/2,I=yw(a);let A=0,M=i-o,F=[];for(let L=0;L<a.length-1;L++){const V=a[L],j=a[L+1],W=V.dist(j),Q=j.angleTo(V);for(;M+o<A+W;){M+=o;const J=(M-A)/W,te=Nt(V.x,j.x,J),me=Nt(V.y,j.y,J);if(te>=0&&te<E&&me>=0&&me<E&&M-T>=0&&M+T<=I){const he=new mu(te,me,0,Q,L);c&&!j0(a,he,m,c,h)||F.push(he)}}A+=W}return x||F.length||g||(F=U0(a,A/2,o,c,h,m,g,!0,E)),F}function ww(a){let i=0,o=0;for(const g of a)i+=g.w*g.h,o=Math.max(o,g.w);a.sort((g,x)=>x.h-g.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),o),h:1/0}];let h=0,m=0;for(const g of a)for(let x=c.length-1;x>=0;x--){const E=c[x];if(!(g.w>E.w||g.h>E.h)){if(g.x=E.x,g.y=E.y,m=Math.max(m,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===E.w&&g.h===E.h){const T=c.pop();T&&x<c.length&&(c[x]=T)}else g.h===E.h?(E.x+=g.w,E.w-=g.w):g.w===E.w?(E.y+=g.h,E.h-=g.h):(c.push({x:E.x+g.w,y:E.y,w:E.w-g.w,h:g.h}),E.y+=g.h,E.h-=g.h);break}}return{w:h,h:m,fill:i/(h*m)||0}}Et(mu,"Anchor");const Zh=1;class gs{static getImagePositionScale(i,o,c){if(o&&i&&i.options&&i.options.transform){const h=i.options.transform;return{x:h.a,y:h.d}}return{x:c,y:c}}constructor(i,o,c,h){this.paddedRect=i;const{pixelRatio:m,version:g,stretchX:x,stretchY:E,content:T,sdf:I,usvg:A}=o;this.pixelRatio=m,this.stretchX=x,this.stretchY=E,this.content=T,this.version=g,this.padding=c,this.sdf=I,this.usvg=A,this.scale=gs.getImagePositionScale(h,A,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function H0(a,i,o){const c=pa.parse(a),h=function(m,g,x=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*x[0])+2*g,h:(m.data?m.data.height:m.height*x[1])+2*g}}(i,o,[c.options.transform.a,c.options.transform.d]);return{bin:h,imagePosition:new gs(h,i,o,c),imageVariant:c}}class Ew{constructor(i,o,c){const h=new Map,m=new Map;this.haveRenderCallbacks=[];const g=[];this.addImages(i,h,Zh,g),this.addImages(o,m,2,g);const{w:x,h:E}=ww(g),T=new Wr({width:x||1,height:E||1});for(const[I,A]of i.entries()){const M=h.get(I).paddedRect;Wr.copy(A.data,T,{x:0,y:0},{x:M.x+Zh,y:M.y+Zh},A.data,c,A.sdf)}for(const[I,A]of o.entries()){const M=m.get(I),F=M.paddedRect;let L=M.padding;const V=F.x+L,j=F.y+L,W=A.data.width,Q=A.data.height;L=L>1?L-1:L,Wr.copy(A.data,T,{x:0,y:0},{x:V,y:j},A.data,c),Wr.copy(A.data,T,{x:0,y:Q-L},{x:V,y:j-L},{width:W,height:L},c),Wr.copy(A.data,T,{x:0,y:0},{x:V,y:j+Q},{width:W,height:L},c),Wr.copy(A.data,T,{x:W-L,y:0},{x:V-L,y:j},{width:L,height:Q},c),Wr.copy(A.data,T,{x:0,y:0},{x:V+W,y:j},{width:L,height:Q},c),Wr.copy(A.data,T,{x:W-L,y:Q-L},{x:V-L,y:j-L},{width:L,height:L},c),Wr.copy(A.data,T,{x:0,y:Q-L},{x:V+W,y:j-L},{width:L,height:L},c),Wr.copy(A.data,T,{x:0,y:0},{x:V+W,y:j+Q},{width:L,height:L},c),Wr.copy(A.data,T,{x:W-L,y:0},{x:V-L,y:j+Q},{width:L,height:L},c)}this.lut=c,this.image=T,this.iconPositions=h,this.patternPositions=m}addImages(i,o,c,h){for(const[m,g]of i.entries()){const{bin:x,imagePosition:E,imageVariant:T}=H0(m,g,c);o.set(m,E),h.push(x),g.hasRenderCallback&&this.haveRenderCallbacks.push(T.id)}}patchUpdatedImages(i,o,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>i.hasImage(h,c)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const h of i.getUpdatedImages(c)){for(const m of this.iconPositions.keys()){const g=pa.parse(m);if(Kt.isEqual(g.id,h)){const x=i.getImage(h,c);this.patchUpdatedImage(this.iconPositions.get(m),x,o)}}for(const m of this.patternPositions.keys()){const g=pa.parse(m);if(Kt.isEqual(g.id,h)){const x=i.getImage(h,c);this.patchUpdatedImage(this.patternPositions.get(m),x,o)}}}}patchUpdatedImage(i,o,c){if(!i||!o||i.version===o.version)return;i.version=o.version;const[h,m]=i.tl,g=i.sdf;if(this.lut||g){const x={width:o.data.width,height:o.data.height},E=new Wr(x);Wr.copy(o.data,E,{x:0,y:0},{x:0,y:0},x,this.lut,g),c.update(E,{position:{x:h,y:m}})}else c.update(o.data,{position:{x:h,y:m}})}}Et(gs,"ImagePosition"),Et(Ew,"ImageAtlas");const Ey=1e20;function Ty(a,i,o,c,h,m,g,x,E){for(let T=i;T<i+c;T++)G0(a,o*m+T,m,h,g,x,E);for(let T=o;T<o+h;T++)G0(a,T*m+i,1,c,g,x,E)}function G0(a,i,o,c,h,m,g){m[0]=0,g[0]=-Ey,g[1]=Ey,h[0]=a[i];for(let x=1,E=0,T=0;x<c;x++){h[x]=a[i+x*o];const I=x*x;do{const A=m[E];T=(h[x]-h[A]+I-A*A)/(x-A)/2}while(T<=g[E]&&--E>-1);E++,m[E]=x,g[E]=T,g[E+1]=Ey}for(let x=0,E=0;x<c;x++){for(;g[E+1]<x;)E++;const T=m[E],I=x-T;a[i+x*o]=h[T]+I*I}}const Tl=2,$0={none:0,ideographs:1,all:2};class xp{constructor(i,o,c){this.requestManager=i,this.localGlyphMode=o,this.localFontFamily=c,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,o){const c=[],h=this.url||so.GLYPHS_URL;for(const m in i)for(const g of i[m])c.push({stack:m,id:g});Te(c,({stack:m,id:g},x)=>{let E=this.entries[m];E||(E=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=E.glyphs[g];if(void 0!==T)return void x(null,{stack:m,id:g,glyph:T});if(T=this._tinySDF(E,m,g),T)return E.glyphs[g]=T,void x(null,{stack:m,id:g,glyph:T});const I=Math.floor(g/256);if(256*I>65535)return _n("glyphs > 65535 not supported"),void x(null,{stack:m,id:g,glyph:T});if(E.ranges[I])return void x(null,{stack:m,id:g,glyph:T});let A=E.requests[I];A||(A=E.requests[I]=[],xp.loadGlyphRange(m,I,h,this.requestManager,(M,F)=>{if(F){E.ascender=F.ascender,E.descender=F.descender;for(const L in F.glyphs)this._doesCharSupportLocalGlyph(+L)||(E.glyphs[+L]=F.glyphs[+L]);E.ranges[I]=!0}for(const L of A)L(M,F);delete E.requests[I]})),A.push((M,F)=>{M?x(M):F&&x(null,{stack:m,id:g,glyph:F.glyphs[g]||null})})},(m,g)=>{if(m)o(m);else if(g){const x={};for(const{stack:E,id:T,glyph:I}of g)void 0===x[E]&&(x[E]={}),void 0===x[E].glyphs&&(x[E].glyphs={}),x[E].glyphs[T]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},x[E].ascender=this.entries[E].ascender,x[E].descender=this.entries[E].descender;o(null,x)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==$0.none&&(this.localGlyphMode===$0.all?!!this.localFontFamily:!!this.localFontFamily&&(jt["CJK Unified Ideographs"](i)||jt["Hangul Syllables"](i)||jt.Hiragana(i)||jt.Katakana(i)||jt["CJK Symbols and Punctuation"](i)||jt["CJK Unified Ideographs Extension A"](i)||jt["CJK Unified Ideographs Extension B"](i)||jt.Osage(i)))}_tinySDF(i,o,c){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(c))return;let m=i.tinySDF;if(!m){let V="400";/bold/i.test(o)?V="900":/medium/i.test(o)?V="500":/light/i.test(o)&&(V="200"),m=i.tinySDF=new xp.TinySDF({fontFamily:h,fontWeight:V,fontSize:24*Tl,buffer:3*Tl,radius:8*Tl}),m.fontWeight=V}if(this.localGlyphs[m.fontWeight][c])return this.localGlyphs[m.fontWeight][c];const g=String.fromCodePoint(c),{data:x,width:E,height:T,glyphWidth:I,glyphHeight:A,glyphLeft:M,glyphTop:F,glyphAdvance:L}=m.draw(g);return this.localGlyphs[m.fontWeight][c]={id:c,bitmap:new hc({width:E,height:T},x),metrics:{width:I/Tl,height:A/Tl,left:M/Tl,top:F/Tl-27,advance:L/Tl,localGlyph:!0}}}}xp.loadGlyphRange=function(a,i,o,c,h){const m=256*i,g=m+255,x=c.transformRequest(c.normalizeGlyphsURL(o).replace("{fontstack}",a).replace("{range}",`${m}-${g}`),Li.Glyphs);Ic(x,(E,T)=>{if(E)h(E);else if(T){const I={},A=new xd(T).readFields(mw,{});for(const M of A.glyphs)I[M.id]=M;h(null,{glyphs:I,ascender:A.ascender,descender:A.descender})}})},xp.TinySDF=class{constructor({fontSize:a=24,buffer:i=3,radius:o=8,cutoff:c=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:g="normal"}={}){this.buffer=i,this.cutoff=c,this.radius=o;const x=this.size=a+4*i,E=this._createCanvas(x),T=this.ctx=E.getContext("2d",{willReadFrequently:!0});T.font=`${g} ${m} ${a}px ${h}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(a){const i=document.createElement("canvas");return i.width=i.height=a,i}draw(a){const{width:i,actualBoundingBoxAscent:o,actualBoundingBoxDescent:c,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(a),g=Math.ceil(o),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),E=Math.min(this.size-this.buffer,g+Math.ceil(c)),T=x+2*this.buffer,I=E+2*this.buffer,A=Math.max(T*I,0),M=new Uint8ClampedArray(A),F={data:M,width:T,height:I,glyphWidth:x,glyphHeight:E,glyphTop:g,glyphLeft:0,glyphAdvance:i};if(0===x||0===E)return F;const{ctx:L,buffer:V,gridInner:j,gridOuter:W}=this;L.clearRect(V,V,x,E),L.fillText(a,V,V+g);const Q=L.getImageData(V,V,x,E);W.fill(Ey,0,A),j.fill(0,0,A);for(let J=0;J<E;J++)for(let te=0;te<x;te++){const me=Q.data[4*(J*x+te)+3]/255;if(0===me)continue;const he=(J+V)*T+te+V;if(1===me)W[he]=0,j[he]=Ey;else{const fe=.5-me;W[he]=fe>0?fe*fe:0,j[he]=fe<0?fe*fe:0}}Ty(W,0,0,T,I,T,this.f,this.v,this.z),Ty(j,V,V,x,E,T,this.f,this.v,this.z);for(let J=0;J<A;J++){const te=Math.sqrt(W[J])-Math.sqrt(j[J]);M[J]=Math.round(255-255*(te/this.radius+this.cutoff))}return F}};const gu=Zh;function Tw(a,i){return a+i[1]-i[0]}function Cw(a,i,o,c,h=1){const m=[],g=a.imagePrimary,x=g.pixelRatio,E=g.paddedRect.w-2*gu,T=g.paddedRect.h-2*gu,I=(a.right-a.left)*h,A=(a.bottom-a.top)*h,M=g.stretchX||[[0,E]],F=g.stretchY||[[0,T]],L=M.reduce(Tw,0),V=F.reduce(Tw,0),j=E-L,W=T-V;let Q=0,J=L,te=0,me=V,he=0,fe=j,be=0,Ee=W;if(g.content&&c){const De=g.content;Q=bp(M,0,De[0]),te=bp(F,0,De[1]),J=bp(M,De[0],De[2]),me=bp(F,De[1],De[3]),he=De[0]-Q,be=De[1]-te,fe=De[2]-De[0]-J,Ee=De[3]-De[1]-me}const je=(De,He,ot,$e)=>{const Ke=Cy(De.stretch-Q,J,I,a.left*h),nt=Sy(De.fixed-he,fe,De.stretch,L),Be=Cy(He.stretch-te,me,A,a.top*h),Je=Sy(He.fixed-be,Ee,He.stretch,V),Ae=Cy(ot.stretch-Q,J,I,a.left*h),Ve=Sy(ot.fixed-he,fe,ot.stretch,L),at=Cy($e.stretch-te,me,A,a.top*h),et=Sy($e.fixed-be,Ee,$e.stretch,V),kt=new Qe(Ke,Be),Dt=new Qe(Ae,Be),Xe=new Qe(Ae,at),tt=new Qe(Ke,at),At=new Qe(nt/x,Je/x),yt=new Qe(Ve/x,et/x),pt=i*Math.PI/180;if(pt){const vn=Math.sin(pt),hn=Math.cos(pt),ri=[hn,-vn,vn,hn];kt._matMult(ri),Dt._matMult(ri),tt._matMult(ri),Xe._matMult(ri)}const xt=De.stretch+De.fixed,zt=ot.stretch+ot.fixed,Zt=He.stretch+He.fixed,on=$e.stretch+$e.fixed,Qt=a.imageSecondary;return{tl:kt,tr:Dt,bl:tt,br:Xe,texPrimary:{x:g.paddedRect.x+gu+xt,y:g.paddedRect.y+gu+Zt,w:zt-xt,h:on-Zt},texSecondary:Qt?{x:Qt.paddedRect.x+gu+xt,y:Qt.paddedRect.y+gu+Zt,w:zt-xt,h:on-Zt}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:At,pixelOffsetBR:yt,minFontScaleX:fe/x/I,minFontScaleY:Ee/x/A,isSDF:o}};if(c&&(g.stretchX||g.stretchY)){const De=Sw(M,j,L),He=Sw(F,W,V);for(let ot=0;ot<De.length-1;ot++){const $e=De[ot],Ke=De[ot+1];for(let nt=0;nt<He.length-1;nt++)m.push(je($e,He[nt],Ke,He[nt+1]))}}else m.push(je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:T+1}));return m}function bp(a,i,o){let c=0;for(const h of a)c+=Math.max(i,Math.min(o,h[1]))-Math.max(i,Math.min(o,h[0]));return c}function Sw(a,i,o){const c=[{fixed:-gu,stretch:0}];for(const[h,m]of a){const g=c[c.length-1];c.push({fixed:h-g.stretch,stretch:g.stretch}),c.push({fixed:h-g.stretch,stretch:g.stretch+(m-h)})}return c.push({fixed:i+gu,stretch:o}),c}function Cy(a,i,o,c){return a/i*o+c}function Sy(a,i,o,c){return a-i*o/c}function ET(a,i,o,c){const h=i+a.positionedLines[c].lineOffset;return 0===c?o+h/2:o+(h+(i+a.positionedLines[c-1].lineOffset))/2}function TT(a,i=1,o=!1){let c=1/0,h=1/0,m=-1/0,g=-1/0;const x=a[0];for(let F=0;F<x.length;F++){const L=x[F];(!F||L.x<c)&&(c=L.x),(!F||L.y<h)&&(h=L.y),(!F||L.x>m)&&(m=L.x),(!F||L.y>g)&&(g=L.y)}const E=Math.min(m-c,g-h);let T=E/2;const I=new Sf([],yc);if(0===E)return new Qe(c,h);for(let F=c;F<m;F+=E)for(let L=h;L<g;L+=E)I.push(new bd(F+T,L+T,T,a));let A=function(F){let L=0,V=0,j=0;const W=F[0];for(let Q=0,J=W.length,te=J-1;Q<J;te=Q++){const me=W[Q],he=W[te],fe=me.x*he.y-he.x*me.y;V+=(me.x+he.x)*fe,j+=(me.y+he.y)*fe,L+=3*fe}return new bd(V/L,j/L,0,F)}(a),M=I.length;for(;I.length;){const F=I.pop();(F.d>A.d||!A.d)&&(A=F,o&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,M)),F.max-A.d<=i||(T=F.h/2,I.push(new bd(F.p.x-T,F.p.y-T,T,a)),I.push(new bd(F.p.x+T,F.p.y-T,T,a)),I.push(new bd(F.p.x-T,F.p.y+T,T,a)),I.push(new bd(F.p.x+T,F.p.y+T,T,a)),M+=4)}return o&&(console.log(`num probes: ${M}`),console.log(`best distance: ${A.d}`)),A.p}function yc(a,i){return i.max-a.max}class bd{constructor(i,o,c,h){this.p=new Qe(i,o),this.h=c,this.d=function(m,g){let x=!1,E=1/0;for(let T=0;T<g.length;T++){const I=g[T];for(let A=0,M=I.length,F=M-1;A<M;F=A++){const L=I[A],V=I[F];L.y>m.y!=V.y>m.y&&m.x<(V.x-L.x)*(m.y-L.y)/(V.y-L.y)+L.x&&(x=!x),E=Math.min(E,ia(m,L,V))}}return(x?1:-1)*Math.sqrt(E)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const CT=Object.keys,Dy=Number.POSITIVE_INFINITY,ST=Math.sqrt(2);function q0(a,[i,o]){let c=0,h=0;if(o===Dy){i<0&&(i=0);const m=i/ST;switch(a){case"top-right":case"top-left":h=m-7;break;case"bottom-right":case"bottom-left":h=7-m;break;case"bottom":h=7-i;break;case"top":h=i-7}switch(a){case"top-right":case"bottom-right":c=-m;break;case"top-left":case"bottom-left":c=m;break;case"left":c=i;break;case"right":c=-i}}else{switch(i=Math.abs(i),o=Math.abs(o),a){case"top-right":case"top-left":case"top":h=o-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-o}switch(a){case"top-right":case"bottom-right":case"right":c=-i;break;case"top-left":case"bottom-left":case"left":c=i}}return[c,h]}function gg(a,i,o,c,h,m,g,x,E){if(!i||!i.usvg)return;const T=by(c),I=by(h),A="both"!==m&&"width"!==m||!vy(c)?1:I.width/T.width,M="both"!==m&&"height"!==m||!xy(c)?1:I.height/T.height;o.scaleSelf(A,M);const F=o.toString();g.set(F,o),x.set(F,i);const{imagePosition:L}=H0(F,i,Zh);E.set(F,L)}function _g(a,i,o,c,h,m,g,x,E){if(!a)return;const T=function(I,A,M,F,L,V){if("camera"===I.kind)return I.maxSize;if("composite"===I.kind){const j=A.possiblyEvaluate(new Tn(I.maxZoom,{worldview:V}),M).evaluate(L,{},M),W=A.possiblyEvaluate(new Tn(I.minZoom,{worldview:V}),M).evaluate(L,{},M);return Math.max(j,W)}return A.possiblyEvaluate(new Tn(F,{worldview:V})).evaluate(L,{},M)}(i,o,c,h,m,E);return a.scaleSelf(T*x*g)}function Iy(a,i,o,c,h,m,g,x,E){return{iconPrimary:_g(a.getPrimary(),i,o,c,h,m,g,x,E),iconSecondary:_g(a.getSecondary(),i,o,c,h,m,g,x,E)}}function YD(a,i,o){if(!i)return;const c=o.get(a.toString()),h=o.get(i.toString());h&&(c.paddedRect.w===h.paddedRect.w&&c.paddedRect.h===h.paddedRect.h||_n(`Mismatch in icon variant sizes: ${a.toString()} and ${i.toString()}`),c.usvg!==h.usvg&&_n(`Mismatch in icon variant image types: ${a.id} and ${i.id}`))}function W0(a,i,o,c){if(!a)return;const h=i.get(o.toString());if(a.imagePrimary=h,c){const m=i.get(c.toString());a.imageSecondary=m}}function Dw(a,i){for(const o in a.horizontal)Z0(a.horizontal[o],i);Z0(a.vertical,i)}function Z0(a,i){if(a)for(const o of a.positionedLines)for(const c of o.positionedGlyphs)if(null!==c.image){const h=c.image.toString();c.rect=i.get(h).paddedRect}}function Ay(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function X0(a,i,o,c,h,m,g,x,E){const T=Y0(m.horizontal)||m.vertical,I=o.get("icon-text-fit-padding").evaluate(c,{},h);let A,M=i;return i&&"none"!==E&&(a.allowVerticalPlacement&&m.vertical&&(A=B0(i,m.vertical,E,I,x,g)),T&&(M=B0(i,T,E,I,x,g))),{defaultShapedIcon:M,verticallyShapedIcon:A}}function _u(a,i,o,c,h,m,g,x,E,T,I,A,M,F,L,V,j,W,Q,J){let te=g.textMaxSize.evaluate(i,{},M);void 0===te?te=x*g.textScaleFactor:te*=g.textScaleFactor;const me=a.layers[0].layout,he=Y0(o.horizontal)||o.vertical,fe="globe"===F.name,be=Pr,Ee=a.tilePixelRatio*te/be,je=(nt=a.overscaling,a.zoom>18&&nt>2&&(nt>>=1),Math.max(ft/(512*nt),1)*me.get("symbol-spacing")),De=me.get("text-padding")*a.tilePixelRatio,He=me.get("icon-padding")*a.tilePixelRatio,ot=Rn(me.get("text-max-angle")),$e="map"===me.get("icon-rotation-alignment")&&"point"!==J,Ke=je/2;var nt;!1===a.hasAnyIconTextFit&&"none"!==j&&(a.hasAnyIconTextFit=!0);const Be=i.properties?+i.properties[vt]:null,Je=Be&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(Be):65535,Ae=(Ve,at,et)=>{if(at.x<0||at.x>=ft||at.y<0||at.y>=ft)return;let kt=null;if(fe){const{x:Dt,y:Xe,z:tt}=F.projectTilePoint(at.x,at.y,et);kt={anchor:new mu(Dt,Xe,tt,0,void 0),up:F.upVector(et,at.x,at.y)}}!function(Dt,Xe,tt,At,yt,pt,xt,zt,Zt,on,Qt,vn,hn,ri,ie,re,Le,ct,ht,mt,It,Gt,wn,$t,fn,li,Xi,nn,Ri){const ci=Dt.addToLineVertexArray(Xe,At);let jn,Xn,Oi,pi,vi,oi,cn,si=0,Bi=0,Ut=0,An=0,Ai=-1,er=-1;const mi={};let Lr=Xd("");const fi=tt?tt.anchor:Xe,Rr="none"!==nn;let Bo=0,po=0;if(void 0===Zt._unevaluatedLayout.getValue("text-radial-offset")){const mr=Zt.layout.get("text-offset").evaluate(It,{},fn);Bo=mr[0]*Pr,po=mr[1]*Pr}else Bo=Zt.layout.get("text-radial-offset").evaluate(It,{},fn)*Pr,po=Dy;if(Dt.allowVerticalPlacement&&yt.vertical){const mr=yt.vertical;if(ie)oi=K0(mr),zt&&(cn=K0(zt));else{const Dr=Zt.layout.get("text-rotate").evaluate(It,{},fn)+90;Oi=vg(on,fi,Xe,Qt,vn,hn,mr,ri,Dr,re),zt&&(pi=vg(on,fi,Xe,Qt,vn,hn,zt,ct,Dr))}}if(pt){const mr=Dt.iconSizeData,Dr=Zt.layout.get("icon-rotate").evaluate(It,{},fn),Io=Cw(pt,Dr,wn,Rr,Gt.iconScaleFactor),Jo=zt?Cw(zt,Dr,wn,Rr,Gt.iconScaleFactor):void 0;Xn=vg(on,fi,Xe,Qt,vn,hn,pt,ct,Dr,null),si=4*Io.length;let Vo=null;"source"===mr.kind?(Vo=[El*Zt.layout.get("icon-size").evaluate(It,{},fn)*Gt.iconScaleFactor],Vo[0]>wd&&_n(`${Dt.layerIds[0]}: Value for "icon-size" is >= ${yg}. Reduce your "icon-size".`)):"composite"===mr.kind&&(Vo=[El*Gt.compositeIconSizes[0].evaluate(It,{},fn)*Gt.iconScaleFactor,El*Gt.compositeIconSizes[1].evaluate(It,{},fn)*Gt.iconScaleFactor],(Vo[0]>wd||Vo[1]>wd)&&_n(`${Dt.layerIds[0]}: Value for "icon-size" is >= ${yg}. Reduce your "icon-size".`)),Dt.addSymbols(Dt.icon,Io,Vo,mt,ht,It,void 0,tt,Xe,ci.lineStartIndex,ci.lineLength,-1,$t,fn,li,Xi),Ai=Dt.icon.placedSymbolArray.length-1,Jo&&(Bi=4*Jo.length,Dt.addSymbols(Dt.icon,Jo,Vo,mt,ht,It,Rs.vertical,tt,Xe,ci.lineStartIndex,ci.lineLength,-1,$t,fn,li,Xi),er=Dt.icon.placedSymbolArray.length-1)}for(const mr in yt.horizontal){const Dr=mr,Io=yt.horizontal[Dr];jn||(Lr=Xd(Io.text),ie?vi=K0(Io):jn=vg(on,fi,Xe,Qt,vn,hn,Io,ri,Zt.layout.get("text-rotate").evaluate(It,{},fn),re));const Jo=1===Io.positionedLines.length;if(Ut+=My(Dt,tt,Xe,Io,xt,Zt,ie,It,re,ci,yt.vertical?Rs.horizontal:Rs.horizontalOnly,Jo?CT(yt.horizontal):[Dr],mi,Ai,Gt,$t,fn,li),Jo)break}yt.vertical&&(An+=My(Dt,tt,Xe,yt.vertical,xt,Zt,ie,It,re,ci,Rs.vertical,["vertical"],mi,er,Gt,$t,fn,li));let no=-1;const ys=(mr,Dr)=>mr?Math.max(mr,Dr):Dr;no=ys(vi,no),no=ys(oi,no),no=ys(cn,no);const xc=no>-1?1:0;Dt.glyphOffsetArray.length>=65535&&_n("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==It.sortKey&&Dt.addToSortKeyRanges(Dt.symbolInstances.length,It.sortKey),Dt.symbolInstances.emplaceBack(Xe.x,Xe.y,fi.x,fi.y,fi.z,mi.right>=0?mi.right:-1,mi.center>=0?mi.center:-1,mi.left>=0?mi.left:-1,mi.vertical>=0?mi.vertical:-1,Ai,er,Lr,void 0!==jn?jn:Dt.collisionBoxArray.length,void 0!==jn?jn+1:Dt.collisionBoxArray.length,void 0!==Oi?Oi:Dt.collisionBoxArray.length,void 0!==Oi?Oi+1:Dt.collisionBoxArray.length,void 0!==Xn?Xn:Dt.collisionBoxArray.length,void 0!==Xn?Xn+1:Dt.collisionBoxArray.length,pi||Dt.collisionBoxArray.length,pi?pi+1:Dt.collisionBoxArray.length,Qt,Ut,An,si,Bi,xc,0,Bo,po,no,0,Rr?1:0,Ri)}(a,at,kt,Ve,o,c,m,h,a.layers[0],a.collisionBoxArray,i.index,i.sourceLayerIndex,a.index,De,Q,T,0,He,$e,W,i,g,I,A,M,L,V,j,Je)};if("line"===J)for(const Ve of np(i.geometry,0,0,ft,ft)){const at=bw(Ve,je,ot,o.vertical||he,c,be,Ee,a.overscaling,ft);for(const et of at)he&&Py(a,he.text,Ke,et)||Ae(Ve,et,M)}else if("line-center"===J){for(const Ve of i.geometry)if(Ve.length>1){const at=wT(Ve,ot,o.vertical||he,c,be,Ee);at&&Ae(Ve,at,M)}}else if("Polygon"===i.type)for(const Ve of Oh(i.geometry,0)){const at=TT(Ve,16);Ae(Ve[0],new mu(at.x,at.y,0,0,void 0),M)}else if("LineString"===i.type)for(const Ve of i.geometry)Ae(Ve,new mu(Ve[0].x,Ve[0].y,0,0,void 0),M);else if("Point"===i.type)for(const Ve of i.geometry)for(const at of Ve)Ae([at],new mu(at.x,at.y,0,0,void 0),M)}const yg=255,wd=yg*El;function My(a,i,o,c,h,m,g,x,E,T,I,A,M,F,L,V,j,W){const Q=function(me,he,fe,be,Ee,je,De,He){const ot=[];if(0===he.positionedLines.length)return ot;const $e=be.layout.get("text-rotate").evaluate(je,{})*Math.PI/180,Ke=function(Ve){const at=Ve[0],et=Ve[1],kt=at*et;return kt>0?[at,-et]:kt<0?[-at,et]:0===at?[et,at]:[et,-at]}(fe);let nt=Math.abs(he.top-he.bottom);for(const Ve of he.positionedLines)nt-=Ve.lineOffset;const Be=he.positionedLines.length,Je=nt/Be;let Ae=he.top-fe[1];for(let Ve=0;Ve<Be;++Ve){const at=he.positionedLines[Ve];Ae=ET(he,Je,Ae,Ve);for(const et of at.positionedGlyphs){if(!et.rect)continue;const kt=et.rect||{};let Dt=dg+1,Xe=!0,tt=1,At=0;if(et.image){const It=De.get(et.image.toString());if(!It)continue;if(It.sdf){_n("SDF images are not supported in formatted text and will be ignored.");continue}Xe=!1,tt=It.pixelRatio,Dt=Zh/tt}const yt=(Ee||He)&&et.vertical,pt=et.metrics.advance*et.scale/2,xt=et.metrics,zt=et.rect;if(null===zt)continue;He&&he.verticalizable&&(At=et.image?pt-et.metrics.width*et.scale/2:0);const Zt=Ee?[et.x+pt,et.y]:[0,0];let on=[0,0],Qt=[0,0],vn=!1;Ee||(yt?(Qt=[et.x+pt+Ke[0],et.y+Ke[1]-At],vn=!0):on=[et.x+pt+fe[0],et.y+fe[1]-At]);const hn=zt.w*et.scale/(tt*(et.localGlyph?Tl:1)),ri=zt.h*et.scale/(tt*(et.localGlyph?Tl:1));let ie,re,Le,ct;if(yt){const It=et.y-Ae,Gt=new Qe(-pt,pt-It),wn=-Math.PI/2,$t=new Qe(...Qt);ie=new Qe(-pt+on[0],on[1]),ie._rotateAround(wn,Gt)._add($t),ie.x+=-It+pt,ie.y-=(xt.left-Dt)*et.scale;const fn=et.image?xt.advance*et.scale:Pr*et.scale,li=String.fromCodePoint(et.glyph);mT(li)?ie.x+=(1-Dt)*et.scale:gT(li)?ie.x+=fn-xt.height*et.scale+(-Dt-1)*et.scale:ie.x+=et.image||xt.width+2*Dt===zt.w&&xt.height+2*Dt===zt.h?(fn-ri)/2:(fn-(xt.height+2*Dt)*et.scale)/2,re=new Qe(ie.x,ie.y-hn),Le=new Qe(ie.x+ri,ie.y),ct=new Qe(ie.x+ri,ie.y-hn)}else{const It=(xt.left-Dt)*et.scale-pt+on[0],Gt=(-xt.top-Dt)*et.scale+on[1],wn=It+hn,$t=Gt+ri;ie=new Qe(It,Gt),re=new Qe(wn,Gt),Le=new Qe(It,$t),ct=new Qe(wn,$t)}if($e){let It;It=Ee?new Qe(0,0):vn?new Qe(Ke[0],Ke[1]):new Qe(fe[0],fe[1]),ie._rotateAround($e,It),re._rotateAround($e,It),Le._rotateAround($e,It),ct._rotateAround($e,It)}const ht=new Qe(0,0),mt=new Qe(0,0);ot.push({tl:ie,tr:re,bl:Le,br:ct,texPrimary:kt,texSecondary:void 0,writingMode:he.writingMode,glyphOffset:Zt,sectionIndex:et.sectionIndex,isSDF:Xe,pixelOffsetTL:ht,pixelOffsetBR:mt,minFontScaleX:0,minFontScaleY:0})}}return ot}(0,c,E,m,g,x,h,a.allowVerticalPlacement),J=a.textSizeData;let te=null;"source"===J.kind?(te=[El*m.layout.get("text-size").evaluate(x,{},j)*L.textScaleFactor],te[0]>wd&&_n(`${a.layerIds[0]}: Value for "text-size" is >= ${yg}. Reduce your "text-size".`)):"composite"===J.kind&&(te=[El*L.compositeTextSizes[0].evaluate(x,{},j)*L.textScaleFactor,El*L.compositeTextSizes[1].evaluate(x,{},j)*L.textScaleFactor],(te[0]>wd||te[1]>wd)&&_n(`${a.layerIds[0]}: Value for "text-size" is >= ${yg}. Reduce your "text-size".`)),a.addSymbols(a.text,Q,te,E,g,x,I,i,o,T.lineStartIndex,T.lineLength,F,V,j,W,!1);for(const me of A)M[me]=a.text.placedSymbolArray.length-1;return 4*Q.length}function Y0(a){for(const i in a)return a[i];return null}function vg(a,i,o,c,h,m,g,x,E,T){let I=g.top,A=g.bottom,M=g.left,F=g.right;if(yy(g)&&g.collisionPadding){const L=g.collisionPadding;M-=L[0],I-=L[1],F+=L[2],A+=L[3]}if(E){const L=new Qe(M,I),V=new Qe(F,I),j=new Qe(M,A),W=new Qe(F,A),Q=Rn(E);let J=new Qe(0,0);T&&(J=new Qe(T[0],T[1])),L._rotateAround(Q,J),V._rotateAround(Q,J),j._rotateAround(Q,J),W._rotateAround(Q,J),M=Math.min(L.x,V.x,j.x,W.x),F=Math.max(L.x,V.x,j.x,W.x),I=Math.min(L.y,V.y,j.y,W.y),A=Math.max(L.y,V.y,j.y,W.y)}return a.emplaceBack(i.x,i.y,i.z,o.x,o.y,M,I,F,A,x,c,h,m),a.length-1}function K0(a){yy(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const i=a.bottom-a.top;return i>0?Math.max(10,i):null}function Py(a,i,o,c){const h=a.compareText;if(i in h){const m=h[i];for(let g=m.length-1;g>=0;g--)if(c.dist(m[g])<o)return!0}else h[i]=[];return h[i].push(c),!1}function wp(a,i){const o=a.fovAboveCenter,c=a.elevation?a.elevation.getMinElevationBelowMSL()*i:0,h=(a._camera.position[2]*a.worldSize-c)/Math.cos(a._pitch),m=Math.sin(o)*h/Math.sin(Math.max(Math.PI/2-a._pitch-o,.01));let g=Math.sin(a._pitch)*m+h;const x=h*(1/a._horizonShift);if(!a.elevation||0===a.elevation.exaggeration()){let E=Math.max(a.zoom-17,0);a.isOrthographic&&(E/=10),g*=1+E}return Math.min(1.01*g,x)}function Ep(a,i){if(!i.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:i};const o=Math.pow(2,-a.z),c=a.x*o,h=(a.x+1)*o,m=a.y*o,g=(a.y+1)*o,x=K(c),E=K(h),T=ee(m),I=ee(g),A=i.project(x,T),M=i.project(E,T),F=i.project(E,I),L=i.project(x,I);let V=Math.min(A.x,M.x,F.x,L.x),j=Math.min(A.y,M.y,F.y,L.y),W=Math.max(A.x,M.x,F.x,L.x),Q=Math.max(A.y,M.y,F.y,L.y);const J=o/16;function te(he,fe,be,Ee,je,De){const He=(be+je)/2,ot=(Ee+De)/2,$e=i.project(K(He),ee(ot)),Ke=Math.max(0,V-$e.x,j-$e.y,$e.x-W,$e.y-Q);V=Math.min(V,$e.x),W=Math.max(W,$e.x),j=Math.min(j,$e.y),Q=Math.max(Q,$e.y),Ke>J&&(te(he,$e,be,Ee,He,ot),te($e,fe,He,ot,je,De))}te(A,M,c,m,h,m),te(M,F,h,m,h,g),te(F,L,h,g,c,g),te(L,A,c,g,c,m),V-=J,j-=J,W+=J,Q+=J;const me=1/Math.max(W-V,Q-j);return{scale:me,x:V*me,y:j*me,x2:W*me,y2:Q*me,projection:i}}function xg(a,{x:i,y:o},c=0){return new Qe(((i-c)*a.scale-a.x)*ft,(o*a.scale-a.y)*ft)}const KD=pn(new Float32Array(16));class Ed{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,o){return{x:0,y:0,z:0}}unproject(i,o){return new O(0,0)}projectTilePoint(i,o,c){return{x:i,y:o,z:0}}locationPoint(i,o,c,h=!0){return i._coordinatePoint(i.locationCoordinate(o,c),h)}pixelsPerMeter(i,o){return $(1,i)*o}pixelSpaceConversion(i,o,c){return 1}farthestPixelDistance(i){return wp(i,i.pixelsPerMeter)}pointCoordinate(i,o,c,h){const m=i.horizonLineFromTop(!1),g=new Qe(o,Math.max(m,c));return i.rayIntersectionCoordinate(i.pointRayIntersection(g,h))}pointCoordinate3D(i,o,c){const h=new Qe(o,c);if(i.elevation)return i.elevation.pointCoordinate(h);{const m=this.pointCoordinate(i,h.x,h.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(i,o){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,o.x,o.y);const c=i.horizonLineFromTop();return o.y<c}createInversionMatrix(i,o){return KD}createTileMatrix(i,o,c){let h,m,g;const x=c.canonical,E=pn(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=Ep(x,this);h=1,m=T.x+c.wrap*T.scale,g=T.y,ro(E,E,[h/T.scale,h/T.scale,i.pixelsPerMeter/o])}else h=o/i.zoomScale(x.z),m=(x.x+Math.pow(2,x.z)*c.wrap)*h,g=x.y*h;return Uo(E,E,[m,g,0]),ro(E,E,[h/ft,h/ft,1]),E}upVector(i,o,c){return[0,0,1]}upVectorScale(i,o,c){return{metersToTile:1}}}class Iw extends Ed{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[o,c]=this.parallels=i.parallels||[29.5,45.5],h=Math.sin(Rn(o));this.n=(h+Math.sin(Rn(c)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(i,o){const{n:c,c:h,r0:m}=this,g=Rn(i-this.center[0]),x=Rn(o),E=Math.sqrt(h-2*c*Math.sin(x))/c;return{x:E*Math.sin(g*c),y:E*Math.cos(g*c)-m,z:0}}unproject(i,o){const{n:c,c:h,r0:m}=this,g=m+o;let x=Math.atan2(i,Math.abs(g))*Math.sign(g);g*c<0&&(x-=Math.PI*Math.sign(i)*Math.sign(g));const E=Rn(this.center[0])*c;x=Fe(x,-Math.PI-E,Math.PI-E);const T=se(Pe(x/c)+this.center[0],-180,180),I=Math.asin(se((h-(i*i+g*g)*c*c)/(2*c),-1,1)),A=se(Pe(I),-le,le);return new O(T,A)}}const Tp=1.340264,bg=-.081106,wg=893e-6,Cp=.003796,Eg=Math.sqrt(3)/2;class Tg extends Ed{project(i,o){o=o/180*Math.PI,i=i/180*Math.PI;const c=Math.asin(Eg*Math.sin(o)),h=c*c,m=h*h*h;return{x:.5*(i*Math.cos(c)/(Eg*(Tp+3*bg*h+m*(7*wg+9*Cp*h)))/Math.PI+.5),y:1-.5*(c*(Tp+bg*h+m*(wg+Cp*h))/Math.PI+1),z:0}}unproject(i,o){i=(2*i-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,h=c*c,m=h*h*h;for(let I,A,M,F=0;F<12&&(A=c*(Tp+bg*h+m*(wg+Cp*h))-o,M=Tp+3*bg*h+m*(7*wg+9*Cp*h),I=A/M,c=se(c-I,-Math.PI/3,Math.PI/3),h=c*c,m=h*h*h,!(Math.abs(I)<1e-12));++F);const g=Eg*i*(Tp+3*bg*h+m*(7*wg+9*Cp*h))/Math.cos(c),x=Math.asin(Math.sin(c)/Eg),E=se(180*g/Math.PI,-180,180),T=se(180*x/Math.PI,-le,le);return new O(E,T)}}class DT extends Ed{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,o){return{x:.5+i/360,y:.5-o/360,z:0}}unproject(i,o){const c=360*(i-.5),h=se(360*(.5-o),-le,le);return new O(c,h)}}const Xh=Math.PI/2;function Cg(a){return Math.tan((Xh+a)/2)}class IT extends Ed{constructor(i){super(i),this.center=i.center||[0,30];const[o,c]=this.parallels=i.parallels||[30,30];let h=Rn(o),m=Rn(c);this.southernCenter=h+m<0,this.southernCenter&&(h=-h,m=-m);const g=Math.cos(h),x=Cg(h);this.n=h===m?Math.sin(h):Math.log(g/Math.cos(m))/Math.log(Cg(m)/x),this.f=g*Math.pow(Cg(h),this.n)/this.n}project(i,o){o=Rn(o),this.southernCenter&&(o=-o),i=Rn(i-this.center[0]);const c=1e-6,{n:h,f:m}=this;m>0?o<-Xh+c&&(o=-Xh+c):o>Xh-c&&(o=Xh-c);const g=m/Math.pow(Cg(o),h);let x=g*Math.sin(h*i),E=m-g*Math.cos(h*i);return x=.5*(x/Math.PI+.5),E=.5*(E/Math.PI+.5),{x,y:this.southernCenter?E:1-E,z:0}}unproject(i,o){i=(2*i-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:c,f:h}=this,m=h-o,g=Math.sign(m),x=Math.sign(c)*Math.sqrt(i*i+m*m);let E=Math.atan2(i,Math.abs(m))*g;m*c<0&&(E-=Math.PI*Math.sign(i)*g);const T=se(Pe(E/c)+this.center[0],-180,180),I=se(Pe(2*Math.atan(Math.pow(h/x,1/c))-Xh),-le,le);return new O(T,this.southernCenter?-I:I)}}class Aw extends Ed{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,o){return{x:U(i),y:q(o),z:0}}unproject(i,o){const c=K(i),h=ee(o);return new O(c,h)}}const Sp=Rn(le);class AT extends Ed{project(i,o){const c=(o=Rn(o))*o,h=c*c;return{x:.5*((i=Rn(i))*(.8707-.131979*c+h*(h*(.003971*c-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+c*(.015085+h*(.028874*c-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(i,o){i=(2*i-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,h=25,m=0,g=c*c;do{g=c*c;const T=g*g;m=(c*(1.007226+g*(.015085+T*(.028874*g-.044475-.005916*T)))-o)/(1.007226+g*(.045255+T*(.259866*g-.311325-.005916*11*T))),c=se(c-m,-Sp,Sp)}while(Math.abs(m)>1e-6&&--h>0);g=c*c;const x=se(Pe(i/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),E=Pe(c);return new O(x,E)}}const Mw=Rn(le);class MT extends Ed{project(i,o){o=Rn(o),i=Rn(i);const c=Math.cos(o),h=2/Math.PI,m=Math.acos(c*Math.cos(i/2)),g=Math.sin(m)/m,x=.5*(i*h+2*c*Math.sin(i/2)/g)||0,E=.5*(o+Math.sin(o)/g)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(i,o){let c=i=(2*i-.5)*Math.PI,h=o=(2*(1-o)-1)*Math.PI,m=25;const g=1e-6;let x=0,E=0;do{const T=Math.cos(h),I=Math.sin(h),A=2*I*T,M=I*I,F=T*T,L=Math.cos(c/2),V=Math.sin(c/2),j=2*L*V,W=V*V,Q=1-F*L*L,J=Q?1/Q:0,te=Q?Math.acos(T*L)*Math.sqrt(1/Q):0,me=.5*(2*te*T*V+2*c/Math.PI)-i,he=.5*(te*I+h)-o,fe=.5*J*(F*W+te*T*L*M)+1/Math.PI,be=J*(j*A/4-te*I*V),Ee=.125*J*(A*V-te*I*F*j),je=.5*J*(M*L+te*W*T)+.5,De=be*Ee-je*fe;x=(he*be-me*je)/De,E=(me*Ee-he*fe)/De,c=se(c-x,-Math.PI,Math.PI),h=se(h-E,-Mw,Mw)}while((Math.abs(x)>g||Math.abs(E)>g)&&--m>0);return new O(Pe(c),Pe(h))}}class Pw extends Ed{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Rn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,o){const{scale:c,cosPhi:h}=this;return{x:Rn(i)*h*c+.5,y:-Math.sin(Rn(o))/h*c+.5,z:0}}unproject(i,o){const{scale:c,cosPhi:h}=this,m=-(o-.5)/c,g=se(Pe((i-.5)/c)/h,-180,180),x=Math.asin(se(m*h,-1,1)),E=se(Pe(x),-le,le);return new O(g,E)}}class PT extends Aw{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,o,c){const h=Vm(i,o,c);return lr(h,h,jm(ja(c))),{x:h[0],y:h[1],z:h[2]}}locationPoint(i,o,c){const h=C(o.lat,o.lng),m=Mi([],h),g=c?i._centerAltitude+c:i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(o),i._centerAltitude):i._centerAltitude;Ho(h,h,m,$(1,0)*ft*g);const x=pn(new Float64Array(16));return Hi(x,i.pixelMatrix,i.globeMatrix),lr(h,h,x),new Qe(h[0],h[1])}pixelsPerMeter(i,o){return $(1,0)*o}pixelSpaceConversion(i,o,c){const h=$(1,i)*o,m=Nt($(1,45)*o,h,c);return this.pixelsPerMeter(i,o)/m}createTileMatrix(i,o,c){const h=Um(ja(c.canonical));return Hi(new Float64Array(16),i.globeMatrix,h)}createInversionMatrix(i,o){const{center:c}=i,h=jm(ja(o));return Zs(h,h,Rn(c.lng)),vs(h,h,Rn(c.lat)),ro(h,h,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(i,o,c,h){return cb(i,o,c,!0)||new ue(0,0)}pointCoordinate3D(i,o,c){const h=this.pointCoordinate(i,o,c,0);return[h.x,h.y,h.z]}isPointAboveHorizon(i,o){return!cb(i,o.x,o.y,!1)}farthestPixelDistance(i){const o=function(h,m){const g=h.cameraToCenterDistance,x=h._centerAltitude*m,E=h._camera,T=h._camera.forward(),I=ki([],Fi([],T,-g),[0,0,x]),A=h.worldSize/(2*Math.PI),M=[0,0,-A],F=h.width/h.height,L=Math.tan(h.fovAboveCenter),V=Fi([],E.up(),L),j=Fi([],E.right(),L*F),W=Mi([],ki([],ki([],T,V),j)),Q=[];let J;if(new Mn(I,W).closestPointOnSphere(M,A,Q)){const te=ki([],Q,M),me=cr([],te,I);J=Math.cos(h.fovAboveCenter)*go(me)}else{const te=cr([],I,M),me=cr([],M,I);Mi(me,me);const he=go(te)-A;J=Math.sqrt(he*(he+2*A));const fe=Math.acos(J/(A+he))-Math.acos(ar(T,me));J*=Math.cos(fe)}return 1.01*J}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),c=lu(i.zoom);if(c>0){const h=wp(i,$(1,i.center.lat)*i.worldSize),m=i.worldSize/(2*Math.PI),g=Math.max(i.width,i.height)/i.worldSize*Math.PI;return Nt(o,h+m*(1-Math.cos(g)),Math.pow(c,10))}return o}upVector(i,o,c){return Vm(o,c,i,1)}upVectorScale(i){return{metersToTile:xl(ms(ja(i)))}}}function Rw(a){const i=a.parallels,o=!!i&&Math.abs(i[0]+i[1])<.01;switch(a.name){case"mercator":return new Aw(a);case"equirectangular":return new DT(a);case"naturalEarth":return new AT(a);case"equalEarth":return new Tg(a);case"winkelTripel":return new MT(a);case"albers":return o?new Pw(a):new Iw(a);case"lambertConformalConic":return o?new Pw(a):new IT(a);case"globe":return new PT(a)}throw new Error(`Invalid projection name: ${a.name}`)}const RT=Re.types,OT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sg(a,i,o,c,h,m,g,x,E,T,I,A,M){const F=x?Math.min(wd,Math.round(x[0])):0,L=x?Math.min(wd,Math.round(x[1])):0;a.emplaceBack(i,o,Math.round(32*c),Math.round(32*h),m,g,(F<<1)+(E?1:0),L,16*T,16*I,256*A,256*M)}function zi(a,i,o){a.emplaceBack(i,o)}function Ry(a,i,o,c,h,m,g){a.emplaceBack(i,o,c,h,m,g)}const Yh=(a,i,o,c)=>{for(let h=0;h<i;h++)a.emplaceBack(o[0],o[1],o[2],c[0],c[1],c[2])};function Oy(a,i,o,c,h){a.emplaceBack(i,o,c,h),a.emplaceBack(i,o,c,h),a.emplaceBack(i,o,c,h),a.emplaceBack(i,o,c,h)}function kT(a){for(const i of a.sections)if(x_(i.text))return!0;return!1}class J0{constructor(i){this.layoutVertexArray=new rd,this.indexArray=new Pi,this.programConfigurations=i,this.segments=new Wi,this.dynamicLayoutVertexArray=new Va,this.opacityVertexArray=new Cm,this.placedSymbolArray=new cc,this.iconTransitioningVertexArray=new va,this.globeExtVertexArray=new Jc,this.zOffsetVertexArray=new hs,this.orientationVertexArray=new Dm}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(i,o,c,h,m){this.isEmpty()||(c&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,k0.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,aw.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,OT,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,cw.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,sw.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,hT.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=i.createVertexBuffer(this.orientationVertexArray,lw.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||h)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Et(J0,"SymbolBuffers");class Q0{constructor(i,o,c){this.layoutVertexArray=new i,this.layoutAttributes=o,this.indexArray=new c,this.segments=new Wi,this.collisionVertexArray=new eu,this.collisionVertexArrayExt=new Va}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,fT.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,pT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Et(Q0,"CollisionBuffers");class ky{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.lut=i.lut,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=pn([]),this.placementViewportMatrix=pn([]);const o=this.layers[0]._unevaluatedLayout._values;this.worldview=i.worldview,this.textSizeData=wy(this.zoom,o["text-size"],this.worldview),this.iconSizeData=wy(this.zoom,o["icon-size"],this.worldview);const c=this.layers[0].layout,h=c.get("symbol-sort-key"),m=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(g=>Rs[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new J0(new Is(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("text")||i.startsWith("symbol"))),this.icon=new J0(new Is(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("icon")||i.startsWith("symbol"))),this.glyphOffsetArray=new Zf,this.lineVertexArray=new S_,this.symbolInstances=new Rm}calculateGlyphDependencies(i,o,c,h,m){for(const g of i){const x=g.codePointAt(0);if(void 0===x)break;if(o[x]=!0,h&&m&&x<=65535){const E=_c[g];E&&(o[E.charCodeAt(0)]=!0)}}}updateFootprints(i,o){}updateReplacement(i,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const c=o.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!W_(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(i,o,c,h){const m=this.layers[0],g=m.layout,x="globe"===this.projection.name,E=g.get("text-font"),T=g.get("text-field"),I=g.get("icon-image"),[A,M]=g.get("icon-size-scale-range"),F=se(o.scaleFactor||1,A,M),L=("constant"!==T.value.kind||T.value.value instanceof Kr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&("constant"!==E.value.kind||E.value.value.length>0),V="constant"!==I.value.kind||!!I.value.value||Object.keys(I.parameters).length>0,j=g.get("symbol-sort-key");if(this.features=[],!L&&!V)return;const W=o.iconDependencies,Q=o.glyphDependencies,J=o.availableImages,te=new Tn(this.zoom,{worldview:this.worldview});for(const{feature:me,id:he,index:fe,sourceLayerIndex:be}of i){const Ee=m._featureFilter.needGeometry,je=Ne(me,Ee);if(!m._featureFilter.filter(te,je,c))continue;if(Ee||(je.geometry=_e(me,c,h)),x&&1!==me.type&&c.z<=5){const Ke=je.geometry,nt=.98078528056,Be=(Je,Ae)=>ar(Vm(Je.x,Je.y,c,1),Vm(Ae.x,Ae.y,c,1))<nt;for(let Je=0;Je<Ke.length;Je++)Ke[Je]=ke(Ke[Je],Be)}let De,He;if(L){const Ke=m.getValueAndResolveTokens("text-field",je,c,J),nt=Kr.factory(Ke);kT(nt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===hr()||this.hasRTLText&&Gs.isParsed())&&(De=fu(nt,m,je))}if(V){const Ke=m.getValueAndResolveTokens("icon-image",je,c,J);He="string"==typeof Ke?vo.build(Ke):Ke}if(!De&&!He)continue;const ot=this.sortFeaturesByKey?j.evaluate(je,{},c):void 0,$e={id:he,text:De,icon:He,index:fe,sourceLayerIndex:be,geometry:je.geometry,properties:me.properties,type:RT[me.type],sortKey:ot};if(this.features.push($e),He){const Ke=this.layers[0]._unevaluatedLayout._values,{iconPrimary:nt,iconSecondary:Be}=Iy(He,this.iconSizeData,Ke["icon-size"],c,this.zoom,$e,this.pixelRatio,F,this.worldview),Je=nt.id.toString();if(W.has(Je)?W.get(Je).push(nt):W.set(Je,[nt]),Be){this.hasAnySecondaryIcon=!0;const Ae=Be.id.toString();W.has(Ae)?W.get(Ae).push(Be):W.set(Ae,[Be])}}if(De){const Ke=E.evaluate(je,{},c).join(","),nt="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Rs.vertical)>=0;for(const Be of De.sections)if(Be.image){const Je=Be.image.getPrimary().scaleSelf(this.pixelRatio),Ae=Je.id.toString(),Ve=W.get(Ae)||[];Ve.push(Je),W.set(Ae,Ve)}else{const Je=zf(De.toString()),Ae=Be.fontStack||Ke,Ve=Q[Ae]=Q[Ae]||{};this.calculateGlyphDependencies(Be.text,Ve,nt,this.allowVerticalPlacement,Je)}}}if("line"===g.get("symbol-placement")&&(this.features=function(me){const he={},fe={},be=[];let Ee=0;function je($e){be.push(me[$e]),Ee++}function De($e,Ke,nt){const Be=fe[$e];return delete fe[$e],fe[Ke]=Be,be[Be].geometry[0].pop(),be[Be].geometry[0]=be[Be].geometry[0].concat(nt[0]),Be}function He($e,Ke,nt){const Be=he[Ke];return delete he[Ke],he[$e]=Be,be[Be].geometry[0].shift(),be[Be].geometry[0]=nt[0].concat(be[Be].geometry[0]),Be}function ot($e,Ke,nt){const Be=nt?Ke[0][Ke[0].length-1]:Ke[0][0];return`${$e}:${Be.x}:${Be.y}`}for(let $e=0;$e<me.length;$e++){const Ke=me[$e],nt=Ke.geometry,Be=Ke.text?Ke.text.toString():null;if(!Be){je($e);continue}const Je=ot(Be,nt),Ae=ot(Be,nt,!0);if(Je in fe&&Ae in he&&fe[Je]!==he[Ae]){const Ve=He(Je,Ae,nt),at=De(Je,Ae,be[Ve].geometry);delete he[Je],delete fe[Ae],fe[ot(Be,be[at].geometry,!0)]=at,be[Ve].geometry=null}else Je in fe?De(Je,Ae,nt):Ae in he?He(Je,Ae,nt):(je($e),he[Je]=Ee-1,fe[Ae]=Ee-1)}return be.filter($e=>$e.geometry)}(this.features)),"hd-road-markup"===g.get("symbol-elevation-reference")){if(this.elevationType="road",o.elevationFeatures){!this.elevationFeatures&&o.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const me of o.elevationFeatures)this.elevationFeatureIdToIndex.set(me.id,this.elevationFeatures.length),this.elevationFeatures.push(me)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");"none"!==this.elevationType&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((me,he)=>me.sortKey-he.sortKey)}update(i,o,c,h,m,g,x){this.text.programConfigurations.updatePaintArrays(i,o,m,c,h,g,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(i,o,m,c,h,g,x,this.worldview)}updateRoadElevation(i){if("road"!==this.elevationType||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let o=!1;const c=ce(i),h=1/c;let m=!1,g=!1;for(let x=0;x<this.symbolInstances.length;x++){const E=this.symbolInstances.get(x),T=gr(1,0,0),I=gr(0,1,0),{numHorizontalGlyphVertices:A,numVerticalGlyphVertices:M,numIconVertices:F,numVerticalIconVertices:L}=E,V=A>0||M>0,j=F>0,W=this.elevationFeatures[E.elevationFeatureIndex];if(W){const Q=new Qe(E.tileAnchorX,E.tileAnchorY),J=.075+W.pointElevation(Q);E.zOffset!==J&&(o=!0,E.zOffset=J);const te=W.computeSlopeNormal(Q,h),me=Mu(Xa(),gr(0,0,1),te);Ma(T,T,me),Ma(I,I,me),T[2]*=c,I[2]*=c,1===T[0]&&0===T[1]&&0===T[2]&&0===I[0]&&1===I[1]&&0===I[2]||(m=m||V,g=g||j)}if(V&&(Yh(this.text.orientationVertexArray,A,T,I),Yh(this.text.orientationVertexArray,M,T,I)),j){const{placedIconSymbolIndex:Q,verticalPlacedIconSymbolIndex:J}=E;Q>=0&&Yh(this.icon.orientationVertexArray,F,T,I),J>=0&&Yh(this.icon.orientationVertexArray,L,T,I)}}m||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),o&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const i=(m,g,x)=>{c+=g,c>m.length&&m.resize(c);for(let E=-g;E<0;E++)m.emplace(E+c,x)},o=(m,g,x)=>{h+=g,h>m.length&&m.resize(h);for(let E=-g;E<0;E++)m.emplace(E+h,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,h=0;for(let m=0;m<this.symbolInstances.length;m++){const g=this.symbolInstances.get(m),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:E,numIconVertices:T}=g,I=g.zOffset,A=T>0;if((x>0||E>0)&&(i(this.text.zOffsetVertexArray,x,I),i(this.text.zOffsetVertexArray,E,I)),A){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:F}=g;M>=0&&o(this.icon.zOffsetVertexArray,T,I),F>=0&&o(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Rw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,o){const c=this.lineVertexArray.length;if(void 0!==i.segment)for(const{x:h,y:m}of o)this.lineVertexArray.emplaceBack(h,m);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(i,o,c,h,m,g,x,E,T,I,A,M,F,L,V,j){const W=i.indexArray,Q=i.layoutVertexArray,J=i.globeExtVertexArray,te=i.segments.prepareSegment(4*o.length,Q,W,this.canOverlap?g.sortKey:void 0),me=this.glyphOffsetArray.length,he=te.vertexLength,fe=this.allowVerticalPlacement&&x===Rs.vertical?Math.PI/2:0,be=g.text&&g.text.sections;for(let je=0;je<o.length;je++){const{tl:De,tr:He,bl:ot,br:$e,texPrimary:Ke,texSecondary:nt,pixelOffsetTL:Be,pixelOffsetBR:Je,minFontScaleX:Ae,minFontScaleY:Ve,glyphOffset:at,isSDF:et,sectionIndex:kt}=o[je],Dt=te.vertexLength,Xe=at[1];if(Sg(Q,T.x,T.y,De.x,Xe+De.y,Ke.x,Ke.y,c,et,Be.x,Be.y,Ae,Ve),Sg(Q,T.x,T.y,He.x,Xe+He.y,Ke.x+Ke.w,Ke.y,c,et,Je.x,Be.y,Ae,Ve),Sg(Q,T.x,T.y,ot.x,Xe+ot.y,Ke.x,Ke.y+Ke.h,c,et,Be.x,Je.y,Ae,Ve),Sg(Q,T.x,T.y,$e.x,Xe+$e.y,Ke.x+Ke.w,Ke.y+Ke.h,c,et,Je.x,Je.y,Ae,Ve),E){const{x:tt,y:At,z:yt}=E.anchor,[pt,xt,zt]=E.up;Ry(J,tt,At,yt,pt,xt,zt),Ry(J,tt,At,yt,pt,xt,zt),Ry(J,tt,At,yt,pt,xt,zt),Ry(J,tt,At,yt,pt,xt,zt),Oy(i.dynamicLayoutVertexArray,tt,At,yt,fe)}else Oy(i.dynamicLayoutVertexArray,T.x,T.y,T.z,fe);if(j){const tt=nt||Ke;zi(i.iconTransitioningVertexArray,tt.x,tt.y),zi(i.iconTransitioningVertexArray,tt.x+tt.w,tt.y),zi(i.iconTransitioningVertexArray,tt.x,tt.y+tt.h),zi(i.iconTransitioningVertexArray,tt.x+tt.w,tt.y+tt.h)}W.emplaceBack(Dt,Dt+1,Dt+2),W.emplaceBack(Dt+1,Dt+2,Dt+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(at[0]),je!==o.length-1&&kt===o[je+1].sectionIndex||i.programConfigurations.populatePaintArrays(Q.length,g,g.index,{},F,L,V,be&&be[kt],this.worldview)}const Ee=E?E.anchor:T;i.placedSymbolArray.emplaceBack(Ee.x,Ee.y,Ee.z,T.x,T.y,me,this.glyphOffsetArray.length-me,he,I,A,T.segment,c?c[0]:0,c?c[1]:0,h[0],h[1],x,0,0,0,M,0)}_commitLayoutVertex(i,o,c,h,m,g,x){i.emplaceBack(o,c,h,m,g,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(i,o,c,h,m,g,x){const E=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),T=E.vertexLength,I=x.tileAnchorX,A=x.tileAnchorY;for(let F=0;F<4;F++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,o,i.padding,x.zOffset),this._commitLayoutVertex(c.layoutVertexArray,h,m,g,I,A,new Qe(i.x1,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,m,g,I,A,new Qe(i.x2,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,m,g,I,A,new Qe(i.x2,i.y2)),this._commitLayoutVertex(c.layoutVertexArray,h,m,g,I,A,new Qe(i.x1,i.y2)),E.vertexLength+=4;const M=c.indexArray;M.emplaceBack(T,T+1),M.emplaceBack(T+1,T+2),M.emplaceBack(T+2,T+3),M.emplaceBack(T+3,T),E.primitiveLength+=4}_addTextDebugCollisionBoxes(i,o,c,h,m,g){for(let x=h;x<m;x++){const E=c.get(x),T=this.getSymbolInstanceTextSize(i,g,o,x);this._addCollisionDebugVertices(E,T,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(i,o,c,h,m,g){for(let x=h;x<m;x++){const E=c.get(x),T=this.getSymbolInstanceIconSize(i,o,g.placedIconSymbolIndex);this._addCollisionDebugVertices(E,T,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}generateCollisionDebugBuffers(i,o,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Q0(xh,uw.members,va),this.iconCollisionBox=new Q0(xh,uw.members,va);const h=mg(this.iconSizeData,i),m=mg(this.textSizeData,i,c);for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(m,i,o,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(m,i,o,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,i,o,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,i,o,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(i,o,c,h){const m=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:h),g=V0(this.textSizeData,i,m)/Pr;return this.tilePixelRatio*g}getSymbolInstanceIconSize(i,o,c){const h=this.icon.placedSymbolArray.get(c),m=V0(this.iconSizeData,i,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(i,o,c,h){i.emplaceBack(o,-c,-c,h),i.emplaceBack(o,c,-c,h),i.emplaceBack(o,c,c,h),i.emplaceBack(o,-c,c,h)}_updateTextDebugCollisionBoxes(i,o,c,h,m,g,x){for(let E=h;E<m;E++){const T=c.get(E),I=this.getSymbolInstanceTextSize(i,g,o,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,T.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(i,o,c,h,m,g,x){for(let E=h;E<m;E++){const T=c.get(E),I=this.getSymbolInstanceIconSize(i,o,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,T.padding,g.zOffset)}}updateCollisionDebugBuffers(i,o,c,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const m=mg(this.iconSizeData,i,h),g=mg(this.textSizeData,i,c);for(let x=0;x<this.symbolInstances.length;x++){const E=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(g,i,o,E.textBoxStartIndex,E.textBoxEndIndex,E,c),this._updateTextDebugCollisionBoxes(g,i,o,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,c),this._updateIconDebugCollisionBoxes(m,i,o,E.iconBoxStartIndex,E.iconBoxEndIndex,E,h),this._updateIconDebugCollisionBoxes(m,i,o,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,o,c,h,m,g,x,E,T){const I={};if(o<c){const{x1:A,y1:M,x2:F,y2:L,padding:V,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:te,featureIndex:me}=i.get(o);I.textBox={x1:A,y1:M,x2:F,y2:L,padding:V,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:te},I.textFeatureIndex=me}if(h<m){const{x1:A,y1:M,x2:F,y2:L,padding:V,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:te,featureIndex:me}=i.get(h);I.verticalTextBox={x1:A,y1:M,x2:F,y2:L,padding:V,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:te},I.verticalTextFeatureIndex=me}if(g<x){const{x1:A,y1:M,x2:F,y2:L,padding:V,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:te,featureIndex:me}=i.get(g);I.iconBox={x1:A,y1:M,x2:F,y2:L,padding:V,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:te},I.iconFeatureIndex=me}if(E<T){const{x1:A,y1:M,x2:F,y2:L,padding:V,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:te,featureIndex:me}=i.get(E);I.verticalIconBox={x1:A,y1:M,x2:F,y2:L,padding:V,projectedAnchorX:j,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:J,tileAnchorY:te},I.verticalIconFeatureIndex=me}return I}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,o){const c=i.placedSymbolArray.get(o),h=c.vertexStartIndex+4*c.numGlyphs;for(let m=c.vertexStartIndex;m<h;m+=4)i.indexArray.emplaceBack(m,m+1,m+2),i.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const o=Math.sin(i),c=Math.cos(i),h=[],m=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const E=this.symbolInstances.get(x);h.push(0|Math.round(o*E.tileAnchorX+c*E.tileAnchorY)),m.push(E.featureIndex)}return g.sort((x,E)=>h[x]-h[E]||m[E]-m[x]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,o){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===o?c.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const c=this.symbolInstances.get(o);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:T}=c;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),g>=0&&g!==m&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ow,kw,Fy;Et(ky,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ky.addDynamicAttributes=Oy;class ex{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Oc,this.defaultValue=i}evaluate(i){if(i.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(i.formattedSection))return o.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Et(ex,"FormatSectionOverride",{omit:["defaultValue"]});const tx=()=>Fy||(Fy={layout:Ow||(Ow=new Ji({"symbol-placement":new it(Se.layout_symbol["symbol-placement"]),"symbol-spacing":new it(Se.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new it(Se.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _t(Se.layout_symbol["symbol-sort-key"]),"symbol-z-order":new it(Se.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new it(Se.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new it(Se.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new it(Se.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new it(Se.layout_symbol["icon-ignore-placement"]),"icon-optional":new it(Se.layout_symbol["icon-optional"]),"icon-rotation-alignment":new it(Se.layout_symbol["icon-rotation-alignment"]),"icon-size":new _t(Se.layout_symbol["icon-size"]),"icon-size-scale-range":new it(Se.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new _t(Se.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _t(Se.layout_symbol["icon-text-fit-padding"]),"icon-image":new _t(Se.layout_symbol["icon-image"]),"icon-rotate":new _t(Se.layout_symbol["icon-rotate"]),"icon-padding":new it(Se.layout_symbol["icon-padding"]),"icon-keep-upright":new it(Se.layout_symbol["icon-keep-upright"]),"icon-offset":new _t(Se.layout_symbol["icon-offset"]),"icon-anchor":new _t(Se.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new it(Se.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new it(Se.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new it(Se.layout_symbol["text-rotation-alignment"]),"text-field":new _t(Se.layout_symbol["text-field"]),"text-font":new _t(Se.layout_symbol["text-font"]),"text-size":new _t(Se.layout_symbol["text-size"]),"text-size-scale-range":new it(Se.layout_symbol["text-size-scale-range"]),"text-max-width":new _t(Se.layout_symbol["text-max-width"]),"text-line-height":new _t(Se.layout_symbol["text-line-height"]),"text-letter-spacing":new _t(Se.layout_symbol["text-letter-spacing"]),"text-justify":new _t(Se.layout_symbol["text-justify"]),"text-radial-offset":new _t(Se.layout_symbol["text-radial-offset"]),"text-variable-anchor":new it(Se.layout_symbol["text-variable-anchor"]),"text-anchor":new _t(Se.layout_symbol["text-anchor"]),"text-max-angle":new it(Se.layout_symbol["text-max-angle"]),"text-writing-mode":new it(Se.layout_symbol["text-writing-mode"]),"text-rotate":new _t(Se.layout_symbol["text-rotate"]),"text-padding":new it(Se.layout_symbol["text-padding"]),"text-keep-upright":new it(Se.layout_symbol["text-keep-upright"]),"text-transform":new _t(Se.layout_symbol["text-transform"]),"text-offset":new _t(Se.layout_symbol["text-offset"]),"text-allow-overlap":new it(Se.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new it(Se.layout_symbol["text-ignore-placement"]),"text-optional":new it(Se.layout_symbol["text-optional"]),visibility:new it(Se.layout_symbol.visibility)})),paint:kw||(kw=new Ji({"icon-opacity":new _t(Se.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new _t(Se.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new _t(Se.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new _t(Se.paint_symbol["text-emissive-strength"]),"icon-color":new _t(Se.paint_symbol["icon-color"]),"icon-halo-color":new _t(Se.paint_symbol["icon-halo-color"]),"icon-halo-width":new _t(Se.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _t(Se.paint_symbol["icon-halo-blur"]),"icon-translate":new it(Se.paint_symbol["icon-translate"]),"icon-translate-anchor":new it(Se.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new it(Se.paint_symbol["icon-image-cross-fade"]),"text-opacity":new _t(Se.paint_symbol["text-opacity"]),"text-occlusion-opacity":new _t(Se.paint_symbol["text-occlusion-opacity"]),"text-color":new _t(Se.paint_symbol["text-color"],{runtimeType:yi,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new _t(Se.paint_symbol["text-halo-color"]),"text-halo-width":new _t(Se.paint_symbol["text-halo-width"]),"text-halo-blur":new _t(Se.paint_symbol["text-halo-blur"]),"text-translate":new it(Se.paint_symbol["text-translate"]),"text-translate-anchor":new it(Se.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new it(Se.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new it(Se.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new it(Se.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new it(Se.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new _t(Se.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"})}))},Fy);class nx extends So{constructor(i,o,c,h){super(i,tx(),o,c,h),this._colorAdjustmentMatrix=pn([]),this.hasInitialOcclusionOpacityProperties=void 0!==i.paint&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}recalculate(i,o){super.recalculate(i,o),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const h=[];for(const m of c)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,o,c,h){return this._saturation===i&&this._contrast===o&&this._brightnessMin===c&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(m,g,x,E){m=_o(m),g=Go(g);const T=Nl(),I=m/3,A=1-2*I,M=[A,I,I,0,I,A,I,0,I,I,A,0,0,0,0,1],F=.5-.5*g,L=E-x;return Hi(T,[L,0,0,0,0,L,0,0,0,0,L,0,x,x,x,1],[g,0,0,0,0,g,0,0,0,0,g,0,F,F,F,1]),Hi(T,T,M),T}(i,o,c,h),this._saturation=i,this._contrast=o,this._brightnessMin=c,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,o,c,h){const m=this.layout.get(i).evaluate(o,{},c,h),g=this._unevaluatedLayout._values[i];return g.isDataDriven()||y_(g.value)||!m?m:(x=o.properties,m.replace(/{([^{}]+)}/g,(T,I)=>I in x?String(x[I]):""));var x}createBucket(i){return new ky(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of tx().paint.overridableProperties){if(!nx.hasPaintOverride(this.layout,i))continue;const o=this.paint.get(i),c=new ex(o),h=new __(c,o.property.specification,this.scope,this.options);let m=null;m="constant"===o.value.kind||"source"===o.value.kind?new Ff("source",h):new Zc("composite",h,o.value.zoomStops,o.value.interpolationType),this.paint._values[i]=new Xc(o.property,m,o.parameters)}}_handleOverridablePaintPropertyUpdate(i,o,c){return!(!this.layout||o.isDataDriven()||c.isDataDriven())&&nx.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,o){const c=i.get("text-field"),h=tx().paint.properties[o];let m=!1;const g=x=>{for(const E of x)if(h.overrides&&h.overrides.hasOverride(E))return void(m=!0)};if("constant"===c.value.kind&&c.value.value instanceof Kr)g(c.value.value.sections);else if("source"===c.value.kind){const x=T=>{m||(T instanceof Vt&&wt(T.value)===kc?g(T.value.sections):T instanceof gt?g(T.sections):T.eachChild(x))},E=c.value;E._styleExpression&&x(E._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(i,o,c){return{config:new Wo(this,{zoom:o,lut:c}),overrideFog:!1}}hasElevation(){return this.layout&&"hd-road-markup"===this.layout.get("symbol-elevation-reference")}}let ix,Fw,FT,Dg;var rx=En([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Ly(a,i,o,c,h,m,g,x){const E=[a,i,1,o,c,1,h,m,1],T=[g,x,1],I=ks([],E),[A,M,F]=Mo(T,T,I);return Fs(E,E,[A,0,0,0,M,0,0,0,F])}function Ny(a,i,o,c,h,m,g,x){const E=function(T,I,A,M,F,L,V,j){const W=Ly(0,0,1,0,1,1,0,1),Q=Ly(T,I,A,M,F,L,V,j);return Fs(Q,Q,ks([],W))}(a,i,o,c,h,m,g,x);return[E[2]/E[8]/ft,E[5]/E[8]/ft]}function zy(a){return[a[0],Math.min(Math.max(a[1],-le),le)]}class Cl extends zu{constructor(i,o,c,h){super(),this.id=i,this.dispatcher=c,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=o,this._dirty=!1}load(i,o){if(this._loaded=o||!1,this.fire(new Yr("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=fa(this.map._requestManager.transformRequest(this.url,Li.Image),(c,h)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new yn(c)):h&&(this.image=h instanceof HTMLImageElement?Xs.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new _d(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Yr("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof _d||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=i[0][1],c=i[0][1];for(const m of i)m[1]>c&&(c=m[1]),m[1]<o&&(o=m[1]);const h=(c+o)/2;if(h>le?this.onNorthPole=!0:h<-le&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const m=i.map(ue.fromLngLat);this.tileID=function(g){let x=1/0,E=1/0,T=-1/0,I=-1/0;for(const V of g)x=Math.min(x,V.x),E=Math.min(E,V.y),T=Math.max(T,V.x),I=Math.max(I,V.y);const A=Math.max(T-x,I-E),M=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),F=Math.pow(2,M);let L=Math.floor((x+T)/2*F);return L>1&&(L-=1),new Zo(M,L,Math.floor((E+I)/2*F))}(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Yr("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof _d||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const W in this.tiles){const Q=this.tiles[W];"loaded"!==Q.state&&(Q.state="loaded",Q.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=Ep(new Zo(0,0,0),this.map.transform.projection),c=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(W){const Q=W[1].x-W[0].x,J=W[1].y-W[0].y,te=W[2].x-W[1].x,me=W[2].y-W[1].y,he=W[3].x-W[2].x,fe=W[3].y-W[2].y,be=W[0].x-W[3].x,Ee=W[0].y-W[3].y,je=Q*me-te*J,De=te*fe-he*me,He=he*Ee-be*fe,ot=be*J-Q*Ee;return je>0&&De>0&&He>0&&ot>0||je<0&&De<0&&He<0&&ot<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Ep(this.tileID,this.map.transform.projection),[m,g,x,E]=this.coordinates.map(W=>{const Q=h.projection.project(W[0],W[1]);return xg(h,Q)._round()});this.perspectiveTransform=Ny(m.x,m.y,g.x,g.y,x.x,x.y,E.x,E.y);const T=this._boundsArray=new to;T.emplaceBack(m.x,m.y,0,0),T.emplaceBack(g.x,g.y,ft,0),T.emplaceBack(E.x,E.y,0,ft),T.emplaceBack(x.x,x.y,ft,ft),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(T,rx.members),this.boundsSegments=Wi.simpleSegment(0,0,4,2);const I=[],A=[zy((M=this.coordinates)[0]),zy(M[1]),zy(M[2]),zy(M[3])];var M;const[F,L,V,j]=function(W){let Q=W[0][0],J=Q,te=W[0][1],me=te;for(let he=1;he<W.length;he++)W[he][0]<Q?Q=W[he][0]:W[he][0]>J&&(J=W[he][0]),W[he][1]<te?te=W[he][1]:W[he][1]>me&&(me=W[he][1]);return[Q,te,J-Q,me-te]}(A);{const W=new to,[Q,J,te,me]=function(Be){let Je=Be[0].x,Ae=Je,Ve=Be[0].y,at=Ve;for(let et=1;et<Be.length;et++)Be[et].x<Je?Je=Be[et].x:Be[et].x>Ae&&(Ae=Be[et].x),Be[et].y<Ve?Ve=Be[et].y:Be[et].y>at&&(at=Be[et].y);return[Je,Ve,Ae-Je,at-Ve]}(c),he=Be=>[(Be.x-Q)/te,(Be.y-J)/me],[fe,be,Ee,je]=c.map(he),De=function(Be,Je,Ae,Ve,at,et,kt,Dt){const Xe=Ly(0,0,1,0,1,1,0,1);return Fs(Xe,Xe,ks([],Ly(Be,Je,Ae,Ve,at,et,kt,Dt)))}(fe[0],fe[1],be[0],be[1],Ee[0],Ee[1],je[0],je[1]);this.elevatedGlobePerspectiveTransform=Ny(fe[0],fe[1],be[0],be[1],Ee[0],Ee[1],je[0],je[1]);const He=(Be,Je)=>{I.push(Be.lng);const Ae=Math.round((Be.lng-F)/V*ft),Ve=Math.round((Be.lat-L)/j*ft),at=he(Je),et=Mo([],[at[0],at[1],1],De),kt=Math.round(et[0]/et[2]*ft),Dt=Math.round(et[1]/et[2]*ft);W.emplaceBack(Ae,Ve,kt,Dt)},ot=c[3].x-c[0].x,$e=c[3].y-c[0].y,Ke=c[2].x-c[1].x,nt=c[2].y-c[1].y;for(let Be=0;Be<65;Be++){const Je=Be/64,Ae=[c[0].x+Je*ot,c[0].y+Je*$e],Ve=[c[1].x+Je*Ke,c[1].y+Je*nt],at=Ve[0]-Ae[0],et=Ve[1]-Ae[1];for(let kt=0;kt<65;kt++){const Dt=kt/64,Xe={x:Ae[0]+at*Dt,y:Ae[1]+et*Dt};He(o.projection.unproject(Xe.x,Xe.y),Xe)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(W,rx.members)}{this.maxLongitudeTriangleSize=0;let W=[],Q=new Pi;const J=(te,me,he)=>{Q.emplaceBack(te,me,he);const fe=I[te],be=I[me],Ee=I[he],je=Math.min(Math.min(fe,be),Ee),De=Math.max(Math.max(fe,be),Ee)-je;De>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=De),W.push(je+De/2)};for(let te=0;te<64;te++)for(let me=0;me<64;me++){const he=65*te+me,fe=he+1,be=he+65,Ee=be+1;J(he,be,fe),J(fe,be,Ee)}[W,Q]=function(te,me){const he=Array.from({length:te.length},(Ee,je)=>je);he.sort((Ee,je)=>te[Ee]-te[je]);const fe=[],be=new Pi;for(let Ee=0;Ee<he.length;Ee++){const je=he[Ee];fe.push(te[je]);const De=3*je,He=De+1;be.emplaceBack(me.uint16[De],me.uint16[He],me.uint16[He+1])}return[fe,be]}(W,Q),this.elevatedGlobeTrianglesCenterLongitudes=W,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(Q)}this.elevatedGlobeSegments=Wi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,V/ft,0,j/ft,0,0,L,F,0])}prepare(){const i=0!==Object.keys(this.tiles).length;if(this.tileID&&!i)return;const o=this.map.painter.context,c=o.gl;!this._dirty||this.texture instanceof _d||(this.texture?this.texture.update(this.image):(this.texture=new Hh(o,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(o)}loadTile(i,o){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},o(null)):(i.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let h=(m=i+180)+360*Math.round((c[0]-m)/360);var m;const g=new Wi,x=(A,M)=>{g.segments.push({vertexOffset:0,primitiveOffset:A,vertexLength:o.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-h)<=E){const A=Xr(c,0,c.length,h+E);return A===c.length||x(A,Si(c,A+1,c.length,h+360-E)-A),g}h<c[0]&&(h+=360);const T=Si(c,0,c.length,h-E);if(T===c.length)return x(0,c.length),g;x(0,T-0);const I=Xr(c,T+1,c.length,h+E);return I!==c.length&&x(I,c.length-I),g}}const Ig=(Math.pow(256,2)-1)/16907520;class _s extends So{constructor(i,o,c,h){super(i,{layout:FT||(FT=new Ji({visibility:new it(Se.layout_raster.visibility)})),paint:Dg||(Dg=new Ji({"raster-opacity":new it(Se.paint_raster["raster-opacity"]),"raster-color":new Yc(Se.paint_raster["raster-color"]),"raster-color-mix":new it(Se.paint_raster["raster-color-mix"]),"raster-color-range":new it(Se.paint_raster["raster-color-range"]),"raster-hue-rotate":new it(Se.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new it(Se.paint_raster["raster-brightness-min"]),"raster-brightness-max":new it(Se.paint_raster["raster-brightness-max"]),"raster-saturation":new it(Se.paint_raster["raster-saturation"]),"raster-contrast":new it(Se.paint_raster["raster-contrast"]),"raster-resampling":new it(Se.paint_raster["raster-resampling"]),"raster-fade-duration":new it(Se.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new it(Se.paint_raster["raster-emissive-strength"]),"raster-array-band":new it(Se.paint_raster["raster-array-band"]),"raster-elevation":new it(Se.paint_raster["raster-elevation"]),"raster-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"})}))},o,c,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof Cl&&(i._source.onNorthPole||i._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(i){"raster-color"!==i&&"raster-color-range"!==i||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[c,h]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(h)||c===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=$m({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,h])}}let Td,Ag,Ea,Ha,Kh;class Jh extends So{constructor(i,o,c,h){super(i,{layout:Td||(Td=new Ji({visibility:new it(Se["layout_raster-particle"].visibility)})),paint:Ag||(Ag=new Ji({"raster-particle-array-band":new it(Se["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new it(Se["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Yc(Se["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new it(Se["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new it(Se["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new it(Se["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new it(Se["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new it(Se["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"})}))},o,c,h),this._updateColorRamp(),this.lastInvalidatedAt=Xs.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){"raster-particle-color"!==i&&"raster-particle-max-speed"!==i||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===i&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=$m({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Xs.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Dp extends So{constructor(i,o){super(i,{},o,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(i){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(i){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function Cd(a,i,o){const c=[0,0,1],h=Pa([]);return jl(h,h,o?-Rn(a)+Math.PI:Rn(a)),Cc(h,h,-Rn(i)),Ma(c,c,h),Mi(c,c)}const Qh={None:0,Model:1,Symbol:2,FillExtrusion:4};class yu{constructor(i,o,c,h){this.message=(i?`${i}: `:"")+c,h&&(this.identifier=h),null!=o&&o.__line__&&(this.line=o.__line__)}}function Sd(a,i){const o=-1===a.indexOf("://");try{return new URL(a,o&&i?"http://example.com":void 0),!0}catch{return!1}}class ef{constructor(i,o){this.feature=i,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class tf{constructor(){this.instancedDataArray=new bh,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class By{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=i.projection,this.index=i.index,this.worldview=i.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=i.styleDefinedModelURLs}updateFootprints(i,o){}populate(i,o,c,h){this.tileToMeter=ce(c);const m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:x,index:E,sourceLayerIndex:T}of i){const I=x??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),A=Ne(g,m);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom,{worldview:this.worldview}),A,c))continue;const M={id:I,sourceLayerIndex:T,index:E,geometry:m?A.geometry:_e(g,c,h),properties:g.properties,type:g.type,patterns:{}},F=this.addFeature(M,M.geometry,A);F&&o.featureIndex.insert(g,M.geometry,E,T,this.index,this.instancesPerModel[F].instancedDataArray.length,ft/32)}this.lookup=null}update(i,o,c,h){for(const m in this.instancesPerModel){const g=this.instancesPerModel[m];for(const x in i)g.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(g.features[g.idToFeaturesIndex[x]],i[x],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const o in this.instancesPerModel){const c=this.instancesPerModel[o];for(const h of c.features){const m=this.layers[0],g=h.feature,x=this.canonical,E=m.paint.get("model-rotation").evaluate(g,{},x),T=m.paint.get("model-scale").evaluate(g,{},x),I=m.paint.get("model-translation").evaluate(g,{},x);xs(h.rotation,E)&&xs(h.scale,T)&&xs(h.translation,I)||(this.evaluate(h,h.featureStates,c,!0),i=!0)}}return i}updateReplacement(i,o,c,h){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const m=o.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(W_(this.activeReplacements,m))return!1;this.activeReplacements=m;let g=!1;for(const x in this.instancesPerModel){const E=this.instancesPerModel[x],T=E.instancedDataArray;for(const I of E.features){const A=I.instancedDataOffset,M=I.instancedDataCount;for(let F=0;F<M;F++){const L=16*(F+A);let V=T.float32[L+0];const j=V>ft;V=j?V-ft:V;const W=Math.floor(V),Q=T.float32[L+1];let J=!1;for(const te of this.activeReplacements)if(!HE(te,c,Qh.Model,h)&&!(te.min.x>W||W>te.max.x||te.min.y>Q||Q>te.max.y)&&(J=Lh(fc(W,Q,i.canonical,te.footprintTileId.canonical),te.footprint),J))break;T.float32[L]=J?V+ft:V,g=g||J!==j}}}return g}isEmpty(){for(const i in this.instancesPerModel)if(0!==this.instancesPerModel[i].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const o in this.instancesPerModel){const c=this.instancesPerModel[o];c.instancedDataArray.length<0||0===c.instancedDataArray.length||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=i.createVertexBuffer(c.instancedDataArray,T0.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const c=this.instancesPerModel[o];0!==c.instancedDataArray.length&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(i&&this.modelUris&&this.modelsRequested)for(const o of this.modelUris)i.removeModel(o,"",!0)}addFeature(i,o,c){const h=this.layers[0],m=h.layout.get("model-id").evaluate(c,{},this.canonical);if(!m)return _n(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),m;(Sd(m,!1)||void 0!==this.styleDefinedModelURLs[m])&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new tf);const g=this.instancesPerModel[m],x=g.instancedDataArray,E=new ef(c,x.length);for(const T of o)for(const I of T){if(I.x<0||I.x>=ft||I.y<0||I.y>=ft)continue;const A=(this.lookupDim-1)/ft,M=this.lookupDim*(I.y*A|0)+I.x*A|0;if(this.lookup){if(0!==this.lookup[M])continue;this.lookup[M]=1}this.instanceCount++;const F=x.length;x.resize(F+1),g.instancesEvaluatedElevation.push(0),x.float32[16*F]=I.x,x.float32[16*F+1]=I.y}return E.instancedDataCount=g.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(i.id&&(g.idToFeaturesIndex[i.id]=g.features.length),g.features.push(E),this.evaluate(E,{},g,!1)),m}getModelUris(){return this.modelUris}evaluate(i,o,c,h){const m=this.layers[0],g=i.feature,x=this.canonical,E=i.rotation=m.paint.get("model-rotation").evaluate(g,o,x),T=i.scale=m.paint.get("model-scale").evaluate(g,o,x),I=i.translation=m.paint.get("model-translation").evaluate(g,o,x),A=m.paint.get("model-color").evaluate(g,o,x);A.a=m.paint.get("model-color-mix-intensity").evaluate(g,o,x);const M=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),Ub(M,E,T);const F=Math.round(100*A.a)+A.b/1.05;for(let L=0;L<i.instancedDataCount;++L){const V=i.instancedDataOffset+L,j=16*V,W=c.instancedDataArray.float32;let Q=0;h&&(Q=W[j+6]-c.instancesEvaluatedElevation[V]);const J=0|W[j+1];W[j]=(0|W[j])+A.r/1.05,W[j+1]=J+A.g/1.05,W[j+2]=F,W[j+3]=1/(x.z>10?this.tileToMeter:ce(x,J)),W[j+4]=I[0],W[j+5]=I[1],W[j+6]=I[2]+Q,W[j+7]=M[0],W[j+8]=M[1],W[j+9]=M[2],W[j+10]=M[4],W[j+11]=M[5],W[j+12]=M[6],W[j+13]=M[8],W[j+14]=M[9],W[j+15]=M[10],c.instancesEvaluatedElevation[V]=I[2]}}}let ox,sx;Et(By,"ModelBucket",{omit:["layers"]}),Et(tf,"PerModelAttributes"),Et(ef,"ModelFeature");class nf{constructor(i,o,c){this._demTile=i,this._dem=this._demTile.dem,this._scale=o,this._offset=c}static create(i,o,c){const h=c||i.findDEMTileFor(o);if(!h||!h.dem)return;const m=h.dem,g=h.tileID,x=1<<o.canonical.z-g.canonical.z;return new nf(h,m.dim/ft/x,[(o.canonical.x/x-g.canonical.x)*m.dim,(o.canonical.y/x-g.canonical.y)*m.dim])}tileCoordToPixel(i,o){const c=o*this._scale+this._offset[1];return new Qe(Math.floor(i*this._scale+this._offset[0]),Math.floor(c))}getElevationAt(i,o,c,h){const m=i*this._scale+this._offset[0],g=o*this._scale+this._offset[1],x=Math.floor(m),E=Math.floor(g),T=this._dem;return h=!!h,c?Nt(Nt(T.get(x,E,h),T.get(x,E+1,h),g-E),Nt(T.get(x+1,E,h),T.get(x+1,E+1,h),g-E),m-x):T.get(x,E,h)}getElevationAtPixel(i,o,c){return this._dem.get(i,o,!!c)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*$(1,i)*this._dem.stride}}const Vy=new Float32Array(262144),Dd=new Uint8Array(262144);function ax(a){let i=0;if(a.meshes)for(const o of a.meshes)i=Math.max(i,o.aabb.max[2]);if(a.children)for(const o of a.children)i=Math.max(i,ax(o));return i}function lx(a,i,o){if(a.meshes)for(const c of a.meshes){if(c.aabb.min[0]===1/0)continue;const h=an.applyTransform(c.aabb,a.matrix);o.insert(i,h.min[0],h.min[1],h.max[0],h.max[1])}if(a.children)for(const c of a.children)lx(c,i,o)}const cx=["","wall","door","roof","window","lamp","logo"];class jy{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:i.id,geometry:[],properties:{height:ax(i)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new an([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const o=new an([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==i&&(c.transformedAabb=an.applyTransformFast(c.aabb,this.node.matrix),o.encapsulate(c.transformedAabb)),i++;this.aabb=o}return this.aabb}}class Uy{constructor(i,o,c,h,m,g,x,E){this.id=c,this.layers=i,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=vd.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=vd.HasMapboxMeshFeatures),m&&(this.modelTraits|=vd.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=E,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of o)this.nodesInfo.push(new jy(T)),lx(T,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(i,o){for(const c of this.getNodesInfo()){const h=c.node;h.footprint&&o.push({footprint:h.footprint,id:i})}}update(i){const o=0!==Object.keys(i).length;if(o&&!this.stateDependentLayers.length)return;const c=o?this.stateDependentLayers:this.layers;if(!el(i,this.states))for(const h of c)this.evaluate(h,i);this.states=structuredClone(i)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const c of o){const h=c.node;this.uploaded?this.updatePbrBuffer(h):hp(h,i,!0)}for(const c of o)uy(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let o=!1;if(!i.meshes)return o;for(const c of i.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),o=!0);return o}needsReEvaluation(i,o,c){const h=i.transform.projectionOptions,m=i.style.getBrightness(),g=this.brightness!==m;if(!this.uploaded||this.dirty||h.name!==this.projection.name||Hy(c.paint.get("model-color").value,g)||Hy(c.paint.get("model-color-mix-intensity").value,g)||Hy(c.paint.get("model-roughness").value,g)||Hy(c.paint.get("model-emissive-strength").value,g)||Hy(c.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=h,this.brightness=m;const x=this.getNodesInfo();for(const E of x)E.state=null;return!0}return!1}evaluateTransform(i,o){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const c=this.getNodesInfo(),h=this.id.canonical;for(const m of c){const g=m.feature;m.evaluatedTranslation=o.paint.get("model-translation").evaluate(g,{},h),m.evaluatedScale=o.paint.get("model-scale").evaluate(g,{},h)}}evaluate(i,o){const c=this.getNodesInfo();for(const h of c){if(!h.node.meshes)continue;const m=h.feature,g=o&&o[m.id];if(el(g,h.state))continue;h.state=structuredClone(g);const x=h.node.meshes&&h.node.meshes[0].featureData,E=h.evaluatedColor[2],T=h.evaluatedRMEA[2],I=this.id.canonical;if(h.hasTranslucentParts=!1,x){for(let A=0;A<cx.length;A++){const M=cx[A];M.length&&(m.properties.part=M);const F=i.paint.get("model-color").evaluate(m,g,I).toPremultipliedRenderColor(null),L=i.paint.get("model-color-mix-intensity").evaluate(m,g,I);h.evaluatedColor[A]=[F.r,F.g,F.b,L],h.evaluatedRMEA[A][0]=i.paint.get("model-roughness").evaluate(m,g,I),h.evaluatedRMEA[A][2]=i.paint.get("model-emissive-strength").evaluate(m,g,I),h.evaluatedRMEA[A][3]=F.a,h.emissionHeightBasedParams[A]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,g,I),!h.hasTranslucentParts&&F.a<1&&(h.hasTranslucentParts=!0)}delete m.properties.part,LT(h,E!==h.evaluatedColor[2]||T!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(m,g,I);h.evaluatedTranslation=i.paint.get("model-translation").evaluate(m,g,I),h.evaluatedScale=i.paint.get("model-scale").evaluate(m,g,I),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,o,c,h){const m=i.findDEMTileFor(c);if(m&&(m.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;const g=nf.create(i,c,m);if(!g)return;this.modelTraits&vd.HasMapboxMeshFeatures&&this.updateDEM(i,g,c,h);for(const x of this.getNodesInfo()){const E=x.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const T=E.footprint.vertices;let I=g.getElevationAt(T[0].x,T[0].y,!0,!0);for(let A=1;A<T.length;A++)I=Math.min(I,g.getElevationAt(T[A].x,T[A].y,!0,!0));E.elevation=I}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=o}}updateDEM(i,o,c,h){let m=o._dem._modifiedForSources[h];if(void 0===m&&(o._dem._modifiedForSources[h]=[],m=o._dem._modifiedForSources[h]),m.includes(c.canonical))return;const g=o._dem.dim;m.push(c.canonical);let x=!1;for(const E of this.getNodesInfo()){const T=E.node;if(!T.footprint||!T.footprint.grid)continue;const I=T.footprint.grid,A=o.tileCoordToPixel(I.min.x,I.min.y),M=o.tileCoordToPixel(I.max.x,I.max.y),F=Math.min(Math.min(g-M.y,A.x),Math.min(A.y,g-M.x));if(F<0)continue;const L=se(F,2,5);let V=Math.max(0,A.x-L),j=Math.max(0,A.y-L),W=Math.min(M.x+L,g-1),Q=Math.min(M.y+L,g-1);for(let he=j;he<=Q;++he)for(let fe=V;fe<=W;++fe)Dd[he*g+fe]=255;let J=0,te=0;for(let he=0;he<I.cellsY;++he)for(let fe=0;fe<I.cellsX;++fe){if(!I.cells[he*I.cellsX+fe])continue;const be=o.tileCoordToPixel(I.min.x+fe/I.xScale,I.min.y+he/I.yScale),Ee=o.tileCoordToPixel(I.min.x+(fe+1)/I.xScale,I.min.y+(he+1)/I.yScale);for(let je=be.y;je<=Math.min(Ee.y+1,g-1);++je)for(let De=be.x;De<=Math.min(Ee.x+1,g-1);++De)255===Dd[je*g+De]&&(Dd[je*g+De]=0,J+=o.getElevationAtPixel(De,je),te++)}const me=J/te;V=Math.max(1,A.x-L),j=Math.max(1,A.y-L),W=Math.min(M.x+L,g-2),Q=Math.min(M.y+L,g-2),x=!0;for(let he=j;he<=Q;++he)for(let fe=V;fe<=W;++fe)0===Dd[he*g+fe]&&(Vy[he*g+fe]=o._dem.set(fe,he,me));for(let he=1;he<L;++he){V=Math.max(1,A.x-he),j=Math.max(1,A.y-he),W=Math.min(M.x+he,g-2),Q=Math.min(M.y+he,g-2);for(let fe=j;fe<=Q;++fe)for(let be=V;be<=W;++be){const Ee=fe*g+be;if(255===Dd[Ee]){let je=0,De=0,He=-1,ot=-1;for(let $e=-1;$e<=1;++$e)for(let Ke=-1;Ke<=1;++Ke){const nt=(fe+$e)*g+be+Ke;if(Dd[nt]>=he)continue;const Be=Vy[nt],Je=Math.abs(Be);Je>De&&(je=Be,De=Je,He=Ke,ot=$e)}if(De>.1){const $e=1-(he+.5*Math.abs(He*ot))/L;let Ke=o._dem.get(be,fe)+je*$e;const nt=o._dem.get(be+He,fe+ot),Be=o._dem.get(be-He,fe-ot,!0);(Ke-nt)*(Ke-Be)>0&&(Ke=(nt+Be)/2),Vy[Ee]=o._dem.set(be,fe,Ke),Dd[Ee]=he}}}}}x&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=Xs.now())}setFilter(i){this.filter=i?_h(i):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(i=>this.filter.filter(new Tn(this.id.overscaledZ,{worldview:this.worldview}),i.feature,this.id.canonical)):this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const o of i)uy(o.node),dy(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const c=o.getReplacementRegionsForTile(i.toUnwrapped());for(const h of this.getNodesInfo()){const m=h.node.footprint;h.hiddenByReplacement=!!m&&!c.find(g=>g.footprint===m)}}getHeightAtTileCoord(i,o){const c=[],h=[0,0,0],m=pn([]);for(const g of this.getNodesInfo()){const x=g.node.meshes[0],E=x.transformedAabb;if(i<E.min[0]||o<E.min[1]||i>E.max[0]||o>E.max[1])continue;if(!0===g.node.hidden)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};ts(m,g.node.matrix),h[0]=i,h[1]=o,lr(h,h,m);const T=(h[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*64|0,I=64*Math.min(63,(h[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*64|0)+Math.min(63,T),A=x.heightmap[I];if(!(A<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:A,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new Qe(i,o),new Qe(i,o),c),c.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function Hy(a,i){return a instanceof Ff&&!a.isLightConstant&&i}function JD(a,i,o,c,h,m,g,x){let E=(61440&i|(61440&i)>>4)>>8,T=(3840&i|(3840&i)>>4)>>4,I=240&i|(240&i)>>4;o[3]>0&&(E=Nt(E,255*o[0],o[3]),T=Nt(T,255*o[1],o[3]),I=Nt(I,255*o[2],o[3]));const A=E<<8|T,M=I<<8|Math.floor(255*c[3]),F=function(he){const fe=se(he,0,2);return Math.min(Math.round(.5*fe*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],L=se(h[0],0,1),V=se(h[1],0,1),j=se(h[2],0,1),W=se(h[3],0,1);let Q,J,te,me;if(L!==V&&g!==m&&V!==L){const he=g-m;J=1/(he*(V-L)),te=-(m+he*L)/(he*(V-L));const fe=se(h[4],-1,1);me=Math.pow(10,fe),Q=255*j<<8|255*W}else Q=65535,J=0,te=1,me=1;if(a.emplaceBack(A,M,F,Q,J,te,me),x){const he=x.length;x.clear();for(let fe=0;fe<he;fe++)x.emplaceBack(A,M,F,Q,J,te,me)}}function LT(a,i,o){const c=a.node;let h=0;const m=o&vd.HasMeshoptCompression;for(const g of c.meshes){if(c.lights&&c.lightMeshIndex===h||!g.featureData)continue;g.featureArray=new tu,g.featureArray.reserve(g.featureData.length);let x=i;for(const E of g.featureData){const T=m?65535&E:E>>16&65535,I=m?E>>16&65535:65535&E,A=(15&I)<8?15&I:0,M=a.evaluatedRMEA[A],F=a.evaluatedColor[A],L=a.emissionHeightBasedParams[A];let V;if(x&&2===A&&c.lights&&(V=new tu,V.resize(10*c.lights.length)),JD(g.featureArray,T,F,M,L,g.aabb.min[2],g.aabb.max[2],V),V&&x){x=!1;const j=c.meshes[c.lightMeshIndex];j.featureArray=V,j.featureArray._trim()}}g.featureArray._trim(),h++}}function Lw(a,i,o,c){const h=1<<a.z;i.lat=ee((c/ft+a.y)/h),i.lng=K((o/ft+a.x)/h)}function QD(a,i,o,c){const h=a.getNodesInfo()[i];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let m=Number.MAX_VALUE;const g=h.node,x=o.tile,E=c.calculatePosMatrix(x.tileID.toUnwrapped(),c.worldSize),T=h.evaluatedScale;let I=0;c.elevation&&g.elevation&&(I=g.elevation*c.elevation.exaggeration()),Uo(E,E,[(g.anchor?g.anchor[0]:0)*(T[0]-1),(g.anchor?g.anchor[1]:0)*(T[1]-1),I]),ro(E,E,T);const A=o.queryGeometry,M=A.isPointQuery()?A.screenBounds:A.screenGeometry,F=function(V){const j=Hi([],E,V.matrix);Hi(j,c.expandedFarZProjMatrix,j);for(let W=0;W<V.meshes.length;++W){const Q=V.meshes[W];if(W===V.lightMeshIndex)continue;const J=Gb(M,c,j,Q.aabb);null!=J&&(m=Math.min(J,m))}if(V.children)for(const W of V.children)F(W)};if(F(g),m===Number.MAX_VALUE)return;const L=new O(0,0);return Lw(x.tileID.canonical,L,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:m,position:L,feature:h.feature}}Et(Uy,"Tiled3dModelBucket",{omit:["layers"]}),Et(jy,"Tiled3dModelFeature");const NT={circle:class extends So{constructor(a,i,o,c){super(a,{layout:su||(su=new Ji({"circle-sort-key":new _t(Se.layout_circle["circle-sort-key"]),"circle-elevation-reference":new it(Se.layout_circle["circle-elevation-reference"]),visibility:new it(Se.layout_circle.visibility)})),paint:dd||(dd=new Ji({"circle-radius":new _t(Se.paint_circle["circle-radius"]),"circle-color":new _t(Se.paint_circle["circle-color"]),"circle-blur":new _t(Se.paint_circle["circle-blur"]),"circle-opacity":new _t(Se.paint_circle["circle-opacity"]),"circle-translate":new it(Se.paint_circle["circle-translate"]),"circle-translate-anchor":new it(Se.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new it(Se.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new it(Se.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _t(Se.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _t(Se.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _t(Se.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new it(Se.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"})}))},i,o,c)}createBucket(a){return new Zn(a)}queryRadius(a){const i=a;return ho("circle-radius",this,i)+ho("circle-stroke-width",this,i)+pr(this.paint.get("circle-translate"))}queryIntersectsFeature(a,i,o,c,h,m,g,x){const E=ud(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,a.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o);return _b(a,c,m,g,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),E,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,i,o){const c=gb(this);return{config:new Wo(this,{zoom:i,lut:o}),defines:c,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&"none"!==this.layout.get("circle-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("circle-elevation-reference")}},heatmap:class extends So{createBucket(a){return new yb(a)}constructor(a,i,o,c){super(a,{layout:vb||(vb=new Ji({visibility:new it(Se.layout_heatmap.visibility)})),paint:Zv||(Zv=new Ji({"heatmap-radius":new _t(Se.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _t(Se.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new it(Se.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yc(Se.paint_heatmap["heatmap-color"]),"heatmap-opacity":new it(Se.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"})}))},i,o,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$m({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(a){return ho("heatmap-radius",this,a)}queryIntersectsFeature(a,i,o,c,h,m,g,x){const E=this.paint.get("heatmap-radius").evaluate(i,o);return _b(a,c,m,g,x,!0,!0,new Qe(0,0),E)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,i,o){return"heatmap"===a?{config:new Wo(this,{zoom:i,lut:o}),overrideFog:!1}:{}}},hillshade:class extends So{constructor(a,i,o,c){super(a,{layout:Xv||(Xv=new Ji({visibility:new it(Se.layout_hillshade.visibility)})),paint:Yv||(Yv=new Ji({"hillshade-illumination-direction":new it(Se.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new it(Se.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new it(Se.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new it(Se.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new it(Se.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new it(Se.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new it(Se.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"})}))},i,o,c)}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,i,o){return{overrideFog:!1}}},fill:class extends So{constructor(a,i,o,c){super(a,{layout:Jm||(Jm=new Ji({"fill-sort-key":new _t(Se.layout_fill["fill-sort-key"]),visibility:new it(Se.layout_fill.visibility),"fill-elevation-reference":new it(Se.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new _t(Se.layout_fill["fill-construct-bridge-guard-rail"])})),paint:G_||(G_=new Ji({"fill-antialias":new it(Se.paint_fill["fill-antialias"]),"fill-opacity":new _t(Se.paint_fill["fill-opacity"]),"fill-color":new _t(Se.paint_fill["fill-color"]),"fill-outline-color":new _t(Se.paint_fill["fill-outline-color"]),"fill-translate":new it(Se.paint_fill["fill-translate"]),"fill-translate-anchor":new it(Se.paint_fill["fill-translate-anchor"]),"fill-pattern":new _t(Se.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new it(Se.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new it(Se.paint_fill["fill-emissive-strength"]),"fill-z-offset":new _t(Se.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new _t(Se.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new _t(Se.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"})}))},i,o,c)}getProgramIds(){const a=this.paint.get("fill-pattern"),i=a&&a.constantOr(1),o=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(a,i,o){return{config:new Wo(this,{zoom:i,lut:o}),overrideFog:!1}}recalculate(a,i){super.recalculate(a,i);const o=this.paint._values["fill-outline-color"];"constant"===o.value.kind&&void 0===o.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new fd(a)}queryRadius(){return pr(this.paint.get("fill-translate"))}queryIntersectsFeature(a,i,o,c,h,m){return!a.queryGeometry.isAboveHorizon&&fr(oa(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,a.pixelToTileUnitsFactor),c)}isTileClipped(){return 0===this.paint.get("fill-z-offset").constantOr(1)}is3D(a){if(0!==this.paint.get("fill-z-offset").constantOr(1))return!0;const i=this.layout&&"none"!==this.layout.get("fill-elevation-reference");return null!=a?i&&!a:i}hasElevation(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}hasShadowPass(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}},"fill-extrusion":class extends So{constructor(a,i,o,c){super(a,{layout:ZE||(ZE=new Ji({visibility:new it(Se["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new it(Se["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:tp||(tp=new Ji({"fill-extrusion-opacity":new it(Se["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _t(Se["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new it(Se["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new it(Se["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _t(Se["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new it(Se["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new _t(Se["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _t(Se["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new it(Se["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new it(Se["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new it(Se["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new it(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new it(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new it(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new it(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new it(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new it(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new it(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new _t(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new _t(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new it(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new it(Se["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new it(Se["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new it(Se["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new _t(Se["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new _t(Se["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new it(Se["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"})}))},i,o,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new du(a)}queryRadius(){return pr(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,i,o,c,h,m,g,x,E){const T=ud(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,a.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(i,o),A=this.paint.get("fill-extrusion-base").evaluate(i,o),M=[0,0],F=x&&m.elevation,L=m.elevation?m.elevation.exaggeration():1,V=a.tile.getBucket(this);if(F&&V instanceof du){const te=V.centroidVertexArray,me=E+1;me<te.length&&(M[0]=te.geta_centroid_pos0(me),M[1]=te.geta_centroid_pos1(me))}if(0===M[0]&&1===M[1])return!1;"globe"===m.projection.name&&(c=Nb([c],[new Qe(0,0),new Qe(ft,ft)],a.tileID.canonical).map(te=>te.polygon).flat());const j=F?x:null,[W,Q]=(me=c,he=A,fe=I,be=T,Ee=g,je=j,De=M,He=L,ot=m.center.lat,"globe"===(te=m).projection.name?function(Ke,nt,Be,Je,Ae,Ve,at,et,kt,Dt,Xe){const tt=[],At=[],yt=Ke.projection.upVectorScale(Xe,Ke.center.lat,Ke.worldSize).metersToTile,pt=[0,0,0,1],xt=[0,0,0,1],zt=(on,Qt,vn,hn)=>{on[0]=Qt,on[1]=vn,on[2]=hn,on[3]=1},Zt=Lb();Be>0&&(Be+=Zt),Je+=Zt;for(const on of nt){const Qt=[],vn=[];for(const hn of on){const ri=hn.x+Ae.x,ie=hn.y+Ae.y,re=Ke.projection.projectTilePoint(ri,ie,Xe),Le=Ke.projection.upVector(Xe,hn.x,hn.y);let ct=Be,ht=Je;if(at){const mt=YE(ri,ie,Be,Je,at,et,kt,Dt);ct+=mt.base,ht+=mt.top}0!==Be?zt(pt,re.x+Le[0]*yt*ct,re.y+Le[1]*yt*ct,re.z+Le[2]*yt*ct):zt(pt,re.x,re.y,re.z),zt(xt,re.x+Le[0]*yt*ht,re.y+Le[1]*yt*ht,re.z+Le[2]*yt*ht),lr(pt,pt,Ve),lr(xt,xt,Ve),Qt.push(new pc(pt[0],pt[1],pt[2])),vn.push(new pc(xt[0],xt[1],xt[2]))}tt.push(Qt),At.push(vn)}return[tt,At]}(te,me,he,fe,be,Ee,je,De,He,ot,a.tileID.canonical):je?function(Ke,nt,Be,Je,Ae,Ve,at,et,kt){const Dt=[],Xe=[],tt=[0,0,0,1];for(const At of Ke){const yt=[],pt=[];for(const xt of At){const zt=xt.x+Je.x,Zt=xt.y+Je.y,on=YE(zt,Zt,nt,Be,Ve,at,et,kt);tt[0]=zt,tt[1]=Zt,tt[2]=on.base,tt[3]=1,bs(tt,tt,Ae),tt[3]=Math.max(tt[3],1e-5);const Qt=new pc(tt[0]/tt[3],tt[1]/tt[3],tt[2]/tt[3]);tt[0]=zt,tt[1]=Zt,tt[2]=on.top,tt[3]=1,bs(tt,tt,Ae),tt[3]=Math.max(tt[3],1e-5);const vn=new pc(tt[0]/tt[3],tt[1]/tt[3],tt[2]/tt[3]);yt.push(Qt),pt.push(vn)}Dt.push(yt),Xe.push(pt)}return[Dt,Xe]}(me,he,fe,be,Ee,je,De,He,ot):function(Ke,nt,Be,Je,Ae){const Ve=[],at=[],et=Ae[8]*nt,kt=Ae[9]*nt,Dt=Ae[10]*nt,Xe=Ae[11]*nt,tt=Ae[8]*Be,At=Ae[9]*Be,yt=Ae[10]*Be,pt=Ae[11]*Be;for(const xt of Ke){const zt=[],Zt=[];for(const on of xt){const Qt=on.x+Je.x,vn=on.y+Je.y,hn=Ae[0]*Qt+Ae[4]*vn+Ae[12],ri=Ae[1]*Qt+Ae[5]*vn+Ae[13],ie=Ae[2]*Qt+Ae[6]*vn+Ae[14],re=Ae[3]*Qt+Ae[7]*vn+Ae[15],Le=hn+et,ct=ri+kt,ht=ie+Dt,mt=Math.max(re+Xe,1e-5),It=hn+tt,Gt=ri+At,wn=ie+yt,$t=Math.max(re+pt,1e-5);zt.push(new pc(Le/mt,ct/mt,ht/mt)),Zt.push(new pc(It/$t,Gt/$t,wn/$t))}Ve.push(zt),at.push(Zt)}return[Ve,at]}(me,he,fe,be,Ee)),J=a.queryGeometry;var te,me,he,fe,be,Ee,je,De,He,ot;return function(te,me,he){let fe=1/0;fr(he,me)&&(fe=ig(he,me[0]));for(let be=0;be<me.length;be++){const Ee=me[be],je=te[be];for(let De=0;De<Ee.length-1;De++){const He=Ee[De],ot=[He,Ee[De+1],je[De+1],je[De],He];hi(he,ot)&&(fe=Math.min(fe,ig(he,ot)))}}return fe!==1/0&&fe}(W,Q,J.isPointQuery()?J.screenBounds:J.screenGeometry)}},building:class extends So{constructor(a,i,o,c){super(a,{layout:Xb||(Xb=new Ji({visibility:new it(Se.layout_building.visibility),"building-facade":new _t(Se.layout_building["building-facade"]),"building-facade-floors":new _t(Se.layout_building["building-facade-floors"]),"building-facade-window":new _t(Se.layout_building["building-facade-window"]),"building-roof-shape":new _t(Se.layout_building["building-roof-shape"]),"building-height":new _t(Se.layout_building["building-height"]),"building-base":new _t(Se.layout_building["building-base"])})),paint:M0||(M0=new Ji({"building-opacity":new it(Se.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new it(Se.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new it(Se.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new it(Se.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new it(Se.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new it(Se.paint_building["building-vertical-scale"]),"building-cast-shadows":new it(Se.paint_building["building-cast-shadows"]),"building-color":new _t(Se.paint_building["building-color"]),"building-emissive-strength":new _t(Se.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new it(Se.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new it(Se.paint_building["building-cutoff-fade-range"]),"building-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"})}))},i,o,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new A0(a)}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(a){return!0}},line:class extends So{constructor(a,i,o,c){const h=rw();super(a,h,i,o,c),h.layout&&(this.layout=new Co(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof ol,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,i){super.recalculate(a,i),this.paint._values["line-floorwidth"]=(()=>{if(ug)return ug;const o=rw();return ug=new O0(o.paint.properties["line-width"].specification),ug.useIntegerZoom=!0,ug})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new wl(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,i,o){const c=iw(this);return{config:new Wo(this,{zoom:i,lut:o}),defines:c,overrideFog:!1}}queryRadius(a){const i=a,o=ow(ho("line-width",this,i),ho("line-gap-width",this,i)),c=ho("line-offset",this,i);return o/2+Math.abs(c)+pr(this.paint.get("line-translate"))}queryIntersectsFeature(a,i,o,c,h,m){if(a.queryGeometry.isAboveHorizon)return!1;const g=oa(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,a.pixelToTileUnitsFactor),x=a.pixelToTileUnitsFactor/2*ow(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),E=this.paint.get("line-offset").evaluate(i,o);return E&&(c=function(T,I){const A=[],M=new Qe(0,0);for(let F=0;F<T.length;F++){const L=T[F],V=[];for(let j=0;j<L.length;j++){const W=L[j],Q=L[j+1],J=0===j?M:W.sub(L[j-1])._unit()._perp(),te=j===L.length-1?M:Q.sub(W)._unit()._perp(),me=J._add(te)._unit();me._mult(1/(me.x*te.x+me.y*te.y)),V.push(me._mult(I)._add(W))}A.push(V)}return A}(c,E*a.pixelToTileUnitsFactor)),function(T,I,A){for(let M=0;M<I.length;M++){const F=I[M];if(T.length>=3)for(let L=0;L<F.length;L++)if(Do(T,F[L]))return!0;if(or(T,F,A))return!0}return!1}(g,c,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets||this.layout&&"hd-road-markup"===this.layout.get("line-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("line-elevation-reference")}},symbol:nx,background:class extends So{constructor(a,i,o,c){super(a,{layout:ix||(ix=new Ji({visibility:new it(Se.layout_background.visibility)})),paint:Fw||(Fw=new Ji({"background-pitch-alignment":new it(Se.paint_background["background-pitch-alignment"]),"background-color":new it(Se.paint_background["background-color"]),"background-pattern":new it(Se.paint_background["background-pattern"]),"background-opacity":new it(Se.paint_background["background-opacity"]),"background-emissive-strength":new it(Se.paint_background["background-emissive-strength"]),"background-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"})}))},i,o,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,i,o){return{overrideFog:!1}}is3D(a){return"viewport"===this.paint.get("background-pitch-alignment")}},raster:_s,"raster-particle":Jh,sky:class extends So{constructor(a,i,o,c){super(a,{layout:Ea||(Ea=new Ji({visibility:new it(Se.layout_sky.visibility)})),paint:Ha||(Ha=new Ji({"sky-type":new it(Se.paint_sky["sky-type"]),"sky-atmosphere-sun":new it(Se.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new it(Se.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new it(Se.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new it(Se.paint_sky["sky-gradient-radius"]),"sky-gradient":new Yc(Se.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new it(Se.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new it(Se.paint_sky["sky-atmosphere-color"]),"sky-opacity":new it(Se.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"})}))},i,o,c),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=$m({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(a,i){if("atmosphere"===this.paint.get("sky-type")){const c=this.paint.get("sky-atmosphere-sun"),h=!c,m=a.style.light,g=m.properties.get("position");return h&&"viewport"===m.properties.get("anchor")&&_n("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Cd(g.azimuthal,90-g.polar,i):Cd(c[0],90-c[1],i)}const o=this.paint.get("sky-gradient-center");return Cd(o[0],90-o[1],i)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}},slot:class extends So{constructor(a,i,o,c){super(a,{paint:Kh||(Kh=new Ji({}))},i,null)}},model:class extends So{constructor(a,i,o,c){super(a,{layout:ox||(ox=new Ji({visibility:new it(Se.layout_model.visibility),"model-id":new _t(Se.layout_model["model-id"])})),paint:sx||(sx=new Ji({"model-opacity":new _t(Se.paint_model["model-opacity"]),"model-rotation":new _t(Se.paint_model["model-rotation"]),"model-scale":new _t(Se.paint_model["model-scale"]),"model-translation":new _t(Se.paint_model["model-translation"]),"model-color":new _t(Se.paint_model["model-color"]),"model-color-mix-intensity":new _t(Se.paint_model["model-color-mix-intensity"]),"model-type":new it(Se.paint_model["model-type"]),"model-cast-shadows":new it(Se.paint_model["model-cast-shadows"]),"model-receive-shadows":new it(Se.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new it(Se.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new _t(Se.paint_model["model-emissive-strength"]),"model-roughness":new _t(Se.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new _t(Se.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new it(Se.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new it(Se.paint_model["model-front-cutoff"]),"model-color-use-theme":new _t({type:"string",default:"default","property-type":"data-driven"})}))},i,o,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new By(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof Uy?ft-1:0}queryIntersectsFeature(a,i,o,c,h,m){if(!this.modelManager)return!1;const g=this.modelManager,x=a.tile.getBucket(this);if(!(x&&x instanceof By))return!1;for(const E in x.instancesPerModel){const T=x.instancesPerModel[E],I=void 0!==i.id?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(I)){const A=T.features[T.idToFeaturesIndex[I]],M=g.getModel(E,this.scope);if(!M)return!1;let F=Nl();const L=new O(0,0),V=x.canonical;let j=Number.MAX_VALUE;for(let W=0;W<A.instancedDataCount;++W){const Q=16*(A.instancedDataOffset+W),J=T.instancedDataArray.float32,te=[J[Q+4],J[Q+5],J[Q+6]];Lw(V,L,J[Q],0|J[Q+1]),$b(F,M,m,L,A.rotation,A.scale,te,!1,!1,!1),"globe"===m.projection.name&&(F=Hb(F,m));const me=Hi([],m.projMatrix,F),he=a.queryGeometry,fe=Gb(he.isPointQuery()?he.screenBounds:he.screenGeometry,m,me,M.aabb);null!=fe&&(j=Math.min(fe,j))}return j!==Number.MAX_VALUE&&j}}return!1}_handleOverridablePaintPropertyUpdate(a,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven()||"model-color"!==a&&"model-color-mix-intensity"!==a&&"model-rotation"!==a&&"model-scale"!==a&&"model-translation"!==a&&"model-emissive-strength"!==a)}_isPropertyZoomDependent(a){const i=this._transitionablePaint._values[a];return null!=i&&null!=i.value&&null!=i.value.expression&&i.value.expression instanceof Zc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends So{constructor(a,i,o,c){super(a,{layout:r0||(r0=new Ji({"clip-layer-types":new it(Se.layout_clip["clip-layer-types"]),"clip-layer-scope":new it(Se.layout_clip["clip-layer-scope"])})),paint:o0||(o0=new Ji({}))},i,o,c)}recalculate(a,i){super.recalculate(a,i)}createBucket(a){return new Ib(a)}is3D(a){return!0}}},Nw=new Jn(0,0,0),ux={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},dx={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Gy={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},hx={PAINT_ORDER_FILL_AND_STROKE:1},vu={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},$y={MASK_TYPE_LUMINANCE:1};function qy(a,i,o){var c,h;1===a&&i.icons.push((c=o,h=o.readVarint()+o.pos,function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;const{metadata:g}=m;if(g.content_area){const{content_area:x}=g;null==x.top&&(x.top=x.left),null==x.width&&(x.width=m.usvg_tree.width),null==x.height&&(x.height=x.width)}return g.stretch_x&&g.stretch_x.length&&fx(g,"x"),g.stretch_y&&g.stretch_y.length&&fx(g,"y"),m}(c.readFields(Mg,{name:void 0},h))))}function fx(a,i){const o=[],c=a[`stretch_${i}`];let h=null;for(let m=0;m<c.length;m++)null===h?h=0===o.length?c[0]:o[o.length-1][1]+c[m]:(o.push([h,h+c[m]]),h=null);a[`stretch_${i}_areas`]=o}function Mg(a,i,o){var c,h;1===a?i.name=o.readString():2===a?i.metadata=(c=o,h=o.readVarint()+o.pos,c.readFields(zw,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)):3===a&&(i.usvg_tree=function(c,h){return c.readFields(BT,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(o,o.readVarint()+o.pos),i.data="usvg_tree")}function zw(a,i,o){var c,h;1===a?i.stretch_x=o.readPackedVarint():2===a?i.stretch_y=o.readPackedVarint():3===a?i.content_area=(c=o,h=o.readVarint()+o.pos,c.readFields(zT,{left:0},h)):4===a&&i.variables.push(function(c,h){return c.readFields(Pg,{name:void 0},h)}(o,o.readVarint()+o.pos))}function zT(a,i,o){1===a?i.left=o.readVarint():2===a?i.width=o.readVarint():3===a?i.top=o.readVarint():4===a&&(i.height=o.readVarint())}function Pg(a,i,o){1===a?i.name=o.readString():2===a&&(i.rgb_color=Yy(o.readVarint()),i.value="rgb_color")}function BT(a,i,o){var c,h;1===a?i.width=i.height=o.readVarint():2===a?i.height=o.readVarint():3===a?i.children.push(Wy(o,o.readVarint()+o.pos)):4===a?i.linear_gradients.push((c=o,h=o.readVarint()+o.pos,c.readFields(px,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h))):5===a?i.radial_gradients.push(function(c,h){return c.readFields(HT,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(o,o.readVarint()+o.pos)):7===a?i.clip_paths.push(function(c,h){return c.readFields(GT,{children:[]},h)}(o,o.readVarint()+o.pos)):8===a&&i.masks.push(function(c,h){const m=c.readFields(Rg,{left:0,width:20,mask_type:$y.MASK_TYPE_LUMINANCE,children:[]},h);return null==m.height&&(m.height=m.width),null==m.top&&(m.top=m.left),m}(o,o.readVarint()+o.pos))}function Wy(a,i){return a.readFields(VT,{},i)}function VT(a,i,o){var c,h;1===a?(i.group=(c=o,h=o.readVarint()+o.pos,c.readFields(jT,{opacity:255,children:[]},h)),i.node="group"):2===a&&(i.path=function(c,h){return c.readFields(Xy,{paint_order:1,commands:[],step:1,diffs:[],rule:ux.PATH_RULE_NON_ZERO},h)}(o,o.readVarint()+o.pos),i.node="path")}function jT(a,i,o){1===a?i.transform=Ip(o,o.readVarint()+o.pos):2===a?i.opacity=o.readVarint():5===a?i.clip_path_idx=o.readVarint():6===a?i.mask_idx=o.readVarint():7===a&&i.children.push(Wy(o,o.readVarint()+o.pos))}function Ip(a,i){return a.readFields(Zy,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function Zy(a,i,o){1===a?i.sx=o.readFloat():2===a?i.ky=o.readFloat():3===a?i.kx=o.readFloat():4===a?i.sy=o.readFloat():5===a?i.tx=o.readFloat():6===a&&(i.ty=o.readFloat())}function Xy(a,i,o){var c,h;1===a?i.fill=(c=o,h=o.readVarint()+o.pos,c.readFields(eI,{rgb_color:Nw,paint:"rgb_color",opacity:255},h)):2===a?i.stroke=function(c,h){return c.readFields(UT,{rgb_color:Nw,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(o,o.readVarint()+o.pos):3===a?i.paint_order=o.readVarint():5===a?o.readPackedVarint(i.commands):6===a?i.step=o.readFloat():7===a?o.readPackedSVarint(i.diffs):8===a&&(i.rule=o.readVarint())}function eI(a,i,o){1===a?(i.rgb_color=Yy(o.readVarint()),i.paint="rgb_color"):2===a?(i.linear_gradient_idx=o.readVarint(),i.paint="linear_gradient_idx"):3===a?(i.radial_gradient_idx=o.readVarint(),i.paint="radial_gradient_idx"):5===a&&(i.opacity=o.readVarint())}function Yy(a){return new Jn((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function UT(a,i,o){1===a?(i.rgb_color=Yy(o.readVarint()),i.paint="rgb_color"):2===a?(i.linear_gradient_idx=o.readVarint(),i.paint="linear_gradient_idx"):3===a?(i.radial_gradient_idx=o.readVarint(),i.paint="radial_gradient_idx"):5===a?o.readPackedFloat(i.dasharray):6===a?i.dashoffset=o.readFloat():7===a?i.miterlimit=o.readFloat():8===a?i.opacity=o.readVarint():9===a?i.width=o.readFloat():10===a?i.linecap=o.readVarint():11===a&&(i.linejoin=o.readVarint())}function px(a,i,o){1===a?i.transform=Ip(o,o.readVarint()+o.pos):2===a?i.spread_method=o.readVarint():3===a?i.stops.push(Bw(o,o.readVarint()+o.pos)):4===a?i.x1=o.readFloat():5===a?i.y1=o.readFloat():6===a?i.x2=o.readFloat():7===a&&(i.y2=o.readFloat())}function Bw(a,i){return a.readFields(Vw,{offset:0,opacity:255,rgb_color:Nw},i)}function Vw(a,i,o){1===a?i.offset=o.readFloat():2===a?i.opacity=o.readVarint():3===a&&(i.rgb_color=Yy(o.readVarint()))}function HT(a,i,o){1===a?i.transform=Ip(o,o.readVarint()+o.pos):2===a?i.spread_method=o.readVarint():3===a?i.stops.push(Bw(o,o.readVarint()+o.pos)):4===a?i.cx=o.readFloat():5===a?i.cy=o.readFloat():6===a?i.r=o.readFloat():7===a?i.fx=o.readFloat():8===a?i.fy=o.readFloat():9===a&&(i.fr=o.readFloat())}function GT(a,i,o){1===a?i.transform=Ip(o,o.readVarint()+o.pos):2===a?i.clip_path_idx=o.readVarint():3===a&&i.children.push(Wy(o,o.readVarint()+o.pos))}function Rg(a,i,o){1===a?i.left=i.top=o.readFloat():2===a?i.width=i.height=o.readFloat():3===a?i.top=o.readFloat():4===a?i.height=o.readFloat():5===a?i.mask_type=o.readVarint():6===a?i.mask_idx=o.readVarint():7===a&&i.children.push(Wy(o,o.readVarint()+o.pos))}class jw{static calculate(i={},o=[]){const c=new Map,h=new Map;if(0===Object.keys(i).length)return c;o.forEach(m=>{h.set(m.name,m.rgb_color||new Jn(0,0,0))});for(const[m,g]of Object.entries(i))h.has(m)?c.set(h.get(m).toString(),g):console.warn(`Ignoring unknown image variable "${m}"`);return c}}function rf(a,i=255,o){const c=i/255,h=a.toString(),m=o.has(h)?o.get(h).clone():a.clone();return m.a*=c,m.toString()}function Og(a,i){if(!nl()){const o=document.createElement("canvas");return o.width=a,o.height=i,o}return new OffscreenCanvas(a,i)}function $T(a,i){const o=jw.calculate(i.params,a.metadata?a.metadata.variables:[]),c=a.usvg_tree,h=c.width,m=c.height,g=i.transform?i.transform:new DOMMatrix,x=Math.max(1,Math.round(h*g.a)),E=Math.max(1,Math.round(m*g.d)),T=new DOMMatrix([x/h,0,0,E/m,0,0]),I=Og(x,E).getContext("2d");return mx(I,T,c,c,o),I.getImageData(0,0,x,E)}function mx(a,i,o,c,h){for(const m of c.children)Uw(a,i,o,m,h)}function Uw(a,i,o,c,h){var m,x,E,T;c.group?(a.save(),function(m,g,x,E,T){const I=null!=E.mask_idx?x.masks[E.mask_idx]:null,A=null!=E.clip_path_idx?x.clip_paths[E.clip_path_idx]:null;if(E.transform&&(g=Mp(E.transform).preMultiplySelf(g)),255===E.opacity&&!(null!=A)&&!(null!=I))return void mx(m,g,x,E,T);const M=Og(m.canvas.width,m.canvas.height),F=M.getContext("2d");mx(F,g,x,E,T),A&&gx(F,g,x,A),I&&Gw(F,g,x,I,T),m.globalAlpha=E.opacity/255,m.drawImage(M,0,0)}(a,i,o,c.group,h),a.restore()):c.path&&(a.save(),x=o,E=c.path,T=h,(m=a).setTransform(i),E.paint_order===hx.PAINT_ORDER_FILL_AND_STROKE?(Ap(m,x,E,T),Hw(m,x,E,T)):(Hw(m,x,E,T),Ap(m,x,E,T)),a.restore())}function Ap(a,i,o,c){const h=o.fill;if(!h)return;const m=h.opacity/255;switch(a.save(),a.beginPath(),$w(o,a),h.paint){case"rgb_color":a.fillStyle=rf(h.rgb_color,h.opacity,c);break;case"linear_gradient_idx":{const g=i.linear_gradients[h.linear_gradient_idx];g.transform&&a.setTransform(Mp(g.transform).preMultiplySelf(a.getTransform())),a.fillStyle=Sl(a,g,m,c);break}case"radial_gradient_idx":{const g=i.radial_gradients[h.radial_gradient_idx];g.transform&&a.setTransform(Mp(g.transform).preMultiplySelf(a.getTransform())),a.fillStyle=vc(a,g,m,c)}}a.fill(Ky(o)),a.restore()}function Ky(a){return a.rule===ux.PATH_RULE_NON_ZERO?"nonzero":a.rule===ux.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Hw(a,i,o,c){const h=o.stroke;if(!h)return;const m=Jy(o);a.lineWidth=h.width,a.miterLimit=h.miterlimit,a.setLineDash(h.dasharray),a.lineDashOffset=h.dashoffset;const g=h.opacity/255;switch(h.paint){case"rgb_color":a.strokeStyle=rf(h.rgb_color,h.opacity,c);break;case"linear_gradient_idx":a.strokeStyle=Sl(a,i.linear_gradients[h.linear_gradient_idx],g,c,!0);break;case"radial_gradient_idx":a.strokeStyle=vc(a,i.radial_gradients[h.radial_gradient_idx],g,c,!0)}switch(h.linejoin){case Gy.LINE_JOIN_MITER_CLIP:case Gy.LINE_JOIN_MITER:a.lineJoin="miter";break;case Gy.LINE_JOIN_ROUND:a.lineJoin="round";break;case Gy.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(h.linecap){case dx.LINE_CAP_BUTT:a.lineCap="butt";break;case dx.LINE_CAP_ROUND:a.lineCap="round";break;case dx.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(m)}function Sl(a,i,o,c,h=!1){if(1===i.stops.length){const M=i.stops[0];return rf(M.rgb_color,M.opacity*o,c)}const{x1:m,y1:g,x2:x,y2:E}=i;let T=new DOMPoint(m,g),I=new DOMPoint(x,E);if(h){const M=Mp(i.transform);T=M.transformPoint(T),I=M.transformPoint(I)}const A=a.createLinearGradient(T.x,T.y,I.x,I.y);for(const M of i.stops)A.addColorStop(M.offset,rf(M.rgb_color,M.opacity*o,c));return A}function vc(a,i,o,c,h=!1){if(1===i.stops.length){const W=i.stops[0];return rf(W.rgb_color,W.opacity*o,c)}const m=Mp(i.transform),{fx:g,fy:x,fr:E,cx:T,cy:I,r:A}=i;let M=new DOMPoint(g,x),F=new DOMPoint(T,I),L=E,V=A;if(h){M=m.transformPoint(M),F=m.transformPoint(F);const W=(m.a+m.d)/2;L=E*W,V=i.r*W}const j=a.createRadialGradient(M.x,M.y,L,F.x,F.y,V);for(const W of i.stops)j.addColorStop(W.offset,rf(W.rgb_color,W.opacity*o,c));return j}function Id(a,i,o,c){const h=c.transform?Mp(c.transform).preMultiplySelf(i):i,m=Og(a.canvas.width,a.canvas.height),g=m.getContext("2d");for(const E of c.children)if(E.group)Id(g,h,o,E.group);else if(E.path){const T=E.path,I=new Path2D;I.addPath(Jy(T),h),g.fill(I,Ky(T))}const x=null!=c.clip_path_idx?o.clip_paths[c.clip_path_idx]:null;x&&gx(g,h,o,x),a.globalCompositeOperation="source-over",a.drawImage(m,0,0)}function gx(a,i,o,c){const h=Og(a.canvas.width,a.canvas.height);Id(h.getContext("2d"),i,o,c),a.globalCompositeOperation="destination-in",a.drawImage(h,0,0)}function Gw(a,i,o,c,h){if(0===c.children.length)return;const m=null!=c.mask_idx?o.masks[c.mask_idx]:null;m&&Gw(a,i,o,m,h);const g=a.canvas.width,x=a.canvas.height,E=Og(g,x),T=E.getContext("2d"),I=c.width,A=c.height,M=c.left,F=c.top,L=new Path2D,V=new Path2D;V.rect(M,F,I,A),L.addPath(V,i),T.clip(L);for(const Q of c.children)Uw(T,i,o,Q,h);const j=T.getImageData(0,0,g,x),W=j.data;if(c.mask_type===$y.MASK_TYPE_LUMINANCE)for(let Q=0;Q<W.length;Q+=4)W[Q+3]=W[Q+3]/255*(.2126*W[Q]+.7152*W[Q+1]+.0722*W[Q+2]);T.putImageData(j,0,0),a.globalCompositeOperation="destination-in",a.drawImage(E,0,0)}function Mp(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function $w(a,i){const o=a.step;let c=a.diffs[0]*o,h=a.diffs[1]*o;i.moveTo(c,h);for(let m=0,g=2;m<a.commands.length;m++)switch(a.commands[m]){case vu.PATH_COMMAND_MOVE:c+=a.diffs[g++]*o,h+=a.diffs[g++]*o,i.moveTo(c,h);break;case vu.PATH_COMMAND_LINE:c+=a.diffs[g++]*o,h+=a.diffs[g++]*o,i.lineTo(c,h);break;case vu.PATH_COMMAND_QUAD:{const x=c+a.diffs[g++]*o,E=h+a.diffs[g++]*o;c=x+a.diffs[g++]*o,h=E+a.diffs[g++]*o,i.quadraticCurveTo(x,E,c,h);break}case vu.PATH_COMMAND_CUBIC:{const x=c+a.diffs[g++]*o,E=h+a.diffs[g++]*o,T=x+a.diffs[g++]*o,I=E+a.diffs[g++]*o;c=T+a.diffs[g++]*o,h=I+a.diffs[g++]*o,i.bezierCurveTo(x,E,T,I,c,h);break}case vu.PATH_COMMAND_CLOSE:i.closePath()}return i}function Jy(a){return $w(a,new Path2D)}class Pp{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const o=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,o),o}put(i,o){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,o)}delete(i){this.cache.delete(i)}}Et(Pp,"LRUCache");class Qy{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(i){return new Wr(i,i.data)}getFromCache(i,o,c){return this.cacheMap.has(c)||this.cacheMap.set(c,new Pp(150)),this.cacheMap.get(c).get(td(i.toString(),o))}setInCache(i,o,c,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new Pp(150));const m=this.cacheDependenciesMap.get(h),g=td(i.id.toString(),c);m.get(g)||m.set(g,new Set);const x=this.cacheMap.get(h),E=i.toString();m.get(g).add(E),x.put(td(i.toString(),c),o)}removeImagesFromCacheByIds(i,o,c=0){if(!this.cacheMap.has(c)||!this.cacheDependenciesMap.has(c))return;const h=this.cacheMap.get(c),m=this.cacheDependenciesMap.get(c);for(const g of i){const x=td(g.toString(),o);if(m.has(x)){for(const E of m.get(x))h.delete(E);m.delete(x)}}}rasterize(i,o,c,h,m=$T){const g=this.getFromCache(i,c,h);if(g)return g.clone();const x=m(o.icon,i.options),E=Qy._getImage(x);return this.setInCache(i,E,c,h),E.clone()}}class _x{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,o){const c=this.toIdx(i,o);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(i,o){return this.leaves[this.toIdx(i,o)]}toIdx(i,o){return o*this.size+i}}function qw(a,i,o,c){let h=0,m=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(c[g])<1e-15){if(o[g]<a[g]||o[g]>i[g])return null}else{const x=1/c[g];let E=(a[g]-o[g])*x,T=(i[g]-o[g])*x;if(E>T){const I=E;E=T,T=I}if(E>h&&(h=E),T<m&&(m=T),h>m)return null}return h}function Ww(a,i,o,c,h,m,g,x,E,T,I){const A=c-a,M=h-i,F=m-o,L=g-a,V=x-i,j=E-o,W=I[1]*j-I[2]*V,Q=I[2]*L-I[0]*j,J=I[0]*V-I[1]*L,te=A*W+M*Q+F*J;if(Math.abs(te)<1e-15)return null;const me=1/te,he=T[0]-a,fe=T[1]-i,be=T[2]-o,Ee=(he*W+fe*Q+be*J)*me;if(Ee<0||Ee>1)return null;const je=fe*F-be*M,De=be*A-he*F,He=he*M-fe*A,ot=(I[0]*je+I[1]*De+I[2]*He)*me;return ot<0||Ee+ot>1?null:(L*je+V*De+j*He)*me}function Zw(a,i,o){return(a-i)/(o-i)}function kg(a,i,o,c,h,m,g,x,E){const T=1<<o,I=m-c,A=g-h,M=(a+1)/T*I+c,F=(i+0)/T*A+h,L=(i+1)/T*A+h;x[0]=(a+0)/T*I+c,x[1]=F,E[0]=M,E[1]=L}class yx{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(m){const g=Math.ceil(Math.log2(m.dim/8)),x=[];let E=Math.ceil(Math.pow(2,g));const T=1/E,I=(F,L,V,j,W)=>{const Q=j?1:0,J=(F+1)*V-Q,te=L*V,me=(L+1)*V-Q;W[0]=F*V,W[1]=te,W[2]=J,W[3]=me};let A=new _x(E);const M=[];for(let F=0;F<E*E;F++){I(F%E,Math.floor(F/E),T,!1,M);const L=xu(M[0],M[1],m),V=xu(M[2],M[1],m),j=xu(M[2],M[3],m),W=xu(M[0],M[3],m);A.minimums.push(Math.min(L,V,j,W)),A.maximums.push(Math.max(L,V,j,W)),A.leaves.push(1)}for(x.push(A),E/=2;E>=1;E/=2){const F=x[x.length-1];A=new _x(E);for(let L=0;L<E*E;L++){I(L%E,Math.floor(L/E),2,!0,M);const V=F.getElevation(M[0],M[1]),j=F.getElevation(M[2],M[1]),W=F.getElevation(M[2],M[3]),Q=F.getElevation(M[0],M[3]),J=F.isLeaf(M[0],M[1]),te=F.isLeaf(M[2],M[1]),me=F.isLeaf(M[2],M[3]),he=F.isLeaf(M[0],M[3]),fe=Math.min(V.min,j.min,W.min,Q.min),be=Math.max(V.max,j.max,W.max,Q.max),Ee=J&&te&&me&&he;A.maximums.push(be),A.minimums.push(fe),A.leaves.push(be-fe<=5&&Ee?1:0)}x.push(A)}return x}(this.dem),c=o.length-1,h=o[c];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(o,0,0,c,0)}raycastRoot(i,o,c,h,m,g,x=1){return qw([i,o,-100],[c,h,this.maximums[0]*x],m,g)}raycast(i,o,c,h,m,g,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(i,o,c,h,m,g,x);if(null==E)return null;const T=[],I=[],A=[],M=[],F=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:L,t:V,nodex:j,nodey:W,depth:Q}=F.pop();if(this.leaves[L]){kg(j,W,Q,i,o,c,h,A,M);const te=1<<Q,me=(j+0)/te,he=(j+1)/te,fe=(W+0)/te,be=(W+1)/te,Ee=xu(me,fe,this.dem)*x,je=xu(he,fe,this.dem)*x,De=xu(he,be,this.dem)*x,He=xu(me,be,this.dem)*x,ot=Ww(A[0],A[1],Ee,M[0],A[1],je,M[0],M[1],De,m,g),$e=Ww(M[0],M[1],De,A[0],M[1],He,A[0],A[1],Ee,m,g),Ke=Math.min(null!==ot?ot:Number.MAX_VALUE,null!==$e?$e:Number.MAX_VALUE);if(Ke!==Number.MAX_VALUE)return Ke;{const nt=Ho([],m,g,V);if(aa(Ee,je,He,De,Zw(nt[0],A[0],M[0]),Zw(nt[1],A[1],M[1]))>=nt[2])return V}continue}let J=0;for(let te=0;te<this._siblingOffset.length;te++){kg((j<<1)+this._siblingOffset[te][0],(W<<1)+this._siblingOffset[te][1],Q+1,i,o,c,h,A,M),A[2]=-100,M[2]=this.maximums[this.childOffsets[L]+te]*x;const me=qw(A,M,m,g);if(null!=me){const he=me;T[te]=he;let fe=!1;for(let be=0;be<J&&!fe;be++)he>=T[I[be]]&&(I.splice(be,0,te),fe=!0);fe||(I[J]=te),J++}}for(let te=0;te<J;te++){const me=I[te];F.push({idx:this.childOffsets[L]+me,t:T[me],nodex:(j<<1)+this._siblingOffset[me][0],nodey:(W<<1)+this._siblingOffset[me][1],depth:Q+1})}}return null}_addNode(i,o,c){return this.minimums.push(i),this.maximums.push(o),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(i,o,c,h,m){if(1===i[h].isLeaf(o,c))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const g=h-1,x=i[g];let E=0,T=0;for(let I=0;I<this._siblingOffset.length;I++){const A=2*o+this._siblingOffset[I][0],M=2*c+this._siblingOffset[I][1],F=x.getElevation(A,M),L=x.isLeaf(A,M),V=this._addNode(F.min,F.max,L);L&&(E|=1<<I),T||(T=V)}for(let I=0;I<this._siblingOffset.length;I++)E&1<<I||this._construct(i,2*o+this._siblingOffset[I][0],2*c+this._siblingOffset[I][1],g,T+I)}}function aa(a,i,o,c,h,m){return Nt(Nt(a,o,m),Nt(i,c,m),h)}function xu(a,i,o){const c=o.dim,h=se(a*c-.5,0,c-1),m=se(i*c-.5,0,c-1),g=Math.floor(h),x=Math.floor(m),E=Math.min(g+1,c-1),T=Math.min(x+1,c-1);return aa(o.get(g,x),o.get(E,x),o.get(g,T),o.get(E,T),h-g,m-x)}const qT={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Xw(a,i,o){return(256*a*256+256*i+o)/10-1e4}function Yw(a,i,o){return 256*a+i+o/256-32768}class Fg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,o,c,h=!1){if(this.uid=i,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return void _n(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const m=this.dim=o.height-2,g=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let E=0;E<m;E++)g[this._idx(-1,E)]=g[this._idx(0,E)],g[this._idx(m,E)]=g[this._idx(m-1,E)],g[this._idx(E,-1)]=g[this._idx(E,0)],g[this._idx(E,m)]=g[this._idx(E,m-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(m,-1)]=g[this._idx(m-1,0)],g[this._idx(-1,m)]=g[this._idx(0,m-1)],g[this._idx(m,m)]=g[this._idx(m-1,m-1)]}const x="terrarium"===c?Yw:Xw;for(let E=0;E<g.length;++E){const T=4*E;this.floatView[E]=x(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=Xs.now()}_buildQuadTree(){this._tree=new yx(this)}get(i,o,c=!1){c&&(i=se(i,-1,this.dim),o=se(o,-1,this.dim));const h=this._idx(i,o);return this.floatView[h]}set(i,o,c){const h=this._idx(i,o),m=this.floatView[h];return this.floatView[h]=c,c-m}static getUnpackVector(i){return qT[i]}_idx(i,o){if(i<-1||i>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(i+1)}static pack(i,o){const c=[0,0,0,0],h=Fg.getUnpackVector(o);let m=Math.floor((i+h[3])/h[2]);return c[2]=m%256,m=Math.floor(m/256),c[1]=m%256,m=Math.floor(m/256),c[0]=m,c}getPixels(){return new xb({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,o,c){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let h=o*this.dim,m=o*this.dim+this.dim,g=c*this.dim,x=c*this.dim+this.dim;switch(o){case-1:h=m-1;break;case 1:m=h+1}switch(c){case-1:g=x-1;break;case 1:x=g+1}const E=-o*this.dim,T=-c*this.dim;for(let I=g;I<x;I++)for(let A=h;A<m;A++){const M=4*this._idx(A,I),F=4*this._idx(A+E,I+T);this.pixels[M+0]=i.pixels[F+0],this.pixels[M+1]=i.pixels[F+1],this.pixels[M+2]=i.pixels[F+2],this.pixels[M+3]=i.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function WT(a,i,o){var c,h;1===a?i.headerLength=o.readFixed32():2===a?i.x=o.readVarint():3===a?i.y=o.readVarint():4===a?i.z=o.readVarint():5===a&&i.layers.push((c=o,h=o.readVarint()+o.pos,c.readFields(vx,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)))}function ZT(a,i,o){var c,h;1===a?(i.delta_filter=(c=o,h=o.readVarint()+o.pos,c.readFields(XT,{blockSize:0},h)),i.filter="delta_filter"):2===a?(o.readVarint(),i.filter="zigzag_filter"):3===a?(o.readVarint(),i.filter="bitshuffle_filter"):4===a&&(o.readVarint(),i.filter="byteshuffle_filter")}function XT(a,i,o){1===a&&(i.blockSize=o.readVarint())}function YT(a,i,o){1===a?(o.readVarint(),i.codec="gzip_data"):2===a?(o.readVarint(),i.codec="jpeg_image"):3===a?(o.readVarint(),i.codec="webp_image"):4===a&&(o.readVarint(),i.codec="png_image")}function Kw(a,i,o){let c=0,h=0;var m,g;1===a?i.firstByte=o.readFixed64():2===a?i.lastByte=o.readFixed64():3===a?i.filters.push((m=o,g=o.readVarint()+o.pos,m.readFields(ZT,{},g))):4===a?i.codec=function(m,g){return m.readFields(YT,{},g)}(o,o.readVarint()+o.pos):5===a?h=o.readFloat():6===a?c=o.readFloat():7===a?i.bands.push(o.readString()):8===a?i.offset=o.readDouble():9===a&&(i.scale=o.readDouble()),0===i.offset&&(i.offset=h),0===i.scale&&(i.scale=c)}function vx(a,i,o){var c,h;1===a?i.version=o.readVarint():2===a?i.name=o.readString():3===a?i.units=o.readString():4===a?i.tileSize=o.readVarint():5===a?i.buffer=o.readVarint():6===a?i.pixelFormat=o.readVarint():7===a&&i.dataIndex.push((c=o,h=o.readVarint()+o.pos,c.readFields(Kw,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)))}function Jw(a,i,o){if(2===a)c=o,h=o.readVarint()+o.pos,c.readFields(Qw,i,h);else if(3===a)throw new Error("Not implemented");var c,h}function Qw(a,i,o){if(1===a){let c=0;const h=o.readVarint()+o.pos;for(;o.pos<h;)i[c++]=o.readVarint()}}function e1(a,i){if(4!==i.length)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let o=i[3];for(let c=2;c>=1;c--){const h=1===c?1:0,m=2===c?1:0;for(let g=0;g<i[0];g++){const x=i[1]*g;for(let E=h;E<i[1];E++){const T=i[2]*(E+x);for(let I=m;I<i[2];I++){const A=i[3]*(I+T);for(let M=0;M<i[3];M++){const F=A+M;a[F]+=a[F-o]}}}}o*=i[c]}return a}function t1(a){for(let i=0,o=a.length;i<o;i++)a[i]=a[i]>>>1^-(1&a[i]);return a}function n1(a,i){switch(i){case"uint32":return a;case"uint16":for(let o=0;o<a.length;o+=2){const c=a[o],h=a[o+1];a[o]=(240&c)>>4|(61440&c)>>8|(240&h)<<4|61440&h,a[o+1]=15&c|(3840&c)>>4|(15&h)<<8|(3840&h)<<4}return a;case"uint8":for(let o=0;o<a.length;o+=4){const c=a[o],h=a[o+1],m=a[o+2],g=a[o+3];a[o+0]=(192&c)>>6|(192&h)>>4|(192&m)>>2|192&g,a[o+1]=(48&c)>>4|(48&h)>>2|48&m|(48&g)<<2,a[o+2]=(12&c)>>2|12&h|(12&m)<<2|(12&g)<<4,a[o+3]=3&c|(3&h)<<2|(3&m)<<4|(3&g)<<6}return a;default:throw new Error(`Invalid pixel format, "${i}"`)}}Et(Fg,"DEMData"),Et(yx,"DemMinMaxQuadTree",{omit:["dem"]});var la=Uint8Array,Rp=Uint16Array,r1=Int32Array,Lg=new la([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),bu=new la([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),KT=new la([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o1=function(a,i){for(var o=new Rp(31),c=0;c<31;++c)o[c]=i+=1<<a[c-1];var h=new r1(o[30]);for(c=1;c<30;++c)for(var m=o[c];m<o[c+1];++m)h[m]=m-o[c]<<5|c;return{b:o,r:h}},ev=o1(Lg,2),Ad=ev.b,xx=ev.r;Ad[28]=258,xx[258]=28;for(var JT=o1(bu,0).b,tv=new Rp(32768),Ur=0;Ur<32768;++Ur){var Ng=(43690&Ur)>>1|(21845&Ur)<<1;tv[Ur]=((65280&(Ng=(61680&(Ng=(52428&Ng)>>2|(13107&Ng)<<2))>>4|(3855&Ng)<<4))>>8|(255&Ng)<<8)>>1}var zg=function(a,i,o){for(var c=a.length,h=0,m=new Rp(i);h<c;++h)a[h]&&++m[a[h]-1];var g,x=new Rp(i);for(h=1;h<i;++h)x[h]=x[h-1]+m[h-1]<<1;g=new Rp(1<<i);var E=15-i;for(h=0;h<c;++h)if(a[h])for(var T=h<<4|a[h],I=i-a[h],A=x[a[h]-1]++<<I,M=A|(1<<I)-1;A<=M;++A)g[tv[A]>>E]=T;return g},Bg=new la(288);for(Ur=0;Ur<144;++Ur)Bg[Ur]=8;for(Ur=144;Ur<256;++Ur)Bg[Ur]=9;for(Ur=256;Ur<280;++Ur)Bg[Ur]=7;for(Ur=280;Ur<288;++Ur)Bg[Ur]=8;var bx=new la(32);for(Ur=0;Ur<32;++Ur)bx[Ur]=5;var QT=zg(Bg,9),zo=zg(bx,5),nv=function(a){for(var i=a[0],o=1;o<a.length;++o)a[o]>i&&(i=a[o]);return i},Dl=function(a,i,o){var c=i/8|0;return(a[c]|a[c+1]<<8)>>(7&i)&o},wx=function(a,i){var o=i/8|0;return(a[o]|a[o+1]<<8|a[o+2]<<16)>>(7&i)},s1=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Il=function(a,i,o){var c=new Error(i||s1[a]);if(c.code=a,Error.captureStackTrace&&Error.captureStackTrace(c,Il),!o)throw c;return c},a1=new la(0),l1=typeof TextDecoder<"u"&&new TextDecoder;try{l1.decode(a1,{stream:!0})}catch{}const Op={gzip_data:"gzip"};class Ga extends Error{constructor(i){super(i),this.name="MRTError"}}const eC={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Ex={uint32:1,uint16:2,uint8:4},tC={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let iv;class Tx{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const o=this.layers[i];if(!o)throw new Ga(`Layer '${i}' not found`);return o}getHeaderLength(i){const o=new Uint8Array(i),c=new DataView(i);if(13!==o[0])throw new Ga("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(i){const o=new Uint8Array(i),c=this.getHeaderLength(i);if(o.length<c)throw new Ga(`Expected header with length >= ${c} but got buffer of length ${o.length}`);const h=new iv(o.subarray(0,c)).readFields(WT,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Ga(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const m of h.layers)this.layers[m.name]=new Cx(m,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const o=[],c=this.getLayer(i.layerName);for(let h of i.blockIndices){const m=c.dataIndex[h],g=m.firstByte-i.firstByte,x=m.lastByte-i.firstByte;if(c._blocksInProgress.has(h))continue;const E={layerName:c.name,firstByte:g,lastByte:x,pixelFormat:c.pixelFormat,blockIndex:h,blockShape:[m.bands.length].concat(c.bandShape),buffer:c.buffer,codec:m.codec.codec,filters:m.filters.map(T=>T.filter)};c._blocksInProgress.add(h),o.push(E)}return new kp(o,()=>{o.forEach(h=>c._blocksInProgress.delete(h.blockIndex))},(h,m)=>{if(o.forEach(g=>c._blocksInProgress.delete(g.blockIndex)),h)throw h;m.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class Cx{constructor({version:i,name:o,units:c,tileSize:h,pixelFormat:m,buffer:g,dataIndex:x},E){if(this.version=i,1!==this.version)throw new Ga(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=o,this.units=c,this.tileSize=h,this.buffer=g,this.pixelFormat=eC[m],this.dataIndex=x,this.bandShape=[h+2*g,h+2*g,Ex[this.pixelFormat]],this._decodedBlocks=new Pp(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Ex[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){const o=i.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,i.data)}getBlockForBand(i){let o=0;switch(typeof i){case"string":for(const[c,h]of this.dataIndex.entries()){for(const[m,g]of h.bands.entries())if(g===i)return{bandIndex:o+m,blockIndex:c,blockBandIndex:m};o+=h.bands.length}break;case"number":for(const[c,h]of this.dataIndex.entries()){if(i>=o&&i<o+h.bands.length)return{bandIndex:i,blockIndex:c,blockBandIndex:i-o};o+=h.bands.length}break;default:throw new Ga(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(i){let o=1/0,c=-1/0;const h=[],m=new Set;for(const g of i){const{blockIndex:x}=this.getBlockForBand(g);if(x<0)throw new Ga(`Invalid band: ${JSON.stringify(g)}`);const E=this.dataIndex[x];h.includes(x)||h.push(x),m.add(x),o=Math.min(o,E.firstByte),c=Math.max(c,E.lastByte)}if(m.size>this.cacheSize)throw new Ga(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:c,blockIndices:h}}hasBand(i){const{blockIndex:o}=this.getBlockForBand(i);return o>=0}hasDataForBand(i){const{blockIndex:o}=this.getBlockForBand(i);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(i){const{blockIndex:o,blockBandIndex:c}=this.getBlockForBand(i);if(o<0)throw new Ga(`Band not found: ${JSON.stringify(i)}`);const h=this._decodedBlocks.get(o.toString());if(!h)throw new Ga(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const m=this.dataIndex[o],g=this.bandShape.reduce((T,I)=>T*I,1),x=c*g,E=h.subarray(x,x+g);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}Tx.setPbf=function(a){iv=a};class kp{constructor(i,o,c){this.tasks=i,this._onCancel=o,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,o){this._finalized||(this._onComplete(i,o),this._finalized=!0)}}Tx.performDecoding=function(a,i){const o=new Uint8Array(a);return Promise.all(i.tasks.map(c=>{const{layerName:h,firstByte:m,lastByte:g,pixelFormat:x,blockShape:E,blockIndex:T,filters:I,codec:A}=c,M=o.subarray(m,g+1),F=new Uint32Array(E[0]*E[1]*E[2]);let L;if("gzip_data"!==A)throw new Ga(`Unhandled codec: ${A}`);return L=function(V,j){if(!globalThis.DecompressionStream&&"gzip_data"===j)return Promise.resolve(((te=function(fe){31==fe[0]&&139==fe[1]&&8==fe[2]||Il(6,"invalid gzip data");var be=fe[3],Ee=10;4&be&&(Ee+=2+(fe[10]|fe[11]<<8));for(var je=(be>>3&1)+(be>>4&1);je>0;je-=!fe[Ee++]);return Ee+(2&be)}(J=V))+8>J.length&&Il(6,"invalid gzip data"),function(fe,be,Ee,je){var De=fe.length;if(!De||be.f&&!be.l)return Ee||new la(0);var He=!Ee,ot=He||2!=be.i,$e=be.i;He&&(Ee=new la(3*De));var Ke,nt,Be=function(Xn){var Oi=Ee.length;if(Xn>Oi){var pi=new la(Math.max(2*Oi,Xn));pi.set(Ee),Ee=pi}},Je=be.f||0,Ae=be.p||0,Ve=be.b||0,at=be.l,et=be.d,kt=be.m,Dt=be.n,Xe=8*De;do{if(!at){Je=Dl(fe,Ae,1);var tt=Dl(fe,Ae+1,3);if(Ae+=3,!tt){var At=fe[(ie=4+((Ae+7)/8|0))-4]|fe[ie-3]<<8,yt=ie+At;if(yt>De){$e&&Il(0);break}ot&&Be(Ve+At),Ee.set(fe.subarray(ie,yt),Ve),be.b=Ve+=At,be.p=Ae=8*yt,be.f=Je;continue}if(1==tt)at=QT,et=zo,kt=9,Dt=5;else if(2==tt){var pt=Dl(fe,Ae,31)+257,xt=Dl(fe,Ae+10,15)+4,zt=pt+Dl(fe,Ae+5,31)+1;Ae+=14;for(var Zt=new la(zt),on=new la(19),Qt=0;Qt<xt;++Qt)on[KT[Qt]]=Dl(fe,Ae+3*Qt,7);Ae+=3*xt;var vn=nv(on),hn=(1<<vn)-1,ri=zg(on,vn);for(Qt=0;Qt<zt;){var ie,re=ri[Dl(fe,Ae,hn)];if(Ae+=15&re,(ie=re>>4)<16)Zt[Qt++]=ie;else{var Le=0,ct=0;for(16==ie?(ct=3+Dl(fe,Ae,3),Ae+=2,Le=Zt[Qt-1]):17==ie?(ct=3+Dl(fe,Ae,7),Ae+=3):18==ie&&(ct=11+Dl(fe,Ae,127),Ae+=7);ct--;)Zt[Qt++]=Le}}var ht=Zt.subarray(0,pt),mt=Zt.subarray(pt);kt=nv(ht),Dt=nv(mt),at=zg(ht,kt),et=zg(mt,Dt)}else Il(1);if(Ae>Xe){$e&&Il(0);break}}ot&&Be(Ve+131072);for(var It=(1<<kt)-1,Gt=(1<<Dt)-1,wn=Ae;;wn=Ae){var $t=(Le=at[wx(fe,Ae)&It])>>4;if((Ae+=15&Le)>Xe){$e&&Il(0);break}if(Le||Il(2),$t<256)Ee[Ve++]=$t;else{if(256==$t){wn=Ae,at=null;break}var fn=$t-254;$t>264&&(fn=Dl(fe,Ae,(1<<(nn=Lg[Qt=$t-257]))-1)+Ad[Qt],Ae+=nn);var li=et[wx(fe,Ae)&Gt],Xi=li>>4;if(li||Il(3),Ae+=15&li,mt=JT[Xi],Xi>3){var nn=bu[Xi];mt+=wx(fe,Ae)&(1<<nn)-1,Ae+=nn}if(Ae>Xe){$e&&Il(0);break}ot&&Be(Ve+131072);var Ri=Ve+fn;if(Ve<mt){var ci=0-mt,jn=Math.min(mt,Ri);for(ci+Ve<0&&Il(3);Ve<jn;++Ve)Ee[Ve]=(void 0)[ci+Ve]}for(;Ve<Ri;++Ve)Ee[Ve]=Ee[Ve-mt]}}be.l=at,be.p=wn,be.b=Ve,be.f=Je,at&&(Je=1,be.m=kt,be.d=et,be.n=Dt)}while(!Je);return Ve!=Ee.length&&He?(Ke=Ee,(null==(nt=Ve)||nt>Ke.length)&&(nt=Ke.length),new la(Ke.subarray(0,nt))):Ee.subarray(0,Ve)}(J.subarray(te,-8),{i:2},new la(((W=J)[(Q=W.length)-4]|W[Q-3]<<8|W[Q-2]<<16|W[Q-1]<<24)>>>0))));var W,Q,J,te;const me=Op[j];if(!me)throw new Error(`Unhandled codec: ${j}`);const he=new globalThis.DecompressionStream(me);return new Response(new Blob([V]).stream().pipeThrough(he)).arrayBuffer().then(fe=>new Uint8Array(fe))}(M,A).then(V=>(new iv(V).readFields(Jw,F),new tC[x](F.buffer))),L.then(V=>{for(let j=I.length-1;j>=0;j--)switch(I[j]){case"delta_filter":e1(V,E);break;case"zigzag_filter":t1(V);break;case"bitshuffle_filter":n1(V,x);break;default:throw new Ga(`Unhandled filter "${I[j]}"`)}return{layerName:h,blockIndex:T,data:V}}).catch(V=>{throw V})}))},Et(kp,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Et(Tx,"MapboxRasterTile"),Et(Cx,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Al{constructor(i){this._stringToNumber={},this._numberToString=[];for(let o=0;o<i.length;o++){const c=i[o];this._stringToNumber[c]=o,this._numberToString[o]=c}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const nC=["id","tile","layer","source","sourceLayer","state"];class Fp{constructor(i,o,c,h,m){this.type="Feature",this._vectorTileFeature=i,this._z=o,this._x=c,this._y=h,this.properties=i.properties,this.id=m}clone(){const i=new Fp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(i.state=Object.assign({},this.state)),this.layer&&(i.layer=Object.assign({},this.layer)),this.source&&(i.source=this.source),this.sourceLayer&&(i.sourceLayer=this.sourceLayer),i}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of nC)void 0!==this[o]&&(i[o]=this[o]);return i}}class Ml{constructor(i,o){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new nc(ft,16,0),this.featureIndexArray=new sd,this.promoteId=o,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(i,o,c,h,m,g=0,x=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,h,m,g);const T=this.grid;for(let I=0;I<o.length;I++){const A=o[I],M=[1/0,1/0,-1/0,-1/0];for(let F=0;F<A.length;F++){const L=A[F];M[0]=Math.min(M[0],L.x),M[1]=Math.min(M[1],L.y),M[2]=Math.max(M[2],L.x),M[3]=Math.max(M[3],L.y)}0!==x&&(M[0]-=x,M[1]-=x,M[2]+=x,M[3]+=x),M[0]<ft&&M[1]<ft&&M[2]>=0&&M[3]>=0&&T.insert(E,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Pt(new xd(this.rawTileData)).layers,this.sourceLayerCoder=new Al(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,o){const{tilespaceGeometry:c,transform:h,tileTransform:m,pixelPosMatrix:g,availableImages:x,worldview:E}=o;this.loadVTLayers(),this.serializedLayersCache.clear();const T=c.bufferedTilespaceBounds,I=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(L,V,j,W)=>Qi(c.bufferedTilespaceGeometry,L,V,j,W));I.sort(Pl);let A=null;h.elevation&&I.length>0&&(A=nf.create(h.elevation,this.tileID));const M={};let F;for(let L=0;L<I.length;L++){const V=I[L];if(V===F)continue;F=V;const j=this.featureIndexArray.get(V);let W=null;this.is3DTile?this.loadMatchingModelFeature(M,j,i,c,h,E):this.loadMatchingFeature(M,j,i,x,E,(Q,J,te,me=0)=>(W||(W=_e(Q,this.tileID.canonical,m)),J.queryIntersectsFeature(c,Q,te,W,this.z,h,g,A,me)))}return M}loadMatchingFeature(i,o,c,h,m,g){const{featureIndex:x,bucketIndex:E,sourceLayerIndex:T,layoutVertexArrayOffset:I}=o,A=this.bucketLayerIDs[E],M=c.layers,F=Object.keys(M);if(F.length&&!un(F,A))return;const L=c.sourceCache,V=this.sourceLayerCoder.decode(T),j=this.vtLayers[V].feature(x),W=this.getId(j,V);for(let Q=0;Q<A.length;Q++){const J=A[Q];if(!M[J])continue;const{styleLayer:te,targets:me}=M[J];let he={};void 0!==W&&(he=L.getFeatureState(te.sourceLayer,W));const fe=!g||g(j,te,he,I);if(!fe)continue;const be=new Fp(j,this.z,this.x,this.y,W);be.tile=this.tileID.canonical,be.state=he;let Ee=this.serializedLayersCache.get(J);Ee||(Ee=te.serialize(),Ee.id=J,this.serializedLayersCache.set(J,Ee)),be.source=Ee.source,be.sourceLayer=Ee["source-layer"],be.layer=Ie({},Ee),be.layer.paint=$a(Ee.paint,te.paint,j,he,h),be.layer.layout=$a(Ee.layout,te.layout,j,he,h);let je=!1;for(const De of me){this.updateFeatureProperties(be,De);const{filter:He}=De;if(He)if(j.properties=be.properties,He.needGeometry){const ot=Ne(j,!0);if(!He.filter(new Tn(this.tileID.overscaledZ,{worldview:m}),ot,this.tileID.canonical))continue}else if(!He.filter(new Tn(this.tileID.overscaledZ,{worldview:m}),j))continue;je=!0,De.targetId&&this.addFeatureVariant(be,De)}je&&this.appendToResult(i,J,x,be,fe)}}loadMatchingModelFeature(i,o,c,h,m,g){const{featureIndex:x,bucketIndex:E}=o,T=this.bucketLayerIDs[E],I=c.layers,A=Object.keys(I);if(!A.length||un(A,T))for(let M=0;M<T.length;M++){const F=T[M],{styleLayer:L,targets:V}=I[F];if("model"!==L.type)continue;const j=h.tile,W=j.getBucket(L);if(!(W&&W instanceof Uy))continue;const Q=QD(W,x,h,m);if(!Q)continue;const{z:J,x:te,y:me}=j.tileID.canonical,{feature:he,intersectionZ:fe,position:be}=Q;let Ee={};void 0!==he.id&&(Ee=c.sourceCache.getFeatureState(L.sourceLayer,he.id));const je=new Fp({},J,te,me,he.id);je.tile=this.tileID.canonical,je.state=Ee,je.properties=he.properties,je.geometry={type:"Point",coordinates:[be.lng,be.lat]};let De=this.serializedLayersCache.get(F);De||(De=L.serialize(),De.id=F,this.serializedLayersCache.set(F,De)),je.source=De.source,je.sourceLayer=De["source-layer"],je.layer=Ie({},De);let He=!1;for(const ot of V){this.updateFeatureProperties(je,ot);const{filter:$e}=ot;if($e)if(he.properties=je.properties,$e.needGeometry){if(!$e.filter(new Tn(this.tileID.overscaledZ,{worldview:g}),he,this.tileID.canonical))continue}else if(!$e.filter(new Tn(this.tileID.overscaledZ,{worldview:g}),he))continue;He=!0,ot.targetId&&this.addFeatureVariant(je,ot)}He&&this.appendToResult(i,F,x,je,fe)}}updateFeatureProperties(i,o,c){if(o.properties){const h={};for(const m in o.properties){const g=o.properties[m].evaluate({zoom:this.z},i._vectorTileFeature,i.state,i.tile,c);null!=g&&(h[m]=g)}i.properties=h}}addFeatureVariant(i,o,c){const h={target:o.target,namespace:o.namespace,uniqueFeatureID:o.uniqueFeatureID};o.properties&&(h.properties=i.properties),i.variants=i.variants||{},i.variants[o.targetId]=i.variants[o.targetId]||[],i.variants[o.targetId].push(h)}appendToResult(i,o,c,h,m){let g=i[o];void 0===g&&(g=i[o]=[]),g.push({featureIndex:c,feature:h,intersectionZ:m})}lookupSymbolFeatures(i,o,c,h,m,g){const x={};this.loadVTLayers();for(const E of i)this.loadMatchingFeature(x,{bucketIndex:o,sourceLayerIndex:c,featureIndex:E,layoutVertexArrayOffset:0},h,m,g);return x}loadFeature(i){const{featureIndex:o,sourceLayerIndex:c}=i;this.loadVTLayers();const h=this.sourceLayerCoder.decode(c),m=this.vtFeatures[h];if(m[o])return m[o];const g=this.vtLayers[h].feature(o);return m[o]=g,g}hasLayer(i){for(const o of this.bucketLayerIDs)for(const c of o)if(i===c)return!0;return!1}getId(i,o){let c=i.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||"object"!=typeof this.promoteId?this.promoteId:this.promoteId[o];if(null!=h)if(Array.isArray(h)){if(!this.promoteIdExpression){const m=Wc(h);if("success"!==m.result)return void _n(`Failed to create expression for promoteId: ${m.value.map(x=>`${x.key}: ${x.message}`).join(", ")}`);this.promoteIdExpression=m.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Qd),c=this.promoteIdExpression.evaluate({zoom:0},i)}else c=i.properties[h];"boolean"==typeof c&&(c=Number(c))}return c}}function $a(a,i,o,c,h){return Yt(a,(m,g)=>{const x=i instanceof Co?i.get(g):null;return x&&x.evaluate?x.evaluate(o,c,void 0,h):x})}function Pl(a,i){return i-a}Et(Ml,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Sx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class rv{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,c]=new Uint8Array(i,0,2);if(219!==o)throw new Error("Data does not appear to be in a KDBush format.");const h=c>>4;if(1!==h)throw new Error(`Got v${h} data when expected v1.`);const m=Sx[15&c];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(i,2,1),[x]=new Uint32Array(i,4,1);return new rv(x,g,m,i)}constructor(i,o=64,c=Float64Array,h){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=c,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const m=Sx.indexOf(this.ArrayType),g=2*i*this.ArrayType.BYTES_PER_ELEMENT,x=i*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-x%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${c}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+x+E,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+g+x+E),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+x+E,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=i)}add(i,o){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=i,this.coords[this._pos++]=o,c}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Dx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,o,c,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:x}=this,E=[0,m.length-1,0],T=[];for(;E.length;){const I=E.pop()||0,A=E.pop()||0,M=E.pop()||0;if(A-M<=x){for(let j=M;j<=A;j++){const W=g[2*j],Q=g[2*j+1];W>=i&&W<=c&&Q>=o&&Q<=h&&T.push(m[j])}continue}const F=M+A>>1,L=g[2*F],V=g[2*F+1];L>=i&&L<=c&&V>=o&&V<=h&&T.push(m[F]),(0===I?i<=L:o<=V)&&(E.push(M),E.push(F-1),E.push(1-I)),(0===I?c>=L:h>=V)&&(E.push(F+1),E.push(A),E.push(1-I))}return T}within(i,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:g}=this,x=[0,h.length-1,0],E=[],T=c*c;for(;x.length;){const I=x.pop()||0,A=x.pop()||0,M=x.pop()||0;if(A-M<=g){for(let j=M;j<=A;j++)ov(m[2*j],m[2*j+1],i,o)<=T&&E.push(h[j]);continue}const F=M+A>>1,L=m[2*F],V=m[2*F+1];ov(L,V,i,o)<=T&&E.push(h[F]),(0===I?i-c<=L:o-c<=V)&&(x.push(M),x.push(F-1),x.push(1-I)),(0===I?i+c>=L:o+c>=V)&&(x.push(F+1),x.push(A),x.push(1-I))}return E}}function Dx(a,i,o,c,h,m){if(h-c<=o)return;const g=c+h>>1;c1(a,i,g,c,h,m),Dx(a,i,o,c,g-1,1-m),Dx(a,i,o,g+1,h,1-m)}function c1(a,i,o,c,h,m){for(;h>c;){if(h-c>600){const T=h-c+1,I=o-c+1,A=Math.log(T),M=.5*Math.exp(2*A/3),F=.5*Math.sqrt(A*M*(T-M)/T)*(I-T/2<0?-1:1);c1(a,i,o,Math.max(c,Math.floor(o-I*M/T+F)),Math.min(h,Math.floor(o+(T-I)*M/T+F)),m)}const g=i[2*o+m];let x=c,E=h;for(Vg(a,i,c,o),i[2*h+m]>g&&Vg(a,i,c,h);x<E;){for(Vg(a,i,x,E),x++,E--;i[2*x+m]<g;)x++;for(;i[2*E+m]>g;)E--}i[2*c+m]===g?Vg(a,i,c,E):(E++,Vg(a,i,E,h)),E<=o&&(c=E+1),o<=E&&(h=E-1)}}function Vg(a,i,o,c){Ix(a,o,c),Ix(i,2*o,2*c),Ix(i,2*o+1,2*c+1)}function Ix(a,i,o){const c=a[i];a[i]=a[o],a[o]=c}function ov(a,i,o,c){const h=a-o,m=i-c;return h*h+m*m}d.$=Qr,d.A=Yr,d.B=pa,d.C=td,d.D=op,d.E=zu,d.F=2,d.G=gs,d.H=ww,d.I=Kt,d.J=$n,d.K=class extends yu{},d.L=Rc,d.M=w_,d.N=Yu,d.O=Xu,d.P=Qe,d.Q=Of,d.R=Li,d.S=y_,d.T=Hh,d.U=Sn,d.V=yu,d.W=Lf,d.X=Wc,d.Y=Jl,d.Z=ga,d._=kn,d.a=function(a){return so.API_CDN_URL_REGEX.test(a)},d.a$=qe,d.a0=Bu,d.a1=Ju,d.a2=dh,d.a3=gm,d.a4=function(a){const i=a.value;let o=[];if(!i)return o;const c=$n(i);return"string"!==c?(o=o.concat([new yu(a.key,i,`string expected, "${c}" found`)]),o):(Sd(i,!0)||(o=o.concat([new yu(a.key,i,`invalid url "${i}"`)])),o)},d.a5=Se,d.a6=Ba,d.a7=Ji,d.a8=it,d.a9=class{constructor(a){this.specification=a}possiblyEvaluate(a,i){return Nr(a.expression.evaluate(i))}interpolate(a,i,o){return{x:Nt(a.x,i.x,o),y:Nt(a.y,i.y,o),z:Nt(a.z,i.z,o),azimuthal:Nt(a.azimuthal,i.azimuthal,o),polar:Nt(a.polar,i.polar,o)}}},d.aA=bs,d.aB=Zi,d.aC=Do,d.aD=U,d.aE=ve,d.aF=function(a,i){const o={};for(let c=0;c<i.length;c++){const h=i[c];h in a&&(o[h]=a[h])}return o},d.aG=N,d.aH=q,d.aI=class{constructor(a){this.entries={},this.scheduler=a}request(a,i,o,c){const h=this.entries[a]=this.entries[a]||{callbacks:[]};if(h.result){const[m,g]=h.result;return this.scheduler?this.scheduler.add(()=>{c(m,g)},i):c(m,g),()=>{}}return h.callbacks.push(c),h.cancel||(h.cancel=o((m,g)=>{h.result=[m,g];for(const x of h.callbacks)this.scheduler?this.scheduler.add(()=>{x(m,g)},i):x(m,g);setTimeout(()=>delete this.entries[a],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(m=>m!==c),h.callbacks.length||(h.cancel(),delete this.entries[a]))}}},d.aJ=function(a,i,o){const c=JSON.stringify(a.request);return a.data&&(this.deduped.entries[c]={result:[null,a.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},h=>{const m=Ic(a.request,(g,x,E,T)=>{g?h(g):x&&h(null,{vectorTile:o?void 0:new Pt(new xd(x)),rawData:x,cacheControl:E,expires:T})});return()=>{m.cancel(),h()}},i)},d.aK=function(a){Nn++,Nn>Di&&(a.getActor().send("enforceCacheSizeLimit",ha),Nn=0)},d.aL=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},d.aM=Mr,d.aN=_s,d.aO=Jh,d.aP=Cl,d.aQ=function(a,i){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){i(null,o)};for(let c=0;c<a.length;c++){const h=document.createElement("source");Bs(a[c])||(o.crossOrigin="Anonymous"),h.src=a[c],o.appendChild(h)}return{cancel:()=>{}}},d.aR=_d,d.aS=function(a){return fetch(a).then(i=>i.arrayBuffer()).then(i=>Uh(i,0,a))},d.aT=Yo,d.aU=class{constructor(a,i,o,c){this.id=a,this.position=null!=i?new O(i[0],i[1]):new O(0,0),this.orientation=o??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new an([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,i){if(Hi(a.matrix,i,a.matrix),a.meshes)for(const o of a.meshes){const c=an.applyTransformFast(o.aabb,a.matrix);this.aabb.encapsulate(c)}if(a.children)for(const o of a.children)this._applyTransformations(o,a.matrix)}computeBoundsAndApplyParent(){const a=pn([]);for(const i of this.nodes)this._applyTransformations(i,a)}computeModelMatrix(a,i,o,c,h,m,g=!1){$b(this.matrix,this,a.transform,this.position,i,o,c,h,m,g)}upload(a){if(!this.uploaded){for(const i of this.nodes)hp(i,a);for(const i of this.nodes)uy(i);this.uploaded=!0}}destroy(){for(const a of this.nodes)dy(a)}},d.aV=Wt,d.aW=Ep,d.aX=K,d.aY=ee,d.aZ=to,d.a_=Pi,d.aa=Tn,d.ab=Zc,d.ac=ue,d.ad=lr,d.ae=go,d.af=we,d.ag=Co,d.ah=lu,d.ai=Nt,d.aj=ft,d.ak=xf,d.al=Rn,d.am=Jn,d.an=class{constructor(a){this.specification=a}possiblyEvaluate(a,i){return function([o,c]){const h=Nr([1,o,c]);return{x:h.x,y:h.y,z:h.z}}(a.expression.evaluate(i))}interpolate(a,i,o){return{x:Nt(a.x,i.x,o),y:Nt(a.y,i.y,o),z:Nt(a.z,i.z,o)}}},d.ao=function(a,i,o=0,c=!0){const h=new Qe(o,o),m=a.sub(h),g=i.add(h),x=[m,new Qe(g.x,m.y),g,new Qe(m.x,g.y)];return c&&x.push(m.clone()),x},d.ap=function(a,i){const o=[];for(let c=0;c<a.length;c++){const h=Fe(c-1,-1,a.length-1),m=Fe(c+1,-1,a.length-1),g=a[c],x=a[m],E=a[h].sub(g).unit(),T=x.sub(g).unit(),I=T.angleWithSep(E.x,E.y),A=E.add(T).unit().mult(-1*i/Math.sin(I/2));o.push(g.add(A))}return o},d.aq=xg,d.ar=Qi,d.as=function(a,i,o=0){return gr(((i.x-o)*a.scale-a.x)*ft,(i.y*a.scale-a.y)*ft,ne(i.z,i.y))},d.at=cr,d.au=Mi,d.av=Mn,d.aw=nw,d.ax=function(a){let i=1/0,o=1/0,c=-1/0,h=-1/0;for(const m of a)i=Math.min(i,m.x),o=Math.min(o,m.y),c=Math.max(c,m.x),h=Math.max(h,m.y);return{min:new Qe(i,o),max:new Qe(c,h)}},d.ay=se,d.az=Hi,d.b=function(a){return so.API_FONTS_REGEX.test(a)},d.b$=Ay,d.b0=wh,d.b1=ky,d.b2=function(){Gs.isLoading()||Gs.isLoaded()||"deferred"!==hr()||Hf()},d.b3=_h,d.b4=Ne,d.b5=Fp,d.b6=Vn,d.b7=wl,d.b8=fd,d.b9=_e,d.bA=function(a,i){const{x:o,y:c}=a.point,h=qv(o,c,a.worldSize/a._pixelsPerMercatorPixel,0,0);return Hi(h,h,Um(ja(i)))},d.bB=Da,d.bC=zd,d.bD=function(a,i){return Math.hypot(i[0]-a[0],i[1]-a[1],i[2]-a[2])},d.bE=Ho,d.bF=gi,d.bG=ar,d.bH=mg,d.bI=Rs,d.bJ=V0,d.bK=function(a,i,o,c,h){const m=5*i+2;a.float32[m+0]=o,a.float32[m+1]=c,a.float32[m+2]=h},d.bL=Oy,d.bM=Zr,d.bN=Qa,d.bO=Ka,d.bP=Ns,d.bQ=Fe,d.bR=function(a,i,o,c){var h=new Ui(4);return h[0]=a,h[1]=i,h[2]=o,h[3]=c,h},d.bS=np,d.bT=hi,d.bU=Pr,d.bV=HE,d.bW=Qh,d.bX=fc,d.bY=Lh,d.bZ=vp,d.b_=q0,d.ba=Ss,d.bb=Mm,d.bc=zm,d.bd=Wi,d.be=Ih,d.bf=rx,d.bg=function(a,i){const o=lu(i.zoom);if(0===o)return ja(a);const c=Bm(a),h=$v(c),m=U(c.getWest())*i.worldSize,g=U(c.getEast())*i.worldSize,x=q(c.getNorth())*i.worldSize,E=q(c.getSouth())*i.worldSize,T=[m,x,0],I=[g,x,0],A=[m,E,0],M=[g,E,0],F=ts([],i.globeMatrix);return lr(T,T,F),lr(I,I,F),lr(A,A,F),lr(M,M,F),h[0]=au(h[0],A,o),h[1]=au(h[1],M,o),h[2]=au(h[2],I,o),h[3]=au(h[3],T,o),an.fromPoints(h)},d.bh=jm,d.bi=ts,d.bj=Vm,d.bk=au,d.bl=Kc,d.bm=P_,d.bn=Bl,d.bo=Uo,d.bp=Tx,d.bq=xd,d.br=Ic,d.bs=function(a,i){const o=[];for(const c in a)c in i||o.push(c);return o},d.bt=Te,d.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.bv=el,d.bw=function(a){var i=new Ui(16);return i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=a[3],i[4]=a[4],i[5]=a[5],i[6]=a[6],i[7]=a[7],i[8]=a[8],i[9]=a[9],i[10]=a[10],i[11]=a[11],i[12]=a[12],i[13]=a[13],i[14]=a[14],i[15]=a[15],i},d.bx=pn,d.by=zl,d.bz=Nl,d.c=_f,d.c$=45,d.c0=rv,d.c1=Fi,d.c2=Vl,d.c3=Pa,d.c4=function(a,i,o){o*=.5;var c=i[0],h=i[1],m=i[2],g=i[3],x=Math.sin(o),E=Math.cos(o);return a[0]=c*E+h*x,a[1]=h*E-c*x,a[2]=m*E+g*x,a[3]=g*E-m*x,a},d.c5=Cc,d.c6=ji,d.c7=function(a,i){return a[0]=-i[0],a[1]=-i[1],a[2]=-i[2],a[3]=i[3],a},d.c8=Ia,d.c9=function(a,i,o,c,h){var m,g=1/Math.tan(i/2);return a[0]=g/o,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=g,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=h&&h!==1/0?(a[10]=(h+c)*(m=1/(c-h)),a[14]=2*h*c*m):(a[10]=-1,a[14]=-2*c),a},d.cA=Zo,d.cB=db,d.cC=function(a,i,o,c,h,m,g,x,E){if("globe"===E.name)return db(a,i,new Zo(o,c,h),!1);const T=Ep({z:o,x:c,y:h},E);return new an([(m+T.x/T.scale)*i,i*(T.y/T.scale),g],[(m+T.x2/T.scale)*i,i*(T.y2/T.scale),x])},d.cD=function(a,i,o){return a[0]=Math.min(i[0],o[0]),a[1]=Math.min(i[1],o[1]),a[2]=Math.min(i[2],o[2]),a[3]=Math.min(i[3],o[3]),a},d.cE=function(a,i,o){return a[0]=Math.max(i[0],o[0]),a[1]=Math.max(i[1],o[1]),a[2]=Math.max(i[2],o[2]),a[3]=Math.max(i[3],o[3]),a},d.cF=function(a){const i=Math.round((a+45+360)%360/90)%4;return Z[i]},d.cG=le,d.cH=Za,d.cI=f,d.cJ=function(a){const i=pn(new Float64Array(16));Hi(i,a.pixelMatrix,a.globeMatrix);const o=[0,y,0],c=[0,v,0];return lr(o,o,i),lr(c,c,i),[o[0]>0&&o[0]<=a.width&&o[1]>0&&o[1]<=a.height&&!k_(a,new O(a.center.lat,90)),c[0]>0&&c[0]<=a.width&&c[1]>0&&c[1]<=a.height&&!k_(a,new O(a.center.lat,-90))]},d.cK=function(a,i){const{scale:o}=a.tileTransform,c=o*ft/(a.tileSize*Math.pow(2,i.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return h=new Float32Array(4),x=(m=i.inverseAdjustmentMatrix)[1],E=m[2],T=m[3],A=(g=[c,c])[1],h[0]=m[0]*(I=g[0]),h[1]=x*I,h[2]=E*A,h[3]=T*A,h;var h,m,g,x,E,T,I,A},d.cL=ly,d.cM=ff,d.cN=jb,d.cO=function(a){const i=jb(a,!0);return Da([],[i[0],i[1],i[4],i[5]])},d.cP=ro,d.cQ=Fn,d.cR=vs,d.cS=function(a){const{x:i,y:o}=a.point,{lng:c,lat:h}=a._center;return qv(i,o,a.worldSize,c,h)},d.cT=pf,d.cU=Pe,d.cV=As,d.cW=rr,d.cX=Jf,d.cY=function(a,i,o){let c=0;for(let h=0;h<2;++h)a[h]>0&&(c+=(a[h]-0)*(a[h]-0)),i[h]<0&&(c+=(0-i[h])*(0-i[h]));return c},d.cZ=function(a){return a*a*a*a*a},d.c_=H,d.ca=function(a,i,o,c,h,m,g){var x=1/(i-o),E=1/(c-h),T=1/(m-g);return a[0]=-2*x,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*E,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*T,a[11]=0,a[12]=(i+o)*x,a[13]=(h+c)*E,a[14]=(g+m)*T,a[15]=1,a},d.cb=$,d.cc=function(a,i,o){a[4*i+0]=o[0],a[4*i+1]=o[1],a[4*i+2]=o[2],a[4*i+3]=o[3]},d.cd=Th,d.ce=ld,d.cf=vr,d.cg=lo,d.ch=dc,d.ci=O,d.cj=Rw,d.ck=function(){var a=new Ui(4);return Ui!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},d.cl=function(a,i,o){var c=i[0],h=i[1],m=i[2],g=i[3],x=Math.sin(o),E=Math.cos(o);return a[0]=c*E+m*x,a[1]=h*E+g*x,a[2]=c*-x+m*E,a[3]=h*-x+g*E,a},d.cm=function(a,i){return a[0]===i[0]&&a[1]===i[1]&&a[2]===i[2]&&a[3]===i[3]},d.cn=xs,d.co=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},d.cp=Ya,d.cq=Ma,d.cr=wa,d.cs=3,d.ct=2,d.cu=7,d.cv=6,d.cw=nr,d.cx=Un,d.cy=In,d.cz=C0,d.d=function(a){return so.API_TILEJSON_REGEX.test(a)},d.d$=(a,i,o,c,h,m,g,x,E,T)=>{const I=a.transform,A=I.calculatePixelsToTileUnitsMatrix(i),M="none"===o.paint.get("line-trim-color-use-theme").constantOr("default"),F=I.pitch<15?py(.07,.7,se((14-I.zoom)/5,0,1)):.07;return{u_matrix:R0(a,i,o,c),u_pixels_to_tile_units:A,u_device_pixel_ratio:m,u_width_scale:g,u_floor_width_scale:x,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:dT(o)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:fo(i,a.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:F,u_tile_to_meter:ce(i.tileID.canonical,0),u_ground_shadow_factor:T}},d.d0=uc,d.d1=function(a,i,o){const c=Math.sqrt(a*a+i*i+o*o),h=c>0?Math.acos(o/c)*gf:0;let m=0!==a||0!==i?Math.atan2(-i,-a)*gf+90:0;return m<0&&(m+=360),[c,m,h]},d.d2=gr,d.d3=Nr,d.d4=ce,d.d5=ki,d.d6=an,d.d7=oo,d.d8=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},d.d9=Sd,d.dA=Bm,d.dB=function(a){const i=le-5;a=se(a,-i,i)/i*90;const o=Math.pow(Math.abs(Math.sin(Rn(a))),3);return Math.round(o*(p.length-1))},d.dC=function(a,i,o,c){const h=i.getNorth(),m=i.getSouth(),g=i.getWest(),x=i.getEast(),E=1<<a.z,T=x-g,I=h-m,A=T/l,M=-I/p[o],F=[0,A,0,M,0,0,h,g,0];if(a.z>0){const L=180/c;Fs(F,F,[L/T+1,0,0,0,L/I+1,0,-.5*L/A,.5*L/M,1])}return F[2]=E,F[5]=a.x,F[8]=a.y,F},d.dD=ja,d.dE=function(a,i,o){const c=pn(new Float64Array(16)),h=(i/(1<<a)-.5)*Math.PI*2;return Zs(c,o.globeMatrix,h),Float32Array.from(c)},d.dF=class{isDataAvailableAtPoint(a){const i=this._source();if(this.isUsingMockSource()||!i||a.y<0||a.y>1)return!1;const o=i.getSource().maxzoom,c=1<<o,h=Math.floor(a.x),m=Math.floor((a.x-h)*c),g=Math.floor(a.y*c),x=this.findDEMTileFor(new Mr(o,h,o,m,g));return!(!x||!x.dem)}getAtPointOrZero(a,i=0){return this.getAtPoint(a,i)||0}getAtPoint(a,i,o=!0){if(this.isUsingMockSource())return null;null==i&&(i=null);const c=this._source();if(!c||a.y<0||a.y>1)return i;const h=c.getSource().maxzoom,m=1<<h,g=Math.floor(a.x),x=a.x-g,E=new Mr(h,g,h,Math.floor(x*m),Math.floor(a.y*m)),T=this.findDEMTileFor(E);if(!T||!T.dem)return i;const I=T.dem,A=1<<T.tileID.canonical.z,M=(x*A-T.tileID.canonical.x)*I.dim,F=(a.y*A-T.tileID.canonical.y)*I.dim,L=Math.floor(M),V=Math.floor(F);return(o?this.exaggeration():1)*Nt(Nt(I.get(L,V),I.get(L,V+1),F-V),Nt(I.get(L+1,V),I.get(L+1,V+1),F-V),M-L)}getAtTileOffset(a,i,o){const c=1<<a.canonical.z;return this.getAtPointOrZero(new ue(a.wrap+(a.canonical.x+i/ft)/c,(a.canonical.y+o/ft)/c))}getAtTileOffsetFunc(a,i,o,c){return h=>{const m=this.getAtTileOffset(a,h.x,h.y),g=c.upVector(a.canonical,h.x,h.y);return Fi(g,g,m*c.upVectorScale(a.canonical,i,o).metersToTile),g}}getForTilePoints(a,i,o,c){if(this.isUsingMockSource())return!1;const h=nf.create(this,a,c);return!!h&&(i.forEach(m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],o)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(a);if(!i||!i.dem)return null;const o=i.dem.tree,c=i.tileID,h=1<<a.canonical.z-c.canonical.z;let m=a.canonical.x/h-c.canonical.x,g=a.canonical.y/h-c.canonical.y,x=0;for(let E=0;E<a.canonical.z-c.canonical.z&&!o.leaves[x];E++){m*=2,g*=2;const T=2*Math.floor(g)+Math.floor(m);x=o.childOffsets[x]+T,m%=1,g%=1}return{min:this.exaggeration()*o.minimums[x],max:this.exaggeration()*o.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,i,o){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(0===a.length)return null;let i=!1,o=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const h of a){const m=this.getMinMaxForTile(h.tileID);m&&(o=Math.min(o,m.min),c=Math.max(c,m.max),i=!0)}return i?{min:o,max:c}:null}},d.dG=xb,d.dH=xl,d.dI=function(a,i){return[Math.pow(a[0],2.2)*i,Math.pow(a[1],2.2)*i,Math.pow(a[2],2.2)*i]},d.dJ=Nd,d.dK=function(a,i){var o=Math.sin(i),c=Math.cos(i);return a[0]=c,a[1]=o,a[2]=0,a[3]=-o,a[4]=c,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},d.dL=Mo,d.dM=Qf,d.dN=Go,d.dO=_o,d.dP=256,d.dQ=function(a,i){const o=[0,0,0];return lr(o,o,jm(ja(i.canonical))),lr(o,o,a),o},d.dR=a=>({u_matrix:new dc(a),u_texsize:new lo(a),u_pixels_to_tile_units:new Yf(a),u_device_pixel_ratio:new vr(a),u_width_scale:new vr(a),u_floor_width_scale:new vr(a),u_image:new Th(a),u_units_to_pixels:new lo(a),u_tile_units_to_pixels:new vr(a),u_alpha_discard_threshold:new vr(a),u_trim_offset:new lo(a),u_trim_fade_range:new lo(a),u_trim_color:new uc(a),u_emissive_strength:new vr(a),u_zbias_factor:new vr(a),u_tile_to_meter:new vr(a),u_ground_shadow_factor:new ld(a),u_pattern_transition:new vr(a)}),d.dS=a=>({u_matrix:new dc(a),u_pixels_to_tile_units:new Yf(a),u_device_pixel_ratio:new vr(a),u_width_scale:new vr(a),u_floor_width_scale:new vr(a),u_units_to_pixels:new lo(a),u_dash_image:new Th(a),u_gradient_image:new Th(a),u_image_height:new vr(a),u_texsize:new lo(a),u_tile_units_to_pixels:new vr(a),u_alpha_discard_threshold:new vr(a),u_trim_offset:new lo(a),u_trim_fade_range:new lo(a),u_trim_color:new uc(a),u_emissive_strength:new vr(a),u_zbias_factor:new vr(a),u_tile_to_meter:new vr(a),u_ground_shadow_factor:new ld(a)}),d.dT=a=>({u_camera_to_center_distance:new vr(a),u_extrude_scale:new Yf(a),u_device_pixel_ratio:new vr(a),u_matrix:new dc(a),u_inv_rot_matrix:new dc(a),u_merc_center:new lo(a),u_tile_id:new ld(a),u_zoom_transition:new vr(a),u_up_dir:new ld(a),u_emissive_strength:new vr(a)}),d.dU=Qc,d.dV=dw,d.dW=gb,d.dX=(a,i,o,c,h,m)=>{const g=a.transform,x="globe"===g.projection.name;let E;if("map"===m.paint.get("circle-pitch-alignment"))if(x){const I=Qf(g.zoom,i.canonical)*g._pixelsPerMercatorPixel;E=Float32Array.from([I,0,0,I])}else E=g.calculatePixelsToTileUnitsMatrix(o);else E=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(g.projection),u_matrix:a.translatePosMatrix(i.projMatrix,o,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Xs.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:mb,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(x){T.u_inv_rot_matrix=c,T.u_merc_center=h,T.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],T.u_zoom_transition=lu(g.zoom);const I=h[0]*ft,A=h[1]*ft;T.u_up_dir=g.projection.upVector(new Zo(0,0,0),I,A)}return T},d.dY=iw,d.dZ=vo,d.d_=(a,i,o,c,h,m,g,x,E,T)=>{const I=a.transform,A=I.pitch<15?py(.07,.7,se((14-I.zoom)/5,0,1)):.07,M="none"===o.paint.get("line-trim-color-use-theme").constantOr("default");return{u_matrix:R0(a,i,o,c),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:h,u_width_scale:m,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:fo(i,I),u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:A,u_tile_to_meter:ce(i.tileID.canonical,0),u_ground_shadow_factor:E,u_pattern_transition:T}},d.da=function(a,i){return a.readFields(qy,{icons:[]},i)},d.db=ry,d.dc=xp,d.dd=$0,d.de=Kp,d.df=_a,d.dg=zs,d.dh=Xd,d.di=mn,d.dj=function(a){const i=a.indexOf("\x1f");return i>=0?a.slice(0,i):a},d.dk=function(a){return a.indexOf("\x1f")>=0},d.dl=function(a){const i=a.lastIndexOf("\x1f");return i>=0?a.slice(i+1):""},d.dm=function(a){const i=[],o=a.id;return void 0===o&&i.push({message:`layers.${o}: missing required property "id"`}),void 0===a.render&&i.push({message:`layers.${o}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&i.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),i},d.dn=function(a,i,o,c){return"custom"===a.type?new Dp(a,i):new NT[a.type](a,i,o,c)},d.dp=bn,d.dq=function(a){const i=a.indexOf("\x1f");return i>=0?a.slice(i+1):""},d.dr=class extends Fp{constructor(a,i){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},d.ds=Uf,d.dt=Nu,d.du=function(a){return a({pluginStatus:To,pluginURL:ic}),Uf.on("pluginStateChange",a),a},d.dv=Ch,d.dw=class extends $s{constructor(a){super(a),this.current=Lm}set(a,i,o){if(this.fetchUniformLocation(a,i))for(let c=0;c<9;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},d.dx=X,d.dy=function(a,i,o){const c=lu(o.zoom),h=a.style.map._antialias,m=a.terrain&&a.terrain.exaggeration()>0;return 0===c&&!h&&!m},d.dz=function(a){const i=a.pixelsPerMeter,o=i/$(1,a.center.lat),c=pn(new Float64Array(16));return Uo(c,c,[a.point.x,a.point.y,0]),ro(c,c,[o,o,i]),Float32Array.from(c)},d.e=so,d.e$=hr,d.e0=Lt,d.e1=$m,d.e2=ne,d.e3=sa,d.e4=du,d.e5=Lb,d.e6=Nh,d.e7=450,d.e8=7,d.e9=pe,d.eA=function(a,i,o,c,h,m,g,x,E,T,I,A,M,F,L,V){var j=new Ui(16);return j[0]=a,j[1]=i,j[2]=o,j[3]=c,j[4]=h,j[5]=m,j[6]=g,j[7]=x,j[8]=E,j[9]=T,j[10]=I,j[11]=A,j[12]=M,j[13]=F,j[14]=L,j[15]=V,j},d.eB=D,d.eC=Im,d.eD=yr,d.eE=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Qe(1/0,1/0),max:new Qe(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,i=!1){const o=Ab(new Qe(0,0),new Qe(ft,ft),a),c=[];if(i&&!q_(o,this._globalClipBounds))return c;for(const h of this._activeRegions){if(h.hiddenByOverlap||!q_(o,h))continue;const m=$E(h.min,h.max,a);c.push({min:m.min,max:m.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return c}setSources(a){this._setSources(a.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const o=[];for(const c of i.cache.getVisibleCoordinates()){const h=i.cache.getTile(c).buckets[i.layer];h&&h.updateFootprints(c.toUnwrapped(),o)}return o},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(a){const i=a.getFootprints();if(0===i.length)return;const o=a.getOrder(),c=a.getClipMask(),h=a.getClipScope();for(const m of i){if(!m.footprint)continue;const g=Ab(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:o,clipMask:c,clipScope:h})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,o)=>i.priority-o.priority||s0(i.min,o.min)||s0(i.max,o.max)||i.order-o.order||i.clipMask-o.clipMask||function(c,h){const m=(g,x)=>g+x;return c.length-h.length||c.reduce(m,"").localeCompare(h.reduce(m,""))}(i.clipScope,o.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let i=0;for(;!a&&i!==this._activeRegions.length;){const o=this._activeRegions[i],c=this._prevRegions[i];a=o.priority!==c.priority||!GE(o,c)||o.order!==c.order||o.clipMask!==c.clipMask||!el(o.clipScope,c.clipScope),++i}}if(a){++this._updateTime;for(const o of this._activeRegions)o.order!==$_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const i=o=>{const c=this._activeRegions;if(o>=c.length)return o;const h=c[o].priority;for(;o<c.length&&c[o].priority===h;)++o;return o};if(this._sourceIds.length>1){let o=0,c=i(o);for(;o!==c;){let h=o;const m=o;for(;h!==c;){const g=this._activeRegions[h];g.hiddenByOverlap=!1;for(let x=0;x<m;x++){const E=this._activeRegions[x];if(!E.hiddenByOverlap&&g.order===$_&&q_(g,E)&&(g.hiddenByOverlap=Z_(g.footprint,g.tileId,E.footprint,E.tileId),g.hiddenByOverlap))break}++h}o=c,c=i(o)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=a.length-1;i>=0;i--)this._addSource(a[i]);this._computeReplacement()}},d.eF=$_,d.eG=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,i){const o=new Ss,c=new Pi,h=[],m=a+1+2,g=i[0]+1,x=i[0]+1+(1+i.length),E=(T,I,A)=>{let M=T===m-1?T-2:0===T?T:T-1;return M+=A?24575:0,[M,I]};for(let T=0;T<m;++T)o.emplaceBack(...E(T,0,!0));for(let T=0;T<g;++T)for(let I=0;I<m;++I)o.emplaceBack(...E(I,T,(0===I||I===m-1)&&!0));for(let T=0;T<i.length;++T){const I=i[T];for(let A=0;A<m;++A)o.emplaceBack(...E(A,I,!0))}for(let T=0;T<i.length;++T){const I=c.length,A=i[T]+1+2,M=new Pi;for(let V=0;V<A-1;V++){const j=V===A-2,W=j?m*(x-i.length+T-V):m;for(let Q=0;Q<m-1;Q++){const J=V*m+Q;0===V||j||0===Q||Q===m-2?(M.emplaceBack(J+1,J,J+W),M.emplaceBack(J+W,J+W+1,J+1)):(c.emplaceBack(J+1,J,J+W),c.emplaceBack(J+W,J+W+1,J+1))}}const F=Wi.simpleSegment(0,I,o.length,c.length-I);for(let V=0;V<M.uint16.length;V+=3)c.emplaceBack(M.uint16[V],M.uint16[V+1],M.uint16[V+2]);const L=Wi.simpleSegment(0,I,o.length,c.length-I);h.push({withoutSkirts:F,withSkirts:L})}return{vertices:o,indices:c,segments:h}}_createGrid(a){const i=this._fillGridMeshWithLods(l,p);this._gridSegments=i.segments,this._gridBuffer=a.createVertexBuffer(i.vertices,zm.members),this._gridIndexBuffer=a.createIndexBuffer(i.indices,!0)}_createPoles(a){const i=new Pi;for(let g=0;g<=l;g++)i.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=a.createIndexBuffer(i,!0);const o=new $r,c=new $r,h=new $r,m=new $r;this._poleSegments=[];for(let g=0,x=0;g<Jf;g++){const E=360/(1<<g);o.emplaceBack(0,-Zi,0,.5,0),c.emplaceBack(0,-Zi,0,.5,1),h.emplaceBack(0,-Zi,0,.5,.5),m.emplaceBack(0,-Zi,0,.5,.5);for(let T=0;T<=l;T++){let I=T/l,A=0;const M=Nt(0,E,I),[F,L,V]=b(pb,IE,M,Zi);o.emplaceBack(F,L,V,I,A),c.emplaceBack(F,L,V,I,1-A);const j=Rn(M);I=.5+.5*Math.sin(j),A=.5+.5*Math.cos(j),h.emplaceBack(F,L,V,I,A),m.emplaceBack(F,L,V,I,1-A)}this._poleSegments.push(Wi.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(o,Nm,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(c,Nm,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(h,Nm,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(m,Nm,!1)}getGridBuffers(a,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},d.eH=UE,d.eI=oe,d.eJ=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},d.eK=ge,d.eL=ae,d.eM=function(a,i,o){return a[0]=i[0]/o[0],a[1]=i[1]/o[1],a[2]=i[2]/o[2],a},d.eN=ns,d.eO=C,d.eP=mf,d.eQ=_r,d.eR=function([a,i,o]){const c=Math.hypot(a,i,o),h=Math.atan2(a,o),m=.5*Math.PI-Math.acos(-i/c);return new O(Pe(h),Pe(m))},d.eS=Ls,d.eT=cg,d.eU=function(a){const i=a.navigator?a.navigator.userAgent:null;return!!function(o){if(null==$i){const c=o.navigator?o.navigator.userAgent:null;$i=!!o.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return $i}(a)&&!(!i||!(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},d.eV=function(a,i){ha=a,Di=i},d.eW=k_,d.eX=hb,d.eY=function(a){const i=[0,0,0],o=pn(new Float64Array(16));return Hi(o,a.pixelMatrix,a.globeMatrix),lr(i,i,o),new Qe(i[0],i[1])},d.eZ=function(){const a=zh;a&&(a.isPreloaded()&&1===a.numActive()?(a.release(iy),zh=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.e_=function(){ry().acquire(iy)},d.ea=function(a,i){if(a===i){var o=i[1],c=i[2],h=i[3],m=i[6],g=i[7],x=i[11];a[1]=i[4],a[2]=i[8],a[3]=i[12],a[4]=o,a[6]=i[9],a[7]=i[13],a[8]=c,a[9]=m,a[11]=i[14],a[12]=h,a[13]=g,a[14]=x}else a[0]=i[0],a[1]=i[4],a[2]=i[8],a[3]=i[12],a[4]=i[1],a[5]=i[5],a[6]=i[9],a[7]=i[13],a[8]=i[2],a[9]=i[6],a[10]=i[10],a[11]=i[14],a[12]=i[3],a[13]=i[7],a[14]=i[11],a[15]=i[15];return a},d.eb=Ig,d.ec=En,d.ed=od,d.ee=256,d.ef=Um,d.eg=Ds,d.eh=Zs,d.ei=function(a,i){return a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[4],a[4]=i[5],a[5]=i[6],a[6]=i[8],a[7]=i[9],a[8]=i[10],a},d.ej=$r,d.ek=ml,d.el=cl,d.em=function(a,i,o,c,h){return se((a-i)/(o-i)*(h-c)+c,c,h)},d.en=jl,d.eo=function(a,i){var o=i[0],c=i[1],h=i[2],m=i[3],g=i[4],x=i[5],E=i[6],T=i[7],I=i[8],A=I*g-x*T,M=-I*m+x*E,F=T*m-g*E,L=o*A+c*M+h*F;return L?(a[0]=A*(L=1/L),a[1]=(-I*c+h*T)*L,a[2]=(x*c-h*g)*L,a[3]=M*L,a[4]=(I*o-h*E)*L,a[5]=(-x*o+h*m)*L,a[6]=F*L,a[7]=(-T*o+c*E)*L,a[8]=(g*o-c*m)*L,a):null},d.ep=2,d.eq=Gi,d.er=Hb,d.es=[1,1,1],d.et=class{constructor(a,i,o,c){this.context=a,this.format=c,this.size=o,this.texture=a.gl.createTexture();const[h,m,g]=this.size,{gl:x}=a;x.bindTexture(x.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),x.texImage3D(x.TEXTURE_3D,0,this.format,h,m,g,0,sg(this.format),ag(this.format),i.data)}bind(a,i){const{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_3D,this.texture),a!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,a),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,a),this.minFilter=a),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},d.eu=nf,d.ev=Bd,d.ew=function(a,i,o,c){var h=i[0],m=i[1],g=i[2],x=i[3];return a[0]=h+c*(o[0]-h),a[1]=m+c*(o[1]-m),a[2]=g+c*(o[2]-g),a[3]=x+c*(o[3]-x),a},d.ex=vd,d.ey=va,d.ez=lc,d.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(i,o)=>String.fromCharCode(+("0x"+o))))},d.f0=function(a,i,o=!1){if(To===ds.deferred||To===ds.loading||To===ds.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");ic=Xs.resolveURL(a),To=ds.deferred,xm=i,jf(),o||Hf()},d.f1=function(a){gd=Xs.resolveURL(a),ap||(ap=new op(ry(),new zu)),ap.broadcast("setMeshoptUrl",gd)},d.f2=Bb,d.f3=function(a){Ua=Xs.resolveURL(a),ap||(ap=new op(ry(),new zu)),ap.broadcast("setDracoUrl",Ua)},d.f4=zb,d.f5=rp,d.f6=function(a){const i=Dc();if(!i)return;const o=i.delete(Oa);a&&o.then(()=>a()).catch(a)},d.f7=mc,d.f8=Et,d.f9=hc,d.fa=Tl,d.fb=Al,d.fc=Ml,d.fd=Ko,d.fe=vt,d.ff="hd_road_elevation",d.fg=Ni,d.fh=Yt,d.fi=kh,d.fj=H0,d.fk=Zh,d.fl=function(a,i,o,c,h,m,g,x=1,E,T,I){a.createArrays(),a.tilePixelRatio=ft/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const A=a.layers[0].layout,M=a.layers[0]._unevaluatedLayout._values,F={};F.scaleFactor=x,F.textSizeScaleRange=A.get("text-size-scale-range"),F.iconSizeScaleRange=A.get("icon-size-scale-range");const[L,V]=F.textSizeScaleRange,[j,W]=F.iconSizeScaleRange;F.textScaleFactor=se(F.scaleFactor,L,V),F.iconScaleFactor=se(F.scaleFactor,j,W);const Q=M["text-size"],J=M["icon-size"];if("composite"===a.textSizeData.kind){const{minZoom:Ee,maxZoom:je}=a.textSizeData;F.compositeTextSizes=[Q.possiblyEvaluate(new Tn(Ee,{worldview:I}),m),Q.possiblyEvaluate(new Tn(je,{worldview:I}),m)]}if("composite"===a.iconSizeData.kind){const{minZoom:Ee,maxZoom:je}=a.iconSizeData;F.compositeIconSizes=[J.possiblyEvaluate(new Tn(Ee,{worldview:I}),m),J.possiblyEvaluate(new Tn(je,{worldview:I}),m)]}F.layoutTextSize=Q.possiblyEvaluate(new Tn(g+1,{worldview:I}),m),F.layoutIconSize=J.possiblyEvaluate(new Tn(g+1,{worldview:I}),m),F.textMaxSize=Q.possiblyEvaluate(new Tn(18,{worldview:I}),m);const te=A.get("symbol-placement"),me="map"===A.get("text-rotation-alignment")&&"point"!==te,he=A.get("text-size");let fe=!1;const be=[];for(const Ee of a.features){const je=A.get("text-font").evaluate(Ee,{},m).join(","),De=he.evaluate(Ee,{},m)*F.textScaleFactor,He=F.layoutTextSize.evaluate(Ee,{},m)*F.textScaleFactor,ot=F.layoutIconSize.evaluate(Ee,{},m)*F.iconScaleFactor,$e={horizontal:{},vertical:void 0},Ke=Ee.text;let nt,Be=[0,0];if(Ke){const xt=Ke.toString(),zt=A.get("text-letter-spacing").evaluate(Ee,{},m)*Pr,Zt=A.get("text-line-height").evaluate(Ee,{},m)*Pr,on=Lv(xt)?zt:0,Qt=A.get("text-anchor").evaluate(Ee,{},m),vn=A.get("text-variable-anchor");if(!vn){const Le=A.get("text-radial-offset").evaluate(Ee,{},m);if(Le)Be=q0(Qt,[Le*Pr,Dy]);else{const ct=A.get("text-offset").evaluate(Ee,{},m);Be=[ct[0]*Pr,ct[1]*Pr]}}let hn=me?"center":A.get("text-justify").evaluate(Ee,{},m);const ri="point"===te,ie=ri?A.get("text-max-width").evaluate(Ee,{},m)*Pr:1/0,re=Le=>{a.allowVerticalPlacement&&zf(xt)&&($e.vertical=_y(Ke,i,o,h,je,ie,Zt,Qt,Le,on,Be,Rs.vertical,!0,He,De,E))};if(!me&&vn){const Le="auto"===hn?vn.map(ht=>Ay(ht)):[hn];let ct=!1;for(let ht=0;ht<Le.length;ht++){const mt=Le[ht];if(!$e.horizontal[mt])if(ct)$e.horizontal[mt]=$e.horizontal[0];else{const It=_y(Ke,i,o,h,je,ie,Zt,"center",mt,on,Be,Rs.horizontal,!1,He,De,E);It&&($e.horizontal[mt]=It,ct=1===It.positionedLines.length)}}re("left")}else{if("auto"===hn&&(hn=Ay(Qt)),ri||A.get("text-writing-mode").indexOf("horizontal")>=0||!zf(xt)){const Le=_y(Ke,i,o,h,je,ie,Zt,Qt,hn,on,Be,Rs.horizontal,!1,He,De,E);Le&&($e.horizontal[hn]=Le)}re(ri?"left":hn)}}let Je,Ae,Ve,at,et,kt,Dt=!1;const Xe=A.get("icon-text-fit").evaluate(Ee,{},m);if(Ee.icon&&Ee.icon.hasPrimary()){const xt=Iy(Ee.icon,a.iconSizeData,M["icon-size"],m,a.zoom,Ee,E,F.iconScaleFactor,I);Je=xt.iconPrimary,Ve=xt.iconSecondary;const zt=Je.toString();if(Ae=c.get(zt),Ae&&(et=A.get("icon-offset").evaluate(Ee,{},m),kt=A.get("icon-anchor").evaluate(Ee,{},m),nt=pg(h.get(zt),Ve?h.get(Ve.toString()):void 0,et,kt),Dt=Ae.sdf,void 0===a.sdfIcons?a.sdfIcons=Ae.sdf:a.sdfIcons!==Ae.sdf&&_n("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ae.pixelRatio!==a.pixelRatio||0!==A.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0)),Ve){const Zt=Ve.toString();at=c.get(Zt)}}fe=fe||!(!Ee.icon||!Ee.icon.hasSecondary());const tt=Y0($e.horizontal)||$e.vertical;a.iconsInText||(a.iconsInText=!!tt&&tt.iconsInText);const At=He*F.textScaleFactor/Pr,{defaultShapedIcon:yt,verticallyShapedIcon:pt}=X0(a,nt,A,Ee,m,$e,At,et,Xe);"none"!==Xe&&nt&&(vy(nt)||xy(nt))&&(gg(0,Ae,Je,nt,yt,Xe,T,c,h),gg(0,at,Ve,nt,yt,Xe,T,c,h),pt&&(gg(0,Ae,Je,nt,pt,Xe,T,c,h),gg(0,at,Ve,nt,pt,Xe,T,c,h))),nt=yt,be.push({feature:Ee,shapedTextOrientations:$e,shapedText:tt,shapedIcon:nt,iconPrimary:Je,iconSecondary:Ve,iconOffset:et,iconAnchor:kt,verticallyShapedIcon:pt,layoutTextSize:He,layoutIconSize:ot,textOffset:Be,isSDFIcon:Dt,iconTextFit:Xe})}return{featureData:be,sizes:F,hasAnySecondaryIcon:fe,textAlongLine:me,symbolPlacement:te}},d.fm=Ew,d.fn=function(a,i,o,c,h,m,g,x,E,T){const{featureData:I,hasAnySecondaryIcon:A,sizes:M,textAlongLine:F,symbolPlacement:L}=i;for(const V of I){const{shapedIcon:j,verticallyShapedIcon:W,feature:Q,shapedTextOrientations:J,shapedText:te,layoutTextSize:me,textOffset:he,isSDFIcon:fe,iconPrimary:be,iconSecondary:Ee,iconTextFit:je,iconOffset:De}=V;W0(j,T.iconPositions,be,Ee),W0(W,T.iconPositions,be,Ee),Dw(J,T.iconPositions),YD(be,Ee,T.iconPositions),(te||j)&&_u(a,Q,J,j,W,E,M,me,0,he,fe,c,h,g,x,A,je,De,F,L)}o&&a.generateCollisionDebugBuffers(m,a.collisionBoxArray,M.textScaleFactor)},d.fo=Pt,d.fp=Fg,d.fq=Re,d.fr=function(a){let i=0;if(new Uint32Array(a,0,1)[0]!==eT){const o=new Uint32Array(a,0,7),[,,c,h,m,g]=o;i=o.byteLength+h+m+g+m,(c!==a.byteLength||i>=a.byteLength)&&_n("Invalid b3dm header information.")}return Uh(a,i)},d.fs=function(a,i){const o=Yo(a);for(const c of o){for(const h of c.meshes)rT(h);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push($h(c.lights,i)))}return o},d.ft=Uy,d.fu=di,d.fv=ny,d.fw=Gs,d.fx=ds,d.fy=function(a){Ki(),ur?.then(i=>{i.keys().then(o=>{for(let c=0;c<o.length-a;c++)i.delete(o[c]).catch(h=>_n(h.message))}).catch(o=>_n(o.message))}).catch(i=>_n(i.message))},d.g=function(a,i){return Nu(Ie(a,{method:"GET"}),i)},d.h=Ie,d.i=function(a){return so.API_STYLE_REGEX.test(a)&&!_f(a)},d.j=function(a){return 0===a.indexOf("mapbox:")},d.k=Hl,d.l=$d,d.m=function(a){return decodeURIComponent(atob(a).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))},d.n=function(a,i){return Nu(Ie(a,{type:"json"}),i)},d.o=fa,d.p=function(a,i){return Nu(Ie(a,{method:"POST"}),i)},d.q=Xs,d.r=Wr,d.s=function(a){try{const i=self[a];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}},d.t=nl,d.u=function(){return function a(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()},d.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},d.w=_n,d.x=function(){return sp||(sp=new mc),sp},d.y=Qy,d.z=yn}),n_(0,function(d){function tr(Pe){const Z=Pe?Pe.url.toString():void 0;return Z?performance.getEntriesByName(Z):[]}function Ui(Pe){if("number"==typeof Pe||"boolean"==typeof Pe||"string"==typeof Pe||null==Pe)return JSON.stringify(Pe);if(Array.isArray(Pe)){let X="[";for(const oe of Pe)X+=`${Ui(oe)},`;return`${X}]`}let Z="{";for(const X of Object.keys(Pe).sort())Z+=`${X}:${Ui(Pe[X])},`;return`${Z}}`}function Da(Pe){let Z="";for(const X of d.bu)Z+=`/${Ui(Pe[X])}`;return Z}class Nd{constructor(Z){this.keyCache={},this._layers={},this._layerConfigs={},Z&&this.replace(Z)}replace(Z,X){this._layerConfigs={},this._layers={},this.update(Z,[],X)}update(Z,X,oe){this._options=oe;for(const se of Z)this._layerConfigs[se.id]=se,(this._layers[se.id]=d.dn(se,this.scope,null,this._options)).compileFilter(oe),this.keyCache[se.id]&&delete this.keyCache[se.id];for(const se of X)delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se];this.familiesBySource={};const ge=function(se,we){const Fe={};for(let Ie=0;Ie<se.length;Ie++){const st=se[Ie];let qe=we&&we[st.id];qe||("symbol"===st.type?qe=st.id:(qe=Da(st),"line"===st.type&&st.paint&&function Wt(Yt){return"string"==typeof Yt&&"line-progress"===Yt||(Array.isArray(Yt)?Yt.some(Wt):!(!Yt||"object"!=typeof Yt)&&Object.values(Yt).some(Wt))}(st.paint["line-width"])&&(qe+=`/${Ui(st.paint["line-width"])}`))),we&&(we[st.id]=qe);let Lt=Fe[qe];Lt||(Lt=Fe[qe]=[]),Lt.push(st)}const Te=[];for(const Ie in Fe)Te.push(Fe[Ie]);return Te}(Object.values(this._layerConfigs),this.keyCache);for(const se of ge){const we=se.map(Lt=>this._layers[Lt.id]),Fe=we[0];if("none"===Fe.visibility)continue;const Te=Fe.source||"";let Ie=this.familiesBySource[Te];Ie||(Ie=this.familiesBySource[Te]={});const st=Fe.sourceLayer||"_geojsonTileLayer";let qe=Ie[st];qe||(qe=Ie[st]=[]),qe.push(we)}}}const ks=1*d.fa;class Fs{constructor(Z){const X={},oe=[];for(const Fe in Z){const Te=Z[Fe],Ie=X[Fe]={};for(const st in Te.glyphs){const qe=Te.glyphs[+st];if(!qe||0===qe.bitmap.width||0===qe.bitmap.height)continue;const Lt=qe.metrics.localGlyph?ks:1,Wt={x:0,y:0,w:qe.bitmap.width+2*Lt,h:qe.bitmap.height+2*Lt};oe.push(Wt),Ie[st]=Wt}}const{w:ge,h:se}=d.H(oe),we=new d.f9({width:ge||1,height:se||1});for(const Fe in Z){const Te=Z[Fe];for(const Ie in Te.glyphs){const st=Te.glyphs[+Ie];if(!st||0===st.bitmap.width||0===st.bitmap.height)continue;const qe=X[Fe][Ie],Lt=st.metrics.localGlyph?ks:1;d.f9.copy(st.bitmap,we,{x:0,y:0},{x:qe.x+Lt,y:qe.y+Lt},st.bitmap)}}this.image=we,this.positions=X}}d.f8(Fs,"GlyphAtlas");class Nl{constructor(Z){this.tileID=new d.aM(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.lut=Z.lut,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.scope=Z.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.request&&Z.request.collectResourceTiming,this.promoteId=Z.promoteId,this.isSymbolTile=Z.isSymbolTile,this.tileTransform=d.aW(Z.tileID.canonical,Z.projection),this.projection=Z.projection,this.worldview=Z.worldview,this.localizableLayerIds=Z.localizableLayerIds,this.brightness=Z.brightness,this.extraShadowCaster=!!Z.extraShadowCaster,this.tessellationStep=Z.tessellationStep,this.scaleFactor=Z.scaleFactor,this.worldview=Z.worldview}parse(Z,X,oe,ge,se,we){this.status="parsing",this.data=Z,this.collisionBoxArray=new d.b0;const Fe=new d.fb(Object.keys(Z.layers).sort()),Te=new d.fc(this.tileID,this.promoteId);Te.bucketLayerIDs=[];const Ie={},st=new d.fd(256,256),qe={featureIndex:Te,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:st,availableImages:oe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Lt=[],Wt=X.familiesBySource[this.source];for(const bn in Wt){const mn=Z.layers[bn];if(!mn)continue;let un=!1,_i=!1,_n=!1;for(const di of Wt[bn])"symbol"===di[0].type?un=!0:_i=!0,di[0].is3D()&&"model"!==di[0].type&&(_n=!0);if(this.extraShadowCaster&&!_n||!0===this.isSymbolTile&&!un||!1===this.isSymbolTile&&!_i)continue;1===mn.version&&d.w(`Vector tile source "${this.source}" layer "${bn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ir=Fe.encode(bn),Ir=[];let Nr=!1;for(let di=0,Vn=0;di<mn.length;di++){const $i=mn.feature(di),ji=Te.getId($i,bn);if(this.localizableLayerIds&&this.localizableLayerIds.has(bn)){const Si=$i.properties?$i.properties.worldview:null;if(this.worldview&&"string"==typeof Si)if("all"===Si)$i.properties.$localized=!0;else{if(!Si.split(",").includes(this.worldview))continue;$i.properties.$localized=!0,$i.properties.worldview=this.worldview}}!Nr&&$i.properties&&$i.properties.hasOwnProperty(d.fe)&&(Nr=!0),Ir.push({feature:$i,id:ji,index:Vn,sourceLayerIndex:ir}),Vn++}Nr&&!qe.elevationFeatures&&Z.layers.hasOwnProperty(d.ff)&&(qe.elevationFeatures=d.fg.parseFrom(Z.layers[d.ff],this.canonical));for(const di of Wt[bn]){const Vn=di[0];if(this.extraShadowCaster&&(!Vn.is3D()||"model"===Vn.type)||void 0!==this.isSymbolTile&&"symbol"===Vn.type!==this.isSymbolTile||Vn.minzoom&&this.zoom<Math.floor(Vn.minzoom)||Vn.maxzoom&&this.zoom>=Vn.maxzoom||"none"===Vn.visibility)continue;pn(di,this.zoom,qe.brightness,oe,this.worldview);const $i=Ie[Vn.id]=Vn.createBucket({index:Te.bucketLayerIDs.length,layers:di,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ir,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:ge,worldview:this.worldview});Te.bucketLayerIDs.push(di.map(Si=>d.C(Si.id,Si.scope)));let ji=$i.prepare?$i.prepare():null;null!=ji?(ji=ji.then(()=>$i.populate(Ir,qe,this.tileID.canonical,this.tileTransform)),Lt.push(ji)):$i.populate(Ir,qe,this.tileID.canonical,this.tileTransform)}}const Yt=()=>{let bn,mn,un,_i,_n,ir;st.trim();const Ir={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Nr=()=>{if(bn)return this.status="done",we(bn);if(this.extraShadowCaster)this.status="done",we(null,{buckets:Object.values(Ie).filter(Vn=>!Vn.isEmpty()),featureIndex:Te,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:qe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(mn&&un&&_i){const Vn=new Fs(mn),$i=new Map;for(const[Xr,Go]of un.entries()){const{imagePosition:_o}=d.fj(Xr,Go,d.fk);$i.set(Xr,_o)}const ji={};for(const Xr in Ie){const Go=Ie[Xr];Go instanceof d.b1&&(pn(Go.layers,this.zoom,qe.brightness,oe,this.worldview),ji[Xr]=d.fl(Go,mn,Vn.positions,un,$i,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,_n,this.worldview))}const Si={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(se,un,_n,()=>{Si.iconsPending=!1,di(ji,Vn,Si)}),this.rasterizeIfNeeded(se,_i,ir,()=>{Si.patternsPending=!1,di(ji,Vn,Si)})}},di=(Vn,$i,ji,Si)=>{if(ji.iconsPending||ji.patternsPending)return;const Xr=new d.fm(un,_i,this.lut);for(const Go in Ie){const _o=Ie[Go];if(Go in Vn)d.fn(_o,Vn[Go],this.showCollisionBoxes,oe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,un,Xr);else if(_o.hasPattern&&(_o instanceof d.b7||_o instanceof d.b8||_o instanceof d.e4)){pn(_o.layers,this.zoom,qe.brightness,oe,this.worldview);const Hd=Object.fromEntries(Xr.patternPositions);_o.addFeatures(qe,this.tileID.canonical,Hd,oe,this.tileTransform,this.brightness)}}this.status="done",we(null,{buckets:Object.values(Ie).filter(Go=>!Go.isEmpty()),featureIndex:Te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:$i.image,lineAtlas:st,imageAtlas:Xr,brightness:qe.brightness})};if(!this.extraShadowCaster){const Vn=d.fh(qe.glyphDependencies,Si=>Object.keys(Si).map(Number));Object.keys(Vn).length?se.send("getGlyphs",{uid:this.uid,stacks:Vn},(Si,Xr)=>{bn||(bn=Si,mn=Xr,Nr())},void 0,!1,Ir):mn={};const $i=Array.from(qe.iconDependencies.keys()).map(Si=>d.I.parse(Si));$i.length?se.send("getImages",{images:$i,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Si,Xr)=>{bn||(bn=Si,un=new Map,_n=this.updateImageMapAndGetImageTaskQueue(un,Xr,qe.iconDependencies),Nr())},void 0,!1,Ir):(un=new Map,_n=new Map);const ji=Array.from(qe.patternDependencies.keys()).map(Si=>d.I.parse(Si));ji.length?se.send("getImages",{images:ji,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Si,Xr)=>{bn||(bn=Si,_i=new Map,ir=this.updateImageMapAndGetImageTaskQueue(_i,Xr,qe.patternDependencies),Nr())},void 0,!1,Ir):(_i=new Map,ir=new Map)}if(qe.elevationFeatures&&qe.elevationFeatures.length>0){const Vn=[];for(const ji of Object.values(Ie))if(ji instanceof d.b8){const Si=ji.getUnevaluatedPortalGraph();Si&&Vn.push(Si)}const $i=d.fi.evaluate(Vn);for(const ji of Object.values(Ie))if(ji instanceof d.b8){const Si=Z.layers[Fe.decode(ji.sourceLayerIndex)];ji.setEvaluatedPortalGraph($i,Si,this.tileID.canonical,qe.availableImages,qe.brightness)}}Nr()};Lt.length>0?Promise.allSettled(Lt).then(Yt).catch(we):Yt()}rasterizeIfNeeded(Z,X,oe,ge){Array.from(X.values()).some(se=>se.usvg)?this.rasterize(Z,X,oe,ge):ge()}updateImageMapAndGetImageTaskQueue(Z,X,oe){const ge=new Map;for(const se of X.keys()){const we=oe.get(se)||[];for(const Fe of we){const Te=Fe.toString(),Ie=X.get(Fe.id.toString());Ie.usvg?ge.has(Te)||(ge.set(Te,Fe),Z.set(Te,Object.assign({},Ie))):Z.set(Te,Ie)}}return ge}rasterize(Z,X,oe,ge){this.rasterizeTask=Z.send("rasterizeImages",{scope:this.scope,tasks:oe},(se,we)=>{if(!se)for(const[Fe,Te]of we.entries()){const Ie=Object.assign(X.get(Fe),{data:Te});X.set(Fe,Ie)}ge()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function pn(Pe,Z,X,oe,ge){const se=new d.aa(Z,{brightness:X,worldview:ge});for(const we of Pe)we.recalculate(se,oe)}class ts extends d.E{constructor(Z,X,oe,ge,se,we,Fe){super(),this.actor=Z,this.layerIndex=X,this.availableImages=oe,this.availableModels=ge,this.loadVectorData=we||d.aJ,this.loading={},this.loaded={},this.deduped=new d.aI(Z.scheduler),this.isSpriteLoaded=se,this.scheduler=Z.scheduler,this.brightness=Fe}loadTile(Z,X){const oe=Z.uid,ge=Z&&Z.request,se=ge&&ge.collectResourceTiming,we=this.loading[oe]=new Nl(Z);we.abort=this.loadVectorData(Z,(Fe,Te)=>{const Ie=!this.loading[oe];if(delete this.loading[oe],we.cancelRasterize(),Ie||Fe||!Te)return we.status="done",Ie||(this.loaded[oe]=we),X(Fe);const st=Te.rawData,qe={};Te.expires&&(qe.expires=Te.expires),Te.cacheControl&&(qe.cacheControl=Te.cacheControl),we.vectorTile=Te.vectorTile||new d.fo(new d.bq(st));const Lt=()=>{we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Wt,Yt)=>{if(Wt||!Yt)return X(Wt);const bn={};if(se){const mn=tr(ge);mn.length>0&&(bn.resourceTiming=JSON.parse(JSON.stringify(mn)))}X(null,d.h({rawTileData:st.slice(0)},Yt,qe,bn))})};this.isSpriteLoaded?Lt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Lt,{type:"parseTile",isSymbolTile:Z.isSymbolTile,zoom:Z.tileZoom}):Lt()}),this.loaded=this.loaded||{},this.loaded[oe]=we})}reloadTile(Z,X){const oe=this.loaded,ge=Z.uid;if(oe&&oe[ge]){const se=oe[ge];se.scaleFactor=Z.scaleFactor,se.showCollisionBoxes=Z.showCollisionBoxes,se.projection=Z.projection,se.brightness=Z.brightness,se.tileTransform=d.aW(Z.tileID.canonical,Z.projection),se.extraShadowCaster=Z.extraShadowCaster,se.lut=Z.lut,se.worldview=Z.worldview;const we=(Fe,Te)=>{const Ie=se.reloadCallback;Ie&&(delete se.reloadCallback,se.parse(se.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ie)),X(Fe,Te)};"parsing"===se.status?se.reloadCallback=we:"done"===se.status&&(se.vectorTile?se.parse(se.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,we):we())}else X(null,void 0)}abortTile(Z,X){const oe=Z.uid,ge=this.loading[oe];ge&&(ge.abort&&ge.abort(),delete this.loading[oe]),X()}removeTile(Z,X){const oe=this.loaded,ge=Z.uid;oe&&oe[ge]&&delete oe[ge],X()}}class Hi{loadTile(Z,X){const{uid:oe,encoding:ge,rawImageData:se,padding:we}=Z,Fe=ImageBitmap&&se instanceof ImageBitmap?this.getImageData(se,we):se;X(null,new d.fp(oe,Fe,ge,we<1))}reloadTile(Z,X){X(null,null)}abortTile(Z,X){X()}removeTile(Z,X){X()}getImageData(Z,X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const oe=this.offscreenCanvasContext.getImageData(-X,-X,Z.width+2*X,Z.height+2*X);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}d.bp.setPbf(d.bq);class Uo{constructor(Z){this._mrt=new d.bp(Z.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Z.uid,this.tileID=Z.tileID,this.source=Z.source}parse(Z,X){const oe=this._mrt;this.status="parsing",this._entireBuffer=Z;try{oe.parseHeader(Z),this._isHeaderLoaded=!0;const ge=[];for(const se in oe.layers){const we=oe.getLayer(se),Fe=we.getDataRange(we.getBandList()),Te=oe.createDecodingTask(Fe),Ie=Z.slice(Fe.firstByte,Fe.lastByte+1),st=d.bp.performDecoding(Ie,Te).then(qe=>Te.complete(null,qe)).catch(qe=>Te.complete(qe,null));ge.push(st)}Promise.allSettled(ge).then(()=>X(null,oe)).catch(se=>X(se))}catch(ge){X(ge)}}}class ro{constructor(Z){this.actor=Z,this.loading={},this.loaded={}}loadTile(Z,X){const oe=Z.uid,ge=Z.request,se=this.loading[oe]=new Uo(Z),{cancel:we}=d.br(ge,(Fe,Te,Ie,st)=>{const qe=!this.loading[oe];if(delete this.loading[oe],qe||Fe||!Te)return se.status="done",qe||(this.loaded[oe]=se),X(Fe);se.parse(Te,(Lt,Wt)=>{if(Lt||!Wt)return X(Lt);X(null,Wt,Ie,st)}),this.loaded[oe]=se});se.abort=we}reloadTile(Z,X){X(null,void 0)}abortTile(Z,X){const oe=Z.uid,ge=this.loading[oe];ge&&(ge.abort&&ge.abort(),delete this.loading[oe]),X()}removeTile(Z,X){const oe=Z.uid;this.loaded[oe]&&delete this.loaded[oe],X()}decodeRasterArray(Z,X){d.bp.performDecoding(Z.buffer,Z.task).then(oe=>X(null,oe)).catch(oe=>X(oe))}}const vs=d.fq.prototype.toGeoJSON;class Zs{constructor(Z){this._feature=Z,this.extent=d.aj,this.type=Z.type,this.properties=Z.tags,"id"in Z&&!isNaN(Z.id)&&(this.id=parseInt(Z.id,10))}loadGeometry(){if(1===this._feature.type){const Z=[];for(const X of this._feature.geometry)Z.push([new d.P(X[0],X[1])]);return Z}{const Z=[];for(const X of this._feature.geometry){const oe=[];for(const ge of X)oe.push(new d.P(ge[0],ge[1]));Z.push(oe)}return Z}}toGeoJSON(Z,X,oe){return vs.call(this,Z,X,oe)}}class zl{constructor(Z,X){this.name=Z,this.extent=d.aj,this.length=X.length,this._jsonFeatures=X}feature(Z){return new Zs(this._jsonFeatures[Z])}}class Bl{constructor(Z){this.layers={},this.extent=d.aj;for(const X of Object.keys(Z))this.layers[X]=new zl(X,Z[X])}}const da=64/4096,Ia=128;class ff{constructor(){this.features=new Map}clear(){this.features.clear()}load(Z=[],X){for(const oe of Z){const ge=oe.id;if(null==ge)continue;let se=this.features.get(ge);se&&this.updateCache(se,X),oe.geometry?(se=Wa(oe),this.updateCache(se,X),this.features.set(ge,se)):this.features.delete(ge),this.updateCache(se,X)}}updateCache(Z,X){for(const{canonical:oe,uid:ge}of Object.values(X)){const{z:se,x:we,y:Fe}=oe;Un(Z,Math.pow(2,se),we,Fe)&&delete X[ge]}}getTile(Z,X,oe){const ge=Math.pow(2,Z),se=[];for(const we of this.features.values())Un(we,ge,X,oe)&&se.push(ki(we,ge,X,oe));return{features:se}}getFeatures(){return[...this.features.values()]}}function Un({minX:Pe,minY:Z,maxX:X,maxY:oe},ge,se,we){return Pe<(se+1+da)/ge&&Z<(we+1+da)/ge&&X>(se-da)/ge&&oe>(we-da)/ge}function Wa(Pe){const{id:Z,geometry:X,properties:oe}=Pe;if(!X)return;if("GeometryCollection"===X.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ge,coordinates:se}=X,we={id:Z,type:1,geometry:[],tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Fe=we.geometry;if("Point"===ge)go(se,Fe,we);else if("MultiPoint"===ge)for(const Te of se)go(Te,Fe,we);else if("LineString"===ge)we.type=2,gr(se,Fe,we);else if("MultiLineString"===ge)we.type=2,_r(se,Fe,we);else if("Polygon"===ge)we.type=3,_r(se,Fe,we,!0);else{if("MultiPolygon"!==ge)throw new Error("Input data is not a valid GeoJSON object.");we.type=3;for(const Te of se)_r(Te,Fe,we,!0)}return we}function go([Pe,Z],X,oe){const ge=d.aD(Pe);let se=d.aH(Z);se=se<0?0:se>1?1:se,X.push(ge,se),oe.minX=Math.min(oe.minX,ge),oe.minY=Math.min(oe.minY,se),oe.maxX=Math.max(oe.maxX,ge),oe.maxY=Math.max(oe.maxY,se)}function gr(Pe,Z,X,oe=!1,ge=!1){const se=[];for(const we of Pe)go(we,se,X);Z.push(se),oe&&function(we,Fe){let Te=0;for(let Ie=0,st=we.length,qe=st-2;Ie<st;qe=Ie,Ie+=2)Te+=(we[Ie]-we[qe])*(we[Ie+1]+we[qe+1]);if(Te>0===Fe)for(let Ie=0,st=we.length;Ie<st/2;Ie+=2){const qe=we[Ie],Lt=we[Ie+1];we[Ie]=we[st-2-Ie],we[Ie+1]=we[st-1-Ie],we[st-2-Ie]=qe,we[st-1-Ie]=Lt}}(se,ge)}function _r(Pe,Z,X,oe=!1){for(let ge=0;ge<Pe.length;ge++)gr(Pe[ge],Z,X,oe,0===ge)}function ki(Pe,Z,X,oe){const{id:ge,type:se,geometry:we,tags:Fe}=Pe,Te=[];if(1===se)!function(Ie,st,qe,Lt,Wt){for(let Yt=0;Yt<Ie.length;Yt+=2){const bn=Math.round(d.aj*(Ie[Yt+0]*st-qe)),mn=Math.round(d.aj*(Ie[Yt+1]*st-Lt));Wt.push([bn,mn])}}(we,Z,X,oe,Te);else for(const Ie of we)oo(Ie,Z,X,oe,Te);return{id:ge,type:se,geometry:Te,tags:Fe}}function oo(Pe,Z,X,oe,ge){const se=-Ia,we=d.aj+Ia;let Fe;for(let Te=0;Te<Pe.length-2;Te+=2){let Ie=Math.round(d.aj*(Pe[Te+0]*Z-X)),st=Math.round(d.aj*(Pe[Te+1]*Z-oe)),qe=Math.round(d.aj*(Pe[Te+2]*Z-X)),Lt=Math.round(d.aj*(Pe[Te+3]*Z-oe));const Wt=qe-Ie,Yt=Lt-st;Ie<se&&qe<se||(Ie<se?(st+=Math.round(Yt*((se-Ie)/Wt)),Ie=se):qe<se&&(Lt=st+Math.round(Yt*((se-Ie)/Wt)),qe=se),st<se&&Lt<se||(st<se?(Ie+=Math.round(Wt*((se-st)/Yt)),st=se):Lt<se&&(qe=Ie+Math.round(Wt*((se-st)/Yt)),Lt=se),Ie>=we&&qe>=we||(Ie>=we?(st+=Math.round(Yt*((we-Ie)/Wt)),Ie=we):qe>=we&&(Lt=st+Math.round(Yt*((we-Ie)/Wt)),qe=we),st>=we&&Lt>=we||(st>=we?(Ie+=Math.round(Wt*((we-st)/Yt)),st=we):Lt>=we&&(qe=Ie+Math.round(Wt*((we-st)/Yt)),Lt=we),Fe&&Ie===Fe[Fe.length-1][0]&&st===Fe[Fe.length-1][1]||(Fe=[[Ie,st]],ge.push(Fe)),Fe.push([qe,Lt])))))}}function pf({name:Pe,features:Z},X){X.writeStringField(1,Pe),X.writeVarintField(5,d.aj);const oe=new Map,ge=new Map,se={keys:oe,values:ge,feature:null};for(const we of Z)se.feature=we,X.writeMessage(2,Aa,se);for(const we of oe.keys())X.writeStringField(3,we);for(const we of ge.keys())X.writeMessage(4,mf,we)}function Aa(Pe,Z){const X=Pe.feature;void 0===X.id||isNaN(+X.id)||Z.writeVarintField(1,+X.id),X.tags&&Z.writeMessage(2,Vi,Pe),Z.writeVarintField(3,X.type),Z.writeMessage(4,Iu,X)}function Vi({keys:Pe,values:Z,feature:X},oe){for(const ge of Object.keys(X.tags)){let se=X.tags[ge];if(null===se)continue;let we=Pe.get(ge);void 0===we&&(we=Pe.size,Pe.set(ge,we)),oe.writeVarint(we);const Fe=typeof se;"string"!==Fe&&"boolean"!==Fe&&"number"!==Fe&&(se=JSON.stringify(se));let Te=Z.get(se);void 0===Te&&(Te=Z.size,Z.set(se,Te)),oe.writeVarint(Te)}}function Fi(Pe,Z){return(Z<<3)+(7&Pe)}function Ho(Pe){return Pe<<1^Pe>>31}function Iu(Pe,Z){const{geometry:X,type:oe}=Pe;let ge=0,se=0;if(1===oe){Z.writeVarint(Fi(1,X.length));for(const we of X){const Fe=we[0]-ge,Te=we[1]-se;Z.writeVarint(Ho(Fe)),Z.writeVarint(Ho(Te)),ge+=Fe,se+=Te}}else for(const we of X){Z.writeVarint(Fi(1,1));const Fe=we.length-(3===oe?1:0);for(let Te=0;Te<Fe;Te++){1===Te&&Z.writeVarint(Fi(2,Fe-1));const Ie=we[Te][0]-ge,st=we[Te][1]-se;Z.writeVarint(Ho(Ie)),Z.writeVarint(Ho(st)),ge+=Ie,se+=st}3===oe&&Z.writeVarint(Fi(7,1))}}function mf(Pe,Z){const X=typeof Pe;"string"===X?Z.writeStringField(1,Pe):"boolean"===X?Z.writeBooleanField(7,Pe):"number"===X&&(Pe%1!=0?Z.writeDoubleField(3,Pe):Pe<0?Z.writeSVarintField(6,Pe):Z.writeVarintField(5,Pe))}const Gi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Pe=>Pe},Mi=Math.fround||(ar=new Float32Array(1),Pe=>(ar[0]=+Pe,ar[0]));var ar;const gi=3,nr=5,lr=6;class Mo{constructor(Z){this.options=Object.assign(Object.create(Gi),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:X,minZoom:oe,maxZoom:ge}=this.options;X&&console.time("total time");const se=`prepare ${Z.length} points`;X&&console.time(se),this.points=Z;const we=[];for(let Te=0;Te<Z.length;Te++){const Ie=Z[Te];if(!Ie.geometry)continue;const[st,qe]=Ie.geometry.coordinates,Lt=Mi(xs(st)),Wt=Mi(cr(qe));we.push(Lt,Wt,1/0,Te,-1,1),this.options.reduce&&we.push(0)}let Fe=this.trees[ge+1]=this._createTree(we);X&&console.timeEnd(se);for(let Te=ge;Te>=oe;Te--){const Ie=+Date.now();Fe=this.trees[Te]=this._createTree(this._cluster(Fe,Te)),X&&console.log("z%d: %d clusters in %dms",Te,Fe.numItems,+Date.now()-Ie)}return X&&console.timeEnd("total time"),this}getClusters(Z,X){let oe=((Z[0]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,Z[1]));let se=180===Z[2]?180:((Z[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)oe=-180,se=180;else if(oe>se){const qe=this.getClusters([oe,ge,180,we],X),Lt=this.getClusters([-180,ge,se,we],X);return qe.concat(Lt)}const Fe=this.trees[this._limitZoom(X)],Te=Fe.range(xs(oe),cr(we),xs(se),cr(ge)),Ie=Fe.data,st=[];for(const qe of Te){const Lt=this.stride*qe;st.push(Ie[Lt+nr]>1?Ma(Ie,Lt,this.clusterProps):this.points[Ie[Lt+gi]])}return st}getChildren(Z){const X=this._getOriginId(Z),oe=this._getOriginZoom(Z),ge="No cluster with the specified id.",se=this.trees[oe];if(!se)throw new Error(ge);const we=se.data;if(X*this.stride>=we.length)throw new Error(ge);const Fe=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),Te=se.within(we[X*this.stride],we[X*this.stride+1],Fe),Ie=[];for(const st of Te){const qe=st*this.stride;we[qe+4]===Z&&Ie.push(we[qe+nr]>1?Ma(we,qe,this.clusterProps):this.points[we[qe+gi]])}if(0===Ie.length)throw new Error(ge);return Ie}getLeaves(Z,X,oe){const ge=[];return this._appendLeaves(ge,Z,X=X||10,oe=oe||0,0),ge}getTile(Z,X,oe){const ge=this.trees[this._limitZoom(Z)],se=Math.pow(2,Z),{extent:we,radius:Fe}=this.options,Te=Fe/we,Ie=(oe-Te)/se,st=(oe+1+Te)/se,qe={features:[]};return this._addTileFeatures(ge.range((X-Te)/se,Ie,(X+1+Te)/se,st),ge.data,X,oe,se,qe),0===X&&this._addTileFeatures(ge.range(1-Te/se,Ie,1,st),ge.data,se,oe,se,qe),X===se-1&&this._addTileFeatures(ge.range(0,Ie,Te/se,st),ge.data,-1,oe,se,qe),qe.features.length?qe:null}getClusterExpansionZoom(Z){let X=this._getOriginZoom(Z)-1;for(;X<=this.options.maxZoom;){const oe=this.getChildren(Z);if(X++,1!==oe.length)break;Z=oe[0].properties.cluster_id}return X}_appendLeaves(Z,X,oe,ge,se){const we=this.getChildren(X);for(const Fe of we){const Te=Fe.properties;if(Te&&Te.cluster?se+Te.point_count<=ge?se+=Te.point_count:se=this._appendLeaves(Z,Te.cluster_id,oe,ge,se):se<ge?se++:Z.push(Fe),Z.length===oe)break}return se}_createTree(Z){const X=new d.c0(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<Z.length;oe+=this.stride)X.add(Z[oe],Z[oe+1]);return X.finish(),X.data=Z,X}_addTileFeatures(Z,X,oe,ge,se,we){for(const Fe of Z){const Te=Fe*this.stride,Ie=X[Te+nr]>1;let st,qe,Lt;if(Ie)st=zd(X,Te,this.clusterProps),qe=X[Te],Lt=X[Te+1];else{const bn=this.points[X[Te+gi]];st=bn.properties;const[mn,un]=bn.geometry.coordinates;qe=xs(mn),Lt=cr(un)}const Wt={type:1,geometry:[[Math.round(this.options.extent*(qe*se-oe)),Math.round(this.options.extent*(Lt*se-ge))]],tags:st};let Yt;Yt=Ie||this.options.generateId?X[Te+gi]:this.points[X[Te+gi]].id,void 0!==Yt&&(Wt.id=Yt),we.features.push(Wt)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,X){const{radius:oe,extent:ge,reduce:se,minPoints:we}=this.options,Fe=oe/(ge*Math.pow(2,X)),Te=Z.data,Ie=[],st=this.stride;for(let qe=0;qe<Te.length;qe+=st){if(Te[qe+2]<=X)continue;Te[qe+2]=X;const Lt=Te[qe],Wt=Te[qe+1],Yt=Z.within(Te[qe],Te[qe+1],Fe),bn=Te[qe+nr];let mn=bn;for(const un of Yt){const _i=un*st;Te[_i+2]>X&&(mn+=Te[_i+nr])}if(mn>bn&&mn>=we){let un,_i=Lt*bn,_n=Wt*bn,ir=-1;const Ir=(qe/st<<5)+(X+1)+this.points.length;for(const Nr of Yt){const di=Nr*st;if(Te[di+2]<=X)continue;Te[di+2]=X;const Vn=Te[di+nr];_i+=Te[di]*Vn,_n+=Te[di+1]*Vn,Te[di+4]=Ir,se&&(un||(un=this._map(Te,qe,!0),ir=this.clusterProps.length,this.clusterProps.push(un)),se(un,this._map(Te,di)))}Te[qe+4]=Ir,Ie.push(_i/mn,_n/mn,1/0,Ir,-1,mn),se&&Ie.push(ir)}else{for(let un=0;un<st;un++)Ie.push(Te[qe+un]);if(mn>1)for(const un of Yt){const _i=un*st;if(!(Te[_i+2]<=X)){Te[_i+2]=X;for(let _n=0;_n<st;_n++)Ie.push(Te[_i+_n])}}}}return Ie}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,X,oe){if(Z[X+nr]>1){const we=this.clusterProps[Z[X+lr]];return oe?Object.assign({},we):we}const ge=this.points[Z[X+gi]].properties,se=this.options.map(ge);return oe&&se===ge?Object.assign({},se):se}}function Ma(Pe,Z,X){return{type:"Feature",id:Pe[Z+gi],properties:zd(Pe,Z,X),geometry:{type:"Point",coordinates:[(oe=Pe[Z],360*(oe-.5)),ns(Pe[Z+1])]}};var oe}function zd(Pe,Z,X){const oe=Pe[Z+nr],ge=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,se=Pe[Z+lr],we=-1===se?{}:Object.assign({},X[se]);return Object.assign(we,{cluster:!0,cluster_id:Pe[Z+gi],point_count:oe,point_count_abbreviated:ge})}function xs(Pe){return Pe/360+.5}function cr(Pe){const Z=Math.sin(Pe*Math.PI/180),X=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return X<0?0:X>1?1:X}function ns(Pe){const Z=(180-360*Pe)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function Vl(Pe,Z,X,oe){let ge=oe;const se=Z+(X-Z>>1);let we,Fe=X-Z;const Te=Pe[Z],Ie=Pe[Z+1],st=Pe[X],qe=Pe[X+1];for(let Lt=Z+3;Lt<X;Lt+=3){const Wt=Bd(Pe[Lt],Pe[Lt+1],Te,Ie,st,qe);if(Wt>ge)we=Lt,ge=Wt;else if(Wt===ge){const Yt=Math.abs(Lt-se);Yt<Fe&&(we=Lt,Fe=Yt)}}ge>oe&&(we-Z>3&&Vl(Pe,Z,we,oe),Pe[we+2]=ge,X-we>3&&Vl(Pe,we,X,oe))}function Bd(Pe,Z,X,oe,ge,se){let we=ge-X,Fe=se-oe;if(0!==we||0!==Fe){const Te=((Pe-X)*we+(Z-oe)*Fe)/(we*we+Fe*Fe);Te>1?(X=ge,oe=se):Te>0&&(X+=we*Te,oe+=Fe*Te)}return we=Pe-X,Fe=Z-oe,we*we+Fe*Fe}function Za(Pe,Z,X,oe){const ge={id:Pe??null,type:Z,geometry:X,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===Z||"MultiPoint"===Z||"LineString"===Z)Ls(ge,X);else if("Polygon"===Z)Ls(ge,X[0]);else if("MultiLineString"===Z)for(const se of X)Ls(ge,se);else if("MultiPolygon"===Z)for(const se of X)Ls(ge,se[0]);return ge}function Ls(Pe,Z){for(let X=0;X<Z.length;X+=3)Pe.minX=Math.min(Pe.minX,Z[X]),Pe.minY=Math.min(Pe.minY,Z[X+1]),Pe.maxX=Math.max(Pe.maxX,Z[X]),Pe.maxY=Math.max(Pe.maxY,Z[X+1])}function bs(Pe,Z,X,oe){if(!Z.geometry)return;const ge=Z.geometry.coordinates;if(ge&&0===ge.length)return;const se=Z.geometry.type,we=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2);let Fe=[],Te=Z.id;if(X.promoteId?Te=Z.properties[X.promoteId]:X.generateId&&(Te=oe||0),"Point"===se)Xa(ge,Fe);else if("MultiPoint"===se)for(const Ie of ge)Xa(Ie,Fe);else if("LineString"===se)Pa(ge,Fe,we,!1);else if("MultiLineString"===se){if(X.lineMetrics){for(const Ie of ge)Fe=[],Pa(Ie,Fe,we,!1),Pe.push(Za(Te,"LineString",Fe,Z.properties));return}Cc(ge,Fe,we,!1)}else if("Polygon"===se)Cc(ge,Fe,we,!0);else{if("MultiPolygon"!==se){if("GeometryCollection"===se){for(const Ie of Z.geometry.geometries)bs(Pe,{id:Te,geometry:Ie,properties:Z.properties},X,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ie of ge){const st=[];Cc(Ie,st,we,!0),Fe.push(st)}}Pe.push(Za(Te,se,Fe,Z.properties))}function Xa(Pe,Z){Z.push(jl(Pe[0]),is(Pe[1]),0)}function Pa(Pe,Z,X,oe){let ge,se,we=0;for(let Te=0;Te<Pe.length;Te++){const Ie=jl(Pe[Te][0]),st=is(Pe[Te][1]);Z.push(Ie,st,0),Te>0&&(we+=oe?(ge*st-Ie*se)/2:Math.sqrt(Math.pow(Ie-ge,2)+Math.pow(st-se,2))),ge=Ie,se=st}const Fe=Z.length-3;Z[2]=1,Vl(Z,0,Fe,X),Z[Fe+2]=1,Z.size=Math.abs(we),Z.start=0,Z.end=Z.size}function Cc(Pe,Z,X,oe){for(let ge=0;ge<Pe.length;ge++){const se=[];Pa(Pe[ge],se,X,oe),Z.push(se)}}function jl(Pe){return Pe/360+.5}function is(Pe){const Z=Math.sin(Pe*Math.PI/180),X=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return X<0?0:X>1?1:X}function rs(Pe,Z,X,oe,ge,se,we,Fe){if(oe/=Z,se>=(X/=Z)&&we<oe)return Pe;if(we<X||se>=oe)return null;const Te=[];for(const Ie of Pe){const st=Ie.geometry;let qe=Ie.type;const Lt=0===ge?Ie.minX:Ie.minY,Wt=0===ge?Ie.maxX:Ie.maxY;if(Lt>=X&&Wt<oe){Te.push(Ie);continue}if(Wt<X||Lt>=oe)continue;let Yt=[];if("Point"===qe||"MultiPoint"===qe)Au(st,Yt,X,oe,ge);else if("LineString"===qe)Ya(st,Yt,X,oe,ge,!1,Fe.lineMetrics);else if("MultiLineString"===qe)Po(st,Yt,X,oe,ge,!1);else if("Polygon"===qe)Po(st,Yt,X,oe,ge,!0);else if("MultiPolygon"===qe)for(const bn of st){const mn=[];Po(bn,mn,X,oe,ge,!0),mn.length&&Yt.push(mn)}if(Yt.length){if(Fe.lineMetrics&&"LineString"===qe){for(const bn of Yt)Te.push(Za(Ie.id,qe,bn,Ie.tags));continue}"LineString"!==qe&&"MultiLineString"!==qe||(1===Yt.length?(qe="LineString",Yt=Yt[0]):qe="MultiLineString"),"Point"!==qe&&"MultiPoint"!==qe||(qe=3===Yt.length?"Point":"MultiPoint"),Te.push(Za(Ie.id,qe,Yt,Ie.tags))}}return Te.length?Te:null}function Au(Pe,Z,X,oe,ge){for(let se=0;se<Pe.length;se+=3){const we=Pe[se+ge];we>=X&&we<=oe&&Zr(Z,Pe[se],Pe[se+1],Pe[se+2])}}function Ya(Pe,Z,X,oe,ge,se,we){let Fe=Mu(Pe);const Te=0===ge?Ka:Ja;let Ie,st,qe=Pe.start;for(let mn=0;mn<Pe.length-3;mn+=3){const un=Pe[mn],_i=Pe[mn+1],_n=Pe[mn+2],ir=Pe[mn+3],Ir=Pe[mn+4],Nr=0===ge?un:_i,di=0===ge?ir:Ir;let Vn=!1;we&&(Ie=Math.sqrt(Math.pow(un-ir,2)+Math.pow(_i-Ir,2))),Nr<X?di>X&&(st=Te(Fe,un,_i,ir,Ir,X),we&&(Fe.start=qe+Ie*st)):Nr>oe?di<oe&&(st=Te(Fe,un,_i,ir,Ir,oe),we&&(Fe.start=qe+Ie*st)):Zr(Fe,un,_i,_n),di<X&&Nr>=X&&(st=Te(Fe,un,_i,ir,Ir,X),Vn=!0),di>oe&&Nr<=oe&&(st=Te(Fe,un,_i,ir,Ir,oe),Vn=!0),!se&&Vn&&(we&&(Fe.end=qe+Ie*st),Z.push(Fe),Fe=Mu(Pe)),we&&(qe+=Ie)}let Lt=Pe.length-3;const Wt=Pe[Lt],Yt=Pe[Lt+1],bn=0===ge?Wt:Yt;bn>=X&&bn<=oe&&Zr(Fe,Wt,Yt,Pe[Lt+2]),Lt=Fe.length-3,se&&Lt>=3&&(Fe[Lt]!==Fe[0]||Fe[Lt+1]!==Fe[1])&&Zr(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&Z.push(Fe)}function Mu(Pe){const Z=[];return Z.size=Pe.size,Z.start=Pe.start,Z.end=Pe.end,Z}function Po(Pe,Z,X,oe,ge,se){for(const we of Pe)Ya(we,Z,X,oe,ge,se,!1)}function Zr(Pe,Z,X,oe){Pe.push(Z,X,oe)}function Ka(Pe,Z,X,oe,ge,se){const we=(se-Z)/(oe-Z);return Zr(Pe,se,X+(ge-X)*we,1),we}function Ja(Pe,Z,X,oe,ge,se){const we=(se-X)/(ge-X);return Zr(Pe,Z+(oe-Z)*we,se,1),we}function Qa(Pe,Z){const X=[];for(let oe=0;oe<Pe.length;oe++){const ge=Pe[oe],se=ge.type;let we;if("Point"===se||"MultiPoint"===se||"LineString"===se)we=Ul(ge.geometry,Z);else if("MultiLineString"===se||"Polygon"===se){we=[];for(const Fe of ge.geometry)we.push(Ul(Fe,Z))}else if("MultiPolygon"===se){we=[];for(const Fe of ge.geometry){const Te=[];for(const Ie of Fe)Te.push(Ul(Ie,Z));we.push(Te)}}X.push(Za(ge.id,se,we,ge.tags))}return X}function Ul(Pe,Z){const X=[];X.size=Pe.size,void 0!==Pe.start&&(X.start=Pe.start,X.end=Pe.end);for(let oe=0;oe<Pe.length;oe+=3)X.push(Pe[oe]+Z,Pe[oe+1],Pe[oe+2]);return X}function Pu(Pe,Z){if(Pe.transformed)return Pe;const X=1<<Pe.z,oe=Pe.x,ge=Pe.y;for(const se of Pe.features){const we=se.geometry,Fe=se.type;if(se.geometry=[],1===Fe)for(let Te=0;Te<we.length;Te+=2)se.geometry.push(Ci(we[Te],we[Te+1],Z,X,oe,ge));else for(let Te=0;Te<we.length;Te++){const Ie=[];for(let st=0;st<we[Te].length;st+=2)Ie.push(Ci(we[Te][st],we[Te][st+1],Z,X,oe,ge));se.geometry.push(Ie)}}return Pe.transformed=!0,Pe}function Ci(Pe,Z,X,oe,ge,se){return[Math.round(X*(Pe*oe-ge)),Math.round(X*(Z*oe-se))]}function Vd(Pe,Z,X,oe,ge){const se=Z===ge.maxZoom?0:ge.tolerance/((1<<Z)*ge.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:Pe.length,source:null,x:X,y:oe,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Fe of Pe)jd(we,Fe,se,ge);return we}function jd(Pe,Z,X,oe){const ge=Z.geometry,se=Z.type,we=[];if(Pe.minX=Math.min(Pe.minX,Z.minX),Pe.minY=Math.min(Pe.minY,Z.minY),Pe.maxX=Math.max(Pe.maxX,Z.maxX),Pe.maxY=Math.max(Pe.maxY,Z.maxY),"Point"===se||"MultiPoint"===se)for(let Fe=0;Fe<ge.length;Fe+=3)we.push(ge[Fe],ge[Fe+1]),Pe.numPoints++,Pe.numSimplified++;else if("LineString"===se)Ns(we,ge,Pe,X,!1,!1);else if("MultiLineString"===se||"Polygon"===se)for(let Fe=0;Fe<ge.length;Fe++)Ns(we,ge[Fe],Pe,X,"Polygon"===se,0===Fe);else if("MultiPolygon"===se)for(let Fe=0;Fe<ge.length;Fe++){const Te=ge[Fe];for(let Ie=0;Ie<Te.length;Ie++)Ns(we,Te[Ie],Pe,X,!0,0===Ie)}if(we.length){let Fe=Z.tags||null;if("LineString"===se&&oe.lineMetrics){Fe={};for(const Ie in Z.tags)Fe[Ie]=Z.tags[Ie];Fe.mapbox_clip_start=ge.start/ge.size,Fe.mapbox_clip_end=ge.end/ge.size}const Te={geometry:we,type:"Polygon"===se||"MultiPolygon"===se?3:"LineString"===se||"MultiLineString"===se?2:1,tags:Fe};null!==Z.id&&(Te.id=Z.id),Pe.features.push(Te)}}function Ns(Pe,Z,X,oe,ge,se){const we=oe*oe;if(oe>0&&Z.size<(ge?we:oe))return void(X.numPoints+=Z.length/3);const Fe=[];for(let Te=0;Te<Z.length;Te+=3)(0===oe||Z[Te+2]>we)&&(X.numSimplified++,Fe.push(Z[Te],Z[Te+1])),X.numPoints++;ge&&function(Te,Ie){let st=0;for(let qe=0,Lt=Te.length,Wt=Lt-2;qe<Lt;Wt=qe,qe+=2)st+=(Te[qe]-Te[Wt])*(Te[qe+1]+Te[Wt+1]);if(st>0===Ie)for(let qe=0,Lt=Te.length;qe<Lt/2;qe+=2){const Wt=Te[qe],Yt=Te[qe+1];Te[qe]=Te[Lt-2-qe],Te[qe+1]=Te[Lt-1-qe],Te[Lt-2-qe]=Wt,Te[Lt-1-qe]=Yt}}(Fe,se),Pe.push(Fe)}const Ud={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Xp{constructor(Z,X){const oe=(X=this.options=function(se,we){for(const Fe in we)se[Fe]=we[Fe];return se}(Object.create(Ud),X)).debug;if(oe&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");let ge=function(se,we){const Fe=[];if("FeatureCollection"===se.type)for(let Te=0;Te<se.features.length;Te++)bs(Fe,se.features[Te],we,Te);else bs(Fe,"Feature"===se.type?se:{geometry:se},we);return Fe}(Z,X);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=function(se,we){const Fe=we.buffer/we.extent;let Te=se;const Ie=rs(se,1,-1-Fe,Fe,0,-1,2,we),st=rs(se,1,1-Fe,2+Fe,0,-1,2,we);return(Ie||st)&&(Te=rs(se,1,-Fe,1+Fe,0,-1,2,we)||[],Ie&&(Te=Qa(Ie,1).concat(Te)),st&&(Te=Te.concat(Qa(st,-1)))),Te}(ge,X),ge.length&&this.splitTile(ge,0,0,0),oe&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Z,X,oe,ge,se,we,Fe){const Te=[Z,X,oe,ge],Ie=this.options,st=Ie.debug;for(;Te.length;){ge=Te.pop(),oe=Te.pop(),X=Te.pop(),Z=Te.pop();const qe=1<<X,Lt=Ru(X,oe,ge);let Wt=this.tiles[Lt];if(!Wt&&(st>1&&console.time("creation"),Wt=this.tiles[Lt]=Vd(Z,X,oe,ge,Ie),this.tileCoords.push({z:X,x:oe,y:ge}),st)){st>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,oe,ge,Wt.numFeatures,Wt.numPoints,Wt.numSimplified),console.timeEnd("creation"));const Vn=`z${X}`;this.stats[Vn]=(this.stats[Vn]||0)+1,this.total++}if(Wt.source=Z,null==se){if(X===Ie.indexMaxZoom||Wt.numPoints<=Ie.indexMaxPoints)continue}else{if(X===Ie.maxZoom||X===se)continue;if(null!=se){const Vn=se-X;if(oe!==we>>Vn||ge!==Fe>>Vn)continue}}if(Wt.source=null,0===Z.length)continue;st>1&&console.time("clipping");const Yt=.5*Ie.buffer/Ie.extent,bn=.5-Yt,mn=.5+Yt,un=1+Yt;let _i=null,_n=null,ir=null,Ir=null,Nr=rs(Z,qe,oe-Yt,oe+mn,0,Wt.minX,Wt.maxX,Ie),di=rs(Z,qe,oe+bn,oe+un,0,Wt.minX,Wt.maxX,Ie);Z=null,Nr&&(_i=rs(Nr,qe,ge-Yt,ge+mn,1,Wt.minY,Wt.maxY,Ie),_n=rs(Nr,qe,ge+bn,ge+un,1,Wt.minY,Wt.maxY,Ie),Nr=null),di&&(ir=rs(di,qe,ge-Yt,ge+mn,1,Wt.minY,Wt.maxY,Ie),Ir=rs(di,qe,ge+bn,ge+un,1,Wt.minY,Wt.maxY,Ie),di=null),st>1&&console.timeEnd("clipping"),Te.push(_i||[],X+1,2*oe,2*ge),Te.push(_n||[],X+1,2*oe,2*ge+1),Te.push(ir||[],X+1,2*oe+1,2*ge),Te.push(Ir||[],X+1,2*oe+1,2*ge+1)}}getTile(Z,X,oe){Z=+Z,X=+X,oe=+oe;const ge=this.options,{extent:se,debug:we}=ge;if(Z<0||Z>24)return null;const Fe=1<<Z,Te=Ru(Z,X=X+Fe&Fe-1,oe);if(this.tiles[Te])return Pu(this.tiles[Te],se);we>1&&console.log("drilling down to z%d-%d-%d",Z,X,oe);let Ie,st=Z,qe=X,Lt=oe;for(;!Ie&&st>0;)st--,qe>>=1,Lt>>=1,Ie=this.tiles[Ru(st,qe,Lt)];return Ie&&Ie.source?(we>1&&(console.log("found parent tile z%d-%d-%d",st,qe,Lt),console.time("drilling down")),this.splitTile(Ie.source,st,qe,Lt,Z,X,oe),we>1&&console.timeEnd("drilling down"),this.tiles[Te]?Pu(this.tiles[Te],se):null):null}}function Ru(Pe,Z,X){return 32*((1<<Pe)*X+Z)+Pe}function Qe(Pe,Z){const X=Pe.tileID.canonical;if(!this._geoJSONIndex)return void Z(null,null);const oe=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!oe)return void Z(null,null);const ge=Ie=>Ie.tags&&"3d_elevation_id"in Ie.tags&&"source"in Ie.tags&&"elevation"===Ie.tags.source,se=oe.features.filter(Ie=>ge(Ie));let we={_geojsonTileLayer:oe.features};se.length>0&&(we={_geojsonTileLayer:oe.features.filter(Ie=>!ge(Ie)),hd_road_elevation:se}),Z(null,{vectorTile:new Bl(we),rawData:function(Ie){const st=new d.bq;for(const qe of Object.keys(Ie))st.writeMessage(3,pf,{name:qe,features:Ie[qe]});return st.finish()}(we).buffer})}class el extends ts{constructor(Z,X,oe,ge,se,we,Fe){super(Z,X,oe,ge,se,Qe,Fe),we&&(this.loadGeoJSON=we),this._dynamicIndex=new ff}loadData(Z,X){const oe=Z&&Z.request,ge=oe&&oe.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(Z,(se,we)=>{if(se||!we)return X(se);if("object"!=typeof we)return X(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{try{if(Z.filter){const Te=d.X(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Te.result)throw new Error(Te.value.map(Ie=>`${Ie.key}: ${Ie.message}`).join(", "));we.features=we.features.filter(Ie=>Te.value.evaluate({zoom:0},Ie))}Z.dynamic?("Feature"===we.type&&(we={type:"FeatureCollection",features:[we]}),Z.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(we.features,this.loaded),Z.cluster&&(we.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Z.cluster?new Mo(function({superclusterOptions:Te,clusterProperties:Ie}){if(!Ie||!Te)return Te;const st={},qe={},Lt={accumulated:null,zoom:0},Wt={properties:null},Yt=Object.keys(Ie);for(const bn of Yt){const[mn,un]=Ie[bn],_i=d.X(un),_n=d.X("string"==typeof mn?[mn,["accumulated"],["get",bn]]:mn);st[bn]=_i.value,qe[bn]=_n.value}return Te.map=bn=>{Wt.properties=bn;const mn={};for(const un of Yt)mn[un]=st[un].evaluate(Lt,Wt);return mn},Te.reduce=(bn,mn)=>{Wt.properties=mn;for(const un of Yt)Lt.accumulated=bn[un],bn[un]=qe[un].evaluate(Lt,Wt)},Te}(Z)).load(we.features):Z.dynamic?this._dynamicIndex:new Xp(Te=we,Z.geojsonVtOptions)}catch(Te){return X(Te)}const Fe={};if(ge){const Te=tr(oe);Te&&(Fe.resourceTiming={},Fe.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Te)))}X(null,Fe)}var Te})}reloadTile(Z,X){const oe=this.loaded;return oe&&oe[Z.uid]?Z.partial?X(null,void 0):super.reloadTile(Z,X):this.loadTile(Z,X)}loadGeoJSON(Z,X){if(Z.request)d.n(Z.request,X);else{if("string"!=typeof Z.data)return X(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return X(null,JSON.parse(Z.data))}catch{return X(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(Z,X){try{X(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(oe){X(oe)}}getClusterChildren(Z,X){try{X(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(oe){X(oe)}}getClusterLeaves(Z,X){try{X(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(oe){X(oe)}}}class Yp{constructor(Z,X,oe){this.tileID=new d.aM(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Z.projection,this.brightness=X,this.worldview=oe}parse(Z,X,oe,ge){this.status="parsing";const se=new d.aM(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),we=[],Fe=X.familiesBySource[oe.source],Te=new d.fc(se,oe.promoteId);Te.bucketLayerIDs=[],Te.is3DTile=!0,d.fr(Z).then(Ie=>{if(!Ie)return ge(new Error("Could not parse tile"));const st=Ie.json.extensionsUsed&&Ie.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ie.json.asset.extras&&Ie.json.asset.extras.MAPBOX_mesh_features,qe=Ie.json.extensionsUsed&&Ie.json.extensionsUsed.includes("EXT_meshopt_compression"),Lt=new d.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Wt in Fe)for(const Yt of Fe[Wt]){const bn=Yt[0];Te.bucketLayerIDs.push(Yt.map(_i=>d.C(_i.id,_i.scope))),bn.recalculate(Lt,[]);const mn=d.fs(Ie,1/d.d4(oe.tileID.canonical)),un=new d.ft(Yt,mn,se,st,qe,this.brightness,Te,this.worldview);st||(un.needsUpload=!0),we.push(un),un.evaluate(bn)}this.status="done",ge(null,{buckets:we,featureIndex:Te,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ie=>ge(new Error(Ie.message)))}}class gf{constructor(Z,X,oe,ge,se,we,Fe,Te){this.actor=Z,this.layerIndex=X,this.availableImages=oe,this.availableModels=ge,this.brightness=Fe,this.loading={},this.loaded={},this.worldview=Te}loadTile(Z,X){const oe=Z.uid,ge=this.loading[oe]=new Yp(Z,this.brightness,this.worldview);d.br(Z.request,(se,we)=>{const Fe=!this.loading[oe];return delete this.loading[oe],Fe||se?(ge.status="done",Fe||(this.loaded[oe]=ge),X(se)):we&&0!==we.byteLength?void ge.parse(we,this.layerIndex,Z,(Te,Ie)=>{ge.status="done",this.loaded=this.loaded||{},this.loaded[oe]=ge,Te||!Ie?X(Te):X(null,Ie)}):(ge.status="done",this.loaded[oe]=ge,X())})}reloadTile(Z,X){const oe=this.loaded,ge=Z.uid;if(oe&&oe[ge]){const se=oe[ge];se.projection=Z.projection,se.brightness=Z.brightness;const we=(Fe,Te)=>{se.reloadCallback&&(delete se.reloadCallback,this.loadTile(Z,X)),X(Fe,Te)};"parsing"===se.status?se.reloadCallback=we:"done"===se.status&&this.loadTile(Z,X)}}abortTile(Z,X){const oe=Z.uid;this.loading[oe]&&delete this.loading[oe],X()}removeTile(Z,X){const oe=this.loaded,ge=Z.uid;oe&&oe[ge]&&delete oe[ge],X()}}class Rn{constructor(Z){this.self=Z,this.actor=new d.fv(Z,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new d.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=d.cj({name:"mercator"}),this.workerSourceTypes={vector:ts,geojson:el,"raster-dem":Hi,"raster-array":ro,"batched-model":gf},this.workerSources={},this.self.registerWorkerSource=(X,oe)=>{if(this.workerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.workerSourceTypes[X]=oe},this.self.registerRTLTextPlugin=X=>{if(d.fw.isParsed())throw new Error("RTL text plugin already registered.");d.fw.setState({pluginStatus:d.fx.parsed,pluginURL:d.fw.getPluginURL()}),d.fw.applyArabicShaping=X.applyArabicShaping,d.fw.processBidirectionalText=X.processBidirectionalText,d.fw.processStyledBidirectionalText=X.processStyledBidirectionalText;for(const oe of this.rtlPluginParsingListeners)oe(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Z,X,oe){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.availableModels[Z],delete this.workerSources[Z],oe()}checkIfReady(Z,X,oe){oe()}setReferrer(Z,X){this.referrer=X}spriteLoaded(Z,X){this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={});const{scope:oe,isLoaded:ge}=X;if(this.isSpriteLoaded[Z][oe]=ge,this.workerSources[Z]&&this.workerSources[Z][oe])for(const se in this.workerSources[Z][oe]){const we=this.workerSources[Z][oe][se];for(const Fe in we){const Te=we[Fe];Te instanceof ts&&(Te.isSpriteLoaded=ge,Te.fire(new d.A("isSpriteLoaded")))}}}setImages(Z,X,oe){this.availableImages[Z]||(this.availableImages[Z]={});const{scope:ge,images:se}=X;if(this.availableImages[Z][ge]=se,this.workerSources[Z]&&this.workerSources[Z][ge]){for(const we in this.workerSources[Z][ge]){const Fe=this.workerSources[Z][ge][we];for(const Te in Fe)Fe[Te].availableImages=se}oe()}else oe()}setModels(Z,{scope:X,models:oe},ge){if(this.availableModels[Z]||(this.availableModels[Z]={}),this.availableModels[Z][X]=oe,this.workerSources[Z]&&this.workerSources[Z][X]){for(const se in this.workerSources[Z][X]){const we=this.workerSources[Z][X][se];for(const Fe in we)we[Fe].availableModels=oe}ge()}else ge()}setProjection(Z,X){this.projections[Z]=d.cj(X)}setBrightness(Z,X,oe){this.brightness=X,oe()}setWorldview(Z,X,oe){this.worldview=X,oe()}setLayers(Z,X,oe){this.getLayerIndex(Z,X.scope).replace(X.layers,X.options),oe()}updateLayers(Z,X,oe){this.getLayerIndex(Z,X.scope).update(X.layers,X.removedIds,X.options),oe()}loadTile(Z,X,oe){X.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,X.type,X.source,X.scope).loadTile(X,oe)}decodeRasterArray(Z,X,oe){this.getWorkerSource(Z,X.type,X.source,X.scope).decodeRasterArray(X,oe)}reloadTile(Z,X,oe){X.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,X.type,X.source,X.scope).reloadTile(X,oe)}abortTile(Z,X,oe){this.getWorkerSource(Z,X.type,X.source,X.scope).abortTile(X,oe)}removeTile(Z,X,oe){this.getWorkerSource(Z,X.type,X.source,X.scope).removeTile(X,oe)}removeSource(Z,X,oe){if(!(this.workerSources[Z]&&this.workerSources[Z][X.scope]&&this.workerSources[Z][X.scope][X.type]&&this.workerSources[Z][X.scope][X.type][X.source]))return;const ge=this.workerSources[Z][X.scope][X.type][X.source];delete this.workerSources[Z][X.scope][X.type][X.source],void 0!==ge.removeSource?ge.removeSource(X,oe):oe()}loadWorkerSource(Z,X,oe){try{this.self.importScripts(X.url),oe()}catch(ge){oe(ge.toString())}}syncRTLPluginState(Z,X,oe){if(d.fw.isParsed())oe(null,!0);else if(d.fw.isParsing())this.rtlPluginParsingListeners.push(oe);else try{d.fw.setState(X);const ge=d.fw.getPluginURL();!d.fw.isLoaded()||d.fw.isParsed()||d.fw.isParsing()||null==ge||(d.fw.setState({pluginStatus:d.fx.parsing,pluginURL:d.fw.getPluginURL()}),this.self.importScripts(ge),d.fw.isParsed()?oe(null,!0):this.rtlPluginParsingListeners.push(oe))}catch(ge){oe(ge.toString())}}setDracoUrl(Z,X){this.dracoUrl=X}getAvailableImages(Z,X){this.availableImages[Z]||(this.availableImages[Z]={});let oe=this.availableImages[Z][X];return oe||(oe=[]),oe}getAvailableModels(Z,X){this.availableModels[Z]||(this.availableModels[Z]={});let oe=this.availableModels[Z][X];return oe||(oe={}),oe}getLayerIndex(Z,X){this.layerIndexes[Z]||(this.layerIndexes[Z]={});let oe=this.layerIndexes[Z][X];return oe||(oe=this.layerIndexes[Z][X]=new Nd,oe.scope=X),oe}getWorkerSource(Z,X,oe,ge){const se=this.workerSources;return se[Z]||(se[Z]={}),se[Z][ge]||(se[Z][ge]={}),se[Z][ge][X]||(se[Z][ge][X]={}),this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),se[Z][ge][X][oe]||(se[Z][ge][X][oe]=new this.workerSourceTypes[X]({send:(we,Fe,Te,Ie,st,qe)=>this.actor.send(we,Fe,Te,Z,st,qe),scheduler:this.actor.scheduler},this.getLayerIndex(Z,ge),this.getAvailableImages(Z,ge),this.getAvailableModels(Z,ge),this.isSpriteLoaded[Z][ge],void 0,this.brightness,this.worldview)),se[Z][ge][X][oe]}rasterizeImagesWorker(Z,X,oe){const ge=new Map;for(const[se,{image:we,imageVariant:Fe}]of X.tasks.entries()){const Te=this.imageRasterizer.rasterize(Fe,we,X.scope,Z);ge.set(se,Te)}oe(void 0,ge)}removeRasterizedImages(Z,X,oe){this.imageRasterizer.removeImagesFromCacheByIds(X.imageIds,X.scope,Z),oe()}enforceCacheSizeLimit(Z,X){d.fy(X)}getWorkerPerformanceMetrics(Z,X,oe){oe(void 0,void 0)}}return d.fu(self)&&(self.worker=new Rn(self)),Rn}),n_(0,function(d){var tr="3.14.0";const Ui={create:"create",load:"load",fullLoad:"fullLoad"},Da={mark(f){performance.mark(f)},measure(f,r,l){performance.measure(f,r,l)}};function Nd(f){const r=f.name.split("?")[0];return d.a(r)&&r.includes("mapbox-gl.js")?"javascript":d.a(r)&&r.includes("mapbox-gl.css")?"css":d.b(r)?"fontRange":d.c(r)?"sprite":d.i(r)?"style":d.d(r)?"tilejson":"other"}var ks,Fs={},Nl=function(){if(ks)return Fs;function f(p){return!r(p)}function r(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,b,C=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(C);try{b=new Worker(D),v=!0}catch{v=!1}return b&&b.terminate(),URL.revokeObjectURL(D),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var b=v.getContext("2d");if(!b)return!1;var C=b.getImageData(0,0,1,1);return C&&C.width===v.width}()?(void 0===l[y=p&&p.failIfMajorPerformanceCaveat]&&(l[y]=function(v){var b,D,R,O,C=(D=v,R=document.createElement("canvas"),(O=Object.create(f.webGLContextAttributes)).failIfMajorPerformanceCaveat=D,R.getContext("webgl2",O));if(!C)return!1;try{b=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!b||C.isContextLost())&&(C.shaderSource(b,"void main() {}"),C.compileShader(b),!0===C.getShaderParameter(b,C.COMPILE_STATUS))}(y)),l[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}ks=1,Fs.supported=f,Fs.notSupportedReason=r;var l={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Fs}();function pn(f,r,l){const p=document.createElement(f);return null!=r&&(p.className=r),l&&l.appendChild(p),p}function ts(f,r,l){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(r))p.setAttributeNS(null,y,String(r[y]));return l&&l.appendChild(p),p}const Hi=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Uo=Hi&&void 0!==Hi.userSelect?"userSelect":"WebkitUserSelect";let ro;function vs(){Hi&&Uo&&(ro=Hi[Uo],Hi[Uo]="none")}function Zs(){Hi&&Uo&&(Hi[Uo]=ro)}function zl(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",zl,!0)}function Bl(){window.addEventListener("click",zl,!0),window.setTimeout(()=>{window.removeEventListener("click",zl,!0)},0)}function da(f,r){const l=f.getBoundingClientRect();return Un(f,l,r)}function Ia(f,r){const l=f.getBoundingClientRect(),p=[];for(let y=0;y<r.length;y++)p.push(Un(f,l,r[y]));return p}function ff(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&2===f.button&&f.ctrlKey?0:f.button}function Un(f,r,l){const p=f.offsetWidth===r.width?1:f.offsetWidth/r.width;return new d.P((l.clientX-r.left)*p,(l.clientY-r.top)*p)}const Wa="01",go="NO_ACCESS_TOKEN";class gr{constructor(r,l,p){this._transformRequestFn=r,this._customAccessToken=l,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const r=function(){let l="";for(let p=0;p<10;p++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Wa,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,l){return this._transformRequestFn&&this._transformRequestFn(r,l)||{url:r}}normalizeStyleURL(r,l){if(!d.j(r))return r;const p=ki(r);return p.params.push(`sdk=js-${tr}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeGlyphsURL(r,l){if(!d.j(r))return r;const p=ki(r);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeModelURL(r,l){if(!d.j(r))return r;const p=ki(r);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||l)}normalizeSourceURL(r,l,p,y){if(!d.j(r))return r;const v=ki(r);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),p&&v.params.push(`language=${p}`),y&&v.params.push(`worldview=${y}`),this._makeAPIURL(v,this._customAccessToken||l)}normalizeIconsetURL(r,l){const p=ki(r);return d.j(r)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||l)):oo(p)}normalizeSpriteURL(r,l,p,y){const v=ki(r);return d.j(r)?(v.path=`/styles/v1${v.path}/sprite${l}${p}`,this._makeAPIURL(v,this._customAccessToken||y)):(v.path+=`${l}${p}`,oo(v))}normalizeTileURL(r,l,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!d.j(r))return r;const y=ki(r);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||p&&"raster"!==y.authority&&512===p?"@2x":""}${d.l.supported?".webp":"$1"}`),"raster"===y.authority?y.path=`/${d.e.RASTER_URL_PREFIX}${y.path}`:"rasterarrays"===y.authority?y.path=`/${d.e.RASTERARRAYS_URL_PREFIX}${y.path}`:"3dtiles"===y.authority?y.path=`/${d.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${d.e.TILE_URL_VERSION}${y.path}`);const v=this._customAccessToken||function(b){for(const C of b){const D=C.match(/^access_token=(.*)$/);if(D)return D[1]}return null}(y.params)||d.e.ACCESS_TOKEN;return d.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,v)}canonicalizeTileURL(r,l){const p=ki(r);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return r;let y="mapbox://";p.path.match(/^\/raster\/v1\//)?y+=`raster/${p.path.replace(`/${d.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${p.path.replace(`/${d.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${p.path.replace(`/${d.e.TILE_URL_VERSION}/`,"")}`;let v=p.params;return l&&(v=v.filter(b=>!b.match(/^access_token=/))),v.length&&(y+=`?${v.join("&")}`),y}canonicalizeTileset(r,l){const p=!!l&&d.j(l),y=[];for(const v of r.tiles||[])d.k(v)?y.push(this.canonicalizeTileURL(v,p)):y.push(v);return y}_makeAPIURL(r,l){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=ki(d.e.API_URL);if(r.protocol=y.protocol,r.authority=y.authority,"http"===r.protocol){const v=r.params.indexOf("secure");v>=0&&r.params.splice(v,1)}if("/"!==y.path&&(r.path=`${y.path}${r.path}`),!d.e.REQUIRE_ACCESS_TOKEN)return oo(r);if(l=l||d.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if("s"===l[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return r.params=r.params.filter(v=>-1===v.indexOf("access_token")),r.params.push(`access_token=${l||""}`),oo(r)}}const _r=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ki(f){const r=f.match(_r);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function oo(f){const r=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${r}`}const pf="mapbox.eventData";function Aa(f){if(!f)return null;const r=f.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(d.m(r[1]))}catch{return null}}class Vi{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const l=Aa(d.e.ACCESS_TOKEN);let p="";return p=l&&l.u?d.f(l.u):d.e.ACCESS_TOKEN||"",r?`${pf}.${r}:${p}`:`${pf}:${p}`}fetchEventData(){const r=d.s("localStorage"),l=this.getStorageKey(),p=this.getStorageKey("uuid");if(r)try{const y=localStorage.getItem(l);y&&(this.eventData=JSON.parse(y));const v=localStorage.getItem(p);v&&(this.anonId=v)}catch{d.w("Unable to read from LocalStorage")}}saveEventData(){const r=d.s("localStorage"),l=this.getStorageKey(),p=this.getStorageKey("uuid"),y=this.anonId;if(r&&y)try{localStorage.setItem(p,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData))}catch{d.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,l,p,y){if(!d.e.EVENTS_URL)return;const v=ki(d.e.EVENTS_URL);v.params.push(`access_token=${y||d.e.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(r).toISOString()},C=l?d.h(b,l):b,D={url:oo(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=d.p(D,R=>{this.pendingRequest=null,p(R),this.saveEventData(),this.processRequests(y)})}queueRequest(r,l){this.queue.push(r),this.processRequests(l)}}const Fi=new class extends Vi{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,r){d.e.EVENTS_URL&&d.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(l=>d.j(l)||d.k(l))&&this.queueRequest(Date.now(),r)}processRequests(f){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Aa(d.e.ACCESS_TOKEN),l=r?r.u:d.e.ACCESS_TOKEN;let p=l!==this.eventData.tokenU;d.v(this.anonId)||(this.anonId=d.u(),p=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),b=new Date(y),C=(y-this.eventData.lastSuccess)/864e5;p=p||C>=1||C<-1||v.getDate()!==b.getDate()}else p=!0;p?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:tr,skuId:Wa,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=y,this.eventData.tokenU=l)},f):this.processRequests()}},Ho=Fi.postTurnstileEvent.bind(Fi),Iu=new class extends Vi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,r,l,p){this.skuToken=r,this.errorCb=p,d.e.EVENTS_URL&&(l||d.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},l):this.errorCb(new Error(go)))}processRequests(f){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),d.v(this.anonId)||(this.anonId=d.u()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:tr,skuId:Wa,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},f))}remove(){this.errorCb=null}},mf=Iu.postMapLoadEvent.bind(Iu),Gi=new class extends Vi{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let r=this.mapInstanceIdMap.get(f);return r||(r=d.u(),this.mapInstanceIdMap.set(f,r)),r}getEventId(f){const r=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,r+1),r}postStyleLoadEvent(f,r){const{map:l,style:p,importedStyles:y}=r;if(!d.e.EVENTS_URL||!f&&!d.e.ACCESS_TOKEN)return;const v=this.getMapInstanceId(l),b={mapInstanceId:v,eventId:this.getEventId(v),style:p};y.length&&(b.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:b},f)}processRequests(f){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:r,payload:l}=this.queue.shift();this.postEvent(r,l,()=>{},f)}},Mi=Gi.postStyleLoadEvent.bind(Gi),ar=new class extends Vi{constructor(){super("gljs.performance")}postPerformanceEvent(f,r){d.e.EVENTS_URL&&(f||d.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},f)}processRequests(f){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:r,performanceData:l}=this.queue.shift(),p=function(y){const v=performance.getEntriesByType("resource"),b=performance.getEntriesByType("mark"),C=function(B){const H={};if(B)for(const U in B)if("other"!==U)for(const q of B[U]){const $=`${U}ResolveRangeMin`,K=`${U}ResolveRangeMax`,ee=`${U}RequestCount`,ne=`${U}RequestCachedCount`;H[$]=Math.min(H[$]||1/0,q.startTime),H[K]=Math.max(H[K]||-1/0,q.responseEnd);const le=de=>{void 0===H[de]&&(H[de]=0),++H[de]};void 0!==q.transferSize&&0===q.transferSize&&le(ne),le(ee)}return H}(function(B,H){const U={};if(B)for(const q of B){const $=H(q);void 0===U[$]&&(U[$]=[]),U[$].push(q)}return U}(v,Nd)),D=window.devicePixelRatio,R=navigator.connection||navigator.mozConnection||navigator.webkitConnection,O=R?R.effectiveType:void 0,N={counters:[],metadata:[],attributes:[]},k=(B,H,U)=>{null!=U&&B.push({name:H,value:U.toString()})};for(const B in C)k(N.counters,B,C[B]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(k(N.counters,"interactionRangeMin",y.interactionRange[0]),k(N.counters,"interactionRangeMax",y.interactionRange[1])),b)for(const B of Object.keys(Ui)){const H=Ui[B],U=b.find(q=>q.name===H);U&&k(N.counters,H,U.startTime)}return k(N.counters,"visibilityHidden",y.visibilityHidden),k(N.attributes,"style",function(B){if(B)for(const H of B){const U=H.name.split("?")[0];if(d.i(U)){const q=U.split("/").slice(-2);if(2===q.length)return`mapbox://styles/${q[0]}/${q[1]}`}}}(v)),k(N.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),k(N.attributes,"fogEnabled",y.fogEnabled?"true":"false"),k(N.attributes,"projection",y.projection),k(N.attributes,"zoom",y.zoom),k(N.metadata,"devicePixelRatio",D),k(N.metadata,"connectionEffectiveType",O),k(N.metadata,"navigatorUserAgent",navigator.userAgent),k(N.metadata,"screenWidth",window.screen.width),k(N.metadata,"screenHeight",window.screen.height),k(N.metadata,"windowWidth",window.innerWidth),k(N.metadata,"windowHeight",window.innerHeight),k(N.metadata,"mapWidth",y.width/D),k(N.metadata,"mapHeight",y.height/D),k(N.metadata,"webglRenderer",y.renderer),k(N.metadata,"webglVendor",y.vendor),k(N.metadata,"sdkVersion",tr),k(N.metadata,"sdkIdentifier","mapbox-gl-js"),N}(l);for(const y of p.metadata);for(const y of p.counters);for(const y of p.attributes);this.postEvent(r,p,()=>{},f)}},gi=ar.postPerformanceEvent.bind(ar),nr=new class extends Vi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,r,l,p){if(!d.e.API_URL||!d.e.SESSION_PATH)return;const y=ki(d.e.API_URL+d.e.SESSION_PATH);y.params.push(`sku=${r||""}`),y.params.push(`access_token=${p||d.e.ACCESS_TOKEN||""}`);const v={url:oo(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=d.g(v,b=>{this.pendingRequest=null,l(b),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,r,l,p){this.skuToken=r,this.errorCb=p,d.e.SESSION_PATH&&d.e.API_URL&&(l||d.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},l):this.errorCb(new Error(go)))}processRequests(f){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||this.getSession(l,this.skuToken,p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},f)}remove(){this.errorCb=null}},lr=nr.getSessionAPI.bind(nr),Mo=new Set;function Ma(f,r){r?Mo.add(f):Mo.delete(f)}class zd{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,l){this._updatedSourceCaches[r]=l,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const l=r.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(r.id),this.setDirty()}removeLayer(r){const l=r.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][r.id]=r,this._updatedLayers[l].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const l in this._updatedLayers)r[l]=r[l]||{},r[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)r[l]=r[l]||{},r[l].removedIds=Object.keys(this._removedLayers[l]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(r){return this._updatedImages[r]?Array.from(this._updatedImages[r].values()):[]}updateImage(r,l){this._updatedImages[l]=this._updatedImages[l]||new Set,this._updatedImages[l].add(d.I.toString(r)),this.setDirty()}resetUpdatedImages(r){this._updatedImages[r]&&this._updatedImages[r].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function xs(f){const{userImage:r}=f;return!!(r&&r.render&&r.render())&&(f.data.replace(new Uint8Array(r.data.buffer)),!0)}class cr extends d.E{constructor(r){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=r,"raster"!==r&&d.t()&&(this.imageRasterizerDispatcher=new d.D(d.x(),this,"Image Rasterizer Worker",1))}addScope(r){this.loaded.set(r,!1),this.imageProviders.set(r,new Map),this.images.set(r,new Map),this.updatedImages.set(r,new Set),this.callbackDispatchedThisFrame.set(r,new Set),this.patterns.set(r,new Map),this.atlasImage.set(r,new d.r({width:1,height:1}))}removeScope(r){this.loaded.delete(r),this.imageProviders.delete(r),this.images.delete(r),this.updatedImages.delete(r),this.callbackDispatchedThisFrame.delete(r),this.patterns.delete(r),this.atlasImage.delete(r);const l=this.atlasTexture.get(r);l&&(l.destroy(),this.atlasTexture.delete(r))}addImageProvider(r,l){this.imageProviders.has(l)||this.imageProviders.set(l,new Map),this.imageProviders.get(l).set(r.id,r)}removeImageProvider(r,l){this.imageProviders.has(l)&&this.imageProviders.get(l).delete(r)}getPendingImageProviders(){const r=[];for(const l of this.imageProviders.values())for(const p of l.values())p.hasPendingRequests()&&r.push(p);return r}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new d.y),this._imageRasterizer}isLoaded(){for(const r of this.loaded.keys())if(!this.loaded.get(r))return!1;return!0}setLoaded(r,l){if(this.loaded.get(l)!==r&&(this.loaded.set(l,r),r)){for(const{ids:p,callback:y}of this.requestors)this._notify(p,l,y);this.requestors=[]}}hasImage(r,l){return!!this.getImage(r,l)}getImage(r,l){return this.images.get(l).get(r.toString())}addImage(r,l,p){this._validate(r,p)&&this.images.get(l).set(r.toString(),p)}_validate(r,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new d.z(new Error(`Image "${r.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new d.z(new Error(`Image "${r.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new d.z(new Error(`Image "${r.name}" has invalid "content" value`))),p=!1),p}_validateStretch(r,l){if(!r)return!0;let p=0;for(const y of r){if(y[0]<p||y[1]<y[0]||l<y[1])return!1;p=y[1]}return!0}_validateContent(r,l){return!r||!(4!==r.length||!l.usvg&&(r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]))&&!(r[2]<r[0]||r[3]<r[1])}updateImage(r,l,p){const y=this.images.get(l).get(r.toString());p.version=y.version+1,this.images.get(l).set(r.toString(),p),this.updatedImages.get(l).add(r),this.removeFromImageRasterizerCache(r,l)}clearUpdatedImages(r){this.updatedImages.get(r).clear()}removeFromImageRasterizerCache(r,l){"raster"!==this.spriteFormat&&(d.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[r],scope:l}):this.imageRasterizer.removeImagesFromCacheByIds([r],l))}removeImage(r,l){const p=this.images.get(l),y=p.get(r.toString());p.delete(r.toString()),this.patterns.get(l).delete(r.toString()),this.removeFromImageRasterizerCache(r,l),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(r){return Array.from(this.images.get(r).keys()).map(l=>d.I.from(l))}getImages(r,l,p){const y=[],v=[],b=this.imageProviders.get(l);for(const O of r){if(!O.iconsetId){y.push(O);continue}const N=b.get(O.iconsetId);N&&(this.getImage(O,l)?v.push(O):N.addPendingRequest(O))}if(0===y.length)return void this._notify(v,l,p);let C=!0;const D=!!this.loaded.get(l),R=this.images.get(l);if(!D)for(const O of y)R.has(O.toString())||(C=!1);D||C?this._notify(y,l,p):this.requestors.push({ids:y,scope:l,callback:p})}rasterizeImages(r,l){const p=new Map,{tasks:y,scope:v}=r;for(const[b,C]of y.entries()){const D=this.getImage(C.id,v);D&&p.set(b,{image:D,imageVariant:C})}this._rasterizeImages(v,p,l)}_rasterizeImages(r,l,p){if(d.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:l,scope:r},p);else{const y=new Map;for(const[v,{image:b,imageVariant:C}]of l.entries())y.set(v,this.imageRasterizer.rasterize(C,b,r,0));p(void 0,y)}}getUpdatedImages(r){return this.updatedImages.get(r)||new Set}_notify(r,l,p){const y=this.images.get(l),v=new Map;for(const b of r){if(!y.get(b.toString())){if(b.iconsetId)continue;this.fire(new d.A("styleimagemissing",{id:b.name}))}const C=y.get(b.toString());if(!C){d.w(`Image "${b.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const D={data:C.usvg?null:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,usvg:C.usvg,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!(!C.userImage||!C.userImage.render)};C.usvg&&Object.assign(D,{width:C.icon.usvg_tree.width,height:C.icon.usvg_tree.height}),v.set(d.I.toString(b),D)}p(null,v)}getPixelSize(r){const{width:l,height:p}=this.atlasImage.get(r);return{width:l,height:p}}getPattern(r,l,p){const y=r.toString(),v=this.patterns.get(l),b=v.get(y),C=this.getImage(r,l);if(!C)return null;if(b){if(b.position.version===C.version)return b.position;b.position.version=C.version}else{if(C.usvg&&!C.data){const D=this.getPatternInFlightId(y,l);if(this.patternsInFlight.has(D))return null;this.patternsInFlight.add(D);const R=new d.B(r).scaleSelf(d.q.devicePixelRatio),O=new Map([[R.toString(),{image:C,imageVariant:R}]]);return this._rasterizeImages(l,O,(N,k)=>this.storePatternImage(R,l,C,p,k)),null}this.storePattern(r,l,C)}return this._updatePatternAtlas(l,p),v.get(y).position}getPatternInFlightId(r,l){return d.C(r,l)}hasPatternsInFlight(){return 0!==this.patternsInFlight.size}storePatternImage(r,l,p,y,v){const b=r.toString(),C=v?v.get(b):void 0;C&&(p.data=C,this.storePattern(r.id,l,p),this._updatePatternAtlas(l,y),this.patternsInFlight.delete(this.getPatternInFlightId(r.id.toString(),l)))}storePattern(r,l,p){const y={w:p.data.width+2*d.F,h:p.data.height+2*d.F,x:0,y:0},v=new d.G(y,p,d.F);this.patterns.get(l).set(r.toString(),{bin:y,position:v})}destroyAtlasTextures(){for(const r of this.atlasTexture.values())r&&r.destroy();this.atlasTexture.clear()}bind(r,l){const p=r.gl;let y=this.atlasTexture.get(l);y?this.dirty&&(y.update(this.atlasImage.get(l)),this.dirty=!1):(y=new d.T(r,this.atlasImage.get(l),p.RGBA8),this.atlasTexture.set(l,y)),y.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(r,l){const p=this.patterns.get(r),y=Array.from(p.values()).map(({bin:R})=>R),{w:v,h:b}=d.H(y),C=this.atlasImage.get(r);C.resize({width:v||1,height:b||1});const D=this.images.get(r);for(const[R,{bin:O,position:N}]of p.entries()){let k=N.padding;const B=O.x+k,H=O.y+k,U=D.get(R).data,q=U.width,$=U.height;k=k>1?k-1:k,d.r.copy(U,C,{x:0,y:0},{x:B,y:H},{width:q,height:$},l),d.r.copy(U,C,{x:0,y:$-k},{x:B,y:H-k},{width:q,height:k},l),d.r.copy(U,C,{x:0,y:0},{x:B,y:H+$},{width:q,height:k},l),d.r.copy(U,C,{x:q-k,y:0},{x:B-k,y:H},{width:k,height:$},l),d.r.copy(U,C,{x:0,y:0},{x:B+q,y:H},{width:k,height:$},l),d.r.copy(U,C,{x:q-k,y:$-k},{x:B-k,y:H-k},{width:k,height:k},l),d.r.copy(U,C,{x:0,y:$-k},{x:B+q,y:H-k},{width:k,height:k},l),d.r.copy(U,C,{x:0,y:0},{x:B+q,y:H+$},{width:k,height:k},l),d.r.copy(U,C,{x:q-k,y:0},{x:B-k,y:H+$},{width:k,height:k},l)}this.dirty=!0}beginFrame(){for(const r of this.images.keys())this.callbackDispatchedThisFrame.set(r,new Set)}dispatchRenderCallbacks(r,l){const p=this.images.get(l);for(const y of r){if(this.callbackDispatchedThisFrame.get(l).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(l).add(y.toString());const v=p.get(y.toString());xs(v)&&this.updateImage(y,l,v)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function ns(f){const r=f.key,l=f.value,p=f.valueSpec||{},y=f.objectElementValidators||{},v=f.style,b=f.styleSpec;let C=[];const D=d.J(l);if("object"!==D)return[new d.V(r,l,`object expected, ${D} found`)];for(const R in l){const O=R.split(".")[0];let N;y[O]?N=y[O]:p[O]?N=Ci:y["*"]?N=y["*"]:p["*"]&&(N=Ci),N?C=C.concat(N({key:(r&&`${r}.`)+R,value:l[R],valueSpec:p[O]||p["*"],style:v,styleSpec:b,object:l,objectKey:R},l)):C.push(new d.K(r,l[R],`unknown property "${R}"`))}for(const R in p)y[R]||p[R].required&&void 0===p[R].default&&void 0===l[R]&&C.push(new d.V(r,l,`missing required property "${R}"`));return C}function Vl(f){const r=f.value,l=f.valueSpec,p=f.style,y=f.styleSpec,v=f.key,b=f.arrayElementValidator||Ci;if("array"!==d.J(r))return[new d.V(v,r,`array expected, ${d.J(r)} found`)];if(l.length&&r.length!==l.length)return[new d.V(v,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new d.V(v,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let C={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};y.$version<7&&(C.function=l.function),"object"===d.J(l.value)&&(C=l.value);let D=[];for(let R=0;R<r.length;R++)D=D.concat(b({array:r,arrayIndex:R,value:r[R],valueSpec:C,style:p,styleSpec:y,key:`${v}[${R}]`},!0));return D}function Bd(f){const r=f.key,l=f.value,p=f.valueSpec;let y=d.J(l);if("number"===y&&l!=l&&(y="NaN"),"number"!==y)return[new d.V(r,l,`number expected, ${y} found`)];if("minimum"in p){let v=p.minimum;if("array"===d.J(p.minimum)&&(v=p.minimum[f.arrayIndex]),l<v)return[new d.V(r,l,`${l} is less than the minimum value ${v}`)]}if("maximum"in p){let v=p.maximum;if("array"===d.J(p.maximum)&&(v=p.maximum[f.arrayIndex]),l>v)return[new d.V(r,l,`${l} is greater than the maximum value ${v}`)]}return[]}function Za(f){const r=f.valueSpec,l=d.M(f.value.type);let p,y,v,b={};const C="categorical"!==l&&void 0===f.value.property,D=!C,R="array"===d.J(f.value.stops)&&"array"===d.J(f.value.stops[0])&&"object"===d.J(f.value.stops[0][0]),O=ns({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(B){if("identity"===l)return[new d.V(B.key,B.value,'identity function may not have a "stops" property')];let H=[];const U=B.value;return H=H.concat(Vl({key:B.key,value:U,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:N})),"array"===d.J(U)&&0===U.length&&H.push(new d.V(B.key,U,"array must have at least one stop")),H},default:function(B){return Ci({key:B.key,value:B.value,valueSpec:r,style:B.style,styleSpec:B.styleSpec})}}});return"identity"===l&&C&&O.push(new d.V(f.key,f.value,'missing required property "property"')),"identity"===l||f.value.stops||O.push(new d.V(f.key,f.value,'missing required property "stops"')),"exponential"===l&&f.valueSpec.expression&&!d.N(f.valueSpec)&&O.push(new d.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(D&&!d.O(f.valueSpec)?O.push(new d.V(f.key,f.value,"property functions not supported")):C&&!d.Q(f.valueSpec)&&O.push(new d.V(f.key,f.value,"zoom functions not supported"))),"categorical"!==l&&!R||void 0!==f.value.property||O.push(new d.V(f.key,f.value,'"property" property is required')),O;function N(B){let H=[];const U=B.value,q=B.key;if("array"!==d.J(U))return[new d.V(q,U,`array expected, ${d.J(U)} found`)];if(2!==U.length)return[new d.V(q,U,`array length 2 expected, length ${U.length} found`)];if(R){if("object"!==d.J(U[0]))return[new d.V(q,U,`object expected, ${d.J(U[0])} found`)];if(void 0===U[0].zoom)return[new d.V(q,U,"object stop key must have zoom")];if(void 0===U[0].value)return[new d.V(q,U,"object stop key must have value")];const $=d.M(U[0].zoom);if("number"!=typeof $)return[new d.V(q,U[0].zoom,"stop zoom values must be numbers")];if(v&&v>$)return[new d.V(q,U[0].zoom,"stop zoom values must appear in ascending order")];$!==v&&(v=$,y=void 0,b={}),H=H.concat(ns({key:`${q}[0]`,value:U[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Bd,value:k}}))}else H=H.concat(k({key:`${q}[0]`,value:U[0],style:B.style,styleSpec:B.styleSpec},U));return d.S(d.U(U[1]))?H.concat([new d.V(`${q}[1]`,U[1],"expressions are not allowed in function stops.")]):H.concat(Ci({key:`${q}[1]`,value:U[1],valueSpec:r,style:B.style,styleSpec:B.styleSpec}))}function k(B,H){const U=d.J(B.value),q=d.M(B.value),$=null!==B.value?B.value:H;if(p){if(U!==p)return[new d.V(B.key,$,`${U} stop domain type must match previous stop domain type ${p}`)]}else p=U;if("number"!==U&&"string"!==U&&"boolean"!==U&&"number"!=typeof q&&"string"!=typeof q&&"boolean"!=typeof q)return[new d.V(B.key,$,"stop domain value must be a number, string, or boolean")];if("number"!==U&&"categorical"!==l){let K=`number expected, ${U} found`;return d.O(r)&&void 0===l&&(K+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new d.V(B.key,$,K)]}return"categorical"!==l||"number"!==U||"number"==typeof q&&isFinite(q)&&Math.floor(q)===q?"categorical"!==l&&"number"===U&&"number"==typeof q&&"number"==typeof y&&void 0!==y&&q<y?[new d.V(B.key,$,"stop domain values must appear in ascending order")]:(y=q,"categorical"===l&&q in b?[new d.V(B.key,$,"stop domain values must be unique")]:(b[q]=!0,[])):[new d.V(B.key,$,`integer expected, found ${String(q)}`)]}}function Ls(f){const r=("property"===f.expressionContext?d.W:d.X)(d.U(f.value),f.valueSpec);if("error"===r.result)return r.value.map(p=>new d.V(`${f.key}${p.key}`,f.value,p.message));const l=r.value.expression||r.value._styleExpression.expression;if("property"===f.expressionContext&&"text-font"===f.propertyKey&&!l.outputDefined())return[new d.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===f.expressionContext&&"layout"===f.propertyType&&!d.Y(l))return[new d.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===f.expressionContext)return bs(l,f);if(f.expressionContext&&0===f.expressionContext.indexOf("cluster")){if(!d.Z(l,["zoom","feature-state"]))return[new d.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===f.expressionContext&&!d._(l))return[new d.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bs(f,r){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const y of r.valueSpec.expression.parameters)l.delete(y);if(0===l.size)return[];const p=[];return f instanceof d.$&&l.has(f.name)?[new d.V(r.key,r.value,`["${f.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(f.eachChild(y=>{p.push(...bs(y,r))}),p)}function Xa(f){const r=f.key,l=f.value,p=f.valueSpec,y=[];return Array.isArray(p.values)?-1===p.values.indexOf(d.M(l))&&y.push(new d.V(r,l,`expected one of [${p.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(p.values).indexOf(d.M(l))&&y.push(new d.V(r,l,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(l)} found`)),y}function Pa(f){return d.a1(d.U(f.value))?Ls(d.L({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Cc(f)}function Cc(f){const r=f.value,l=f.key;if("array"!==d.J(r))return[new d.V(l,r,`array expected, ${d.J(r)} found`)];const p=f.styleSpec;let y,v=[];if(r.length<1)return[new d.V(l,r,"filter array must have at least 1 element")];switch(v=v.concat(Xa({key:`${l}[0]`,value:r[0],valueSpec:p.filter_operator,style:f.style,styleSpec:f.styleSpec})),d.M(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===d.M(r[1])&&v.push(new d.V(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&v.push(new d.V(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(y=d.J(r[1]),"string"!==y&&v.push(new d.V(`${l}[1]`,r[1],`string expected, ${y} found`)));for(let b=2;b<r.length;b++)y=d.J(r[b]),"$type"===d.M(r[1])?v=v.concat(Xa({key:`${l}[${b}]`,value:r[b],valueSpec:p.geometry_type,style:f.style,styleSpec:f.styleSpec})):"string"!==y&&"number"!==y&&"boolean"!==y&&v.push(new d.V(`${l}[${b}]`,r[b],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let b=1;b<r.length;b++)v=v.concat(Cc({key:`${l}[${b}]`,value:r[b],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":y=d.J(r[1]),2!==r.length?v.push(new d.V(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==y&&v.push(new d.V(`${l}[1]`,r[1],`string expected, ${y} found`))}return v}function jl(f,r){const l=f.key,p=f.style,y=f.layer,v=f.styleSpec,b=f.value,C=f.objectKey,D=v[`${r}_${f.layerType}`];if(!D)return[];const R=C.match(/^(.*)-use-theme$/);if("paint"===r&&R&&D[R[1]])return d.S(b)?[].concat(Ci({key:f.key,value:b,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:v,expressionContext:"property",propertyType:r,propertyKey:C})):Ci({key:l,value:b,valueSpec:{type:"string"},style:p,styleSpec:v});const O=C.match(/^(.*)-transition$/);if("paint"===r&&O&&D[O[1]]&&D[O[1]].transition)return Ci({key:l,value:b,valueSpec:v.transition,style:p,styleSpec:v});const N=f.valueSpec||D[C];if(!N)return[new d.K(l,b,`unknown property "${C}"`)];let k;if("string"===d.J(b)&&d.O(N)&&!N.tokens&&(k=/^{([^}]+)}$/.exec(b))){const H=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new d.V(l,b,`"${C}" does not support interpolation syntax\nUse an identity property function instead: ${H}.`)]}const B=[];if("symbol"===f.layerType)"text-field"!==C||!p||p.glyphs||p.imports||B.push(new d.V(l,b,'use of "text-field" requires a style "glyphs" property')),"text-font"===C&&d.a2(d.U(b))&&"identity"===d.M(b.type)&&B.push(new d.V(l,b,'"text-font" does not support identity functions'));else if("model"===f.layerType&&"paint"===r&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&d.O(N)&&(d.a3(N)||d.Q(N))){const H=d.W(d.U(b),N),U=H.value.expression||H.value._styleExpression.expression;U&&!d.Z(U,["measure-light"])&&("model-emissive-strength"===C&&d._(U)&&d.Y(U)||B.push(new d.V(l,b,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return B.concat(Ci({key:f.key,value:b,valueSpec:N,style:p,styleSpec:v,expressionContext:"property",propertyType:r,propertyKey:C}))}function is(f){return jl(f,"paint")}function rs(f){return jl(f,"layout")}function Au(f){let r=[];const l=f.value,p=f.key,y=f.style,v=f.styleSpec;l.type||l.ref||r.push(new d.V(p,l,'either "type" or "ref" is required'));let b=d.M(l.type);const C=d.M(l.ref);if(l.id){const D=d.M(l.id);for(let R=0;R<f.arrayIndex;R++){const O=y.layers[R];d.M(O.id)===D&&r.push(new d.V(p,l.id,`duplicate layer id "${l.id}", previously used at line ${O.id.__line__}`))}}if("ref"in l){let D;["type","source","source-layer","filter","layout"].forEach(R=>{R in l&&r.push(new d.V(p,l[R],`"${R}" is prohibited for ref layers`))}),y.layers.forEach(R=>{d.M(R.id)===C&&(D=R)}),D?D.ref?r.push(new d.V(p,l.ref,"ref cannot reference another ref layer")):b=d.M(D.type):"string"==typeof C&&r.push(new d.V(p,l.ref,`ref layer "${C}" not found`))}else if("background"!==b&&"sky"!==b&&"slot"!==b)if(l.source){const D=y.sources&&y.sources[l.source],R=D&&d.M(D.type);D?"vector"===R&&"raster"===b?r.push(new d.V(p,l.source,`layer "${l.id}" requires a raster source`)):"raster"===R&&"raster"!==b?r.push(new d.V(p,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==R||l["source-layer"]?"raster-dem"===R&&"hillshade"!==b?r.push(new d.V(p,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==R||["raster","raster-particle"].includes(b)?"line"===b&&l.paint&&(l.paint["line-gradient"]||l.paint["line-trim-offset"])&&"geojson"===R&&!D.lineMetrics?r.push(new d.V(p,l,`layer "${l.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):"raster-particle"===b&&"raster-array"!==R&&r.push(new d.V(p,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):r.push(new d.V(p,l.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new d.V(p,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new d.V(p,l.source,`source "${l.source}" not found`))}else r.push(new d.V(p,l,'missing required property "source"'));return r=r.concat(ns({key:p,value:l,valueSpec:v.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ci({key:`${p}.type`,value:l.type,valueSpec:v.layer.type,style:f.style,styleSpec:f.styleSpec,object:l,objectKey:"type"}),filter:D=>Pa(d.L({layerType:b},D)),layout:D=>ns({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":R=>rs(d.L({layerType:b},R))}}),paint:D=>ns({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":R=>is(d.L({layerType:b,layer:l},R))}})}})),r}function Ya(f){const r=f.value,l=f.key,p=d.J(r);return"string"!==p?[new d.V(l,r,`string expected, ${p} found`)]:[]}const Mu={promoteId:function f({key:r,value:l}){if("string"===d.J(l))return Ya({key:r,value:l});if(Array.isArray(l)){const p=[],y=d.U(l),v=d.X(y);return"error"===v.result&&v.value.forEach(b=>{p.push(new d.V(`${r}${b.key}`,null,`${b.message}`))}),d.Z(v.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||p.push(new d.V(`${r}`,null,"promoteId expression should be only feature dependent")),p}{const p=[];for(const y in l)p.push(...f({key:`${r}.${y}`,value:l[y]}));return p}}};function Po(f){const r=f.value,l=f.key,p=f.styleSpec,y=f.style;if(!r.type)return[new d.V(l,r,'"type" is required')];const v=d.M(r.type);let b=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(r.url||r.tiles||b.push(new d.K(l,r,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return b=b.concat(ns({key:l,value:r,valueSpec:p[`source_${v.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:Mu})),b;case"geojson":if(b=ns({key:l,value:r,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:Mu}),r.cluster)for(const C in r.clusterProperties){const[D,R]=r.clusterProperties[C],O="string"==typeof D?[D,["accumulated"],["get",C]]:D;b.push(...Ls({key:`${l}.${C}.map`,value:R,expressionContext:"cluster-map"})),b.push(...Ls({key:`${l}.${C}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return b;case"video":return ns({key:l,value:r,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return ns({key:l,value:r,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new d.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xa({key:`${l}.type`,value:r.type,valueSpec:{values:Zr(p)}})}}function Zr(f){return f.source.reduce((r,l)=>{const p=f[l];return"enum"===p.type.type&&(r=r.concat(Object.keys(p.type.values))),r},[])}function Ka(f){const r=f.value,l=f.styleSpec,p=l.light,y=f.style;let v=[];const b=d.J(r);if(void 0===r)return v;if("object"!==b)return v=v.concat([new d.V("light",r,`object expected, ${b} found`)]),v;for(const C in r){const D=C.match(/^(.*)-transition$/),R=C.match(/^(.*)-use-theme$/);v=v.concat(R&&p[R[1]]?Ci({key:C,value:r[C],valueSpec:{type:"string"},style:y,styleSpec:l}):D&&p[D[1]]&&p[D[1]].transition?Ci({key:C,value:r[C],valueSpec:l.transition,style:y,styleSpec:l}):p[C]?Ci({key:C,value:r[C],valueSpec:p[C],style:y,styleSpec:l}):[new d.V(C,r[C],`unknown property "${C}"`)])}return v}function Ja(f){const r=f.value;let l=[];if(!r)return l;const p=d.J(r);if("object"!==p)return l=l.concat([new d.V("light-3d",r,`object expected, ${p} found`)]),l;const y=f.styleSpec,v=y["light-3d"],b=f.key,C=f.style,D=f.style.lights;for(const N of["type","id"])if(!(N in r))return l=l.concat([new d.V("light-3d",r,`missing property ${N} on light`)]),l;if(r.type&&D)for(let N=0;N<f.arrayIndex;N++){const k=d.M(r.type),B=D[N];d.M(B.type)===k&&l.push(new d.V(b,r.id,`duplicate light type "${r.type}", previously defined at line ${B.id.__line__}`))}const R=`properties_light_${r.type}`;if(!(R in y))return l=l.concat([new d.V("light-3d",r,`Invalid light type ${r.type}`)]),l;const O=y[R];for(const N in r)if("properties"===N){const k=r[N],B=d.J(k);if("object"!==B)return l=l.concat([new d.V("properties",k,`object expected, ${B} found`)]),l;for(const H in k){const U=H.match(/^(.*)-transition$/),q=H.match(/^(.*)-use-theme$/);l=l.concat(q&&O[q[1]]?Ci({key:N,value:k[H],valueSpec:{type:"string"},style:C,styleSpec:y}):U&&O[U[1]]&&O[U[1]].transition?Ci({key:N,value:r[N],valueSpec:y.transition,style:C,styleSpec:y}):O[H]?Ci({key:H,value:k[H],valueSpec:O[H],style:C,styleSpec:y}):[new d.K(f.key,k[H],`unknown property "${H}"`)])}}else l=l.concat(v[N]?Ci({key:N,value:r[N],valueSpec:v[N],style:C,styleSpec:y}):[new d.K(N,r[N],`unknown property "${N}"`)]);return l}function Qa(f){const r=f.value,l=f.key,p=f.style,y=f.styleSpec,v=y.terrain;let b=[];const C=d.J(r);if(void 0===r||"null"===C)return b;if("object"!==C)return b=b.concat([new d.V("terrain",r,`object expected, ${C} found`)]),b;for(const D in r){const R=D.match(/^(.*)-transition$/),O=D.match(/^(.*)-use-theme$/);b=b.concat(O&&v[O[1]]?Ci({key:D,value:r[D],valueSpec:{type:"string"},style:p,styleSpec:y}):R&&v[R[1]]&&v[R[1]].transition?Ci({key:D,value:r[D],valueSpec:y.transition,style:p,styleSpec:y}):v[D]?Ci({key:D,value:r[D],valueSpec:v[D],style:p,styleSpec:y}):[new d.K(D,r[D],`unknown property "${D}"`)])}if(r.source){const D=p.sources&&p.sources[r.source],R=D&&d.M(D.type);D?"raster-dem"!==R&&b.push(new d.V(l,r.source,`terrain cannot be used with a source of type ${String(R)}, it only be used with a "raster-dem" source type`)):b.push(new d.V(l,r.source,`source "${r.source}" not found`))}else b.push(new d.V(l,r,'terrain is missing required property "source"'));return b}function Ul(f){const r=f.value,l=f.style,p=f.styleSpec,y=p.fog;let v=[];const b=d.J(r);if(void 0===r)return v;if("object"!==b)return v=v.concat([new d.V("fog",r,`object expected, ${b} found`)]),v;for(const C in r){const D=C.match(/^(.*)-transition$/),R=C.match(/^(.*)-use-theme$/);v=v.concat(R&&y[R[1]]?Ci({key:C,value:r[C],valueSpec:{type:"string"},style:l,styleSpec:p}):D&&y[D[1]]&&y[D[1]].transition?Ci({key:C,value:r[C],valueSpec:p.transition,style:l,styleSpec:p}):y[C]?Ci({key:C,value:r[C],valueSpec:y[C],style:l,styleSpec:p}):[new d.K(C,r[C],`unknown property "${C}"`)])}return v}const Pu={"*":()=>[],array:Vl,boolean:function(f){const r=f.value,l=f.key,p=d.J(r);return"boolean"!==p?[new d.V(l,r,`boolean expected, ${p} found`)]:[]},number:Bd,color:function(f){const r=f.key,l=f.value,p=d.J(l);return"string"!==p?[new d.V(r,l,`color expected, ${p} found`)]:null===d.a0.parseCSSColor(l)?[new d.V(r,l,`color expected, "${l}" found`)]:[]},enum:Xa,filter:Pa,function:Za,layer:Au,object:ns,source:Po,model:d.a4,light:Ka,"light-3d":Ja,terrain:Qa,fog:Ul,string:Ya,formatted:function(f){return 0===Ya(f).length?[]:Ls(f)},resolvedImage:function(f){return 0===Ya(f).length?[]:Ls(f)},projection:function(f){const r=f.value,l=f.styleSpec,p=l.projection,y=f.style;let v=[];const b=d.J(r);if("object"===b)for(const C in r)v=v.concat(Ci({key:C,value:r[C],valueSpec:p[C],style:y,styleSpec:l}));else"string"!==b&&(v=v.concat([new d.V("projection",r,`object or string expected, ${b} found`)]));return v},import:function(f){const{value:r,styleSpec:l}=f,{data:p,...y}=r;Object.defineProperty(y,"__line__",{value:r.__line__,enumerable:!1});let v=ns(d.L({},f,{value:y,valueSpec:l.import}));return""===d.M(y.id)&&v.push(new d.V(`${f.key}.id`,y,"import id can't be an empty string")),p&&(v=v.concat(jd(p,l,{key:`${f.key}.data`}))),v},iconset:function(f){const r=f.value,l=f.key,p=f.styleSpec,y=f.style;if(!r.type)return[new d.V(l,r,'"type" is required')];const v=d.M(r.type);let b=[];if(b=b.concat(ns({key:l,value:r,valueSpec:p[`iconset_${v}`],style:y,styleSpec:p})),"source"===v&&r.source){const C=y.sources&&y.sources[r.source],D=C&&d.M(C.type);C?"raster-array"!==D&&b.push(new d.V(l,r.source,`iconset cannot be used with a source of type ${String(D)}, it only be used with a "raster-array" source type`)):b.push(new d.V(l,r.source,`source "${r.source}" not found`))}return b}};function Ci(f,r=!1){const l=f.value,p=f.valueSpec,y=f.styleSpec;if(p.expression&&d.a2(d.M(l)))return Za(f);if(p.expression&&d.S(d.U(l)))return Ls(f);if(p.type&&Pu[p.type]){const v=Pu[p.type](f);return!0===r&&v.length>0&&"array"===d.J(f.value)?Ls(f):v}return ns(d.L({},f,{valueSpec:p.type?y[p.type]:p}))}function Vd(f){const r=f.value,l=f.key,p=Ya(f);return p.length||(-1===r.indexOf("{fontstack}")&&p.push(new d.V(l,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&p.push(new d.V(l,r,'"glyphs" url must include a "{range}" token'))),p}function jd(f,r=d.a5,l={}){return Ci({key:l.key||"",value:f,valueSpec:r.$root,styleSpec:r,style:f,objectElementValidators:{glyphs:Vd,"*":()=>[]}})}function Ns(f,r=d.a5){return ge(jd(f,r))}const Ud=f=>ge(Po(f)),Xp=f=>ge(Ka(f)),Ru=f=>ge(Ja(f)),Qe=f=>ge(Qa(f)),el=f=>ge(Ul(f)),Yp=f=>ge(function(r){const l=r.value,p=r.style,y=r.styleSpec,v=y.snow;let b=[];const C=d.J(l);if(void 0===l)return b;if("object"!==C)return b=b.concat([new d.V("snow",l,`object expected, ${C} found`)]),b;for(const D in l){const R=D.match(/^(.*)-transition$/);b=b.concat(R&&v[R[1]]&&v[R[1]].transition?Ci({key:D,value:l[D],valueSpec:y.transition,style:p,styleSpec:y}):v[D]?Ci({key:D,value:l[D],valueSpec:v[D],style:p,styleSpec:y}):[new d.K(D,l[D],`unknown property "${D}"`)])}return b}(f)),gf=f=>ge(function(r){const l=r.value,p=r.style,y=r.styleSpec,v=y.rain;let b=[];const C=d.J(l);if(void 0===l)return b;if("object"!==C)return b=b.concat([new d.V("rain",l,`object expected, ${C} found`)]),b;for(const D in l){const R=D.match(/^(.*)-transition$/);b=b.concat(R&&v[R[1]]&&v[R[1]].transition?Ci({key:D,value:l[D],valueSpec:y.transition,style:p,styleSpec:y}):v[D]?Ci({key:D,value:l[D],valueSpec:v[D],style:p,styleSpec:y}):[new d.K(D,l[D],`unknown property "${D}"`)])}return b}(f)),Rn=f=>ge(Au(f)),Pe=f=>ge(Pa(f)),Z=f=>ge(is(f)),X=f=>ge(rs(f)),oe=f=>ge(d.a4(f));function ge(f){return f.slice().sort((r,l)=>r.line&&l.line?r.line-l.line:0)}function se(f,r){let l=!1;if(r&&r.length)for(const p of r)p instanceof d.K?d.w(p.message):(f.fire(new d.z(new Error(p.message))),l=!0);return l}let we;class Fe extends d.E{constructor(r,l="flat"){super(),this._transitionable=new d.a6(we||(we=new d.a7({anchor:new d.a8(d.a5.light.anchor),position:new d.a9(d.a5.light.position),color:new d.a8(d.a5.light.color),intensity:new d.a8(d.a5.light.intensity)}))),this.setLight(r,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l,p={}){this._validate(Xp,r,p)||(this._transitionable.setTransitionOrValue(r),this.id=l)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||!1!==p.validate)&&se(this,r.call(Ns,d.h({value:l,style:{glyphs:!0,sprite:!0},styleSpec:d.a5})))}}let Te=class extends d.E{constructor(f,r,l,p,y){super(),this.scope=l,this._transitionable=new d.a6(new d.a7({source:new d.a8(d.a5.terrain.source),exaggeration:new d.a8(d.a5.terrain.exaggeration)}),l,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r,this.worldview=y}get(){return this._transitionable.serialize()}set(f,r){this._transitionable.setTransitionOrValue(f,r)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new d.aa(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const r=f.value.expression;if(!r)return null;let l=-1,p=-1,y=1;for(const v of r.zoomStops)y=r.evaluate(new d.aa(v,{worldview:this.worldview})),y>.01?(l=v,p=-1):p=v;return y<.01&&l>0&&p>l?[l,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return null!=f&&null!=f.value&&null!=f.value.expression&&f.value.expression instanceof d.ab}};const Ie=45,st=65,qe=.05;function Lt(f,r,l,p){const y=d.af(Ie,st,l),[v,b]=Wt(f,p);let C=1-Math.min(1,Math.exp((r-v)/(b-v)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*y*f.alpha}function Wt(f,r){const l=.5/Math.tan(.5*r);return[f.range[0]+l,f.range[1]+l]}function Yt(f,r,l,p,y){const v=d.ad([],[r,l,p],y.mercatorFogMatrix);return Lt(f,d.ae(v),y.pitch,y._fov)}function bn(f,r,l,p,y,v,b){const C=[[l,p,0],[y,p,0],[y,v,0],[l,v,0]];let D=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(const O of C){const N=d.ad([],O,r),k=d.ae(N);D=Math.min(D,k),R=Math.max(R,k)}return[Lt(f,D,b.pitch,b._fov),Lt(f,R,b.pitch,b._fov)]}class mn extends d.E{constructor(r,l,p,y){super();const v=new d.a7({range:new d.a8(d.a5.fog.range),color:new d.a8(d.a5.fog.color),"color-use-theme":new d.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new d.a8(d.a5.fog["high-color"]),"high-color-use-theme":new d.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new d.a8(d.a5.fog["space-color"]),"space-color-use-theme":new d.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new d.a8(d.a5.fog["horizon-blend"]),"star-intensity":new d.a8(d.a5.fog["star-intensity"]),"vertical-range":new d.a8(d.a5.fog["vertical-range"])});this._transitionable=new d.a6(v,p,new Map(y)),this.set(r,y),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new d.ag(v),this.scope=p}get state(){const r=this._transform,l="globe"===r.projection.name,p=d.ah(r.zoom),y=this.properties.get("range"),v=[.5,3];return{range:l?[d.ai(v[0],y[0],p),d.ai(v[1],y[1],p)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l,p={}){if(this._validate(el,r,p))return;const y=d.h({},r);for(const v of Object.keys(d.a5.fog))void 0===y[v]&&(y[v]=d.a5.fog[v].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:d.af(Ie,st,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(p,y,v){const b=d.ac.fromLngLat(y),C=v.elevation?v.elevation.getAtPointOrZero(b):0;return Yt(p,b.x,b.y,C,v)}(this.state,r,l):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(r.toUnwrapped());return bn(this.state,l,0,0,d.aj,d.aj,this._transform)}getOpacityForBounds(r,l,p,y,v){return this._transform.projection.supportsFog?bn(this.state,r,l,p,y,v,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Wt(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const p of l){const y=r.points[p];let v;if(y[2]>=0)v=y;else{const b=r.points[p-4];v=d.ak(b,y,b[2]/(b[2]-y[2]))}if(Yt(this.state,v[0],v[1],0,this._transform)>=qe)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,p){return(!p||!1!==p.validate)&&se(this,r.call(Ns,d.h({value:l,style:{glyphs:!0,sprite:!0},styleSpec:d.a5})))}}let un,_i,_n,ir,Ir=class extends d.E{constructor(f,r,l,p){super();const y=un||(un=new d.a7({density:new d.a8(d.a5.snow.density),intensity:new d.a8(d.a5.snow.intensity),color:new d.a8(d.a5.snow.color),opacity:new d.a8(d.a5.snow.opacity),vignette:new d.a8(d.a5.snow.vignette),"vignette-color":new d.a8(d.a5.snow["vignette-color"]),"center-thinning":new d.a8(d.a5.snow["center-thinning"]),direction:new d.a8(d.a5.snow.direction),"flake-size":new d.a8(d.a5.snow["flake-size"])}));this._transitionable=new d.a6(y,l,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new d.ag(y),this.scope=l}get state(){const f=this.properties.get("opacity"),r=this.properties.get("color"),l=this.properties.get("direction"),p=d.al(l[0]),y=-Math.max(d.al(l[1]),.01),v=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],b=this.properties.get("vignette"),C=this.properties.get("vignette-color");return C.a=b,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new d.am(r.r,r.g,r.b,r.a*f),direction:v,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:C}}get(){return this._transitionable.serialize()}set(f,r,l={}){if(this._validate(Yp,f,l))return;const p=d.h({},f);for(const y of Object.keys(d.a5.snow))void 0===p[y]&&(p[y]=d.a5.snow[y].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,r,l){return(!l||!1!==l.validate)&&se(this,f.call(Ns,d.h({value:r,style:{glyphs:!0,sprite:!0},styleSpec:d.a5})))}},Nr=class extends d.E{constructor(f,r,l,p){super();const y=_i||(_i=new d.a7({density:new d.a8(d.a5.rain.density),intensity:new d.a8(d.a5.rain.intensity),color:new d.a8(d.a5.rain.color),opacity:new d.a8(d.a5.rain.opacity),vignette:new d.a8(d.a5.rain.vignette),"vignette-color":new d.a8(d.a5.rain["vignette-color"]),"center-thinning":new d.a8(d.a5.rain["center-thinning"]),direction:new d.a8(d.a5.rain.direction),"droplet-size":new d.a8(d.a5.rain["droplet-size"]),"distortion-strength":new d.a8(d.a5.rain["distortion-strength"])}));this._transitionable=new d.a6(y,l,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new d.ag(y),this.scope=l}get state(){const f=this.properties.get("opacity"),r=this.properties.get("color"),l=this.properties.get("direction"),p=d.al(l[0]),y=-Math.max(d.al(l[1]),.01),v=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],b=this.properties.get("vignette-color");return b.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new d.am(r.r,r.g,r.b,r.a*f),direction:v,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:b}}get(){return this._transitionable.serialize()}set(f,r,l={}){if(this._validate(gf,f,l))return;const p=d.h({},f);for(const y of Object.keys(d.a5.rain))void 0===p[y]&&(p[y]=d.a5.rain[y].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,r,l){return(!l||!1!==l.validate)&&se(this,f.call(Ns,d.h({value:r,style:{glyphs:!0,sprite:!0},styleSpec:d.a5})))}};class di extends d.E{constructor(r,l,p,y){super(),this.scope=p,this._options=r,this.properties=new d.ag(l),this._transitionable=new d.a6(l,p,new Map(y)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,l){this._options=r,this._transitionable.setTransitionOrValue(r.properties,l)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}class Vn{constructor(r,l,p){this.screenBounds=r,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=l,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(r,l){let p,y;if(r instanceof d.P||"number"==typeof r[0]){const v=d.P.convert(r);p=[v],y=l.isPointAboveHorizon(v)}else{const v=d.P.convert(r[0]),b=d.P.convert(r[1]),C=v.add(b)._div(2);p=[v,b],y=d.ao(v,b).every(D=>l.isPointAboveHorizon(D))&&l.isPointAboveHorizon(C)}return new Vn(p,y,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return d.ao(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new d.P(1,1)):this.screenBounds[1],y=d.ao(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?y[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(y[3]=this.cameraPoint)),d.ap(y,r)}bufferedCameraGeometryGlobe(r){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new d.P(1,1)):this.screenBounds[1],y=d.ao(l,p,r),v=this.cameraPoint.clone();switch(3*((v.y>l.y)+(v.y>p.y))+((v.x>l.x)+(v.x>p.x))){case 0:y[0]=v,y[4]=v.clone();break;case 1:y.splice(1,0,v);break;case 2:y[1]=v;break;case 3:y.splice(4,0,v);break;case 5:y.splice(2,0,v);break;case 6:y[3]=v;break;case 7:y.splice(3,0,v);break;case 8:y[2]=v}return y}containsTile(r,l,p,y=0){const v=r.queryPadding/l._pixelsPerMercatorPixel+1,b=p?this._bufferedCameraMercator(v,l):this._bufferedScreenMercator(v,l);let C=r.tileID.wrap+(b.unwrapped?y:0);const D=b.polygon.map(q=>d.aq(r.tileTransform,q,C));if(!d.ar(D,0,0,d.aj,d.aj))return;C=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const R=this.screenGeometryMercator.polygon.map(q=>d.as(r.tileTransform,q,C)),O=R.map(q=>new d.P(q[0],q[1])),N=l.getFreeCameraOptions().position||new d.ac(0,0,0),k=d.as(r.tileTransform,N,C),B=R.map(q=>{const $=d.at(q,q,k);return d.au($,$),new d.av(k,$)}),H=d.aw(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:B,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(U=d.ax(D),U.min.x=d.ay(U.min.x,0,d.aj),U.min.y=d.ay(U.min.y,0,d.aj),U.max.x=d.ay(U.max.x,0,d.aj),U.max.y=d.ay(U.max.y,0,d.aj),U),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:H};var U}_bufferedScreenMercator(r,l){const p=Si(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let y;return y="globe"===l.projection.name?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[p]=y,y}}_bufferedCameraMercator(r,l){const p=Si(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let y;return y="globe"===l.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[p]=y,y}}_projectAndResample(r,l){const p=function(v,b){const C=d.az([],b.pixelMatrix,b.globeMatrix),D=[0,-d.aB,0,1],R=[0,d.aB,0,1],O=[0,0,0,1];d.aA(D,D,C),d.aA(R,R,C),d.aA(O,O,C);const N=new d.P(D[0]/D[3],D[1]/D[3]),k=new d.P(R[0]/R[3],R[1]/R[3]),B=d.aC(v,N)&&D[3]<O[3],H=d.aC(v,k)&&R[3]<O[3];if(!B&&!H)return null;const U=function(pe,ae,ce){for(let ue=1;ue<pe.length;ue++){const Me=ji(ae.pointCoordinate3D(pe[ue-1]).x),ve=ji(ae.pointCoordinate3D(pe[ue]).x);if(ce<0){if(Me<ve)return{idx:ue,t:-Me/(ve-1-Me)}}else if(ve<Me)return{idx:ue,t:(1-Me)/(ve+1-Me)}}return null}(v,b,B?-1:1);if(!U)return null;const{idx:q,t:$}=U;let K=q>1?$i(v.slice(0,q),b):[],ee=q<v.length?$i(v.slice(q),b):[];K=K.map(pe=>new d.P(ji(pe.x),pe.y)),ee=ee.map(pe=>new d.P(ji(pe.x),pe.y));const ne=[...K];0===ne.length&&ne.push(ee[ee.length-1]);const le=d.ai(ne[ne.length-1].y,(0===ee.length?K[0]:ee[0]).y,$);let de;return de=B?[new d.P(0,le),new d.P(0,0),new d.P(1,0),new d.P(1,le)]:[new d.P(1,le),new d.P(1,1),new d.P(0,1),new d.P(0,le)],ne.push(...de),0===ee.length?ne.push(K[0]):ne.push(...ee),{polygon:ne.map(pe=>new d.ac(pe.x,pe.y)),unwrapped:!1}}(r,l);if(p)return p;const y=function(v,b){let C=!1,D=-1/0,R=0;for(let N=0;N<v.length-1;N++)v[N].x>D&&(D=v[N].x,R=N);for(let N=0;N<v.length-1;N++){const k=(R+N)%(v.length-1),B=v[k],H=v[k+1];Math.abs(B.x-H.x)>.5&&(B.x<H.x?(B.x+=1,0===k&&(v[v.length-1].x+=1)):(H.x+=1,k+1===v.length-1&&(v[0].x+=1)),C=!0)}const O=d.aD(b.center.lng);return C&&O<Math.abs(O-1)&&v.forEach(N=>{N.x-=1}),{polygon:v,unwrapped:C}}($i(r,l).map(v=>new d.P(ji(v.x),v.y)),l);return{polygon:y.polygon.map(v=>new d.ac(v.x,v.y)),unwrapped:y.unwrapped}}}function $i(f,r){return d.aE(f,l=>{const p=r.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function ji(f){return f<0?1+f%1:f%1}function Si(f){return 100*f|0}function Xr(f,r,l,p,y){const v=function(C,D){if(C)return y(C);if(D){if(f.url&&D.tiles&&f.tiles&&delete f.tiles,D.variants){if(!Array.isArray(D.variants))return y(new Error("variants must be an array"));for(const O of D.variants){if(null==O||"object"!=typeof O||O.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(O.capabilities))return y(new Error("capabilities must be an array"));if(1===O.capabilities.length&&"meshopt"===O.capabilities[0]){D=d.h(D,O);break}}}const R=d.aF(d.h({},D,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);R.tiles=r.canonicalizeTileset(R,f.url),y(null,R)}},b=function(C,D,R){if(!C)return null;if(!D&&!R)return C;R=R||C.worldview_default;const O=Object.values(C.language||{});if(0===O.length)return null;const N=Object.values(C.worldview||{});if(0===N.length)return null;const k=O.every(H=>H===D),B=N.every(H=>H===R);return k&&B?C:D in(C.language_options||{})||R in(C.worldview_options||{})?null:C.language_options&&C.worldview_options?C:null}(f.data,l,p);return b?d.q.frame(()=>v(null,b)):f.url?d.n(r.transformRequest(r.normalizeSourceURL(f.url,null,l,p),d.R.Source),v):d.q.frame(()=>{const{data:C,...D}=f;v(null,D)})}function Go(f,r){const l=Math.pow(2,r.z),p=Math.floor(d.aD(f.getWest())*l),y=Math.floor(d.aH(f.getNorth())*l),v=Math.ceil(d.aD(f.getEast())*l),b=Math.ceil(d.aH(f.getSouth())*l);return r.x>=p&&r.x<v&&r.y>=y&&r.y<b}class _o{constructor(r,l,p){this.bounds=r?d.aG.convert(this.validateBounds(r)):null,this.minzoom=l||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}addExtraBounds(r){if(r){this.extraBounds||(this.extraBounds=[]);for(const l of r)this.extraBounds.push(d.aG.convert(this.validateBounds(l)))}}contains(r){if(r.z>this.maxzoom||r.z<this.minzoom||this.bounds&&!Go(this.bounds,r))return!1;if(!this.extraBounds)return!0;for(const l of this.extraBounds)if(Go(l,r))return!0;return!1}static fromTileJSON(r){if(!r.bounds&&!r.extra_bounds)return null;const l=new _o(r.bounds,r.minzoom,r.maxzoom);return l.addExtraBounds(r.extra_bounds),l}}class Hd extends d.E{constructor(r,l,p,y){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.h(this,d.aF(l,["url","scheme","tileSize","promoteId"])),this._options=d.h({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new d.aI}load(r){this._loaded=!1,this.fire(new d.A("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=Xr(this._options,this.map._requestManager,l,p,(y,v)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new d.z(y));else if(v){if(d.h(this,v),this.hasWorldviews=!!v.worldview_options,v.worldview_default&&(this.worldviewDefault=v.worldview_default),v.vector_layers){this.vectorLayers=v.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const b of v.vector_layers)this.vectorLayerIds.push(b.id),v.worldview&&v.worldview[b.source]&&this.localizableLayerIds.add(b.id)}this.tileBounds=_o.fromTileJSON(v),Ho(v.tiles,this.map._requestManager._customAccessToken),this.fire(new d.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.A("data",{dataType:"source",sourceDataType:"content"}))}r&&r(y)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=d.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return d.h({},this._options)}loadTile(r,l){const p=r.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(p),v=this.map._requestManager.transformRequest(y,d.R.Tile),b=this.map.style?this.map.style.getLut(this.scope):null,C=b?{image:b.image.clone()}:null,D={request:v,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,lut:C,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:d.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&d.j(p)&&(D.localizableLayerIds=this.localizableLayerIds),D.request.collectResourceTiming=this._collectResourceTiming,r.actor&&"expired"!==r.state)"loading"===r.state?r.reloadCallback=l:r.request=r.actor.send("reloadTile",D,R.bind(this));else if(r.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",D,R.bind(this),void 0,!0);else{const O=d.aJ.call({deduped:this._deduped},D,(N,k)=>{N||!k?R.call(this,N):(D.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},r.actor&&r.actor.send("loadTile",D,R.bind(this),void 0,!0))},!0);r.request={cancel:O}}function R(O,N){return delete r.request,r.aborted?l(null):O&&404!==O.status?l(O):(N&&N.resourceTiming&&(r.resourceTiming=N.resourceTiming),this.map._refreshExpiredTiles&&N&&r.setExpiryData(N),r.loadVectorData(N,this.map.painter),d.aK(this.dispatcher),l(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,l){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class so extends d.E{constructor(r,l,p,y){super(),this.id=r,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.h({type:"raster"},l),d.h(this,d.aF(l,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new d.A("dataloading",{dataType:"source"}));const l=this.map.getWorldview();this._tileJSONRequest=Xr(this._options,this.map._requestManager,null,l,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new d.z(p)):y&&(d.h(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map(v=>v.id)),this.tileBounds=_o.fromTileJSON(y),Ho(y.tiles),this.fire(new d.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.A("data",{dataType:"source",sourceDataType:"content"}))),r&&r(p)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=d.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return d.h({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const p=d.q.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=d.o(this.map._requestManager.transformRequest(y,d.R.Tile),(v,b,C,D)=>(delete r.request,r.aborted?(r.state="unloaded",l(null)):v?(r.state="errored",l(v)):b?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:C,expires:D}),r.setTexture(b,this.map.painter),r.state="loaded",d.aK(this.dispatcher),void l(null)):l(null)))}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l&&l()}unloadTile(r,l){r.texture&&r.texture instanceof d.T?(r.destroy(!0),r.texture&&r.texture instanceof d.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Hl extends so{constructor(r,l,p,y){super(r,l,p,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=d.h({type:"raster-array"},l)}triggerRepaint(r){const l=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);l&&l.enabled&&p&&l._clearRenderCacheForTile(p.id,r.tileID),this.map.triggerRepaint()}loadTile(r,l){const p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(p,d.R.Tile),v={request:y,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};r.source=this.id,r.scope=this.scope,r.requestParams=y,r.actor||(r.actor=this.dispatcher.getActor());const b=(C,D,R,O)=>{if(delete r.request,r.aborted)return r.state="unloaded",l(null);if(C)return"AbortError"===C.name?void 0:(r.state="errored",l(C));if(this.map._refreshExpiredTiles&&D&&r.setExpiryData({cacheControl:R,expires:O}),this.partial)r.state="empty";else{if(!D)return l(null);r.state="loaded",r._isHeaderLoaded=!0,r._mrt=D}l(null)};r.request=this.partial?r.fetchHeader(void 0,b.bind(this)):r.actor.send("loadTile",v,b.bind(this),void 0,!0)}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,l){const p=r.texturePerLayer;if(r.flushAllQueues(),p.size){r.destroy(!0);for(const y of p.values())this.map.painter.saveTileTexture(y)}else r.destroy()}prepareTile(r,l,p,y){r._isHeaderLoaded&&("empty"!==r.state&&(r.state="reloading"),r.fetchBand(l,p,y,(v,b)=>{if(v)return r.state="errored",this.fire(new d.z(v)),void this.triggerRepaint(r);b&&(r._isHeaderLoaded=!0,r.setTexturePerLayer(p,b,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const l=this.rasterLayers.find(({id:v})=>v===r),p=l&&l.fields,y=p&&p.bands&&p.bands;return y?y[0]:0}getTextureDescriptor(r,l,p){if(!r)return;const y=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let v=null;l instanceof d.aN?v=l.paint.get("raster-array-band"):l instanceof d.aO&&(v=l.paint.get("raster-particle-array-band"));const b=v||this.getInitialBand(y);if(null==b)return;if(!r.textureDescriptorPerLayer.get(l.id))return void this.prepareTile(r,y,l.id,b);if(r.updateNeeded(l.id,b)&&!p)return;const C=r.textureDescriptorPerLayer.get(l.id);return Object.assign({},C,{texture:r.texturePerLayer.get(l.id)})}getImages(r,l){const p=new Map;for(const y of r)for(const v of l){const[b,C]=v.split("/"),D=y.getLayer(b);if(!D||!D.hasBand(C)||!D.hasDataForBand(C))continue;const{bytes:R,tileSize:O,buffer:N}=D.getBandView(C),k=O+2*N,B={data:new d.r({width:k,height:k},R),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(v,B)}return p}}const _f={vector:Hd,raster:so,"raster-dem":class extends so{constructor(f,r,l,p){super(f,r,l,p),this.type="raster-dem",this.maxzoom=22,this._options=d.h({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(f,r){const l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(y,v){y&&(f.state="errored",r(y)),v&&(f.dem=v,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",r(null))}f.request=d.o(this.map._requestManager.transformRequest(l,d.R.Tile),function(y,v,b,C){if(delete f.request,f.aborted)f.state="unloaded",r(null);else if(y)f.state="errored",r(y);else if(v){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:b,expires:C});const D=ImageBitmap&&v instanceof ImageBitmap&&d.t(),R=1-(v.width-d.aL(v.width))/2;R<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const O=D?v:d.q.getImageData(v,R),N={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:O,encoding:this.encoding,padding:R};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",N,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const r=f.canonical,l=Math.pow(2,r.z),p=(r.x-1+l)%l,y=0===r.x?f.wrap-1:f.wrap,v=(r.x+1+l)%l,b=r.x+1===l?f.wrap+1:f.wrap,C={};return C[new d.aM(f.overscaledZ,y,r.z,p,r.y).key]={backfilled:!1},C[new d.aM(f.overscaledZ,b,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(C[new d.aM(f.overscaledZ,y,r.z,p,r.y-1).key]={backfilled:!1},C[new d.aM(f.overscaledZ,f.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},C[new d.aM(f.overscaledZ,b,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<l&&(C[new d.aM(f.overscaledZ,y,r.z,p,r.y+1).key]={backfilled:!1},C[new d.aM(f.overscaledZ,f.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},C[new d.aM(f.overscaledZ,b,r.z,v,r.y+1).key]={backfilled:!1}),C}},"raster-array":Hl,geojson:class extends d.E{constructor(f,r,l,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=r.data,this._options=d.h({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),void 0!==r.minzoom&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const y=d.aj/this.tileSize;this.workerOptions=d.h({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*y,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*y,extent:d.aj,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:d.aj,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*y,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new d.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof f&&("Feature"===f.type&&(f={type:"FeatureCollection",features:[f]}),"FeatureCollection"!==f.type))return this.fire(new d.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof f&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const r=new Map;for(const l of this._data.features)r.set(l.id,l);for(const l of f.features)r.set(l.id,l);this._data.features=[...r.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterChildren(f,r){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterLeaves(f,r,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:r,offset:l},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.A("dataloading",{dataType:"source"})),this._loaded=!1;const r=d.h({append:f},this.workerOptions);r.scope=this.scope;const l=this._data;"string"==typeof l?(r.request=this.map._requestManager.transformRequest(d.q.resolveURL(l),d.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(p,y)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new d.z(p));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(v.resourceTiming=y.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new d.A("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=d.C(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,r){const l=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,y=p?{image:p.image.clone()}:null,v=this._partialReload,b={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:d.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:v,worldview:this.map.getWorldview()};f.request=this.actor.send(l,b,(C,D)=>v&&!D?(f.state="loaded",r(null)):(delete f.request,f.destroy(),f.aborted?r(null):C?r(C):(f.loadVectorData(D,this.map.painter,"reloadTile"===l),r(null))),void 0,"loadTile"===l)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,r){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends d.aP{constructor(f,r,l,p){super(f,r,l,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const r of f.urls)this.urls.push(this.map._requestManager.transformRequest(r,d.R.Source).url);d.aQ(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new d.z(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const r=this.video.seekable;f<r.start(0)||f>r.end(0)?this.fire(new d.z(new d.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,r=f.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new d.T(f,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:d.aP,model:class extends d.E{constructor(f,r,l,p){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){const f=[];for(const r in this._options.models){const l=this._options.models[r],p=d.aS(this.map._requestManager.transformRequest(l.uri,d.R.Model).url).then(y=>{if(!y)return;const v=d.aT(y),b=new d.aU(r,l.position,l.orientation,v);b.computeBoundsAndApplyParent(),this.models.push(b)}).catch(y=>{this.fire(new d.z(new Error(`Could not load model ${r} from ${l.uri}: ${y.message}`)))});f.push(p)}Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new d.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this._loaded=!0,this.fire(new d.z(new Error(`Could not load models: ${r.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,r){}serialize(){return this._options}},"batched-model":class extends d.E{constructor(f,r,l,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=d.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new d.A("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map.getWorldview();this._tileJSONRequest=Xr(this._options,this.map._requestManager,r,l,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),l&&2!==l.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new d.z(p))):y&&(d.h(this,y),y.bounds&&(this.tileBounds=new _o(y.bounds,this.minzoom,this.maxzoom)),Ho(y.tiles,this.map._requestManager._customAccessToken),this.fire(new d.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.A("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,r){const l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,d.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:d.q.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&"expired"!==f.state)if("loading"===f.state)f.reloadCallback=r;else{if(f.buckets){const v=Object.values(f.buckets);for(const b of v)b.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,y.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,y.bind(this),void 0,!0);function y(v,b){return f.aborted?r(null):v&&404!==v.status?r(v):(this.map._refreshExpiredTiles&&b&&f.setExpiryData(b),f.loadModelData(b,this.map.painter),f.state="loaded",void r(null))}}serialize(){return d.h({},this._options)}},canvas:class extends d.aP{constructor(f,r,l,p){super(f,r,l,p),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(y=>!Array.isArray(y)||2!==y.length||y.some(v=>"number"!=typeof v))||this.fire(new d.z(new d.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.z(new d.V(`sources.${f}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new d.z(new d.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof HTMLCanvasElement||this.fire(new d.z(new d.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.z(new d.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof d.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends d.E{constructor(f,r,l,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new d.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new d.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _o(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),d.h(this,d.aF(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return d.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new d.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new d.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:r,y:l,z:p}=f.canonical;return this._implementation.hasTile({x:r,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,r){const{x:l,y:p,z:y}=f.tileID.canonical,v=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:y},{signal:v.signal})).then(function(b){return delete f.request,f.aborted?(f.state="unloaded",r(null)):void 0===b?(f.state="errored",r(null)):null===b?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",r(null)):(C=b)instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement?(this.loadTileData(f,b),f.state="loaded",void r(null)):(f.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var C}.bind(this)).catch(b=>{"AbortError"!==b.name&&(f.state="errored",r(b))}),f.request.cancel=()=>v.abort()}loadTileData(f,r){f.setTexture(r,this.map.painter)}unloadTile(f,r){if(f.texture&&f.texture instanceof d.T?(f.destroy(!0),f.texture&&f.texture instanceof d.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:l,y:p,z:y}=f.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:y})}r&&r()}abortTile(f,r){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=d.C(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new d.A("data",{dataType:"source",sourceDataType:"content"}))}}},Ou=function(f,r,l,p){const y=new _f[r.type](f,r,l,p);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return d.aV(["load","abort","unload","serialize","prepare"],y),y};function Gd(f,r,l=""){return`${l}:${r.id||""}:${r.layer.id}:${function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:y,importId:v}=p;return`featureset:${y}${v?`:import:${v}`:""}`}}(f.target)}`}function yf(f,r,l,p=""){if(f.uniqueFeatureID){const y=Gd(f,r,p);if(l.has(y))return!0;l.add(y)}return!1}function Ra(f,r,l,p,y=!1){const v=r.sourceCache.transform,b=r.sourceCache.tilesIn(f,r.has3DLayers,y);b.sort(nl);const C=[];for(const D of b){const R=D.tile.queryRenderedFeatures(r,D,l,p,v,y);Object.keys(R).length&&C.push({wrappedTileID:D.tile.tileID.wrapped().key,queryResults:R})}return 0===C.length?{}:function(D){const R={},O={};for(const N of D){const k=N.queryResults,B=N.wrappedTileID,H=O[B]=O[B]||{};for(const U in k){const q=k[U],$=H[U]=H[U]||{},K=R[U]=R[U]||[];for(const ee of q)$[ee.featureIndex]||($[ee.featureIndex]=!0,K.push(ee))}}return R}(C)}function tl(f,r,l,p,y,v){const b={},C=p.queryRenderedSymbols(f),D=[];for(const R of Object.keys(C).map(Number))D.push(y[R]);D.sort(nl);for(const R of D){const O=R.featureIndex.lookupSymbolFeatures(C[R.bucketInstanceId],R.bucketIndex,R.sourceLayerIndex,r,l,v);for(const N in O){const k=b[N]=b[N]||[],B=O[N];B.sort((H,U)=>{const q=R.featureSortOrder;if(q){const $=q.indexOf(H.featureIndex);return q.indexOf(U.featureIndex)-$}return U.featureIndex-H.featureIndex});for(const H of B)k.push(H)}}return b}function ku(f,r){const l=f.getRenderableIds().map(v=>f.getTileByID(v)),p=[],y={};for(let v=0;v<l.length;v++){const b=l[v],C=b.tileID.canonical.key;y[C]||(y[C]=!0,b.querySourceFeatures(p,r))}return p}function nl(f,r){const l=f.tileID,p=r.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function Xs(f,r){const l={};if(!r)return l;for(const p of f){const y=p.layerIds.map(v=>r.getLayer(v)).filter(Boolean);if(0!==y.length){p.layers=y,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(v=>y.filter(b=>b.id===v)[0]));for(const v of y)l[v.fqid]=p}}return l}const Oa=new Uint16Array(8184);for(let f=0;f<2046;f++){let r=f+2,l=0,p=0,y=0,v=0,b=0,C=0;for(1&r?y=v=b=32:l=p=C=32;(r>>=1)>1;){const R=l+y>>1,O=p+v>>1;1&r?(y=l,v=p,l=b,p=C):(l=y,p=v,y=b,v=C),b=R,C=O}const D=4*f;Oa[D+0]=l,Oa[D+1]=p,Oa[D+2]=y,Oa[D+3]=v}const ha=new Uint16Array(2178),Di=new Uint8Array(1089),Gl=new Uint16Array(1089);function ur(f){return 0===f?-.03125:32===f?.03125:0}const Sc={type:2,extent:d.aj,loadGeometry:()=>[[new d.P(0,0),new d.P(d.aj+1,0),new d.P(d.aj+1,d.aj+1),new d.P(0,d.aj+1),new d.P(0,0)]]};class Dc{constructor(r,l,p,y,v,b){this.tileID=r,this.uid=d.a$(),this.uses=0,this.tileSize=l,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=b}registerFadeDuration(r){const l=r+this.timeAdded;l<d.q.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=d.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,l,p){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=Xs(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const v=this.buckets[y];if(v instanceof d.b1){if(this.hasSymbolBuckets=!0,!p)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const v=this.buckets[y];if(v instanceof d.b1&&v.hasRTLText){this.hasRTLText=!0,d.b2();break}}this.queryPadding=0;for(const y in this.buckets){const v=this.buckets[y],b=l.style.getOwnLayer(y);if(!b)continue;const C=b.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,C)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new d.b0}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(r,l,p){r&&(r.resourceTiming&&(this.resourceTiming=r.resourceTiming),this.buckets=Object.assign({},this.buckets,Xs(r.buckets,l.style)),r.featureIndex&&(this.latestFeatureIndex=r.featureIndex))}getBucket(r){return this.buckets[r.fqid]}upload(r){for(const y in this.buckets){const v=this.buckets[y];v.uploadPending()&&v.upload(r)}const l=r.gl,p=this.imageAtlas;p&&!p.uploaded&&(this.imageAtlasTexture=new d.T(r,p.image,l.RGBA8,{useMipmap:!!p.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new d.T(r,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new d.T(r,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(r,l,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,p),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=l.style.getBrightness();(this._lastUpdatedBrightness||y)&&(this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(l,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}queryRenderedFeatures(r,l,p,y,v,b){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const C=function(D,R){const O=d.bn([],[.5*D.width,.5*-D.height,1]);return d.bo(O,O,[1,-1,0]),d.az(O,O,D.calculateProjMatrix(R.toUnwrapped())),Float32Array.from(O)}(v,this.tileID);return this.latestFeatureIndex.query(r,{tilespaceGeometry:l,pixelPosMatrix:C,transform:y,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(r,l){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const y=p.loadVTLayers(),v=l?l.sourceLayer:"",b=y._geojsonTileLayer||y[v];if(!b)return;const C=d.b3(l&&l.filter),{z:D,x:R,y:O}=this.tileID.canonical,N={z:D,x:R,y:O};for(let k=0;k<b.length;k++){const B=b.feature(k);if(C.needGeometry){const q=d.b4(B,!0);if(!C.filter(new d.aa(this.tileID.overscaledZ,{worldview:this.worldview}),q,this.tileID.canonical))continue}else if(!C.filter(new d.aa(this.tileID.overscaledZ,{worldview:this.worldview}),B))continue;const H=p.getId(B,v),U=new d.b5(B,D,R,O,H);U.tile=N,r.push(U)}}loaded(){return"loaded"===this.state||"errored"===this.state}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const p=d.b6(r.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const p=Date.now();let y=!1;if(this.expirationTime>p)y=!1;else if(l)if(this.expirationTime<l)y=!0;else{const v=this.expirationTime-l;v?this.expirationTime=p+Math.max(v,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}refreshFeatureState(r){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&r&&this.updateBuckets(r)}updateBuckets(r,l){if(!this.latestFeatureIndex||!r.style)return;const p=this.latestFeatureIndex.loadVTLayers(),y=r.style.listImages(),v=r.style.getBrightness();for(const b in this.buckets){if(!r.style.hasLayer(b))continue;const C=this.buckets[b],D=C.layers[0],R=D.sourceLayer||"_geojsonTileLayer",O=p[R],N=r.style.getLayerSourceCache(D);let k={};N&&(k=N._state.getState(R,void 0));const B=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},H=Object.keys(k).length>0&&!l;H&&!C.stateDependentLayers.length&&!l||C.update(k,O,y,B,H?C.stateDependentLayers:C.layers,l,v),(C instanceof d.b7||C instanceof d.b8)&&r._terrain&&r._terrain.enabled&&N&&C.uploadPending()&&r._terrain._clearRenderCacheForTile(N.id,this.tileID);const U=r&&r.style&&r.style.getOwnLayer(b);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(C)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<d.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=d.q.now()+r}setTexture(r,l){const p=l.context,y=p.gl;this.texture=this.texture||l.getTileTexture(r.width),this.texture&&this.texture instanceof d.T?this.texture.update(r):(this.texture=new d.T(p,r,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(r,l){const p={};for(const y of l)p[y]=!0;this.dependencies[r]=p}hasDependency(r,l){for(const p of r){const y=this.dependencies[p];if(y)for(const v of l)if(y[v])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const p=d.b9(Sc,this.tileID.canonical,this.tileTransform)[0],y=new d.ba,v=new d.bb;for(let b=0;b<p.length;b++){const{x:C,y:D}=p[b];y.emplaceBack(C,D),v.emplaceBack(b)}v.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(v),this._tileDebugBuffer=r.createVertexBuffer(y,d.bc.members),this._tileDebugSegments=d.bd.simpleSegment(0,0,y.length,v.length)}_makeTileBoundsBuffers(r,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const p=d.b9(Sc,this.tileID.canonical,this.tileTransform)[0];let y,v;if(this.isRaster){const b=function(C,D){const R=d.aW(C,D),O=Math.pow(2,C.z);for(let q=0;q<33;q++)for(let $=0;$<33;$++){const K=d.aX((C.x+($+ur($))/32)/O),ee=d.aY((C.y+(q+ur(q))/32)/O),ne=D.project(K,ee),le=33*q+$;ha[2*le+0]=Math.round((ne.x*R.scale-R.x)*d.aj),ha[2*le+1]=Math.round((ne.y*R.scale-R.y)*d.aj)}Di.fill(0),Gl.fill(0);for(let q=2045;q>=0;q--){const $=4*q,K=Oa[$+0],ee=Oa[$+1],ne=Oa[$+2],le=Oa[$+3],de=K+ne>>1,pe=ee+le>>1,ae=de+pe-ee,ce=pe+K-de,ue=33*ee+K,Me=33*le+ne,ve=33*pe+de,Ue=Math.hypot((ha[2*ue+0]+ha[2*Me+0])/2-ha[2*ve+0],(ha[2*ue+1]+ha[2*Me+1])/2-ha[2*ve+1])>=16;Di[ve]=Di[ve]||(Ue?1:0),q<1022&&(Di[ve]=Di[ve]||Di[33*(ee+ce>>1)+(K+ae>>1)]||Di[33*(le+ce>>1)+(ne+ae>>1)])}const N=new d.aZ,k=new d.a_;let B=0;function H(q,$){const K=33*$+q;return 0===Gl[K]&&(N.emplaceBack(ha[2*K+0],ha[2*K+1],q*d.aj/32,$*d.aj/32),Gl[K]=++B),Gl[K]-1}function U(q,$,K,ee,ne,le){const de=q+K>>1,pe=$+ee>>1;if(Math.abs(q-ne)+Math.abs($-le)>1&&Di[33*pe+de])U(ne,le,q,$,de,pe),U(K,ee,ne,le,de,pe);else{const ae=H(q,$),ce=H(K,ee),ue=H(ne,le);k.emplaceBack(ae,ce,ue)}}return U(0,0,32,32,32,0),U(32,32,0,0,0,32),{vertices:N,indices:k}}(this.tileID.canonical,l);y=b.vertices,v=b.indices}else{y=new d.aZ,v=new d.a_;for(const{x:C,y:D}of p)y.emplaceBack(C,D,0,0);const b=d.be(y.int16.subarray(0,4*y.length),void 0,4);for(let C=0;C<b.length;C+=3)v.emplaceBack(b[C],b[C+1],b[C+2])}this._tileBoundsBuffer=r.createVertexBuffer(y,d.bf.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(v),this._tileBoundsSegments=d.bd.simpleSegment(0,0,y.length,v.length)}_makeGlobeTileDebugBuffers(r,l){const p=l.projection;if(!p||"globe"!==p.name||l.freezeTileCoverage)return;const y=this.tileID.canonical,v=d.bg(y,l),b=d.bh(v),C=d.ah(l.zoom);let D;C>0&&(D=d.bi(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,y,l,b,D,C),this._makeGlobeTileDebugTextBuffer(r,y,l,b,D,C)}_globePoint(r,l,p,y,v,b,C){let D=d.bj(r,l,p);if(b){const R=1<<p.z,O=d.aD(y.center.lng),N=d.aH(y.center.lat),k=(p.x+.5)/R-O;let B=0;k>.5?B=-1:k<-.5&&(B=1);let H=(r/d.aj+p.x)/R+B,U=(l/d.aj+p.y)/R;H=(H-O)*y._pixelsPerMercatorPixel+O,U=(U-N)*y._pixelsPerMercatorPixel+N;const q=[H*y.worldSize,U*y.worldSize,0];d.ad(q,q,b),D=d.bk(D,q,C)}return d.ad(D,D,v)}_makeGlobeTileDebugBorderBuffer(r,l,p,y,v,b){const C=new d.ba,D=new d.bb,R=new d.bl,O=(k,B,H,U,q)=>{const $=(H-k)/(q-1),K=(U-B)/(q-1),ee=C.length;for(let ne=0;ne<q;ne++){const le=k+ne*$,de=B+ne*K;C.emplaceBack(le,de);const pe=this._globePoint(le,de,l,p,y,v,b);R.emplaceBack(pe[0],pe[1],pe[2]),D.emplaceBack(ee+ne)}},N=d.aj;O(0,0,N,0,16),O(N,0,N,N,16),O(N,N,0,N,16),O(0,N,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(D),this._tileDebugBuffer=r.createVertexBuffer(C,d.bc.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(R,d.bm.members),this._tileDebugSegments=d.bd.simpleSegment(0,0,C.length,D.length)}_makeGlobeTileDebugTextBuffer(r,l,p,y,v,b){const C=d.aj/4,D=new d.ba,R=new d.a_,O=new d.bl,N=25;R.reserve(32),D.reserve(N),O.reserve(N);const k=(B,H)=>N*B+H;for(let B=0;B<N;B++){const H=B*C;for(let U=0;U<N;U++){const q=U*C;D.emplaceBack(q,H);const $=this._globePoint(q,H,l,p,y,v,b);O.emplaceBack($[0],$[1],$[2])}}for(let B=0;B<4;B++)for(let H=0;H<4;H++){const U=k(B,H),q=k(B,H+1),$=k(B+1,H),K=k(B+1,H+1);R.emplaceBack(U,q,$),R.emplaceBack($,q,K)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(R),this._tileDebugTextBuffer=r.createVertexBuffer(D,d.bc.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(O,d.bm.members),this._tileDebugTextSegments=d.bd.simpleSegment(0,0,N,32)}destroy(r=!1){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof d.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}d.bp.setPbf(d.bq);class Ki extends Dc{constructor(r,l,p,y,v){super(r,l,p,y,v),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(r){return this._mrt&&this._mrt.getLayer(r)}setTexturePerLayer(r,l,p){const y=p.context,v=y.gl;let b=this.texturePerLayer.get(r)||p.getTileTexture(l.width);b&&b instanceof d.T?b.update(l,{premultiply:!1}):b=new d.T(y,l,v.RGBA8,{premultiply:!1}),this.texturePerLayer.has(r)||this.texturePerLayer.set(r,b)}flushQueues(r){const l=this._workQueuePerLayer.get(r)||[],p=this._fetchQueuePerLayer.get(r)||[];for(;l.length;)l.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const r of this._workQueuePerLayer.keys()){const l=this._workQueuePerLayer.get(r)||[];for(;l.length;)l.pop()()}for(const r of this._fetchQueuePerLayer.keys()){const l=this._fetchQueuePerLayer.get(r)||[];for(;l.length;)l.pop()()}}fetchHeader(r=16384,l){const p=this._mrt=new d.bp(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=d.br(y,(v,b,C,D)=>{if(v)l(v);else try{const R=p.getHeaderLength(b);if(R>r)return void(this.request=this.fetchHeader(R,l));p.parseHeader(b),this._isHeaderLoaded=!0;let O=0;for(const N of Object.values(p.layers))O=Math.max(O,N.dataIndex[N.dataIndex.length-1].lastByte);b.byteLength>=O&&(this.entireBuffer=b),l(null,this.entireBuffer||b,C,D)}catch(R){l(R)}}),this.request}fetchBand(r,l,p,y){const v=this._mrt;if(!this._isHeaderLoaded||!v)return void y(new Error("Tile header is not ready"));const b=this.actor;if(!b)return void y(new Error("Can't fetch tile band without an actor"));let C;const D=(k,B)=>{if(C.complete(k,B),k)return void y(k);this.updateTextureDescriptor(r,l,p);const H=this.textureDescriptorPerLayer.get(l);y(null,H&&H.img)},R=(k,B)=>{if(k)return y(k);const H=b.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:B,task:C},D,void 0,!0),U=this._workQueuePerLayer.get(l)||[];U.push(()=>{H&&H.cancel(),C.cancel()}),this._workQueuePerLayer.has(l)||this._workQueuePerLayer.set(l,U)},O=v.getLayer(r);if(!O)return void y(new Error(`Unknown sourceLayer "${r}"`));if(O.hasDataForBand(p)){this.updateTextureDescriptor(r,l,p);const k=this.textureDescriptorPerLayer.get(l);return void y(null,k?k.img:null)}const N=O.getDataRange([p]);if(C=v.createDecodingTask(N),!C||C.tasks.length)if(this.flushQueues(l),this.entireBuffer)R(null,this.entireBuffer.slice(N.firstByte,N.lastByte+1));else{const k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${N.firstByte}-${N.lastByte}`}}),B=d.br(k,R),H=this._fetchQueuePerLayer.get(l)||[];H.push(()=>{B.cancel(),C.cancel()}),this._fetchQueuePerLayer.has(l)||this._fetchQueuePerLayer.set(l,H)}else y(null)}updateNeeded(r,l){return(!this.textureDescriptorPerLayer.get(r)||this.textureDescriptorPerLayer.get(r).band!==l)&&"errored"!==this.state}updateTextureDescriptor(r,l,p){if(!this._mrt)return;const y=this._mrt.getLayer(r);if(!y||!y.hasBand(p)||!y.hasDataForBand(p))return;const{bytes:v,tileSize:b,buffer:C,offset:D,scale:R}=y.getBandView(p),O=b+2*C,N=new d.r({width:O,height:O},v),k=this.texturePerLayer.get(l);k&&k instanceof d.T&&k.update(N,{premultiply:!1}),this.textureDescriptorPerLayer.set(l,{layer:r,band:p,img:N,buffer:C,offset:D,tileSize:b,format:y.pixelFormat,mix:[R,256*R,65536*R,16777216*R]})}destroy(r=!1){if(super.destroy(r),delete this._mrt,!r)for(const l of this.texturePerLayer.values())l&&l instanceof d.T&&l.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Nn{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,p){const y=r.wrapped().key;void 0===this.data[y]&&(this.data[y]=[]);const v={value:l,timeout:void 0};if(void 0!==p&&(v.timeout=setTimeout(()=>{this.remove(r,v)},p)),this.data[y].push(v),this.order.push(y),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const p=r.wrapped().key,y=void 0===l?0:this.data[p].indexOf(l),v=this.data[p][y];return this.data[p].splice(y,1),v.timeout&&clearTimeout(v.timeout),0===this.data[p].length&&delete this.data[p],this.onRemove(v.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const p in this.data)for(const y of this.data[p])r(y.value)||l.push(y);for(const p of l)this.remove(p.value.tileID,p)}}class $d{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,p){const y=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][y]=this.stateChanges[r][y]||{},d.h(this.stateChanges[r][y],p),null===this.deletedStates[r]){this.deletedStates[r]={};for(const v in this.state[r])v!==y&&(this.deletedStates[r][v]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][y]){this.deletedStates[r][y]={};for(const v in this.state[r][y])p[v]||(this.deletedStates[r][y][v]=null)}else for(const v in p)this.deletedStates[r]&&this.deletedStates[r][y]&&null===this.deletedStates[r][y][v]&&delete this.deletedStates[r][y][v]}removeFeatureState(r,l,p){if(null===this.deletedStates[r])return;const y=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},p&&void 0!==l)null!==this.deletedStates[r][y]&&(this.deletedStates[r][y]=this.deletedStates[r][y]||{},this.deletedStates[r][y][p]=null);else if(void 0!==l)if(this.stateChanges[r]&&this.stateChanges[r][y])for(p in this.deletedStates[r][y]={},this.stateChanges[r][y])this.deletedStates[r][y][p]=null;else this.deletedStates[r][y]=null;else this.deletedStates[r]=null}getState(r,l){const p=this.state[r]||{},y=this.stateChanges[r]||{},v=this.deletedStates[r];if(null===v)return{};if(void 0!==l){const C=String(l),D=d.h({},p[C],y[C]);if(v){const R=v[l];if(null===R)return{};for(const O in R)delete D[O]}return D}const b=d.h({},p,y);if(v)for(const C in v)delete b[C];return b}initializeTileState(r,l){r.refreshFeatureState(l)}coalesceChanges(r,l){const p={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const v={};for(const b in this.stateChanges[y])this.state[y][b]||(this.state[y][b]={}),d.h(this.state[y][b],this.stateChanges[y][b]),v[b]=this.state[y][b];p[y]=v}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const v={};if(null===this.deletedStates[y])for(const b in this.state[y])v[b]={},this.state[y][b]={};else for(const b in this.deletedStates[y]){if(null===this.deletedStates[y][b])this.state[y][b]={};else if(this.state[y][b])for(const C of Object.keys(this.deletedStates[y][b]))delete this.state[y][b][C];v[b]=this.state[y][b]}p[y]=p[y]||{},d.h(p[y],v)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(p).length)for(const y in r)r[y].refreshFeatureState(l)}}class Ro extends d.E{constructor(r,l,p){super(),this.id=r,this._onlySymbols=p,l.on("data",y=>{"source"===y.dataType&&"metadata"===y.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===y.dataType&&"content"===y.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new Nn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new $d,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(r){this.map=r,this._minTileCacheSize=void 0===this._minTileCacheSize&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles)if(!this._tiles[r].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const p=this._tiles[l];p.upload(r),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(Fu).map(r=>r.key)}getRenderableIds(r,l){const p=[];for(const y in this._tiles)this._isIdRenderable(+y,r,l)&&p.push(this._tiles[y]);return r?p.sort((y,v)=>{const b=y.tileID,C=v.tileID,D=new d.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),R=new d.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-C.overscaledZ||R.y-D.y||R.x-D.x}).map(y=>y.tileID.key):p.map(y=>y.tileID).sort(Fu).map(y=>y.key)}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l,p){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())&&(p||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){const p=this._tiles[r];p&&("loading"!==p.state&&(p.state=l),this._loadTile(p,this._tileLoaded.bind(this,p,r,l)))}_tileLoaded(r,l,p,y){if(y)if(r.state="errored",404!==y.status)this._source.fire(new d.z(y,{tile:r}));else{if(this._source.fire(new d.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=d.q.now(),"expired"===p&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new d.A("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const l=this.getRenderableIds();for(let y=0;y<l.length;y++){const v=l[y];if(r.neighboringTiles&&r.neighboringTiles[v]){const b=this.getTileByID(v);p(r,b),p(b,r)}}function p(y,v){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let b=v.tileID.canonical.x-y.tileID.canonical.x;const C=v.tileID.canonical.y-y.tileID.canonical.y,D=Math.pow(2,y.tileID.canonical.z),R=v.tileID.key;0===b&&0===C||Math.abs(C)>1||(Math.abs(b)>1&&(1===Math.abs(b+D)?b+=D:1===Math.abs(b-D)&&(b-=D)),v.dem&&y.dem&&(y.dem.backfillBorder(v.dem,b,C),y.neighboringTiles&&y.neighboringTiles[R]&&(y.neighboringTiles[R].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,p,y){for(const v in this._tiles){let b=this._tiles[v];if(y[v]||!b.hasData()||b.tileID.overscaledZ<=l||b.tileID.overscaledZ>p)continue;let C=b.tileID;for(;b&&b.tileID.overscaledZ>l+1;){const R=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[R.key],b&&b.hasData()&&(C=R)}let D=C;for(;D.overscaledZ>l;)if(D=D.scaledTo(D.overscaledZ-1),r[D.key]){y[C.key]=C;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const p=this._loadedParentTiles[r.key];return p&&p.tileID.overscaledZ>=l?p:null}for(let p=r.overscaledZ-1;p>=l;p--){const y=r.scaledTo(p),v=this._getLoadedTile(y);if(v)return v}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;const p=Math.ceil(r.width/l)+1,y=Math.ceil(r.height/l)+1,v=Math.floor(p*y*5),b="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,v):v,C="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(C)}handleWrapJump(r){const l=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,l){const p={};for(const y in this._tiles){const v=this._tiles[y];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+l),p[v.tileID.key]=v}this._tiles=p;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(r,l,p,y,v){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(r,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const b="batched-model"===this._source.type;let C,D=this._source.maxzoom;const R=this.map&&this.map.painter?this.map.painter._terrain:null;if(R&&R.sourceCache===this&&R.attenuationRange()){const k=R.attenuationRange()[0],B=Math.floor(k)-Math.log2(R.getDemUpscale());D>B&&(D=B)}if(this.used||this.usedForTerrain){if(this._source.tileID)C=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new d.aM(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y));else if(0!==this.tileCoverLift){const k=r.clone();k.tileCoverLift=this.tileCoverLift,C=k.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.minzoom<=1&&"globe"===r.projection.name&&(C.push(new d.aM(1,0,1,0,0)),C.push(new d.aM(1,0,1,1,0)),C.push(new d.aM(1,0,1,0,1)),C.push(new d.aM(1,0,1,1,1)))}else if(C=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:b}),this._source.hasTile){const k=this._source.hasTile.bind(this._source);C=C.filter(B=>k(B))}}else C=[];if(C.length>0&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Lu(this._source.type)){const k=r.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),B=Math.min(k,this._source.maxzoom);if(b){const H=r.extendTileCover(C,B);for(const U of H)C.push(U)}else if(v){const H=r.extendTileCoverToNearPlane(C,this.transform.getFrustum(B),B);for(const U of H)C.push(U)}else if(this.castsShadows&&y){const H=r.extendTileCover(C,B,y);for(const U of H)this._shadowCasterTiles[U.key]=!0,C.push(U)}}const O=this._updateRetainedTiles(C);if(Lu(this._source.type)&&0!==C.length){const k={},B={},H=Object.keys(O);for(const q of H){const $=O[q],K=this._tiles[q];if(!K||K.fadeEndTime&&K.fadeEndTime<=d.q.now())continue;const ee=this.findLoadedParent($,Math.max($.overscaledZ-Ro.maxOverzooming,this._source.minzoom));ee&&(this._addTile(ee.tileID),k[ee.tileID.key]=ee.tileID),B[q]=$}const U=C[C.length-1].overscaledZ;for(const q in this._tiles){const $=this._tiles[q];if(O[q]||!$.hasData())continue;let K=$.tileID;for(;K.overscaledZ>U;){K=K.scaledTo(K.overscaledZ-1);const ee=this._tiles[K.key];if(ee&&ee.hasData()&&B[K.key]){O[q]=$.tileID;break}}}for(const q in k)O[q]||(this._coveredTiles[q]=!0,O[q]=k[q])}for(const k in O)this._tiles[k].clearFadeHold();const N=d.bs(this._tiles,O);for(const k of N){const B=this._tiles[k];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(+k)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const l={};if(0===r.length)return l;const p={},y=r.reduce((R,O)=>Math.min(R,O.overscaledZ),1/0),v=r[0].overscaledZ,b=Math.max(v-Ro.maxOverzooming,this._source.minzoom),C=Math.max(v+Ro.maxUnderzooming,this._source.minzoom),D={};for(const R of r){const O=this._addTile(R);l[R.key]=R,O.hasData()||y<this._source.maxzoom&&(D[R.key]=R)}this._retainLoadedChildren(D,y,C,l);for(const R of r){let O=this._tiles[R.key];if(O.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const k=R.children(this._source.maxzoom)[0],B=this.getTile(k);if(B&&B.hasData()){l[k.key]=k;continue}}else{const k=R.children(this._source.maxzoom);if(l[k[0].key]&&l[k[1].key]&&l[k[2].key]&&l[k[3].key])continue}let N=O.wasRequested();for(let k=R.overscaledZ-1;k>=b;--k){const B=R.scaledTo(k);if(p[B.key]||(p[B.key]=!0,O=this.getTile(B),!O&&N&&(O=this._addTile(B)),O&&(l[B.key]=B,N=O.wasRequested(),O.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let p,y=this._tiles[r].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){p=this._loadedParentTiles[y.key];break}l.push(y.key);const v=y.scaledTo(y.overscaledZ-1);if(p=this._getLoadedTile(v),p)break;y=v}for(const v of l)this._loadedParentTiles[v]=p}}_addTile(r){let l=this._tiles[r.key];if(l)return!0!==l.isExtraShadowCaster||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const p=!!l;if(!p){const y=this.map?this.map.painter:null,v=this._source.tileSize*r.overscaleFactor();l="raster-array"===this._source.type?new Ki(r,v,this.transform.tileZoom,y,this._isRaster):new Dc(r,v,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))}return l.uses++,this._tiles[r.key]=l,p||this._source.fire(new d.A("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const p=l.getExpiryTimeout();p&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},p))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&"reloading"!==l.state||"empty"===l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,l,p){const y=[],v=this.transform;if(!v)return y;const b="globe"===v.projection.name,C=d.aD(v.center.lng);for(const D in this._tiles){const R=this._tiles[D];if(p&&R.clearQueryDebugViz(),R.holdingForFade())continue;let O;if(b){const N=R.tileID.canonical;if(0===N.z){const k=[Math.abs(d.ay(C,...bt(N,-1))-C),Math.abs(d.ay(C,...bt(N,1))-C)];O=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(d.ay(C,...bt(N,-1))-C),Math.abs(d.ay(C,...bt(N,0))-C),Math.abs(d.ay(C,...bt(N,1))-C)];O=[k.indexOf(Math.min(...k))-1]}}else O=[0];for(const N of O){const k=r.containsTile(R,v,l,N);k&&y.push(k)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,l){const p=this.getRenderableIds(r,l).map(v=>this._tiles[v].tileID),y="globe"===this.transform.projection.name;for(const v of p)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=y?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return p}sortCoordinatesByDistance(r){const l=r.slice(),p=this.transform._camera.position,y=this.transform._camera.forward(),v={};for(const b of l){const C=1/(1<<b.canonical.z);v[b.key]=((b.canonical.x+.5)*C+b.wrap-p[0])*y[0]+((b.canonical.y+.5)*C-p[1])*y[1]-p[2]*y[2]}return l.sort((b,C)=>v[b.key]-v[C.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(Lu(this._source.type))for(const r in this._tiles){const l=this._tiles[r];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=d.q.now())return!0}return!1}setFeatureState(r,l,p){this._state.updateState(r=r||"_geojsonTileLayer",l,p)}removeFeatureState(r,l,p){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,p)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,p){const y=this._tiles[r];y&&y.setDependencies(l,p)}reloadTilesForDependencies(r,l){for(const p in this._tiles)this._tiles[p].hasDependency(r,l)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(r,l))}_preloadTiles(r,l){if(!this._sourceLoaded){const D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(r,l))};return void this._source.on("data",D)}const p=new Map,y=Array.isArray(r)?r:[r],v=this.map.painter.terrain,b=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const D of y){const R=D.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const O of R)p.set(O.key,O);this.usedForTerrain&&D.updateElevation(!1)}const C=Array.from(p.values());d.bt(C,(D,R)=>{const O=new Dc(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(O,N=>{"raster-dem"===this._source.type&&O.dem&&this._backfillDEM(O),R(N,O)})},l)}}function Fu(f,r){const l=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*r.wrap)-+(r.wrap<0);return f.overscaledZ-r.overscaledZ||p-l||r.canonical.y-f.canonical.y||r.canonical.x-f.canonical.x}function Lu(f){return"raster"===f||"image"===f||"video"===f||"custom"===f}function bt(f,r){const l=1<<f.z;return[f.x/l+r,(f.x+1)/l+r]}Ro.maxOverzooming=10,Ro.maxUnderzooming=3;class qd{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];for(const p in this.style._mergedLayers){const y=this.style._mergedLayers[p];if("fill-extrusion"===y.type||"building"===y.type)this.layers.push({layer:y,visible:false,visibilityChanged:false});else if("model"===y.type){const v=this.style.getLayerSource(y);v&&"batched-model"===v.type&&this.layers.push({layer:y,visible:false,visibilityChanged:false})}}}onNewFrame(r){this.layersGotHidden=!1;for(const l of this.layers){const p=l.layer;let y=!1;"fill-extrusion"===p.type?y=!p.isHidden(r)&&p.paint.get("fill-extrusion-opacity")>0:"building"===p.type?y=!p.isHidden(r)&&p.paint.get("building-opacity")>0:"model"===p.type&&(y=!p.isHidden(r)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&l.visible,l.visible=y}}updateZOffset(r,l){this.currentBuildingBuckets=[];for(const y of this.layers){const v=y.layer,b=this.style.getLayerSourceCache(v);let C=1;"fill-extrusion"===v.type?C=y.visible?v.paint.get("fill-extrusion-vertical-scale"):0:"building"===v.type&&(C=y.visible?v.paint.get("building-vertical-scale"):0);let D=b?b.getTile(l):null;if(!D&&b)for(const R in b._tiles){const O=b._tiles[R];if(l.canonical.isChildOf(O.tileID.canonical)){D=O;break}}this.currentBuildingBuckets.push({bucket:D?D.getBucket(v):null,tileID:D?D.tileID:l,verticalScale:C})}r.hasAnyZOffset=!1;let p=!1;for(let y=0;y<r.symbolInstances.length;y++){const v=r.symbolInstances.get(y),b=v.zOffset,C=this._getHeightAtTileOffset(l,v.tileAnchorX,v.tileAnchorY);v.zOffset=C!==Number.NEGATIVE_INFINITY?C:b,p||b===v.zOffset||(p=!0),r.hasAnyZOffset||0===v.zOffset||(r.hasAnyZOffset=!0)}p&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,l,p,y){let v=l,b=p;if(r.canonical.z!==y.canonical.z){const C=y.canonical,D=1/(1<<r.canonical.z-C.z);v=(l+r.canonical.x*d.aj)*D-C.x*d.aj|0,b=(p+r.canonical.y*d.aj)*D-C.y*d.aj|0}return{tileX:v,tileY:b}}_getHeightAtTileOffset(r,l,p){let y,v;for(let b=0;b<this.layers.length;++b){const C=this.layers[b].layer;if("fill-extrusion"!==C.type&&"building"!==C.type)continue;const{bucket:D,tileID:R,verticalScale:O}=this.currentBuildingBuckets[b];if(!D)continue;const{tileX:N,tileY:k}=this._mapCoordToOverlappingTile(r,l,p,R),B=D.getHeightAtTileCoord(N,k);B&&void 0!==B.height&&(B.hidden?y=B.height:v=Math.max(B.height*O,v||0))}if(void 0!==v)return v;for(let b=0;b<this.layers.length;++b){const C=this.layers[b];if("model"!==C.layer.type||!C.visible)continue;const{bucket:D,tileID:R}=this.currentBuildingBuckets[b];if(!D)continue;const{tileX:O,tileY:N}=this._mapCoordToOverlappingTile(r,l,p,R),k=D.getHeightAtTileCoord(O,N);if(k&&!k.hidden)return void 0===k.height&&void 0!==y?Math.min(k.maxHeight,y)*k.verticalScale:k.height?k.height*k.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Wn(f,r){const l={};for(const p in f)"ref"!==p&&(l[p]=f[p]);return d.bu.forEach(p=>{p in r&&(l[p]=r[p])}),l}function Li(f){f=f.slice();const r=Object.create(null);for(let l=0;l<f.length;l++)r[f[l].id]=f[l];for(let l=0;l<f.length;l++)"ref"in f[l]&&(f[l]=Wn(f[l],r[f[l].ref]));return f}const On={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Kp(f,r,l){l.push({command:On.addSource,args:[f,r[f]]})}function Nu(f,r,l){r.push({command:On.removeSource,args:[f]}),l[f]=!0}function Ic(f,r,l,p){Nu(f,l,p),Kp(f,r,l)}function Bs(f,r,l){let p;for(p in f[l])if(f[l].hasOwnProperty(p)&&"data"!==p&&!d.bv(f[l][p],r[l][p]))return!1;for(p in r[l])if(r[l].hasOwnProperty(p)&&"data"!==p&&!d.bv(f[l][p],r[l][p]))return!1;return!0}function vf(f,r,l,p,y,v){let b;for(b in r=r||{},f=f||{})f.hasOwnProperty(b)&&(d.bv(f[b],r[b])||l.push({command:v,args:[p,b,r[b],y]}));for(b in r)r.hasOwnProperty(b)&&!f.hasOwnProperty(b)&&(d.bv(f[b],r[b])||l.push({command:v,args:[p,b,r[b],y]}))}function Ac(f){return f.id}function Mc(f,r){return f[r.id]=r,f}function fa(f,r,l){const p=r.createTileMatrix(f,f.worldSize,l.toUnwrapped());return d.az(new Float32Array(16),f.projMatrix,p)}function Tv(f,r,l){if(r.projection.name===l.projection.name)return f.projMatrix;const p=l.clone();return p.setProjection(r.projection),fa(p,r.getProjection(),f)}function Jp(f,r,l){return r.name===l.projection.name?f.projMatrix:fa(l,r,f)}class Cv{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=d.ay(r,0,1);let l=1,p=this._distances[l];const y=r*this.paddedLength+this.padding;for(;p<y&&l<this._distances.length;)p=this._distances[++l];const v=l-1,b=this._distances[v],C=p-b,D=C>0?(y-b)/C:0;return this.points[v].mult(1-D).add(this.points[l].mult(D))}}class Wd{constructor(r,l,p){const y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(l/p);for(let b=0;b<this.xCellCount*this.yCellCount;b++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,p,y,v){this._forEachCell(l,p,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(r,l,p,y){this._forEachCell(l-y,p-y,l+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(p),this.circles.push(y)}_insertBoxCell(r,l,p,y,v,b){this.boxCells[v].push(b)}_insertCircleCell(r,l,p,y,v,b){this.circleCells[v].push(b)}_query(r,l,p,y,v,b){if(p<0||r>this.width||y<0||l>this.height)return!v&&[];const C=[];if(r<=0&&l<=0&&this.width<=p&&this.height<=y){if(v)return!0;for(let D=0;D<this.boxKeys.length;D++)C.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const R=this.circles[3*D],O=this.circles[3*D+1],N=this.circles[3*D+2];C.push({key:this.circleKeys[D],x1:R-N,y1:O-N,x2:R+N,y2:O+N})}return b?C.filter(b):C}return this._forEachCell(r,l,p,y,this._queryCell,C,{hitTest:v,seenUids:{box:{},circle:{}}},b),v?C.length>0:C}_queryCircle(r,l,p,y,v){const b=r-p,C=r+p,D=l-p,R=l+p;if(C<0||b>this.width||R<0||D>this.height)return!y&&[];const O=[];return this._forEachCell(b,D,C,R,this._queryCellCircle,O,{hitTest:y,circle:{x:r,y:l,radius:p},seenUids:{box:{},circle:{}}},v),y?O.length>0:O}query(r,l,p,y,v){return this._query(r,l,p,y,!1,v)}hitTest(r,l,p,y,v){return this._query(r,l,p,y,!0,v)}hitTestCircle(r,l,p,y){return this._queryCircle(r,l,p,!0,y)}_queryCell(r,l,p,y,v,b,C,D){const R=C.seenUids,O=this.boxCells[v];if(null!==O){const k=this.bboxes;for(const B of O)if(!R.box[B]){R.box[B]=!0;const H=4*B;if(r<=k[H+2]&&l<=k[H+3]&&p>=k[H+0]&&y>=k[H+1]&&(!D||D(this.boxKeys[B]))){if(C.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[B],x1:k[H],y1:k[H+1],x2:k[H+2],y2:k[H+3]})}}}const N=this.circleCells[v];if(null!==N){const k=this.circles;for(const B of N)if(!R.circle[B]){R.circle[B]=!0;const H=3*B;if(this._circleAndRectCollide(k[H],k[H+1],k[H+2],r,l,p,y)&&(!D||D(this.circleKeys[B]))){if(C.hitTest)return b.push(!0),!0;{const U=k[H],q=k[H+1],$=k[H+2];b.push({key:this.circleKeys[B],x1:U-$,y1:q-$,x2:U+$,y2:q+$})}}}}}_queryCellCircle(r,l,p,y,v,b,C,D){const R=C.circle,O=C.seenUids,N=this.boxCells[v];if(null!==N){const B=this.bboxes;for(const H of N)if(!O.box[H]){O.box[H]=!0;const U=4*H;if(this._circleAndRectCollide(R.x,R.y,R.radius,B[U+0],B[U+1],B[U+2],B[U+3])&&(!D||D(this.boxKeys[H])))return b.push(!0),!0}}const k=this.circleCells[v];if(null!==k){const B=this.circles;for(const H of k)if(!O.circle[H]){O.circle[H]=!0;const U=3*H;if(this._circlesCollide(B[U],B[U+1],B[U+2],R.x,R.y,R.radius)&&(!D||D(this.circleKeys[H])))return b.push(!0),!0}}}_forEachCell(r,l,p,y,v,b,C,D){const R=this._convertToXCellCoord(r),O=this._convertToYCellCoord(l),N=this._convertToXCellCoord(p),k=this._convertToYCellCoord(y);for(let B=R;B<=N;B++)for(let H=O;H<=k;H++)if(v.call(this,r,l,p,y,this.xCellCount*H+B,b,C,D))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,p,y,v,b){const C=y-r,D=v-l,R=p+b;return R*R>C*C+D*D}_circleAndRectCollide(r,l,p,y,v,b,C){const D=(b-y)/2,R=Math.abs(r-(y+D));if(R>D+p)return!1;const O=(C-v)/2,N=Math.abs(l-(v+O));if(N>O+p)return!1;if(R<=D||N<=O)return!0;const k=R-D,B=N-O;return k*k+B*B<=p*p}}const Pc={unknown:0,flipRequired:1,flipNotRequired:2},Sv=Math.tan(85*Math.PI/180);function Zd(f,r,l,p,y,v,b){const C=d.bz();if(l)if("globe"===v.name){const D=d.bA(y,r);d.az(C,C,D)}else{const D=d.bB([],b);C[0]=D[0],C[1]=D[1],C[4]=D[2],C[5]=D[3],p||d.by(C,C,y.angle)}else d.az(C,y.labelPlaneMatrix,f);return C}function Xd(f,r,l,p,y,v,b){const C=Zd(f,r,l,p,y,v,b);return"globe"===v.name&&l||(C[2]=C[6]=C[10]=C[14]=0),C}function Yr(f,r,l,p,y,v,b){if(l){if("globe"===v.name){const C=Zd(f,r,l,p,y,v,b);return d.bi(C,C),d.az(C,f,C),C}{const C=d.bw(f),D=d.bx([]);return D[0]=b[0],D[1]=b[1],D[4]=b[2],D[5]=b[3],d.az(C,C,D),p||d.by(C,C,-y.angle),C}}return y.glCoordMatrix}function yn(f,r,l,p){const y=[f,r,l,1];l?d.aA(y,y,p):Yd(y,y,p);const v=y[3];return y[0]/=v,y[1]/=v,y[2]/=v,y}function i_(f,r){return Math.min(.5+f/r*.5,1.5)}function r_(f,r){const l=f[0]/f[3],p=f[1]/f[3];return l>=-r[0]&&l<=r[0]&&p>=-r[1]&&p<=r[1]}function zu(f,r,l,p,y,v,b,C,D,R){const O=l.transform,N=p?f.textSizeData:f.iconSizeData,k=d.bH(N,l.transform.zoom),B="globe"===O.projection.name,H=[256/l.width*2+1,256/l.height*2+1],U=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;U.clear();let q=null;B&&(q=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const $=f.lineVertexArray,K=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ee=l.transform.width/l.transform.height;let ne,le=!1;for(let de=0;de<K.length;de++){const pe=K.get(de),{numGlyphs:ae,writingMode:ce}=pe;if(ce!==d.bI.vertical||le||ne===d.bI.horizontal||(le=!0),ne=ce,(pe.hidden||ce===d.bI.vertical)&&!le){ju(ae,U);continue}le=!1;const ue=new d.P(pe.tileAnchorX,pe.tileAnchorY);let{x:Me,y:ve,z:Ue}=O.projection.projectTilePoint(ue.x,ue.y,R.canonical);if(D){const[Pt,Ft,vt]=D(ue);Me+=Pt,ve+=Ft,Ue+=vt}const ke=[Me,ve,Ue,1];if(d.aA(ke,ke,r),!r_(ke,H)){ju(ae,U);continue}const Ge=ke[3],rt=i_(l.transform.getCameraToCenterDistance(O.projection),Ge),Ce=d.bJ(N,k,pe),_e=b?Ce/rt:Ce*rt,Ne=yn(Me,ve,Ue,y);if(Ne[3]<=0){ju(ae,U);continue}let Re={};const We=d.al(f.layers[0].layout.get("text-max-angle")),Ze=Math.cos(We),Ye=b?null:D,dt=Tr(pe,_e,!1,C,r,y,v,f.glyphOffsetArray,$,U,q,Ne,ue,Re,ee,Ye,O.projection,R,b,Ze);le=dt.useVertical,Ye&&dt.needsFlipping&&(Re={}),(dt.notEnoughRoom||le||dt.needsFlipping&&Tr(pe,_e,!0,C,r,y,v,f.glyphOffsetArray,$,U,q,Ne,ue,Re,ee,Ye,O.projection,R,b,Ze).notEnoughRoom)&&ju(ae,U)}p?(f.text.dynamicLayoutVertexBuffer.updateData(U),q&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(q)):(f.icon.dynamicLayoutVertexBuffer.updateData(U),q&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(q))}function Kt(f,r,l,p,y,v,b,C,D,R,O,N,k,B,H,U,q){const{lineStartIndex:$,glyphStartIndex:K,segment:ee}=C,ne=K+C.numGlyphs,le=$+C.lineLength,de=r.getoffsetX(K),pe=r.getoffsetX(ne-1),ae=Vu(f*de,l,p,y,v,b,ee,$,le,D,R,O,N,k,!0,B,H,U,q);if(!ae)return null;const ce=Vu(f*pe,l,p,y,v,b,ee,$,le,D,R,O,N,k,!0,B,H,U,q);return ce?{first:ae,last:ce}:null}function o_(f,r,l,p){return f===d.bI.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:f===d.bI.vertical?p>0?{needsFlipping:!0}:null:r!==Pc.unknown&&(0===(y=l)||Math.abs(p/y)>Sv)?r===Pc.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null;var y}function Tr(f,r,l,p,y,v,b,C,D,R,O,N,k,B,H,U,q,$,K,ee){const ne=r/24,le=f.lineOffsetX*ne,de=f.lineOffsetY*ne,{lineStartIndex:pe,glyphStartIndex:ae,numGlyphs:ce,segment:ue,writingMode:Me,flipState:ve}=f,Ue=pe+f.lineLength,ke=Ge=>{if(O){const[Ne,Re,We]=Ge.up,Ze=R.length;d.bK(O,Ze+0,Ne,Re,We),d.bK(O,Ze+1,Ne,Re,We),d.bK(O,Ze+2,Ne,Re,We),d.bK(O,Ze+3,Ne,Re,We)}const[rt,Ce,_e]=Ge.point;d.bL(R,rt,Ce,_e,Ge.angle)};if(ce>1){const Ge=Kt(ne,C,le,de,l,N,k,f,D,v,B,U,!1,q,$,K,ee);if(!Ge)return{notEnoughRoom:!0};if(p&&!l){let[rt,Ce,_e]=Ge.first.point,[Ne,Re,We]=Ge.last.point;[rt,Ce]=yn(rt,Ce,_e,b),[Ne,Re]=yn(Ne,Re,We,b);const Ze=o_(Me,ve,(Ne-rt)*H,Re-Ce);if(f.flipState=Ze&&Ze.needsFlipping?Pc.flipRequired:Pc.flipNotRequired,Ze)return Ze}ke(Ge.first);for(let rt=ae+1;rt<ae+ce-1;rt++){const Ce=Vu(ne*C.getoffsetX(rt),le,de,l,N,k,ue,pe,Ue,D,v,B,U,!1,!1,q,$,K,ee);if(!Ce)return R.length-=4*(rt-ae),{notEnoughRoom:!0};ke(Ce)}ke(Ge.last)}else{if(p&&!l){const rt=yn(k.x,k.y,0,y),Ce=pe+ue+1,_e=new d.P(D.getx(Ce),D.gety(Ce)),Ne=yn(_e.x,_e.y,0,y),Re=Ne[3]>0?Ne:Jn(k,_e,rt,1,y,void 0,q,$.canonical),We=o_(Me,ve,(Re[0]-rt[0])*H,Re[1]-rt[1]);if(f.flipState=We&&We.needsFlipping?Pc.flipRequired:Pc.flipNotRequired,We)return We}const Ge=Vu(ne*C.getoffsetX(ae),le,de,l,N,k,ue,pe,Ue,D,v,B,U,!1,!1,q,$,K,ee);if(!Ge)return{notEnoughRoom:!0};ke(Ge)}return{}}function Bu(f,r,l,p,y){const{x:v,y:b,z:C}=p.projectTilePoint(f.x,f.y,r);if(!y)return yn(v,b,C,l);const[D,R,O]=y(f);return yn(v+D,b+R,C+O,l)}function Jn(f,r,l,p,y,v,b,C){const D=Bu(f.sub(r)._unit()._add(f),C,y,b,v);return d.at(D,l,D),d.au(D,D),d.bE(D,l,D,p)}function Vu(f,r,l,p,y,v,b,C,D,R,O,N,k,B,H,U,q,$,K){const ee=p?f-r:f+r;let ne=ee>0?1:-1,le=0;p&&(ne*=-1,le=Math.PI),ne<0&&(le+=Math.PI);let de=C+b+(ne>0?0:1)|0,pe=y,ae=y,ce=0,ue=0;const Me=Math.abs(ee),ve=[],Ue=[];let ke=v,Ge=ke,rt=d.bC([]);const Ce=()=>Jn(Ge,ke,ae,Me-ce+1,O,k,U,q.canonical);for(;ce+ue<=Me;){if(de+=ne,de<C||de>=D)return null;if(ae=pe,Ge=ke,ve.push(ae),B&&Ue.push(Ge),ke=new d.P(R.getx(de),R.gety(de)),pe=N[de],!pe){const vt=Bu(ke,q.canonical,O,U,k);pe=vt[3]>0?N[de]=vt:Ce()}ce+=ue;const Pt=d.at([],pe,ae),Ft=d.bD(ae,pe);if(l&&Ft>0&&ue>0&&d.bG(rt,Pt)/(ue*Ft)<K)return null;ue=Ft,rt=Pt}H&&k&&(N[de]&&(pe=Ce(),ue=d.bD(ae,pe),rt=d.at([],pe,ae)),N[de]=pe);const _e=(Me-ce)/ue,Ne=ke.sub(Ge)._mult(_e)._add(Ge),Re=d.bE([],ae,rt,_e);let We=[0,0,1],Ze=rt[0],Ye=rt[1];if($&&(We=U.upVector(q.canonical,Ne.x,Ne.y),0!==We[0]||0!==We[1]||1!==We[2])){const Pt=[We[2],0,-We[0]],Ft=d.bF([],We,Pt);d.au(Pt,Pt),d.au(Ft,Ft),Ze=d.bG(rt,Pt),Ye=d.bG(rt,Ft)}if(l){const Pt=d.bF([],We,rt);d.au(Pt,Pt),d.bE(Re,Re,Pt,l*ne)}const dt=le+Math.atan2(Ye,Ze);return ve.push(Re),B&&Ue.push(Ne),{point:Re,angle:dt,path:ve,tilePath:Ue,up:We}}function ju(f,r){const l=r.length,p=l+4*f;r.resize(p),r.float32.fill(-1/0,4*l,4*p)}function Yd(f,r,l){const p=r[0],y=r[1];return f[0]=l[0]*p+l[4]*y+l[12],f[1]=l[1]*p+l[5]*y+l[13],f[3]=l[3]*p+l[7]*y+l[15],f}const Nt=100;class xf{constructor(r,l,p=new Wd(r.width+200,r.height+200,25),y=new Wd(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Nt,this.screenBottomBoundary=r.height+Nt,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,p,y,v,b,C,D,R,O,N){let k=p.projectedAnchorX,B=p.projectedAnchorY,H=p.projectedAnchorZ;const U=p.tileAnchorX,q=p.tileAnchorY,$=p.elevation,K=p.tileID,ee=r.getProjection();if($&&K){const[Ue,ke,Ge]=ee.upVector(K.canonical,p.tileAnchorX,p.tileAnchorY),rt=ee.upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=Ue*$*rt,B+=ke*$*rt,H+=Ge*$*rt}const ne="globe"===r.projection.name,le="globe"===r.projection.name?d.ah(this.transform.zoom):0;if(K&&ne&&le<1&&!b){const Ue=1<<K.canonical.z,ke=d.bM(U,q);d.bN(ke,ke,1/d.aj),d.bO(ke,ke,d.bM(K.canonical.x,K.canonical.y)),d.bN(ke,ke,1/Ue),d.bP(ke,ke,d.bM(y[0],y[1])),ke[0]=d.bQ(ke[0],-.5,.5),d.bN(ke,ke,d.aj);const Ge=d.bR(ke[0],ke[1],d.aj/(2*Math.PI),1);d.aA(Ge,Ge,v),k=d.ai(k,Ge[0],le),B=d.ai(B,Ge[1],le),H=d.ai(H,Ge[2],le)}const de=this.projectAndGetPerspectiveRatio(O,k,B,H,p.tileID,"globe"===ee.name||!!$||this.transform.pitch>0,ee),pe=R*de.perspectiveRatio,ae=(p.x1*l+C.x-p.padding)*pe+de.point.x,ce=(p.y1*l+C.y-p.padding)*pe+de.point.y,ue=(p.x2*l+C.x+p.padding)*pe+de.point.x,Me=(p.y2*l+C.y+p.padding)*pe+de.point.y,ve=de.perspectiveRatio<=.55||de.occluded;return!this.isInsideGrid(ae,ce,ue,Me)||!D&&this.grid.hitTest(ae,ce,ue,Me,N)||ve?{box:[],offscreen:!1,occluded:de.occluded}:{box:[ae,ce,ue,Me],offscreen:this.isOffscreen(ae,ce,ue,Me),occluded:!1}}placeCollisionCircles(r,l,p,y,v,b,C,D,R,O,N,k,B,H,U){const q=[],$=this.transform.elevation,K=r.getProjection(),ee=$?$.getAtTileOffsetFunc(U,this.transform.center.lat,this.transform.worldSize,K):null,ne=new d.P(p.tileAnchorX,p.tileAnchorY);let{x:le,y:de,z:pe}=K.projectTilePoint(ne.x,ne.y,U.canonical);if(ee){const[We,Ze,Ye]=ee(ne);le+=We,de+=Ze,pe+=Ye}const ae="globe"===K.name,ce=this.projectAndGetPerspectiveRatio(C,le,de,pe,U,ae||!!$||this.transform.pitch>0,K),{perspectiveRatio:ue}=ce,Me=(N?b/ue:b*ue)/d.bU,ve=yn(le,de,pe,D),Ue=p.lineOffsetX*Me,ke=p.lineOffsetY*Me,Ge=d.al(r.layers[0].layout.get("text-max-angle")),rt=Math.cos(Ge),Ce=ce.signedDistanceFromCamera>0?Kt(Me,v,Ue,ke,!1,ve,ne,p,y,D,{},$&&!N?ee:null,N&&!!$,K,U,N,rt):null;let _e=!1,Ne=!1,Re=!0;if(Ce&&!ce.occluded){const We=.5*B*ue+H,Ze=new d.P(-100,-100),Ye=new d.P(this.screenRightBoundary,this.screenBottomBoundary),dt=new Cv,{first:Pt,last:Ft}=Ce,vt=Pt.path.length;let Ot=[];for(let tn=vt-1;tn>=1;tn--)Ot.push(Pt.path[tn]);for(let tn=1;tn<Ft.path.length;tn++)Ot.push(Ft.path[tn]);const Rt=2.5*We;R&&(Ot=Ot.map(([tn,gn,Dn],Jt)=>(ee&&!ae&&(Dn=ee(Jt<vt-1?Pt.tilePath[vt-1-Jt]:Ft.tilePath[Jt-vt+2])[2]),yn(tn,gn,Dn,R))),Ot.some(tn=>tn[3]<=0)&&(Ot=[]));let Xt=[];if(Ot.length>0){let tn=1/0,gn=-1/0,Dn=1/0,Jt=-1/0;for(const Mn of Ot)tn=Math.min(tn,Mn[0]),Dn=Math.min(Dn,Mn[1]),gn=Math.max(gn,Mn[0]),Jt=Math.max(Jt,Mn[1]);gn>=Ze.x&&tn<=Ye.x&&Jt>=Ze.y&&Dn<=Ye.y&&(Xt=[Ot.map(Mn=>new d.P(Mn[0],Mn[1]))],(tn<Ze.x||gn>Ye.x||Dn<Ze.y||Jt>Ye.y)&&(Xt=d.bS(Xt,Ze.x,Ze.y,Ye.x,Ye.y)))}for(const tn of Xt){dt.reset(tn,.25*We);let gn=0;gn=dt.length<=.5*We?1:Math.ceil(dt.paddedLength/Rt)+1;for(let Dn=0;Dn<gn;Dn++){const Jt=Dn/Math.max(gn-1,1),Mn=dt.lerp(Jt),Fn=Mn.x+Nt,ni=Mn.y+Nt;q.push(Fn,ni,We,0);const dn=Fn-We,Ln=ni-We,zn=Fn+We,In=ni+We;if(Re=Re&&this.isOffscreen(dn,Ln,zn,In),Ne=Ne||this.isInsideGrid(dn,Ln,zn,In),!l&&this.grid.hitTestCircle(Fn,ni,We,k)&&(_e=!0,!O))return{circles:[],offscreen:!1,collisionDetected:_e,occluded:!1}}}}return{circles:!O&&_e||!Ne?[]:q,offscreen:Re,collisionDetected:_e,occluded:ce.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let p=1/0,y=1/0,v=-1/0,b=-1/0;for(const O of r){const N=new d.P(O.x+Nt,O.y+Nt);p=Math.min(p,N.x),y=Math.min(y,N.y),v=Math.max(v,N.x),b=Math.max(b,N.y),l.push(N)}const C=this.grid.query(p,y,v,b).concat(this.ignoredGrid.query(p,y,v,b)),D={},R={};for(const O of C){const N=O.key;if(void 0===D[N.bucketInstanceId]&&(D[N.bucketInstanceId]={}),D[N.bucketInstanceId][N.featureIndex])continue;const k=[new d.P(O.x1,O.y1),new d.P(O.x2,O.y1),new d.P(O.x2,O.y2),new d.P(O.x1,O.y2)];d.bT(l,k)&&(D[N.bucketInstanceId][N.featureIndex]=!0,void 0===R[N.bucketInstanceId]&&(R[N.bucketInstanceId]=[]),R[N.bucketInstanceId].push(N.featureIndex))}return R}insertCollisionBox(r,l,p,y,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:v},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,p,y,v){const b=l?this.ignoredGrid:this.grid,C={bucketInstanceId:p,featureIndex:y,collisionGroupID:v};for(let D=0;D<r.length;D+=4)b.insertCircle(C,r[D],r[D+1],r[D+2])}projectAndGetPerspectiveRatio(r,l,p,y,v,b,C){const D=[l,p,y,1];let R=!1;y||this.transform.pitch>0?(d.aA(D,D,r),this.fogState&&v&&"globe"!==C.name&&(R=function(k,B,H,U,q,$){const K=$.calculateFogTileMatrix(q),ee=[B,H,U];return d.ad(ee,ee,K),Lt(k,d.ae(ee),$.pitch,$._fov)}(this.fogState,l,p,y,v.toUnwrapped(),this.transform)>.9)):Yd(D,D,r);const O=D[3];return{point:new d.P((D[0]/O+1)/2*this.transform.width+Nt,(-D[1]/O+1)/2*this.transform.height+Nt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/O*.5,1.5),signedDistanceFromCamera:O,occluded:b&&D[2]>O||R}}isOffscreen(r,l,p,y){return p<Nt||r>=this.screenRightBoundary||y<Nt||l>this.screenBottomBoundary}isInsideGrid(r,l,p,y){return p>=0&&r<this.gridRightBoundary&&y>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=d.bx([]);return d.bo(r,r,[-100,-100,0]),r}}class Uu{constructor(r,l,p,y){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):y&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class Rc{constructor(r,l,p,y,v,b=!1){this.text=new Uu(r?r.text:null,l,p,v),this.icon=new Uu(r?r.icon:null,l,y,v),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Hn{constructor(r,l,p,y=!1){this.text=r,this.icon=l,this.skipFade=p,this.clipped=y}}class Kd{constructor(){this.invProjMatrix=d.bz(),this.viewportMatrix=d.bz(),this.circles=[]}}class Oc{constructor(r,l,p,y,v){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=v}}class St{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[r]}}function Gn(f,r,l,p,y){const{horizontalAlign:v,verticalAlign:b}=d.bZ(f),C=-(v-.5)*r,D=-(b-.5)*l,R=d.b_(f,p);return new d.P(C+R[0]*y,D+R[1]*y)}function Yn(f,r,l,p,y){const v=new d.P(f,r);return l&&v._rotate(p?y:-y),v}class yi{constructor(r,l,p,y,v,b){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new xf(this.transform,v),this.buildingIndex=b,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new St(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,p,y,v=1){const b=p.getBucket(l),C=p.latestFeatureIndex;if(!b||!C||l.fqid!==b.layerIds[0])return;const D=b.layers[0].layout,R=b.layers[0].paint,O=p.collisionBoxArray,N=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),k=p.tileSize/d.aj,B=p.tileID.toUnwrapped();this.transform.setProjection(b.projection);const H=(U=p.tileID,q=b.getProjection(),$=this.transform,q.name===this.projection?$.calculateProjMatrix(U.toUnwrapped()):fa($,q,U));var U,q,$;const K="map"===D.get("text-pitch-alignment"),ee="map"===D.get("text-rotation-alignment");l.compileFilter(l.options);const ne=l.dynamicFilter(),le=l.dynamicFilterNeedsFeature(),de=this.transform.calculatePixelsToTileUnitsMatrix(p),pe=Xd(H,p.tileID.canonical,K,ee,this.transform,b.getProjection(),de);let ae=null;const ce=b.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(K){const _e=Yr(H,p.tileID.canonical,K,ee,this.transform,b.getProjection(),de);ae=d.az([],this.transform.labelPlaneMatrix,_e)}let ue=null;ne&&p.latestFeatureIndex&&(ue={unwrappedTileID:B,dynamicFilter:ne,dynamicFilterNeedsFeature:le}),this.retainedQueryData[b.bucketInstanceId]=new Oc(b.bucketInstanceId,C,b.sourceLayerIndex,b.index,p.tileID);const[Me,ve]=b.layers[0].layout.get("text-size-scale-range"),Ue=d.ay(v,Me,ve),[ke,Ge]=D.get("icon-size-scale-range"),rt=d.ay(v,ke,Ge),Ce={bucket:b,layout:D,paint:R,posMatrix:H,invMatrix:ce,mercatorCenter:[d.aD(this.transform.center.lng),d.aH(this.transform.center.lat)],textLabelPlaneMatrix:pe,labelToScreenMatrix:ae,clippingData:ue,scale:N,textPixelRatio:k,holdingForFade:p.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:d.bH(b.textSizeData,this.transform.zoom,Ue),partiallyEvaluatedIconSize:d.bH(b.iconSizeData,this.transform.zoom,rt),collisionGroup:this.collisionGroups.get(b.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(y)for(const _e of b.sortKeyRanges){const{sortKey:Ne,symbolInstanceStart:Re,symbolInstanceEnd:We}=_e;r.push({sortKey:Ne,symbolInstanceStart:Re,symbolInstanceEnd:We,parameters:Ce})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(r,l,p,y,v,b,C,D,R,O,N,k,B,H,U,q,$,K,ee,ne,le){const{textOffset0:de,textOffset1:pe,crossTileID:ae}=U,ce=[de,pe],ue=Gn(r,b,C,ce,D),Me=this.collisionIndex.placeCollisionBox($,D,l,p,y,v,Yn(ue.x,ue.y,R,O,this.transform.angle),H,N,k,B.predicate);if(ee){const ve=$.getSymbolInstanceIconSize(le,this.transform.zoom,U.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox($,ve,ee,p,y,v,Yn(ue.x,ue.y,R,O,this.transform.angle),H,N,k,B.predicate).box.length)return}if(Me.box.length>0){let ve;return this.prevPlacement&&this.prevPlacement.variableOffsets[ae]&&this.prevPlacement.placements[ae]&&this.prevPlacement.placements[ae].text&&(ve=this.prevPlacement.variableOffsets[ae].anchor),this.variableOffsets[ae]={textOffset:ce,width:b,height:C,anchor:r,textScale:D,prevAnchor:ve},this.markUsedJustification($,r,U,K),$.allowVerticalPlacement&&(this.markUsedOrientation($,K,U),this.placedOrientations[ae]=K),{shift:ue,placedGlyphBoxes:Me}}}placeLayerBucketPart(r,l,p,y,v=1){const{bucket:b,layout:C,paint:D,posMatrix:R,textLabelPlaneMatrix:O,labelToScreenMatrix:N,clippingData:k,textPixelRatio:B,mercatorCenter:H,invMatrix:U,holdingForFade:q,collisionBoxArray:$,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:ee,collisionGroup:ne,latestFeatureIndex:le}=r.parameters,de=C.get("text-optional"),pe=C.get("icon-optional"),ae=C.get("text-allow-overlap"),ce=C.get("icon-allow-overlap"),ue="map"===C.get("text-rotation-alignment"),Me="map"===C.get("icon-rotation-alignment"),ve="map"===C.get("text-pitch-alignment"),Ue=D.get("symbol-z-offset"),ke="sea"===C.get("symbol-elevation-reference"),Ge=C.get("symbol-placement"),[rt,Ce]=C.get("text-size-scale-range"),[_e,Ne]=C.get("icon-size-scale-range"),Re=d.ay(v,rt,Ce),We=d.ay(v,_e,Ne),Ze=C.get("text-variable-anchor"),Ye=ue&&"point"!==Ge,dt=Me&&"point"!==Ge,Pt=Ze&&b.hasTextData(),Ft=b.hasIconTextFit()&&Pt&&b.hasIconData();this.transform.setProjection(b.projection);const vt=Pt||Ye,Ot=dt||Ft;let Rt=ae&&(ce||!b.hasIconData()||pe),Xt=ce&&(ae||!b.hasTextData()||de);const tn=!Ue.isConstant();!b.collisionArrays&&$&&b.deserializeCollisionBoxes($),p&&y&&b.updateCollisionDebugBuffers(this.transform.zoom,$,Re,We);const gn=(Jt,Mn,Fn)=>{const{crossTileID:ni,numVerticalGlyphVertices:dn}=Jt;let Ln=null;if(k&&k.dynamicFilterNeedsFeature||tn){const Qi=this.retainedQueryData[b.bucketInstanceId];Ln=le.loadFeature({featureIndex:Jt.featureIndex,bucketIndex:Qi.bucketIndex,sourceLayerIndex:Qi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(k&&!(0,k.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Ln,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new d.P(Jt.tileAnchorX,Jt.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[ni]=new Hn(!1,!1,!1,!0),void l.add(ni);const zn=Ue.evaluate(Ln,{});if(l.has(ni))return;if(q)return void(this.placements[ni]=new Hn(!1,!1,!1));let In=!1,an=!1,ii=!0,qn=!1,Ni=!1,Pn=null,Zn={box:null,offscreen:null,occluded:null},hi={box:null},xr=null,fr=null,or=null,qr=0,ba=0,No=0;Fn.textFeatureIndex?qr=Fn.textFeatureIndex:Jt.useRuntimeCollisionCircles&&(qr=Jt.featureIndex),Fn.verticalTextFeatureIndex&&(ba=Fn.verticalTextFeatureIndex);const qs=Qi=>{Qi.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const rr=this.transform.elevation;Qi.elevation=ke?zn:zn+(rr?rr.getAtTileOffset(Qi.tileID,Qi.tileAnchorX,Qi.tileAnchorY):0),Qi.elevation+=Jt.zOffset},uo=Fn.textBox;if(uo){qs(uo);const Qi=Ei=>{let Sr=d.bI.horizontal;if(b.allowVerticalPlacement&&!Ei&&this.prevPlacement){const ho=this.prevPlacement.placedOrientations[ni];ho&&(this.placedOrientations[ni]=ho,Sr=ho,this.markUsedOrientation(b,Sr,Jt))}return Sr},rr=(Ei,Sr)=>{if(b.allowVerticalPlacement&&dn>0&&Fn.verticalTextBox){for(const ho of b.writingModes)if(ho===d.bI.vertical?(Zn=Sr(),hi=Zn):Zn=Ei(),Zn&&Zn.box&&Zn.box.length)break}else Zn=Ei()};if(Ze){let Ei=Ze;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ni]){const pr=this.prevPlacement.variableOffsets[ni];Ei.indexOf(pr.anchor)>0&&(Ei=Ei.filter(oa=>oa!==pr.anchor),Ei.unshift(pr.anchor))}const Sr=(pr,oa,ud)=>{const su=b.getSymbolInstanceTextSize(K,Jt,this.transform.zoom,Mn),dd=(pr.x2-pr.x1)*su+2*pr.padding,vl=(pr.y2-pr.y1)*su+2*pr.padding,Zo=Jt.hasIconTextFit&&!ce?oa:null;Zo&&qs(Zo);let wa={box:[],offscreen:!1,occluded:!1};const Mr=ae?2*Ei.length:Ei.length;for(let As=0;As<Mr;++As){const sa=this.attemptAnchorPlacement(Ei[As%Ei.length],pr,H,U,vt,dd,vl,su,ue,ve,B,R,ne,As>=Ei.length,Jt,Mn,b,ud,Zo,K,ee);if(sa&&(wa=sa.placedGlyphBoxes,wa&&wa.box&&wa.box.length)){In=!0,Pn=sa.shift;break}}return wa};rr(()=>Sr(uo,Fn.iconBox,d.bI.horizontal),()=>{const pr=Fn.verticalTextBox;return pr&&qs(pr),b.allowVerticalPlacement&&!(Zn&&Zn.box&&Zn.box.length)&&dn>0&&pr?Sr(pr,Fn.verticalIconBox,d.bI.vertical):{box:null,offscreen:null,occluded:null}}),Zn&&(In=Zn.box,ii=Zn.offscreen,qn=Zn.occluded);const ho=Qi(!(!Zn||!Zn.box));if(!In&&this.prevPlacement){const pr=this.prevPlacement.variableOffsets[ni];pr&&(this.variableOffsets[ni]=pr,this.markUsedJustification(b,pr.anchor,Jt,ho))}}else{const Ei=(Sr,ho)=>{const pr=b.getSymbolInstanceTextSize(K,Jt,this.transform.zoom,Mn,v),oa=this.collisionIndex.placeCollisionBox(b,pr,Sr,H,U,vt,new d.P(0,0),ae,B,R,ne.predicate);return oa&&oa.box&&oa.box.length&&(this.markUsedOrientation(b,ho,Jt),this.placedOrientations[ni]=ho),oa};rr(()=>Ei(uo,d.bI.horizontal),()=>{const Sr=Fn.verticalTextBox;return b.allowVerticalPlacement&&dn>0&&Sr?(qs(Sr),Ei(Sr,d.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Qi(!!(Zn&&Zn.box&&Zn.box.length))}}if(xr=Zn,In=xr&&xr.box&&xr.box.length>0,ii=xr&&xr.offscreen,qn=xr&&xr.occluded,Jt.useRuntimeCollisionCircles){const Qi=b.text.placedSymbolArray.get(Jt.centerJustifiedTextSymbolIndex>=0?Jt.centerJustifiedTextSymbolIndex:Jt.verticalPlacedTextSymbolIndex),rr=d.bJ(b.textSizeData,K,Qi),Ei=C.get("text-padding");fr=this.collisionIndex.placeCollisionCircles(b,ae,Qi,b.lineVertexArray,b.glyphOffsetArray,rr,R,O,N,p,ve,ne.predicate,Jt.collisionCircleDiameter*rr/d.bU,Ei,this.retainedQueryData[b.bucketInstanceId].tileID),In=ae||fr.circles.length>0&&!fr.collisionDetected,ii=ii&&fr.offscreen,qn=fr.occluded}if(Fn.iconFeatureIndex&&(No=Fn.iconFeatureIndex),Fn.iconBox){const Qi=rr=>{qs(rr);const Ei=Jt.hasIconTextFit&&Pn?Yn(Pn.x,Pn.y,ue,ve,this.transform.angle):new d.P(0,0),Sr=b.getSymbolInstanceIconSize(ee,this.transform.zoom,Jt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,Sr,rr,H,U,Ot,Ei,ce,B,R,ne.predicate)};hi&&hi.box&&hi.box.length&&Fn.verticalIconBox?(or=Qi(Fn.verticalIconBox),an=or.box.length>0):(or=Qi(Fn.iconBox),an=or.box.length>0),ii=ii&&or.offscreen,Ni=or.occluded}const ia=de||0===Jt.numHorizontalGlyphVertices&&0===dn,ra=pe||0===Jt.numIconVertices;if(ia||ra?ra?ia||(an=an&&In):In=an&&In:an=In=an&&In,In&&xr&&xr.box&&this.collisionIndex.insertCollisionBox(xr.box,C.get("text-ignore-placement"),b.bucketInstanceId,hi&&hi.box&&ba?ba:qr,ne.ID),an&&or&&this.collisionIndex.insertCollisionBox(or.box,C.get("icon-ignore-placement"),b.bucketInstanceId,No,ne.ID),fr&&(In&&this.collisionIndex.insertCollisionCircles(fr.circles,C.get("text-ignore-placement"),b.bucketInstanceId,qr,ne.ID),p)){const Qi=b.bucketInstanceId;let rr=this.collisionCircleArrays[Qi];void 0===rr&&(rr=this.collisionCircleArrays[Qi]=new Kd);for(let Ei=0;Ei<fr.circles.length;Ei+=4)rr.circles.push(fr.circles[Ei+0]),rr.circles.push(fr.circles[Ei+1]),rr.circles.push(fr.circles[Ei+2]),rr.circles.push(fr.collisionDetected?1:0)}const Do="globe"!==b.projection.name;Rt=Rt&&(Do||!qn),Xt=Xt&&(Do||!Ni),this.placements[ni]=new Hn(In||Rt,an||Xt,ii||b.justReloaded),l.add(ni)},Dn=this.retainedQueryData[b.bucketInstanceId].tileID;if("offset"===b.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(b,Dn),"road"===b.elevationType&&b.updateRoadElevation(Dn.canonical),b.updateZOffset(),b.sortFeaturesByY){const Jt=b.getSortedSymbolIndexes(this.transform.angle);for(let Mn=Jt.length-1;Mn>=0;--Mn){const Fn=Jt[Mn];gn(b.symbolInstances.get(Fn),Fn,b.collisionArrays[Fn])}b.hasAnyZOffset&&d.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){const Jt=b.getSortedIndexesByZOffset();for(let Mn=0;Mn<Jt.length;++Mn){const Fn=Jt[Mn];gn(b.symbolInstances.get(Fn),Fn,b.collisionArrays[Fn])}}else for(let Jt=r.symbolInstanceStart;Jt<r.symbolInstanceEnd;Jt++)gn(b.symbolInstances.get(Jt),Jt,b.collisionArrays[Jt]);if(p&&b.bucketInstanceId in this.collisionCircleArrays){const Jt=this.collisionCircleArrays[b.bucketInstanceId];d.bi(Jt.invProjMatrix,R),Jt.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(r,l,p,y){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:D,crossTileID:R}=p,O=d.b$(l),N=y===d.bI.vertical?D:"left"===O?v:"center"===O?b:"right"===O?C:-1;v>=0&&(r.text.placedSymbolArray.get(v).crossTileID=N>=0&&v!==N?0:R),b>=0&&(r.text.placedSymbolArray.get(b).crossTileID=N>=0&&b!==N?0:R),C>=0&&(r.text.placedSymbolArray.get(C).crossTileID=N>=0&&C!==N?0:R),D>=0&&(r.text.placedSymbolArray.get(D).crossTileID=N>=0&&D!==N?0:R)}markUsedOrientation(r,l,p){const y=l===d.bI.horizontal||l===d.bI.horizontalOnly?l:0,v=l===d.bI.vertical?l:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:R}=p,O=r.text.placedSymbolArray;b>=0&&(O.get(b).placedOrientation=y),C>=0&&(O.get(C).placedOrientation=y),D>=0&&(O.get(D).placedOrientation=y),R>=0&&(O.get(R).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const y=l?l.symbolFadeChange(r):1,v=l?l.opacities:{},b=l?l.variableOffsets:{},C=l?l.placedOrientations:{};for(const D in this.placements){const R=this.placements[D],O=v[D];O?(this.opacities[D]=new Rc(O,y,R.text,R.icon,null,R.clipped),p=p||R.text!==O.text.placed||R.icon!==O.icon.placed):(this.opacities[D]=new Rc(null,y,R.text,R.icon,R.skipFade,R.clipped),p=p||R.text||R.icon)}for(const D in v){const R=v[D];if(!this.opacities[D]){const O=new Rc(R,y,!1,!1);O.isHidden()||(this.opacities[D]=O,p=p||R.text.placed||R.icon.placed)}}for(const D in b)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=b[D]);for(const D in C)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=C[D]);p?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l,p,y){const v=new Set;for(const b of l){const C=b.getBucket(r);C&&b.latestFeatureIndex&&r.fqid===C.layerIds[0]&&(this.updateBucketOpacities(C,v,b,b.collisionBoxArray,p,y,b.tileID,r.scope),"offset"===C.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(C,b.tileID),"road"===C.elevationType&&C.updateRoadElevation(b.tileID.canonical),C.updateZOffset())}}updateBucketOpacities(r,l,p,y,v,b,C,D){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const R=r.layers[0].layout,O=r.layers[0].paint,N=!!r.layers[0].dynamicFilter(),k=new Rc(null,0,!1,!1,!0),B=R.get("text-allow-overlap"),H=R.get("icon-allow-overlap"),U=R.get("text-variable-anchor"),q="map"===R.get("text-rotation-alignment"),$="map"===R.get("text-pitch-alignment"),K=O.get("symbol-z-offset"),ee="sea"===R.get("symbol-elevation-reference"),ne=!K.isConstant(),le=new Rc(null,0,B&&(H||!r.hasIconData()||R.get("icon-optional")),H&&(B||!r.hasTextData()||R.get("text-optional")),!0);!r.collisionArrays&&y&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(y);const de=(ae,ce,ue)=>{for(let Me=0;Me<ce/4;Me++)ae.opacityVertexArray.emplaceBack(ue)};let pe=0;b&&r.updateReplacement(C,b);for(let ae=0;ae<r.symbolInstances.length;ae++){const ce=r.symbolInstances.get(ae),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:Me,crossTileID:ve,numIconVertices:Ue,tileAnchorX:ke,tileAnchorY:Ge}=ce;let rt=null;const Ce=this.retainedQueryData[r.bucketInstanceId];ne&&ce&&Ce&&(rt=p.latestFeatureIndex.loadFeature({featureIndex:ce.featureIndex,bucketIndex:Ce.bucketIndex,sourceLayerIndex:Ce.sourceLayerIndex,layoutVertexArrayOffset:0}));const _e=K.evaluate(rt,{}),Ne=l.has(ve);let Re=this.opacities[ve];Ne?Re=k:Re||(Re=le,this.opacities[ve]=Re),l.add(ve);const We=ue>0||Me>0,Ze=Ue>0,Ye=this.placedOrientations[ve],dt=Ye===d.bI.vertical,Pt=Ye===d.bI.horizontal||Ye===d.bI.horizontalOnly;!We&&!Ze||Re.isHidden()||pe++;let Ft=!1;if((We||Ze)&&b)for(const vt of r.activeReplacements){if(d.bV(vt,v,d.bW.Symbol,D)||vt.min.x>ke||ke>vt.max.x||vt.min.y>Ge||Ge>vt.max.y)continue;const Ot=d.bX(ke,Ge,C.canonical,vt.footprintTileId.canonical);if(Ft=d.bY(Ot,vt.footprint),Ft)break}if(We){const vt=Ft?Lc:ql(Re.text);de(r.text,ue,dt?Lc:vt),de(r.text,Me,Pt?Lc:vt);const Ot=Re.text.isHidden(),{leftJustifiedTextSymbolIndex:Rt,centerJustifiedTextSymbolIndex:Xt,rightJustifiedTextSymbolIndex:tn,verticalPlacedTextSymbolIndex:gn}=ce,Dn=r.text.placedSymbolArray,Jt=Ot||dt?1:0;Rt>=0&&(Dn.get(Rt).hidden=Jt),Xt>=0&&(Dn.get(Xt).hidden=Jt),tn>=0&&(Dn.get(tn).hidden=Jt),gn>=0&&(Dn.get(gn).hidden=Ot||Pt?1:0);const Mn=this.variableOffsets[ve];Mn&&this.markUsedJustification(r,Mn.anchor,ce,Ye);const Fn=this.placedOrientations[ve];Fn&&(this.markUsedJustification(r,"left",ce,Fn),this.markUsedOrientation(r,Fn,ce))}if(Ze){const vt=Ft?Lc:ql(Re.icon),{placedIconSymbolIndex:Ot,verticalPlacedIconSymbolIndex:Rt}=ce,Xt=r.icon.placedSymbolArray,tn=Re.icon.isHidden()?1:0;Ot>=0&&(de(r.icon,Ue,dt?Lc:vt),Xt.get(Ot).hidden=tn),Rt>=0&&(de(r.icon,ce.numVerticalIconVertices,Pt?Lc:vt),Xt.get(Rt).hidden=tn)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const vt=r.collisionArrays[ae];if(vt){let Ot=new d.P(0,0),Rt=!0;if(vt.textBox||vt.verticalTextBox){if(U){const tn=this.variableOffsets[ve];tn?(Ot=Gn(tn.anchor,tn.width,tn.height,tn.textOffset,tn.textScale),q&&Ot._rotate($?this.transform.angle:-this.transform.angle)):Rt=!1}N&&(Rt=!Re.clipped),vt.textBox&&$l(r.textCollisionBox.collisionVertexArray,Re.text.placed,!Rt||dt,_e,ee,Ot.x,Ot.y),vt.verticalTextBox&&$l(r.textCollisionBox.collisionVertexArray,Re.text.placed,!Rt||Pt,_e,ee,Ot.x,Ot.y)}const Xt=Rt&&!(Pt||!vt.verticalIconBox);vt.iconBox&&$l(r.iconCollisionBox.collisionVertexArray,Re.icon.placed,Xt,_e,ee,ce.hasIconTextFit?Ot.x:0,ce.hasIconTextFit?Ot.y:0),vt.verticalIconBox&&$l(r.iconCollisionBox.collisionVertexArray,Re.icon.placed,!Xt,_e,ee,ce.hasIconTextFit?Ot.x:0,ce.hasIconTextFit?Ot.y:0)}}}if(r.fullyClipped=0===pe,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=ae.invProjMatrix,r.placementViewportMatrix=ae.viewportMatrix,r.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function $l(f,r,l,p,y,v,b){f.emplaceBack(r?1:0,l?1:0,v||0,b||0,p,y?1:0),f.emplaceBack(r?1:0,l?1:0,v||0,b||0,p,y?1:0),f.emplaceBack(r?1:0,l?1:0,v||0,b||0,p,y?1:0),f.emplaceBack(r?1:0,l?1:0,v||0,b||0,p,y?1:0)}const Qn=Math.pow(2,25),Ht=Math.pow(2,24),kc=Math.pow(2,17),Fc=Math.pow(2,16),yo=Math.pow(2,9),Cr=Math.pow(2,8),Dv=Math.pow(2,1);function ql(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const r=f.placed?1:0,l=Math.floor(127*f.opacity);return l*Qn+r*Ht+l*kc+r*Fc+l*yo+r*Cr+l*Dv+r}const Lc=0;class bf{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,l,p,y,v,b){const C=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(C,y,r[this._currentTileIndex],this._sortAcrossTiles,b),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((D,R)=>D.sortKey-R.sortKey));this._currentPartIndex<C.length;){const D=C[this._currentPartIndex];if(l.placeLayerBucketPart(D,this._seenCrossTileIDs,p,0===D.symbolInstanceStart,b),this._currentPartIndex++,v())return!0}return!1}}class Qp{constructor(r,l,p,y,v,b,C,D,R){this.placement=new yi(r,v,b,C,D,R),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(r,l,p,y,v){const b=d.q.now(),C=()=>{const D=d.q.now()-b;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=l[r[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if("symbol"===D.type&&(!D.minzoom||D.minzoom<=R)&&(!D.maxzoom||D.maxzoom>R)){const O=D,N=O.layout.get("symbol-z-elevate"),k=void 0!==O.layout.get("symbol-sort-key").constantOr(1),B=O.layout.get("symbol-z-order"),H="viewport-y"===B||"auto"===B&&!("viewport-y"!==B&&k),U=O.layout.get("text-allow-overlap")||O.layout.get("icon-allow-overlap")||O.layout.get("text-ignore-placement")||O.layout.get("icon-ignore-placement"),q=H&&U,$=this._inProgressLayer=this._inProgressLayer||new bf(O),K=d.C(D.source,D.scope);if($.continuePlacement(N||q?y[K]:p[K],this.placement,this._showCollisionBoxes,D,C,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const wf=512/d.aj/2;class em{constructor(r,l,p){this.tileID=r,this.bucketInstanceId=p,this.index=new d.c0(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=r.canonical.x*d.aj,v=r.canonical.y*d.aj;for(let b=0;b<l.length;b++){const{key:C,crossTileID:D,tileAnchorX:R,tileAnchorY:O}=l.get(b),N=Math.floor((y+R)*wf),k=Math.floor((v+O)*wf);this.index.add(N,k),this.keys.push(C),this.crossTileIDs.push(D)}this.index.finish()}findMatches(r,l,p){const y=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),v=wf/Math.pow(2,l.canonical.z-this.tileID.canonical.z),b=l.canonical.x*d.aj,C=l.canonical.y*d.aj;for(let D=0;D<r.length;D++){const R=r.get(D);if(R.crossTileID)continue;const{key:O,tileAnchorX:N,tileAnchorY:k}=R,B=Math.floor((b+N)*v),H=Math.floor((C+k)*v),U=this.index.range(B-y,H-y,B+y,H+y).sort((q,$)=>q-$);for(const q of U){const $=this.crossTileIDs[q];if(this.keys[q]===O&&!p.has($)){p.add($),R.crossTileID=$;break}}}}}class Kr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class pa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(0!==l)for(const p in this.indexes){const y=this.indexes[p],v={};for(const b in y){const C=y[b];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+l),v[C.tileID.key]=C}this.indexes[p]=v}this.lng=r}addBucket(r,l,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const y=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const b=this.indexes[v];if(Number(v)>r.overscaledZ)for(const C in b){const D=b[C];D.tileID.isChildOf(r)&&D.findMatches(l.symbolInstances,r,y)}else{const C=b[r.scaledTo(Number(v)).key];C&&C.findMatches(l.symbolInstances,r,y)}}for(let v=0;v<l.symbolInstances.length;v++){const b=l.symbolInstances.get(v);b.crossTileID||(b.crossTileID=p.generate(),y.add(b.crossTileID))}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new em(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const p of l.crossTileIDs)this.usedCrossTileIDs[r].delete(p)}removeStaleBuckets(r){let l=!1;for(const p in this.indexes){const y=this.indexes[p];for(const v in y)r[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[v]),delete y[v],l=!0)}return l}}class vo{constructor(){this.layerIndexes={},this.crossTileIDs=new Kr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,p,y){let v=this.layerIndexes[r.fqid];void 0===v&&(v=this.layerIndexes[r.fqid]=new pa);let b=!1;const C={};"globe"!==y.name&&v.handleWrapJump(p);for(const D of l){const R=D.getBucket(r);R&&r.fqid===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(D.tileID,R,this.crossTileIDs)&&(b=!0),C[R.bucketInstanceId]=!0)}return v.removeStaleBuckets(C)&&(b=!0),b}pruneUnusedLayers(r){const l={};r.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}class ln{constructor(r,l,p,y){this.blendFunction=r,this.blendColor=l.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=y}}ln.Replace=[1,0,1,0],ln.disabled=new ln(ln.Replace,d.am.transparent,[!1,!1,!1,!1]),ln.unblended=new ln(ln.Replace,d.am.transparent,[!0,!0,!0,!0]),ln.alphaBlended=new ln([1,771,1,771],d.am.transparent,[!0,!0,!0,!0]),ln.alphaBlendedNonPremultiplied=new ln([770,771,770,771],d.am.transparent,[!0,!0,!0,!0]),ln.multiply=new ln([774,0,774,0],d.am.transparent,[!0,!0,!0,!0]);class wt{constructor(r,l,p){this.func=r,this.mask=l,this.range=p}}wt.ReadOnly=!1,wt.ReadWrite=!0,wt.disabled=new wt(519,wt.ReadOnly,[0,1]);class Vt{constructor(r,l,p,y,v,b){this.test=r,this.ref=l,this.mask=p,this.fail=y,this.depthFail=v,this.pass=b}}Vt.disabled=new Vt({func:519,mask:0},0,0,7680,7680,7680);class Bt{constructor(r,l,p){this.enable=r,this.mode=l,this.frontFace=p}}function gt(f,r){const l=d.c6(f,3);d.c8(f,r),d.cc(f,3,l)}function zc(f,r){const l=d.c3([]);return d.c4(l,l,-r),d.c5(l,l,-f),l}function $n(f,r){const l=[f[0],f[1],0],p=[r[0],r[1],0];if(d.ae(l)>=1e-15){const b=d.au([],l);d.c1(p,b,d.bG(p,b)),r[0]=p[0],r[1]=p[1]}const y=d.bF([],r,f);if(d.c2(y)<1e-15)return null;const v=Math.atan2(-y[1],y[0]);return zc(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),v)}Bt.disabled=new Bt(!1,1029,2305),Bt.backCCW=new Bt(!0,1029,2305),Bt.backCW=new Bt(!0,1029,2304),Bt.frontCW=new Bt(!0,1028,2304),Bt.frontCCW=new Bt(!0,1028,2305);class Jd{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){const l=r instanceof d.ac?r:new d.ac(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=d.bQ(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;const p=this.position,y=this._elevation?this._elevation.getAtPointOrZero(d.ac.fromLngLat(r)):0,v=d.ac.fromLngLat(r,y),b=[v.x-p.x,v.y-p.y,v.z-p.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=$n(b,l)}setPitchBearing(r,l){this.orientation=zc(d.al(r),d.al(-l))}}class ws{constructor(r,l){this._transform=d.bx([]),this.orientation=l,this.position=r}get mercatorPosition(){const r=this.position;return new d.ac(r[0],r[1],r[2])}get position(){const r=d.c6(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&d.cc(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||d.c3([]),r&&gt(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=zc(r,l),gt(this._transform,this._orientation)}forward(){const r=d.c6(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=d.c6(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=d.c6(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const p=new Float64Array(16);return d.bi(p,this.getWorldToCamera(r,l)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,l,p){const y=this.position;d.c1(y,y,-r);const v=new Float64Array(16);return d.bn(v,[p,p,p]),d.bo(v,v,y),v[10]*=l,v}getWorldToCamera(r,l){const p=new Float64Array(16),y=new Float64Array(4),v=this.position;return d.c7(y,this._orientation),d.c1(v,v,-r),d.c8(p,y),d.bo(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(r,l,p,y){const v=new Float64Array(16);return d.c9(v,r,l,p,y),v}getCameraToClipOrthographic(r,l,p,y,v,b){const C=new Float64Array(16);return d.ca(C,r,l,p,y,v,b),C}getDistanceToElevation(r,l=!1){const p=0===r?0:d.cb(r,l?d.aY(this.position[1]):this.position[1]),y=this.forward();return(p-this.position[2])/y[2]}clone(){return new ws([...this.position],[...this.orientation])}}const Jr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Qd{constructor(r=0,l=0,p=0,y=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=p,this.right=y}interpolate(r,l,p){return null!=l.top&&null!=r.top&&(this.top=d.ai(r.top,l.top,p)),null!=l.bottom&&null!=r.bottom&&(this.bottom=d.ai(r.bottom,l.bottom,p)),null!=l.left&&null!=r.left&&(this.left=d.ai(r.left,l.left,p)),null!=l.right&&null!=r.right&&(this.right=d.ai(r.right,l.right,p)),this}getCenter(r,l){const p=d.ay((this.left+r-this.right)/2,0,r),y=d.ay((this.top+l-this.bottom)/2,0,l);return new d.P(p,y)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Qd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class tm{constructor(r,l,p,y,v,b,C){this.tileSize=512,this._renderWorldCopies=void 0===v||v,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=y??60,this.setProjection(b),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new d.ci(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Qd,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ws,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const r=new tm(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r._allowWorldUnderZoom=this._allowWorldUnderZoom,r}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(r,l=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||p)&&this._updateCameraOnTerrain(),(r||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return d.aF(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=d.cj(this.projectionOptions);const p=this.getProjection(),y=!d.bv(l,p);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=d.cj({name:"mercator"});const l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return d.cb(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return d.bQ(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const l=-r*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=d.ck(),d.cl(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=d.ay(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=d.al(r),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(void 0===this._centerAltitudeValidForExaggeration)return;const r=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(r)}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let y=0,v=0;for(let b=0;b<l.length;b++){const C=new d.P(l[b][0]*this.width,p+l[b][1]*(this.height-p)),D=r.pointCoordinate(C);if(!D)continue;const R=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);y+=D[3]*R,v+=R}return 0===v?NaN:y/v}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,y=this._mercatorZfromZoom(r),v=this._mercatorZfromZoom(this._maxZoom),b=Math.max(y-p,v);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const y=d.ae(d.at([],this._camera.position,p));return d.ay(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!d.cm(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];d.cn(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new Jd;return l.position=new d.ac(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!d.co(r))return!1;d.cp(r,r);const l=d.cq([],[0,0,-1],r),p=d.cq([],[0,-1,0],r);if(p[2]<0)return!1;const y=$n(l,p);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;r[2]=d.ay(r[2],y/p,y/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,p){this._unmodified=!1,this._edgeInsets.interpolate(r,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new d.cr(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new d.P(0,0)),y=this.pointCoordinate(new d.P(this.width,0)),v=this.pointCoordinate(new d.P(this.width,this.height)),b=this.pointCoordinate(new d.P(0,this.height)),C=Math.floor(Math.min(p.x,y.x,v.x,b.x)),D=Math.floor(Math.max(p.x,y.x,v.x,b.x)),R=1;for(let O=C-R;O<=D+R;O++)0!==O&&l.push(new d.cr(O,r))}return l}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,l,p){let y=[];const v=null!=p,b=!v;if(b&&this.zoom<l||v&&0===p[0]&&0===p[1])return y;const C=new Set,D=(O,N,k,B,H)=>{const U=d.cV(N,O,k,B,H);C.has(U)||(y.push(new d.aM(O,N,k,B,H)),C.add(U))};for(let O=0;O<r.length;O++){const N=r[O];if(b&&N.canonical.z!==l)continue;const k=N.canonical,B=N.overscaledZ,H=N.wrap,U=1<<k.z,q=k.x+1<U,$=k.x>0,K=k.y+1<U,ee=k.y>0,ne=N.wrap-($?0:1),le=N.wrap+(q?0:1),de=$?k.x-1:U-1,pe=q?k.x+1:0;if(v)p[0]<0?(D(B,le,k.z,pe,k.y),p[1]<0&&K&&(D(B,H,k.z,k.x,k.y+1),D(B,le,k.z,pe,k.y+1)),p[1]>0&&ee&&(D(B,H,k.z,k.x,k.y-1),D(B,le,k.z,pe,k.y-1))):p[0]>0?(D(B,ne,k.z,de,k.y),p[1]<0&&K&&(D(B,H,k.z,k.x,k.y+1),D(B,ne,k.z,de,k.y+1)),p[1]>0&&ee&&(D(B,H,k.z,k.x,k.y-1),D(B,ne,k.z,de,k.y-1))):p[1]<0&&K?D(B,H,k.z,k.x,k.y+1):ee&&D(B,H,k.z,k.x,k.y-1);else{const ae=N.visibleQuadrants;1&ae&&(D(B,ne,k.z,de,k.y),ee&&(D(B,H,k.z,k.x,k.y-1),D(B,ne,k.z,de,k.y-1))),2&ae&&(D(B,le,k.z,pe,k.y),ee&&(D(B,H,k.z,k.x,k.y-1),D(B,le,k.z,pe,k.y-1))),4&ae&&(D(B,ne,k.z,de,k.y),K&&(D(B,H,k.z,k.x,k.y+1),D(B,ne,k.z,de,k.y+1))),8&ae&&(D(B,le,k.z,pe,k.y),K&&(D(B,H,k.z,k.x,k.y+1),D(B,le,k.z,pe,k.y+1)))}}const R=[];for(const O of y)y.some(N=>O.isChildOf(N))||R.push(O);if(y=R.filter(O=>!r.some(N=>!!(O.overscaledZ<l&&N.isChildOf(O))||O.equals(N)||O.isChildOf(N))),b){const O=1<<l,N="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),k=[O*N.x,O*N.y],B=4,H=B*B;y=y.filter(U=>{const q=U.canonical.x+.5-k[0],$=U.canonical.y+.5-k[1];return q*q+$*$<H})}return y}extendTileCoverToNearPlane(r,l,p){const y=[],v=new Set;for(const K of r)v.add(K.key);const b=(K,ee,ne,le,de)=>{const pe=d.cV(ee,K,ne,le,de);v.has(pe)||(y.push(new d.aM(K,ee,ne,le,de)),v.add(pe))},C=r.reduce((K,ee)=>Math.max(K,ee.overscaledZ),p),D=1<<p,R=[new d.P(0,0),new d.P(d.aj,0),new d.P(d.aj,d.aj),new d.P(0,d.aj)],O=new d.P(0,0),N=new d.P(0,0),k=(K,ee)=>{const ne=Math.floor(K[0]),le=Math.floor(K[1]),de=(K[0]-ne)*d.aj,pe=(K[1]-le)*d.aj,ae=Math.floor(ee[0]),ce=Math.floor(ee[1]),ue=(ee[0]-ae)*d.aj,Me=(ee[1]-ce)*d.aj;for(let ve=-1;ve<=1;ve++){const Ue=ne+ve;if(!(Ue<0||Ue>=D)){O.x=de-ve*d.aj,N.x=ue-(Ue-ae)*d.aj;for(let ke=-1;ke<=1;ke++){const Ge=le+ke;O.y=pe-ke*d.aj,N.y=Me-(Ge-ce)*d.aj,d.cW(O,N,R)&&b(C,0,p,Ue,Ge)}}}},B=l.points,H=B[d.cs],U=B[d.ct],q=this._projectToGround(H,B[d.cu]),$=this._projectToGround(U,B[d.cv]);return k(H,q),k(U,$),y}_projectToGround(r,l){return d.cw(d.cx(),r,l,r[2]/(r[2]-l[2]))}coveringTiles(r){let l=this.coveringZoomLevel(r);const p=l,y=this.elevation&&this.elevation.exaggeration(),v=y&&!r.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==r.minzoom&&l<r.minzoom)return[];void 0!==r.maxzoom&&l>r.maxzoom&&(l=r.maxzoom);const C=this.locationCoordinate(this.center),D=this.center.lat,R=1<<l,O=[R*C.x,R*C.y,0],N="globe"===this.projection.name,k=!N,B=d.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,k),H=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=R*d.cb(1,this.center.lat),q=this._camera.position[2]/d.cb(1,this.center.lat),$=[R*H.x,R*H.y,q*(k?1:U)],K=N||y,ee=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ne=this.isLODDisabled(!0)?l:0;let le;if(this._elevation&&r.isTerrainDEM)le=1e4*this._elevation.exaggeration();else if(this._elevation){const _e=this._elevation.getMinMaxForVisibleTiles();le=_e?_e.max:this._centerAltitude}else le=this._centerAltitude;const de=r.isTerrainDEM?-le:this._elevation?this._elevation.getMinElevationBelowMSL():0,pe=this.projection.isReprojectedInTileSpace?d.cz(this):1,ae=_e=>{const Re=new d.ac(_e.x+25e-6,_e.y,_e.z),We=new d.ac(_e.x,_e.y+25e-6,_e.z),Ze=_e.toLngLat(),Ye=Re.toLngLat(),dt=We.toLngLat(),Pt=this.locationCoordinate(Ze),Ft=this.locationCoordinate(Ye),vt=this.locationCoordinate(dt),Ot=Math.hypot(Ft.x-Pt.x,Ft.y-Pt.y),Rt=Math.hypot(vt.x-Pt.x,vt.y-Pt.y);return Math.sqrt(Ot*Rt)*pe/25e-6},ce=_e=>{const Ne=le,Re=de;return{aabb:d.cC(this,R,0,0,0,_e,Re,Ne,this.projection),zoom:0,x:0,y:0,minZ:Re,maxZ:Ne,wrap:_e,fullyVisible:!1}},ue=[];let Me=[];const ve=l,Ue=r.reparseOverscaled?p:l,ke=(q-this._centerAltitude)*U,Ge=_e=>{if(!this._elevation||!_e.tileID||!b)return;const Ne=this._elevation.getMinMaxForTile(_e.tileID),Re=_e.aabb;Ne?(Re.min[2]=Ne.min,Re.max[2]=Ne.max,Re.center[2]=(Re.min[2]+Re.max[2])/2):(_e.shouldSplit=Ce(_e),_e.shouldSplit||(Re.min[2]=Re.max[2]=Re.center[2]=this._centerAltitude))},rt=(_e,Ne)=>{if(.707*Ne<_e)return 1;const Re=Ne/_e;return Re/(1.4144271570014144+(Math.pow(1.1,Re-1.4144271570014144+1)-1)/(1.1-1)-1)},Ce=_e=>{if(_e.zoom<ne)return!0;if(_e.zoom===ve)return!1;if(null!=_e.shouldSplit)return _e.shouldSplit;const Ne=_e.aabb.distanceX($),Re=_e.aabb.distanceY($);let We=ke,Ze=1;if(N){We=_e.aabb.distanceZ($);const Rt=Math.pow(2,_e.zoom),Xt=d.aY((_e.y+1)/Rt),tn=d.aY(_e.y/Rt),gn=Math.min(Math.max(D,Xt),tn),Dn=d.c_(gn)/d.c_(D);if(Ze=gn===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Dn/this._mercatorScaleRatio),this.zoom<=d.cX&&_e.zoom===ve-1&&Dn>=.9)return!0}else if(v&&(We=_e.aabb.distanceZ($)*U),this.projection.isReprojectedInTileSpace&&p<=5){const Rt=Math.pow(2,_e.zoom),Xt=ae(new d.ac((_e.x+.5)/Rt,(_e.y+.5)/Rt));Ze=Xt>.85?1:Xt}if(!b){const Rt=Math.sqrt(Ne*Ne+Re*Re+We*We);let Xt=(1<<ve-_e.zoom)*ee*Ze;return Xt*=rt(Math.max(We,ke),Rt),Rt<Xt}let Ye=Number.MAX_VALUE,dt=0;const Pt=_e.aabb.getCorners(),Ft=[];for(const Rt of Pt){d.at(Ft,Rt,$),N||(v?Ft[2]*=U:Ft[2]=ke);const Xt=d.bG(Ft,this._camera.forward());Xt<Ye&&(Ye=Xt,dt=Math.abs(Ft[2]))}let vt=(1<<ve-_e.zoom)*ee*Ze;if(vt*=rt(Math.max(dt,ke),Ye),Ye<vt)return!0;const Ot=_e.aabb.closestPoint(O);return Ot[0]===O[0]&&Ot[1]===O[1]};if(this.renderWorldCopies)for(let _e=1;_e<=3;_e++)ue.push(ce(-_e)),ue.push(ce(_e));for(ue.push(ce(0));ue.length>0;){const _e=ue.pop(),Ne=_e.x,Re=_e.y;let We=_e.fullyVisible;const Ze=()=>"globe"===this.projection.name&&(0===_e.y||_e.y===(1<<_e.zoom)-1);if(!We){let Ye=K?_e.aabb.intersects(B):_e.aabb.intersectsFlat(B);if(0===Ye&&Ze()){const dt=new d.cA(_e.zoom,Ne,Re);Ye=d.cB(this,R,dt,!0).intersects(B)}if(0===Ye)continue;We=2===Ye}if(_e.zoom!==ve&&Ce(_e))for(let Ye=0;Ye<4;Ye++){const dt=(Ne<<1)+Ye%2,Pt=(Re<<1)+(Ye>>1),Ft={aabb:b?_e.aabb.quadrant(Ye):d.cC(this,R,_e.zoom+1,dt,Pt,_e.wrap,_e.minZ,_e.maxZ,this.projection),zoom:_e.zoom+1,x:dt,y:Pt,wrap:_e.wrap,fullyVisible:We,tileID:void 0,shouldSplit:void 0,minZ:_e.minZ,maxZ:_e.maxZ};v&&!N&&(Ft.tileID=new d.aM(_e.zoom+1===ve?Ue:_e.zoom+1,_e.wrap,_e.zoom+1,dt,Pt),Ge(Ft)),ue.push(Ft)}else{const Ye=_e.zoom===ve?Ue:_e.zoom;if(r.minzoom&&r.minzoom>Ye)continue;let dt=0;if(!We){let Ot=K?_e.aabb.intersectsPrecise(B):_e.aabb.intersectsPreciseFlat(B);if(0===Ot&&Ze()){const Rt=new d.cA(_e.zoom,Ne,Re);Ot=d.cB(this,R,Rt,!0).intersectsPrecise(B)}if(0===Ot)continue;if(r.calculateQuadrantVisibility)if(B.containsPoint(_e.aabb.center))dt=15;else for(let Rt=0;Rt<4;Rt++)0!==_e.aabb.quadrant(Rt).intersects(B)&&(dt|=1<<Rt)}const Pt=O[0]-(.5+Ne+(_e.wrap<<_e.zoom))*(1<<l-_e.zoom),Ft=O[1]-.5-Re,vt=_e.tileID?_e.tileID:new d.aM(Ye,_e.wrap,_e.zoom,Ne,Re);r.calculateQuadrantVisibility&&(vt.visibleQuadrants=dt),Me.push({tileID:vt,distanceSq:Pt*Pt+Ft*Ft})}}if(this.fogCullDistSq){const _e=this.fogCullDistSq,Ne=this.horizonLineFromTop();Me=Me.filter(Re=>{const We=[0,0,0,1],Ze=[d.aj,d.aj,0,1],Ye=this.calculateFogTileMatrix(Re.tileID.toUnwrapped());d.aA(We,We,Ye),d.aA(Ze,Ze,Ye);const dt=d.cD([],We,Ze),Pt=d.cE([],We,Ze),Ft=d.cY(dt,Pt);if(0===Ft)return!0;let vt=!1;const Ot=this._elevation;if(Ot&&Ft>_e&&0!==Ne){const Rt=this.calculateProjMatrix(Re.tileID.toUnwrapped());let Xt;r.isTerrainDEM||(Xt=Ot.getMinMaxForTile(Re.tileID)),Xt||(Xt={min:de,max:le});const tn=d.cF(this.rotation),gn=[tn[0]*d.aj,tn[1]*d.aj,Xt.max];d.ad(gn,gn,Rt),vt=(1-gn[1])*this.height*.5<Ne}return Ft<_e||vt})}return Me.sort((_e,Ne)=>_e.distanceSq-Ne.distanceSq).map(_e=>_e.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=d.ay(r.lat,-d.cG,d.cG),p=this.projection.project(r.lng,l);return new d.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/d.cb(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,l){let p,y;const v=this.centerPoint;if("globe"===this.projection.name){const C=this.worldSize;p=(l.x-v.x)/C,y=(l.y-v.y)/C}else{const C=this.pointCoordinate(l),D=this.pointCoordinate(v);p=C.x-D.x,y=C.y-D.y}const b=this.locationCoordinate(r);this.setLocation(new d.ac(b.x-p,b.y-y))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r,l){return this.projection.locationPoint(this,r,l)}locationPoint3D(r,l){return this.projection.locationPoint(this,r,l,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r,l){return this.coordinateLocation(this.pointCoordinate3D(r,l))}locationCoordinate(r,l){const p=l?d.cb(l,r.lat):void 0,y=this.projection.project(r.lng,r.lat);return new d.ac(y.x,y.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){const p=l??this._centerAltitude,y=[r.x,r.y,0,1],v=[r.x,r.y,1,1];d.aA(y,y,this.pixelMatrixInverse),d.aA(v,v,this.pixelMatrixInverse);const b=v[3];d.cH(y,y,1/y[3]),d.cH(v,v,1/b);const C=y[2],D=v[2];return{p0:y,p1:v,t:C===D?0:(p-C)/(D-C)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return d.aA(l,l,this.pixelMatrixInverse),d.aA(p,p,this.pixelMatrixInverse),d.cH(l,l,1/l[3]),d.cH(p,p,1/p[3]),l[2]=d.cb(l[2],this._center.lat)*this.worldSize,p[2]=d.cb(p[2],this._center.lat)*this.worldSize,d.cH(l,l,1/this.worldSize),d.cH(p,p,1/this.worldSize),new d.av([l[0],l[1],l[2]],d.au([],d.at([],p,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:p,t:y}=r,v=d.cb(l[2],this._center.lat),b=d.cb(p[2],this._center.lat);return new d.ac(d.ai(l[0],p[0],y)/this.worldSize,d.ai(l[1],p[1],y)/this.worldSize,d.ai(v,b,y))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r,l){if(!this.elevation)return this.pointCoordinate(r,l);let p=this.projection.pointCoordinate3D(this,r.x,r.y);if(p)return new d.ac(p[0],p[1],p[2]);let y=0,v=this.horizonLineFromTop();if(r.y>v)return this.pointCoordinate(r,l);const b=.02*v,C=r.clone();for(let D=0;D<10&&v-y>b;D++){C.y=d.ai(y,v,.66);const R=this.projection.pointCoordinate3D(this,C.x,C.y);R?(v=C.y,p=R):y=C.y}return p?new d.ac(p[0],p[1],p[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=d.cI)return!this.isPointAboveHorizon(r);const l=this.pointCoordinate(r);return l.y>=0&&l.y<=1}_coordinatePoint(r,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,y=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return d.aA(y,y,this.pixelMatrix),y[3]>0?new d.P(y[0]/y[3],y[1]/y[3]):new d.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,v=this.pointLocation3D(new d.P(l,r)),b=this.pointLocation3D(new d.P(y,r)),C=this.pointLocation3D(new d.P(y,p)),D=this.pointLocation3D(new d.P(l,p));let R=Math.min(v.lng,b.lng,C.lng,D.lng),O=Math.max(v.lng,b.lng,C.lng,D.lng),N=Math.min(v.lat,b.lat,C.lat,D.lat),k=Math.max(v.lat,b.lat,C.lat,D.lat);const B=Math.pow(2,-this.zoom)/16*270,H="globe"===this.projection.name?1:4,U=(q,$,K,ee,ne)=>{const le=(q+K)/2,de=($+ee)/2,pe=new d.P(le,de),{lng:ae,lat:ce}=this.pointLocation3D(pe),ue=Math.max(0,R-ae,N-ce,ae-O,ce-k);R=Math.min(R,ae),O=Math.max(O,ae),N=Math.min(N,ce),k=Math.max(k,ce),(ne<H||ue>B)&&(U(q,$,le,de,ne+1),U(le,de,K,ee,ne+1))};if(U(l,r,y,r,1),U(y,r,y,p,1),U(y,p,l,p,1),U(l,p,l,r,1),"globe"===this.projection.name){const[q,$]=d.cJ(this);q?(k=90,O=180,R=-180):$&&(N=-90,O=180,R=-180)}return new d.aG(new d.ci(R,N),new d.ci(O,k))}_getBoundsRectangular(r,l){const{top:p,left:y}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,C=new d.P(y,p),D=new d.P(b,p),R=new d.P(b,v),O=new d.P(y,v);let N=this.pointCoordinate(C,r),k=this.pointCoordinate(D,r);const B=this.pointCoordinate(R,l),H=this.pointCoordinate(O,l),U=(q,$)=>($.y-q.y)/($.x-q.x);return N.y>1&&k.y>=0?N=new d.ac((1-H.y)/U(H,N)+H.x,1):N.y<0&&k.y<=1&&(N=new d.ac(-H.y/U(H,N)+H.x,0)),k.y>1&&N.y>=0?k=new d.ac((1-B.y)/U(B,k)+B.x,1):k.y<0&&N.y<=1&&(k=new d.ac(-B.y/U(B,k)+B.x,0)),(new d.aG).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(B))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=r.visibleDemTiles.reduce((p,y)=>{if(y.dem){const v=y.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-d.cG,this.maxLat=d.cG,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.aD(this.minLng)*this.tileSize,this.worldMaxX=d.aD(this.maxLng)*this.tileSize,this.worldMinY=d.aH(this.maxLat)*this.tileSize,this.worldMaxY=d.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){const l=r.key,p=this._distanceTileDataCache;if(p[l])return p[l];const y=r.canonical,v=1/this.height,b=this.cameraWorldSize,C=b/this.zoomScale(y.z),D=(y.x+Math.pow(2,y.z)*r.wrap)*C,R=y.y*C,O=this.point;O.x*=b/this.worldSize,O.y*=b/this.worldSize;const N=this.angle,k=Math.sin(-N),B=-Math.cos(-N);return p[l]={bearing:[k,B],center:[(O.x-D)*v,(O.y-R)*v],scale:C/d.aj*v},p[l]}calculateFogTileMatrix(r){const l=r.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return d.az(y,this.worldToFogMatrix,y),p[l]=new Float32Array(y),p[l]}calculateProjMatrix(r,l=!1,p=!1){const y=r.key;let v;if(v=p?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,v[y])return v[y];const b=this.calculatePosMatrix(r,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,d.az(b,C,b),v[y]=new Float32Array(b),v[y]}calculatePixelsToTileUnitsMatrix(r){const l=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const y=d.cK(r,this);return p[l]=y,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const r=1/this.worldSize,l=d.bn([],[r,r,r]);return d.az(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const r=this._elevation;this._updateCameraState();const l=d.cb(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),y=this._camera.forward(),v=d.cb(1,this._center.lat);p[2]/=v,y[2]/=v,d.au(y,y);const b=r.raycast(p,y,r.exaggeration());if(b){const C=d.bE([],p,y,b),D=new d.ac(C[0],C[1],d.cb(C[2],d.aY(C[1]))),R=(D.z+d.ae([D.x-p[0],D.y-p[1],D.z-p[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const l=this._elevation,p=d.cb(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(p),v=l.getAtPointOrZero(new d.ac(...y)),b=this.pixelsPerMeter/this.worldSize*v,C=this._minimumHeightOverTerrain(),D=y[2]-b;if(D<=C)if(D<0||r){const R=this.locationCoordinate(this._center,this._centerAltitude),O=[y[0],y[1],R.z-y[2]],N=d.ae(O);O[2]-=(C-D)/this._pixelsPerMercatorPixel;const k=d.ae(O);if(0===k)return;d.c1(O,O,N/k*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],R.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const k=this.center;return k.lat=d.ay(k.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(k.lng=d.ay(k.lng,this.minLng,this.maxLng)),this.center=k,void(this._constraining=!1)}const l=this._unmodified,{x:p,y}=this.point;let v=0,b=p,C=y;const D=this.width/2,R=this.height/2,O=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(y-R<O&&(C=O+R),y+R>N&&(C=N-R),N-O<this.height&&(v=Math.max(v,this.height/(N-O)),C=(N+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const k=this.worldMinX*this.scale,B=this.worldMaxX*this.scale,H=this.worldSize/2-(k+B)/2;b=(p+H+this.worldSize)%this.worldSize-H,b-D<k&&(b=k+D),b+D>B&&(b=B-D),B-k<this.width&&(v=Math.max(v,this.width/(B-k)),b=(B+k)/2)}b===p&&C===y||this._allowWorldUnderZoom||(this.center=this.unproject(new d.P(b,C))),v&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l="globe"===this.projection.name,p=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=d.cb(1,this.center.lat)/d.cb(1,d.c$));const y=d.cL(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v="meters"===this.projection.zAxisUnit?p:1,b=this._camera.getWorldToCamera(this.worldSize,v);let C;const D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-r.x/this.width,D[9]=2*r.y/this.height,this.isOrthographic){let ce=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ue=ce*this.aspect,Me=-ue,ve=-ce;ue-=r.x,Me-=r.x,ce+=r.y,ve+=r.y,C=this._camera.getCameraToClipOrthographic(Me,ue,ve,ce,this._nearZ,this._farZ),((Ue,ke,Ge,rt)=>{for(let Ce=0;Ce<16;Ce++)Ue[Ce]=d.ai(ke[Ce],Ge[Ce],rt)})(C,C,D,d.cZ(this.pitch>=15?1:this.pitch/15))}else C=D;const R=d.cM([],D,b);let O=d.cM([],C,b);if(this.projection.isReprojectedInTileSpace){const ce=this.locationCoordinate(this.center),ue=d.bx([]);d.bo(ue,ue,[ce.x*this.worldSize,ce.y*this.worldSize,0]),d.az(ue,ue,d.cN(this)),d.bo(ue,ue,[-ce.x*this.worldSize,-ce.y*this.worldSize,0]),d.az(O,O,ue),d.az(R,R,ue),this.inverseAdjustmentMatrix=d.cO(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=d.cP([],O,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=O,this.invProjMatrix=d.bi(new Float64Array(16),this.projMatrix),l){const ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ce[8]=2*-r.x/this.width,ce[9]=2*r.y/this.height,this.expandedFarZProjMatrix=d.cM([],ce,b)}else this.expandedFarZProjMatrix=this.projMatrix;const N=d.bi([],C);this.frustumCorners=d.cQ.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height),this.cameraFrustum=d.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const k=new Float32Array(16);d.bx(k),d.cP(k,k,[1,-1,1]),d.cR(k,k,this._pitch),d.by(k,k,this.angle);const B=d.c9(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=d.bw(B);const H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-r.x/this.width,B[9]=2*(r.y+H)/this.height,this.skyboxMatrix=d.az(k,B,k);const U=this.point,q=U.x,$=U.y,K=this.width%2/2,ee=this.height%2/2,ne=Math.cos(this.angle),le=Math.sin(this.angle),de=q-Math.round(q)+ne*K+le*ee,pe=$-Math.round($)+ne*ee+le*K,ae=new Float64Array(O);if(d.bo(ae,ae,[de>.5?de-1:de,pe>.5?pe-1:pe,0]),this.alignedProjMatrix=ae,O=d.bz(),d.cP(O,O,[this.width/2,-this.height/2,1]),d.bo(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=d.bz(),d.cP(O,O,[1,-1,1]),d.bo(O,O,[-1,-1,0]),d.cP(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=d.az(new Float64Array(16),this.labelPlaneMatrix,R),this._calcFogMatrices(),this._distanceTileDataCache={},O=d.bi(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=d.cS(this);const ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=d.ad(ce,ce,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,v=[r,r,l];d.c1(v,v,y),d.c1(p,p,-1),d.cT(p,p,v);const b=d.bz();d.bo(b,b,p),d.cP(b,b,v),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,y)}_computeCameraPosition(r){const l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),y=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-p[0]*v,y.y/this.worldSize-p[1]*v,r/this.worldSize*this._centerAltitude-p[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],y=r[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(v=Math.min((l-p)/y,1)),this._camera.position=d.bE([],this._camera.position,r,v),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:y}=this._camera.getPitchBearing(),v=d.cb(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.al(this._maxPitch)),C=Math.max((r[2]-v)/Math.cos(p),b),D=this._zoomFromMercatorZ(C);d.bE(r,r,l,C),this._pitch=d.ay(p,d.al(this.minPitch),d.al(this.maxPitch)),this.angle=d.bQ(y,-Math.PI,Math.PI),this._setZoom(d.ay(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new d.ac(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,r)*this.tileSize))}zoomFromMercatorZAdjusted(r){let l=0,p=d.cI,y=0,v=1/0;for(;p-l>1e-6&&p>l;){const b=l+.5*(p-l),C=this.tileSize*Math.pow(2,b),D=this.getCameraToCenterDistance(this.projection,b,C),R=this.scaleZoom(D/(Math.max(0,r)*this.tileSize)),O=Math.abs(b-R);O<v&&(v=O,y=b),b<R?l=b:p=b}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(d.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){const p=Math.min(r.x,l.x),y=Math.max(r.x,l.x),v=Math.min(r.y,l.y),b=Math.max(r.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const C=[new d.P(p,v),new d.P(y,b),new d.P(p,b),new d.P(y,v)],D=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const O of C){const N=this.pointRayIntersection(O);if(N.t<0)return!0;const k=this.rayIntersectionCoordinate(N);if(k.x<D||k.y<0||k.x>R||k.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.cU(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.P(0,0),new d.P(this.width,this.height))}zoomDeltaToMovement(r,l){const p=d.ae(d.at([],this._camera.position,r)),y=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(y)}getCameraPoint(){if("globe"===this.projection.name){const r=function([l,p,y],v){const b=[l,p,y,1];d.aA(b,b,v);const C=b[3]=Math.max(b[3],1e-6);return b[0]/=C,b[1]/=C,b[2]/=C,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new d.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,r))}}getCameraToCenterDistance(r,l=this.zoom,p=this.worldSize){const y=d.cL(r,l,this.width,this.height,1024),v=r.pixelSpaceConversion(this.center.lat,p,y);let b=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(b=d.ai(1,b,d.cZ(this.pitch>=15?1:this.pitch/15))),b}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&d.az(r,r,this.globeMatrix),r}getFrustum(r){return d.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,"meters"===this.projection.zAxisUnit)}}const xo=(f,r)=>{if(r>0&&f.terrain&&d.w("Cutoff is currently disabled on terrain"),r<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=f.transform,p=Math.max(Math.abs(l._zoom-(f.minCutoffZoom-1)),1),y=l.isLODDisabled(!1)?d.af(60,45,l.pitch):d.af(30,15,l.pitch),v=l._farZ-l._nearZ,b=r*l.height,C=((1-(D=y))*l.cameraToCenterDistance+D*(l._farZ+b))*p;var D;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(C-l._nearZ)/v,(C-b-l._nearZ)/v]}}},eo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class $o{constructor(r,l){this.aabb=r,this.lastCascade=l}}class ka{add(r,l){const p=this.receivers[r.key];void 0!==p?(p.aabb.min[0]=Math.min(p.aabb.min[0],l.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],l.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],l.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],l.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],l.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],l.max[2])):this.receivers[r.key]=new $o(l,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,l,p){const y=d.d6.fromPoints(r.points);let v=0;for(const b in this.receivers){const C=this.receivers[b];if(!C||!y.intersectsAabb(C.aabb))continue;C.aabb.min=y.closestPoint(C.aabb.min),C.aabb.max=y.closestPoint(C.aabb.max);const D=C.aabb.getCorners();for(let R=0;R<p.length;R++){let O=!0;for(const N of D){const k=[N[0]*l,N[1]*l,N[2]];if(d.ad(k,k,p[R].matrix),k[0]<-1||k[0]>1||k[1]<-1||k[1]>1){O=!1;break}}if(C.lastCascade=R,v=Math.max(v,R),O)break}}return v+1}}class qi{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ka,this._depthMode=new wt(r.context.gl.LEQUAL,wt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(eo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(eo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),r.tp.registerParameter(eo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,l){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;const y=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||y<=0||(this._shadowLayerCount=p.style.order.reduce((H,U)=>{const q=p.style._mergedLayers[U];return H+(q.hasShadowPass()&&!q.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const v=p.context,b=eo.shadowMapResolution,C=eo.shadowMapResolution;if(0===this._cascades.length||eo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let H=0;H<eo.cascadeCount;++H){const U=p._shadowMapDebug,q=v.gl,$=v.createFramebuffer(b,C,U,"texture"),K=new d.T(v,{width:b,height:C,data:null},q.DEPTH_COMPONENT16);if($.depthAttachment.set(K.texture),U){const ee=new d.T(v,{width:b,height:C,data:null},q.RGBA8);$.colorAttachment.set(ee.texture)}this._cascades.push({framebuffer:$,texture:K,matrix:[],far:0,boundingSphereRadius:0,frustum:new d.cy,scale:0})}}this.shadowDirection=Wl(l);let D=0;if(r.elevation){const H=r.elevation,U=[1e4,-1e4];H.visibleDemTiles.filter(q=>q.dem).forEach(q=>{const $=q.dem.tree;U[0]=Math.min(U[0],$.minimums[0]),U[1]=Math.max(U[1],$.maximums[0])}),1e4!==U[0]&&(D=(U[1]-U[0])*H.exaggeration())}const R=1.5*r.cameraToCenterDistance,O=3*R,N=new Float64Array(16);for(let H=0;H<this._cascades.length;++H){const U=this._cascades[H];let q=r.height/50,$=1;1===eo.cascadeCount?$=O:0===H?$=R:(q=R,$=O);const[K,ee]=Bc(r,this.shadowDirection,q,$,eo.shadowMapResolution,D);U.scale=r.scale,U.matrix=K,U.boundingSphereRadius=ee,d.bi(N,U.matrix),U.frustum=d.cy.fromInvProjectionMatrix(N,1,0,!0),U.far=$}const k=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[k].far,this._cascades[k].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/eo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=eo.shadowMapResolution,this._uniformValues.u_shadowmap_0=Jr.ShadowMap0,this._uniformValues.u_shadowmap_1=Jr.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const B=p.transform.elevation;for(const H of this._groundShadowTiles){let U={min:0,max:0};if(B){const q=B.getMinMaxForTile(H);q&&(U=q)}this.addShadowReceiver(H.toUnwrapped(),U.min,U.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,l){if(!this.enabled)return;const p=this.painter,y=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),y.viewport.set([0,0,eo.shadowMapResolution,eo.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){p.currentShadowCascade=v,y.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),y.clear({color:d.am.white,depth:1});for(const b of r.order){const C=r._mergedLayers[b];if(!C.hasShadowPass()||C.isHidden(p.transform.zoom))continue;const D=r.getLayerSourceCache(C),R=D?l[D.id]:void 0;("model"===C.type||R&&R.length)&&p.renderLayer(p,D,C,R)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,l=r.style,p=r.context,y=p.gl,v=l.directionalLight,b=l.ambientLight;if(!v||!b)return;const C=[],D=xo(r,r.longestCutoffRange);D.shouldRenderCutoff&&C.push("RENDER_CUTOFF"),C.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&C.push("NORMAL_OFFSET");const R=il(l,v,b),O=new wt(y.LEQUAL,wt.ReadOnly,r.depthRangeFor3D),N=new Vt({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const k of this._groundShadowTiles){const B=k.toUnwrapped(),H=r.isTileAffectedByFog(k),U=r.getOrCreateProgram("groundShadow",{defines:C,overrideFog:H});this.setupShadows(B,U),r.uploadCommonUniforms(p,U,B,null,D);const q={u_matrix:r.transform.calculateProjMatrix(B),u_ground_shadow_factor:R};U.draw(r,y.TRIANGLES,O,N,ln.multiply,Bt.disabled,q,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,null,r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?ln.unblended:ln.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const l=this.painter.transform,p=l.calculatePosMatrix(r,l.worldSize);return d.az(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(r){return d.az(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,l,p){if(!this.enabled)return;const y=this.painter.transform,v=this.painter.context,b=v.gl,C=this._uniformValues,D=new Float64Array(16),R=y.calculatePosMatrix(r,y.worldSize);for(let O=0;O<this._cascades.length;O++)d.az(D,this._cascades[O].matrix,R),C[0===O?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),v.activeTexture.set(b.TEXTURE0+Jr.ShadowMap0+O),this._cascades[O].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const O=d.d4(r.canonical),N=2/y.tileSize*d.aj/eo.shadowMapResolution,k=N*this._cascades[0].boundingSphereRadius,B=N*this._cascades[this._cascades.length-1].boundingSphereRadius,H=("vector-tile"===p?1:3)*function(U,q,$,K,ee){const ne=d.ay((U-22)/-22,0,1);return.125*(1-ne)+4*ne}(y.zoom);C.u_shadow_normal_offset=[O,k*H,B*H],C.u_shadow_bias=[1e-4,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(v,C)}setupShadowsFromMatrix(r,l,p=!1){if(!this.enabled)return;const y=this.painter.context,v=y.gl,b=this._uniformValues,C=new Float64Array(16);for(let D=0;D<eo.cascadeCount;D++)d.az(C,this._cascades[D].matrix,r),b[0===D?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),y.activeTexture.set(v.TEXTURE0+Jr.ShadowMap0+D),this._cascades[D].texture.bindExtraParam(v.LINEAR,v.LINEAR,v.CLAMP_TO_EDGE,v.CLAMP_TO_EDGE,v.GREATER);if(this.useNormalOffset=p,p){const D=eo.normalOffset;b.u_shadow_normal_offset=[1,D,D],b.u_shadow_bias=[6e-5,.0012,.012]}else b.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(y,b)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,l,p,y){if(y[2]>=0)return{};const v=function(D,R,O){const N=O/(1<<D.canonical.z);return new d.d6([D.canonical.x*N+D.wrap*O,D.canonical.y*N+D.wrap*O,0],[(D.canonical.x+1)*N+D.wrap*O,(D.canonical.y+1)*N+D.wrap*O,R])}(r,l,p).getCorners(),b=l/-y[2];y[0]<0?(d.d5(v[0],v[0],[y[0]*b,0,0]),d.d5(v[3],v[3],[y[0]*b,0,0])):y[0]>0&&(d.d5(v[1],v[1],[y[0]*b,0,0]),d.d5(v[2],v[2],[y[0]*b,0,0])),y[1]<0?(d.d5(v[0],v[0],[0,y[1]*b,0]),d.d5(v[1],v[1],[0,y[1]*b,0])):y[1]>0&&(d.d5(v[2],v[2],[0,y[1]*b,0]),d.d5(v[3],v[3],[0,y[1]*b,0]));const C={};return C.vertices=v,C.planes=[ma(v[1],v[0],v[4]),ma(v[2],v[1],v[5]),ma(v[3],v[2],v[6]),ma(v[0],v[3],v[7])],C}addShadowReceiver(r,l,p){this._receivers.add(r,d.d6.fromTileIdAndHeight(r,l,p))}getMaxCascadeForTile(r){const l=this._receivers.get(r);return l&&l.lastCascade?l.lastCascade:0}}function ma(f,r,l){const p=d.at([],l,r),y=d.at([],f,r),v=d.bF([],p,y),b=d.ae(v);return 0===b?[0,0,1,0]:(d.c1(v,v,1/b),[v[0],v[1],v[2],-d.bG(v,r)])}function Wl(f){const r=f.properties.get("direction"),l=d.d1(r.x,r.y,r.z);l[2]=d.ay(l[2],0,75);const p=d.d3([l[0],l[1],l[2]]);return d.d2(p.x,p.y,p.z)}function il(f,r,l){const p="none"===r.properties.get("color-use-theme"),y=r.properties.get("color"),v=r.properties.get("intensity"),b=r.properties.get("direction"),C=[b.x,b.y,b.z],D="none"===l.properties.get("color-use-theme"),R=l.properties.get("color"),O=l.properties.get("intensity"),N=Math.max(d.bG([0,0,1],C),0),k=[0,0,0];d.c1(k,R.toPremultipliedRenderColor(D?null:f.getLut(r.scope)).toArray01Linear().slice(0,3),O);const B=[0,0,0];return d.c1(B,y.toPremultipliedRenderColor(p?null:f.getLut(l.scope)).toArray01Linear().slice(0,3),N*v),d.d8([k[0]>0?k[0]/(k[0]+B[0]):0,k[1]>0?k[1]/(k[1]+B[1]):0,k[2]>0?k[2]/(k[2]+B[2]):0])}function Bc(f,r,l,p,y,v){const b=f.zoom,C=f.scale,D=f.worldSize,R=1/D,O=f.aspect,N=Math.sqrt(1+O*O)*Math.tan(.5*f.fovX),k=N*N,B=p-l,H=p+l;let U,q;k>B/H?(U=p,q=p*N):(U=.5*H*(1+k),q=.5*Math.sqrt(B*B+2*(p*p+l*l)*k+H*H*k*k));const $=f.projection.pixelsPerMeter(f.center.lat,D),K=f._camera.getCameraToWorldMercator(),ee=[0,0,-U*R];d.ad(ee,ee,K);let ne=q*R;const le=f._edgeInsets;if(!(0===le.left&&0===le.top&&0===le.right&&0===le.bottom||le.left===le.right&&le.top===le.bottom)){const We=f._camera.getWorldToCamera(f.worldSize,"meters"===f.projection.zAxisUnit?$:1),Ze=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,l,p);Ze[8]=2*-f.centerOffset.x/f.width,Ze[9]=2*f.centerOffset.y/f.height;const Ye=new Float64Array(16);d.cM(Ye,Ze,We);const dt=new Float64Array(16);d.bi(dt,Ye);const Pt=d.cy.fromInvProjectionMatrix(dt,D,b,!0);for(const Ft of Pt.points){const vt=((de=Ft)[0]/=C,de[1]/=C,de[2]=d.cb(de[2],f._center.lat),de);ne=Math.max(ne,d.c2(d.d7([],ee,vt)))}}var de;ne*=y/(y-1);const pe=Math.acos(r[2]),ae=Math.atan2(-r[0],-r[1]),ce=new ws;ce.position=ee,ce.setPitchBearing(pe,ae);const ue=ce.getWorldToCamera(D,$),Me=ne*D,ve=Math.min(f._mercatorZfromZoom(17)*D*-2,-2*Me),Ue=ce.getCameraToClipOrthographic(-Me,Me,-Me,Me,ve,(Me+v*$)/r[2]),ke=new Float64Array(16);d.az(ke,Ue,ue);const Ge=d.d2(Math.floor(1e6*ee[0])/1e6*D,Math.floor(1e6*ee[1])/1e6*D,0),rt=.5*y,Ce=[0,0,0];d.ad(Ce,Ge,ke),d.c1(Ce,Ce,rt);const _e=[Math.floor(Ce[0]),Math.floor(Ce[1]),Math.floor(Ce[2])],Ne=[0,0,0];d.at(Ne,Ce,_e),d.c1(Ne,Ne,-1/rt);const Re=new Float64Array(16);return d.bx(Re),d.bo(Re,Re,Ne),d.az(ke,Re,ke),[ke,Me]}class Fa extends d.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(r,l){return d.aS(this.requestManager.transformRequest(l,d.R.Model).url).then(p=>{if(!p)return;const y=d.aT(p),v=new d.aU(r,void 0,void 0,y);return v.computeBoundsAndApplyParent(),v}).catch(p=>{if(p&&404===p.status)return null;this.fire(new d.z(new Error(`Could not load model ${r} from ${l}: ${p.message}`)))})}load(r,l,p={forceReload:!1}){this.models[l]||(this.models[l]={});const y=Object.keys(r),v=[],b=[];for(const C of y){const D=r[C];this.hasURLBeenRequested(D)&&!p.forceReload||(this.modelByURL[D]={modelId:C,scope:l},v.push(this.loadModel(C,D)),b.push(C)),this.models[l][C]||(this.models[l][C]={model:null,numReferences:1})}this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+b.length,Promise.allSettled(v).then(C=>{for(let D=0;D<C.length;D++){const{status:R}=C[D];if("rejected"===R)continue;const{value:O}=C[D];this.models[l][b[D]]||(this.models[l][b[D]]={model:null,numReferences:1}),this.models[l][b[D]].model=O}this.numModelsLoading[l]-=b.length,this.fire(new d.A("data",{dataType:"style"}))}).catch(C=>{this.fire(new d.z(new Error(`Could not load models: ${C.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,l,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(r,l):this.getModelByURL(this.modelUris[l][r]))}getModel(r,l){return this.models[l]||(this.models[l]={}),this.models[l][r]?this.models[l][r].model:void 0}getModelByURL(r){if(!r)return null;const l=this.modelByURL[r];return l?this.models[l.scope][l.modelId].model:null}hasModelBeenAdded(r,l){return this.models[l]&&void 0!==this.models[l][r]}getModelURIs(r){return this.modelUris[r]||{}}addModel(r,l,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const y=this.requestManager.normalizeModelURL(l);if((this.hasModel(r,p,{exactIdMatch:!0})||this.hasModelBeenAdded(r,p))&&this.modelUris[p][r]===y)this.models[p][r].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:v,modelId:b}=this.modelByURL[y];this.models[v][b].numReferences++}else this.modelUris[p][r]=y,this.load({[r]:this.modelUris[p][r]},p)}addModelURLs(r,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const p=this.modelUris[l];for(const y in r)p[y]=this.requestManager.normalizeModelURL(r[y])}reloadModels(r){this.load(this.modelUris[r],r,{forceReload:!0})}addModelsFromBucket(r,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const p={};for(const y of r)this.hasModel(y,l,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[l][y].numReferences++:this.modelUris[l][y]&&!this.hasURLBeenRequested(y)?p[y]=this.modelUris[l][y]:!this.hasURLBeenRequested(y)&&d.d9(y,!1)&&(this.modelUris[l][y]=this.requestManager.normalizeModelURL(y),p[y]=this.modelUris[l][y]);this.load(p,l)}hasURLBeenRequested(r){return void 0!==this.modelByURL[r]}removeModel(r,l,p=!1,y=!1){if(this.models[l]&&this.models[l][r]&&(this.models[l][r].numReferences--,0===this.models[l][r].numReferences||y)){const v=this.modelUris[l][r];p||delete this.modelUris[l][r],delete this.modelByURL[v];const b=this.models[l][r].model;if(!b)return;delete this.models[l][r],b.destroy()}}destroy(){for(const r of Object.keys(this.models))for(const l of Object.keys(this.models[r])){const p=this.models[r][l].model;delete this.models[r][l],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,l){this.models[l]||(this.models[l]={});for(const p in this.models[l])this.models[l][p].model&&this.models[l][p].model.upload(r.context)}}const Zl=new d.a7({data:new d.a8(d.a5.colorTheme.data)});class Ef{constructor(r){this._scope=r,this._buildingQueryParams={target:{featuresetId:"building-outline",importId:this._scope}},this._floorQueryParams={target:{featuresetId:"floor-outline",importId:this._scope}}}execute(r){const l=this._makeBuildingsQueryArea(r),p=this._makeFloorsQueryArea(r),y=r.queryRenderedFeatures(l,this._buildingQueryParams).filter(C=>"building"===C.properties.shape_type).reduce((C,D)=>{const R=D.properties.id;return"building"!==D.properties.shape_type||C.some(O=>O.properties.id===R)||C.push(D),C},[]),v=r.queryRenderedFeatures(p,this._floorQueryParams).filter(C=>"floor"===C.properties.shape_type).reduce((C,D)=>{const R=D.properties.id;return"floor"!==D.properties.shape_type||C.some(O=>O.properties.id===R)||C.push(D),C},[]),b=[r.getCenter().lng,r.getCenter().lat];return{floors:v,building:this._findBuildingAtCenter(b,y)||(y.length>0?y[0]:null)}}_makeBuildingsQueryArea(r){const l=r.transform.width,p=r.transform.height,y=Math.min(l,p),v=y*(1/8),b=y*(1/8),C=.5*(l-v),D=.5*(p-b);return[new d.P(C,D),new d.P(C+v,D+b)]}_makeFloorsQueryArea(r){const l=r.transform.width,p=r.transform.height,y=l*(2/3),v=p*(2/3),b=.5*(l-y),C=.5*(p-v);return[new d.P(b,C),new d.P(b+y,C+v)]}_findBuildingAtCenter(r,l){for(const p of l)if("Polygon"===p.geometry.type&&this._pointInPolygon(r,p.geometry.coordinates[0]))return p;return null}_pointInPolygon(r,l){let p=!1;for(let y=0,v=l.length-1;y<l.length;v=y++){const b=l[y][0],C=l[y][1],D=l[v][1];C>r[1]!=D>r[1]&&r[0]<(l[v][0]-b)*(r[1]-C)/(D-C)+b&&(p=!p)}return p}}class rl{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}setBuildingId(r){this._selectedBuildingId=r}setFloors(r){if(this._floors=r.filter(l=>l.properties.building_id===this._selectedBuildingId),!this._selectedFloorId||!this._floors.map(l=>l.properties.id).includes(this._selectedFloorId)){const l=this._floors.map(p=>({id:p.properties.id,level:p.properties.floor_level})).reduce((p,y)=>{const v=Math.abs(p.level-1),b=Math.abs(y.level-1);return b<v||b===v&&y.level>p.level?y:p});this._selectedFloorId=l.id}}setFloorId(r){this._selectedFloorId=r}getSelectedFloorId(){return this._selectedFloorId}getCurrentBuildingFloors(){return this._floors}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}}const nm={"mbx-indoor-level-selected":{default:["literal",[]]}};function im(f){return f=f||{},Object.assign(f,nm)}class s_ extends d.E{constructor(r){super(),d.aV(["_onLoad","_onMove"],this),this._map=r,this._floorSelectionState=new rl,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=null,this._floorSelectionState=null}_onLoad(){this._map.style.forEachFragmentStyle(r=>{r.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new d.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=r.scope,this._indoorDataQuery=new Ef(this._scope)))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<16)return void this._clearIndoorData();const r=this._indoorDataQuery.execute(this._map);r&&0!==r.floors.length?(this._floorSelectionState.getSelectedFloorId()||this._map._addIndoorControl(),this._selectFloors(r)):this._clearIndoorData()}_selectFloors(r){if(r.building)this._floorSelectionState.setBuildingId(r.building.properties.id),this._floorSelectionState.setFloors(r.floors),this._updateUI();else{const l=this._floorSelectionState.getSelectedFloorId();if(l&&r.floors.some(p=>p.properties.id===l))return;this._clearIndoorData()}}_clearIndoorData(){this._floorSelectionState.reset(),this._map._removeIndoorControl(),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[]])}_updateUI(){const r=this._floorSelectionState.getCurrentBuildingFloors().map(p=>({id:p.properties.id,name:p.properties.name,shortName:p.properties.floor_level,levelOrder:p.properties.floor_level})),l=this._floorSelectionState.getSelectedFloorId();l?(this._updateIndoorConfig(),this.fire(new d.A("indoorupdate",{selectedFloorId:l,floors:r}))):console.warn("IndoorManager: Selected floor is not set")}_updateIndoorConfig(){const r=this._floorSelectionState.getSelectedFloorId();r?this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[r]]):console.warn("IndoorManager: Selected floor is not set")}selectFloor(r){this._floorSelectionState.setFloorId(r),this._updateIndoorConfig()}}function Hu(f){if(!f.metadata||!f.metadata.content_area)return;const r=d.q.devicePixelRatio,{left:l,top:p,width:y,height:v}=f.metadata.content_area,b=l*r,C=p*r;return[b,C,b+y*r,C+v*r]}function rm(f){if(f)return f.map(([r,l])=>[r*d.q.devicePixelRatio,l*d.q.devicePixelRatio])}class Tf{constructor(r,l,p){this.id=r,this.scope=l,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(r){this.missingRequests.has(r.name)||this.pendingRequests.has(r.name)||this.pendingRequests.add(r.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const r=new Map;if(!this.sourceCache.loaded())return r;const l=this.sourceCache.getVisibleCoordinates();if(0===l.length)return r;const p=this.sourceCache.getSource();if(!(p instanceof Hl))return r;const y=l.map(b=>this.sourceCache.getTile(b)),v=p.getImages(y,Array.from(this.pendingRequests));for(const[b,C]of v)r.set(d.I.from({name:b,iconsetId:this.id}),C),this.pendingRequests.delete(b);for(const b of this.pendingRequests)this.missingRequests.add(b);return this.pendingRequests.clear(),r}}const Xl=(f,r)=>se(f,r&&r.filter(l=>"source.canvas"!==l.identifier)),om=d.aF(On,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),a_=d.aF(On,["setCenter","setZoom","setBearing","setPitch"]),Cf=new Set(["background","sky","slot","custom"]),bo={version:8,layers:[],sources:{}},eh={duration:300,delay:0};class js extends d.E{constructor(r,l={}){super(),this.map=r,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=d.h({},eh),this._buildingIndex=new qd(this),this.crossTileSymbolIndex=new vo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new zd,this.dispatcher=l.dispatcher?l.dispatcher:new d.D(d.db(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new cr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new d.dc(r._requestManager,l.localFontFamily?d.dd.all:l.localIdeographFontFamily?d.dd.ideographs:d.dd.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new Fa(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:l.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",d.de());const p=this;this._rtlTextPluginCallback=js.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(v,b)=>{if(d.df(v),b&&b.every(C=>C))for(const C in p._sourceCaches){const D=p._sourceCaches[C],R=D.getSource().type;"vector"!==R&&"geojson"!==R||D.reload()}})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const v=this.getOwnSource(y.sourceId);if(v&&v.vectorLayerIds)for(const b in this._layers){const C=this._layers[b];C.source===v.id&&this._validateLayer(C)}})}load(r){return r?("string"==typeof r?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if("string"==typeof r){if(d.j(r))return r;const l=d.dg(r);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${d.dh(JSON.stringify(r))}`}_diffStyle(r,l,p){this.globalId=this._getGlobalId(r);const y=(v,b)=>{try{b(null,this.setState(v,p))}catch(C){b(C,!1)}};if("string"==typeof r){const v=this.map._requestManager.normalizeStyleURL(r),b=this.map._requestManager.transformRequest(v,d.R.Style);d.n(b,(C,D)=>{C?this.fire(new d.z(C)):D&&y(D,l)})}else"object"==typeof r&&y(r,l)}loadURL(r,l={}){this.fire(new d.A("dataloading",{dataType:"style"}));const p="boolean"==typeof l.validate?l.validate:!d.j(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,l.accessToken),this.resolvedImports.add(r);const y=this.importsCache.get(r);if(y)return this._load(y,p);const v=this.map._requestManager.transformRequest(r,d.R.Style);this._request=d.n(v,(b,C)=>{if(this._request=null,b)this.fire(new d.z(b));else if(C)return this.importsCache.set(r,C),this._load(C,p)})}loadJSON(r,l={}){this.fire(new d.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=d.q.frame(()=>{this._request=null,this._load(r,!1!==l.validate)})}loadEmpty(){this.fire(new d.A("dataloading",{dataType:"style"})),this._load(bo,!1)}_loadImports(r,l,p){if(this.importDepth>=4)return d.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const v of r){const b=this._createFragmentStyle(v),C=new Promise(O=>{b.once("style.import.load",O),b.once("error",O)}).then(()=>this.mergeAll());if(y.push(C),this.resolvedImports.has(v.url)){b.loadEmpty();continue}const D=v.data||this.importsCache.get(v.url);D?(b.loadJSON(D,{validate:l}),this._isInternalStyle(D)&&(b.globalId=null)):v.url?b.loadURL(v.url,{validate:l}):b.loadEmpty();const R={style:b,id:v.id,config:v.config};if(p){const O=this.fragments.findIndex(({id:N})=>N===p);this.fragments=this.fragments.slice(0,O).concat(R).concat(this.fragments.slice(O))}else this.fragments.push(R)}return Promise.allSettled(y)}getImportGlobalIds(r=this,l=new Set){for(const p of r.fragments)p.style.globalId&&l.add(p.style.globalId),this.getImportGlobalIds(p.style,l);return[...l.values()]}_createFragmentStyle(r){const l=this.scope?d.C(r.id,this.scope):r.id;let p;const y=this._initialConfig&&this._initialConfig[l];(r.config||y)&&(p=d.h({},r.config,y));const v=new js(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:r["color-theme"],configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&!1!==r.fragment)}_load(r,l){const p=r.indoor?im(r.schema):r.schema;if(this._isInternalStyle(r)){const b=d.h({},bo,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(b,l)}if(this.updateConfig(this._config,p),l&&Xl(this,Ns(r)))return;this._loaded=!0,this.stylesheet=d.di(r);const y=()=>{for(const R in r.sources)this.addSource(R,r.sources[R],{validate:!1,isInitialLoad:!0});if(r.iconsets)for(const R in r.iconsets)this.addIconset(R,r.iconsets[R]);r.sprite?this._loadIconset(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&r.glyphs&&this.glyphManager.setURL(r.glyphs);const b=Li(this.stylesheet.layers);if(this._order=b.map(R=>R.id),this.stylesheet.light&&d.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const R=this.stylesheet.lights[0];this.light=new Fe(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Fe(this.stylesheet.light)),this._layers={};for(const R of b){const O=d.dn(R,this.scope,this._styleColorTheme.lut,this.options);0!==O.configDependencies.size&&this._configDependentLayers.add(O.fqid),O.setEventedParent(this,{layer:{id:O.id}}),this._layers[O.id]=O;const N=this.getOwnLayerSourceCache(O),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();N&&O.canCastShadows()&&k&&(N.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const C=this.stylesheet.terrain;C&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(C,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new d.A("data",{dataType:"style"}));const D=this.isRootStyle();r.imports?this._loadImports(r.imports,l).then(()=>{this._reloadImports(),this.fire(new d.A(D?"style.load":"style.import.load"))}).catch(R=>{this.fire(new d.z(new Error("Failed to load imports",R))),this.fire(new d.A(D?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new d.A(D?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const b=this._evaluateColorThemeData(v);this._loadColorTheme(b).then(()=>{y()}).catch(C=>{d.w(`Couldn't load color theme from the stylesheet: ${C}`),y()})}else this._styleColorTheme.lut=null,y()}isRootStyle(){return 0===this.importDepth}mergeAll(){let r,l,p,y,v,b,C,D,R,O;const N={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(k=>{if(k.stylesheet){if(null!=k.light&&(r=k.light),k.stylesheet.lights)for(const B of k.stylesheet.lights)"ambient"===B.type&&null!=k.ambientLight&&(l=k.ambientLight),"directional"===B.type&&null!=k.directionalLight&&(p=k.directionalLight);y=this._prioritizeTerrain(y,k.terrain,k.stylesheet.terrain),k.stylesheet.fog&&null!=k.fog&&(v=k.fog),k.stylesheet.snow&&null!=k.snow&&(b=k.snow),k.stylesheet.rain&&null!=k.rain&&(C=k.rain),null!=k.stylesheet.camera&&(O=k.stylesheet.camera),null!=k.stylesheet.projection&&(D=k.stylesheet.projection),null!=k.stylesheet.transition&&(R=k.stylesheet.transition),N[k.scope]=k._styleColorTheme}}),this.light=r,this.ambientLight=l,this.directionalLight=p,this.fog=v,this.snow=b,this.rain=C,this._styleColorThemeForScope=N,null===y?delete this.terrain:this.terrain=y,this.camera=O||{"camera-projection":"perspective"},this.projection=D||{name:"mercator"},this.transition=d.h({},eh,R),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){const l=p=>{for(const y of p.fragments)l(y.style);r(p)};l(this)}_prioritizeTerrain(r,l,p){const y=r&&0===r.drapeRenderMode;return null===p?l&&0===l.drapeRenderMode?l:y?r:null:null!=l&&(!r||y||l&&1===l.drapeRenderMode)?l:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{r=this._prioritizeTerrain(r,l.terrain,l.stylesheet.terrain)}),null===r?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(l=>{null!=l.stylesheet.projection&&(r=l.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},l={},p={};this.forEachFragmentStyle(y=>{for(const v in y._sourceCaches){const b=d.C(v,y.scope);r[b]=y._sourceCaches[v]}for(const v in y._otherSourceCaches){const b=d.C(v,y.scope);l[b]=y._otherSourceCaches[v]}for(const v in y._symbolSourceCaches){const b=d.C(v,y.scope);p[b]=y._symbolSourceCaches[v]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=p}mergeLayers(){const r={},l=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(const b of v._order){const C=v._layers[b];if("slot"===C.type){const D=d.dj(b);if(r[D])continue;r[D]=[]}C.slot&&r[C.slot]?r[C.slot].push(C):l.push(C)}}),this._mergedOrder=[];const y=(v=[])=>{for(const b of v)if("slot"===b.type){const C=d.dj(b.id);r[C]&&y(r[C]),this._mergedSlots.push(C)}else{const C=d.C(b.id,b.scope);this._mergedOrder.push(C),p[C]=b,b.is3D(!!this.terrain)&&(this._has3DLayers=!0),"circle"===b.type&&(this._hasCircleLayers=!0),"symbol"===b.type&&(this._hasSymbolLayers=!0),"clip"===b.type&&(this._clipLayerPresent=!0)}};y(l),this._mergedOrder.sort((v,b)=>{const C=p[v],D=p[b];return C.hasInitialOcclusionOpacityProperties?D.is3D(!!this.terrain)?1:0:C.is3D(!!this.terrain)&&D.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=d.h({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(l,p,y,v){const b=d.h({},p);for(const D of Object.keys(d.a5.colorTheme))void 0===b[D]&&(b[D]=d.a5.colorTheme[D].default);const C=new d.a6(Zl,l,new Map(y));return C.setTransitionOrValue(b,y),C.untransitioned().possiblyEvaluate(new d.aa(0,{worldview:void 0}))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,y)=>{const v="data:image/png;base64,";if(!r||0===r.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let b=r;b.startsWith(v)||(b=v+b);const C=d.I.from("mapbox-reserved-lut"),D=new Image;D.src=b,D.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},D.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void p();this._styleColorTheme.lutLoading=!1;const{width:R,height:O,data:N}=d.q.getImageData(D);if(O>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(R!==O*O)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(C)&&this.removeImage(C),this.addImage(C,{data:new d.r({width:R,height:O},N),pixelRatio:1,sdf:!1,usvg:!1,version:0});const k=this.imageManager.getImage(C,this.scope);k?(this._styleColorTheme.lut={image:k.data,data:r},p()):y(new Error("Missing LUT image."))}})}getLut(r){const l=this._styleColorThemeForScope[r];return l?l.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(l,p,y){let v,b,C;const D=d.q.devicePixelRatio>1?"@2x":"";let R=d.n(p.transformRequest(p.normalizeSpriteURL(l,D,".json"),d.R.SpriteJSON),(k,B)=>{R=null,C||(C=k,v=B,N())}),O=d.o(p.transformRequest(p.normalizeSpriteURL(l,D,".png"),d.R.SpriteImage),(k,B)=>{O=null,C||(C=k,b=B,N())});function N(){if(C)y(C);else if(v&&b){const k=d.q.getImageData(b),B={};for(const H in v){const{width:U,height:q,x:$,y:K,sdf:ee,pixelRatio:ne,stretchX:le,stretchY:de,content:pe}=v[H],ae=new d.r({width:U,height:q});d.r.copy(k,ae,{x:$,y:K},{x:0,y:0},{width:U,height:q},null),B[H]={data:ae,pixelRatio:ne,sdf:ee,stretchX:le,stretchY:de,content:pe,usvg:!1}}y(null,B)}}return{cancel(){R&&(R.cancel(),R=null),O&&(O.cancel(),O=null)}}}(r,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new d.z(l));else if(p){const y=new Map;for(const v in p)y.set(d.I.from(v),p[v]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new d.A("data",{dataType:"style"}))})}addIconset(r,l){if("sprite"===l.type)return void this._loadSprite(l.url);const p=this.getOwnSourceCache(l.source);if(!p)return void this.fire(new d.z(new Error(`Source "${l.source}" as specified by iconset "${r}" does not exist and cannot be used as an iconset source`)));const y=p.getSource();if("raster-array"!==y.type)return void this.fire(new d.z(new Error(`Source "${l.source}" as specified by iconset "${r}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const v=new Tf(r,this.scope,p);this.imageManager.addImageProvider(v,this.scope)}removeIconset(r){this.imageManager.removeImageProvider(r,this.scope)}_loadIconset(r){if(!d.j(r)&&"icon_set"!==this.map._spriteFormat||"raster"===this.map._spriteFormat)return void this._loadSprite(r);const l="auto"===this.map._spriteFormat;var p,y;this._spriteRequest=(y=(v,b)=>{if(this._spriteRequest=null,v)l?this._loadSprite(r):this.fire(new d.z(v));else if(b){const C=new Map;for(const D in b)C.set(d.I.from(D),b[D]);this.addImages(C)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new d.A("data",{dataType:"style"}))},d.br((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(r),d.R.Iconset),(v,b)=>{if(v)return void y(v);const C={},D=d.da(new d.bq(b));for(const R of D.icons){const O={version:1,pixelRatio:d.q.devicePixelRatio,content:Hu(R),stretchX:R.metadata?rm(R.metadata.stretch_x_areas):void 0,stretchY:R.metadata?rm(R.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:R};C[R.name]=O}y(null,C)}))}_validateLayer(r){const l=this.getOwnSource(r.source);if(!l)return;const p=r.sourceLayer;p&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(p))&&this.fire(new d.z(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,l)=>{const p=this.fragments[l];return p&&p.style&&(r.data=p.style.serialize()),r})}_serializeSources(){const r={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();r[p.id]||(r[p.id]=p.serialize())}return r}_serializeLayers(r){const l=[];for(const p of r){const y=this._layers[p];y&&"custom"!==y.type&&l.push(y.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(r){return r?this.order:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const l=this.getOwnLayer(r);if(l)return l;this.fire(new d.z(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const l=this.getOwnSource(r);if(l)return l;this.fire(new d.z(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,l){const p=this.map.painter;if(p)for(let y=r.minzoom||0;y<(r.maxzoom||25.5);y++){const v=r.getProgramIds();if(v)for(const b of v){const C=r.getDefaultProgramParams(b,l.zoom,this._styleColorTheme.lut);C&&(p.style=this,this.fog&&(p._fogVisible=!0,C.overrideFog=!0,p.getOrCreateProgram(b,C)),p._fogVisible=!1,C.overrideFog=!1,p.getOrCreateProgram(b,C),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(C.overrideRtt=!0,p.getOrCreateProgram(b,C)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const l=this.calculateLightsBrightness();r.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l)),r.worldview!==this._worldview&&(this._worldview=r.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const C=this._changes.getLayerUpdatesByScope();for(const D in C){const{updatedIds:R,removedIds:O}=C[D];(R||O)&&(this._updateWorkerLayers(D,R,O),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this.snow&&this.snow.updateTransitions(r),this.rain&&this.rain.updateTransitions(r),this._changes.reset()}const v={};for(const C in this._mergedSourceCaches){const D=this._mergedSourceCaches[C];v[C]=D.used,D.used=!1,D.tileCoverLift=0}for(const C of this._mergedOrder){const D=this._mergedLayers[C];if(D.recalculate(r,this._availableImages),!D.isHidden(r.zoom)){const R=this.getLayerSourceCache(D);R&&(R.used=!0,R.tileCoverLift=Math.max(R.tileCoverLift,D.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(D,r)}):this.precompilePrograms(D,r))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const b=this.imageManager.getPendingImageProviders();for(const C of b)C.sourceCache.used=!0;for(const C in v){const D=this._mergedSourceCaches[C];v[C]!==D.used&&D.getSource().fire(new d.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.snow&&this.snow.recalculate(r),this.rain&&this.rain.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new d.A("data",{dataType:"style"}))}updateImageProviders(){const r=this.imageManager.getPendingImageProviders();for(const l of r){const p=l.resolvePendingRequests(),y=this.getFragmentStyle(l.scope);y&&y.addImages(p)}}_updateTilesForChangedImages(){const r={};for(const l in this._mergedSourceCaches){const p=this._mergedSourceCaches[l].getSource().scope;r[p]=r[p]||this._changes.getUpdatedImages(p),0!==r[p].length&&this._mergedSourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r[p])}for(const l in r)this._changes.resetUpdatedImages(l)}_updateWorkerLayers(r,l,p){const y=this.getFragmentStyle(r);y&&this.dispatcher.broadcast("updateLayers",{layers:l?y._serializeLayers(l):[],scope:r,removedIds:p||[],options:y.options})}setState(r,l){if(this._checkLoaded(),Xl(this,Ns(r)))return!1;(r=d.di(r)).layers=Li(r.layers);const p=function(b,C){if(!b)return[{command:On.setStyle,args:[C]}];let D=[];try{if(!d.bv(b.version,C.version))return[{command:On.setStyle,args:[C]}];if(d.bv(b.center,C.center)||D.push({command:On.setCenter,args:[C.center]}),d.bv(b.zoom,C.zoom)||D.push({command:On.setZoom,args:[C.zoom]}),d.bv(b.bearing,C.bearing)||D.push({command:On.setBearing,args:[C.bearing]}),d.bv(b.pitch,C.pitch)||D.push({command:On.setPitch,args:[C.pitch]}),d.bv(b.sprite,C.sprite)||D.push({command:On.setSprite,args:[C.sprite]}),d.bv(b.glyphs,C.glyphs)||D.push({command:On.setGlyphs,args:[C.glyphs]}),d.bv(b.imports,C.imports)||function(B=[],H=[],U){H=H||[];const q=(B=B||[]).map(Ac),$=H.map(Ac),K=B.reduce(Mc,{}),ee=H.reduce(Mc,{}),ne=q.slice();let le,de,pe,ae;for(le=0,de=0;le<q.length;le++)pe=q[le],ee.hasOwnProperty(pe)?de++:(U.push({command:On.removeImport,args:[pe]}),ne.splice(ne.indexOf(pe,de),1));for(le=0,de=0;le<$.length;le++)pe=$[$.length-1-le],ne[ne.length-1-le]!==pe&&(K.hasOwnProperty(pe)?(U.push({command:On.removeImport,args:[pe]}),ne.splice(ne.lastIndexOf(pe,ne.length-de),1)):de++,ae=ne[ne.length-le],U.push({command:On.addImport,args:[ee[pe],ae]}),ne.splice(ne.length-le,0,pe));for(const ce of H){const ue=K[ce.id];ue&&(delete ue.data,d.bv(ue,ce)||U.push({command:On.updateImport,args:[ce.id,ce]}))}}(b.imports,C.imports,D),d.bv(b.transition,C.transition)||D.push({command:On.setTransition,args:[C.transition]}),d.bv(b.light,C.light)||D.push({command:On.setLight,args:[C.light]}),d.bv(b.fog,C.fog)||D.push({command:On.setFog,args:[C.fog]}),d.bv(b.snow,C.snow)||D.push({command:On.setSnow,args:[C.snow]}),d.bv(b.rain,C.rain)||D.push({command:On.setRain,args:[C.rain]}),d.bv(b.projection,C.projection)||D.push({command:On.setProjection,args:[C.projection]}),d.bv(b.lights,C.lights)||D.push({command:On.setLights,args:[C.lights]}),d.bv(b.camera,C.camera)||D.push({command:On.setCamera,args:[C.camera]}),d.bv(b.iconsets,C.iconsets)||function(B,H,U){let q;for(q in H=H||{},B=B||{})B.hasOwnProperty(q)&&(H.hasOwnProperty(q)||U.push({command:On.removeIconset,args:[q]}));for(q in H){if(!H.hasOwnProperty(q))continue;const $=H[q];B.hasOwnProperty(q)?d.bv(B[q],$)||(U.push({command:On.removeIconset,args:[q]}),U.push({command:On.addIconset,args:[q,$]})):U.push({command:On.addIconset,args:[q,$]})}}(b.iconsets,C.iconsets,D),!d.bv(b["color-theme"],C["color-theme"]))return[{command:On.setStyle,args:[C]}];const R={},O=[];!function(B,H,U,q){let $;for($ in H=H||{},B=B||{})B.hasOwnProperty($)&&(H.hasOwnProperty($)||Nu($,U,q));for($ in H){if(!H.hasOwnProperty($))continue;const K=H[$];B.hasOwnProperty($)?d.bv(B[$],K)||("geojson"===B[$].type&&"geojson"===K.type&&Bs(B,H,$)?U.push({command:On.setGeoJSONSourceData,args:[$,K.data]}):Ic($,H,U,q)):Kp($,H,U)}}(b.sources,C.sources,O,R);const N=[];b.layers&&b.layers.forEach(B=>{B.source&&R[B.source]?D.push({command:On.removeLayer,args:[B.id]}):N.push(B)});let k=b.terrain;k&&R[k.source]&&(D.push({command:On.setTerrain,args:[void 0]}),k=void 0),D=D.concat(O),d.bv(k,C.terrain)||D.push({command:On.setTerrain,args:[C.terrain]}),function(B,H,U){H=H||[];const q=(B=B||[]).map(Ac),$=H.map(Ac),K=B.reduce(Mc,{}),ee=H.reduce(Mc,{}),ne=q.slice(),le=Object.create(null);let de,pe,ae,ce,ue,Me,ve;for(de=0,pe=0;de<q.length;de++)ae=q[de],ee.hasOwnProperty(ae)?pe++:(U.push({command:On.removeLayer,args:[ae]}),ne.splice(ne.indexOf(ae,pe),1));for(de=0,pe=0;de<$.length;de++)ae=$[$.length-1-de],ne[ne.length-1-de]!==ae&&(K.hasOwnProperty(ae)?(U.push({command:On.removeLayer,args:[ae]}),ne.splice(ne.lastIndexOf(ae,ne.length-pe),1)):pe++,Me=ne[ne.length-de],U.push({command:On.addLayer,args:[ee[ae],Me]}),ne.splice(ne.length-de,0,ae),le[ae]=!0);for(de=0;de<$.length;de++)if(ae=$[de],ce=K[ae],ue=ee[ae],!le[ae]&&!d.bv(ce,ue))if(d.bv(ce.source,ue.source)&&d.bv(ce["source-layer"],ue["source-layer"])&&d.bv(ce.type,ue.type)){for(ve in vf(ce.layout,ue.layout,U,ae,null,On.setLayoutProperty),vf(ce.paint,ue.paint,U,ae,null,On.setPaintProperty),d.bv(ce.slot,ue.slot)||U.push({command:On.setSlot,args:[ae,ue.slot]}),d.bv(ce.filter,ue.filter)||U.push({command:On.setFilter,args:[ae,ue.filter]}),d.bv(ce.minzoom,ue.minzoom)&&d.bv(ce.maxzoom,ue.maxzoom)||U.push({command:On.setLayerZoomRange,args:[ae,ue.minzoom,ue.maxzoom]}),ce)ce.hasOwnProperty(ve)&&"layout"!==ve&&"paint"!==ve&&"filter"!==ve&&"metadata"!==ve&&"minzoom"!==ve&&"maxzoom"!==ve&&"slot"!==ve&&(0===ve.indexOf("paint.")?vf(ce[ve],ue[ve],U,ae,ve.slice(6),On.setPaintProperty):d.bv(ce[ve],ue[ve])||U.push({command:On.setLayerProperty,args:[ae,ve,ue[ve]]}));for(ve in ue)ue.hasOwnProperty(ve)&&!ce.hasOwnProperty(ve)&&"layout"!==ve&&"paint"!==ve&&"filter"!==ve&&"metadata"!==ve&&"minzoom"!==ve&&"maxzoom"!==ve&&"slot"!==ve&&(0===ve.indexOf("paint.")?vf(ce[ve],ue[ve],U,ae,ve.slice(6),On.setPaintProperty):d.bv(ce[ve],ue[ve])||U.push({command:On.setLayerProperty,args:[ae,ve,ue[ve]]}))}else U.push({command:On.removeLayer,args:[ae]}),Me=ne[ne.lastIndexOf(ae)+1],U.push({command:On.addLayer,args:[ue,Me]})}(N,C.layers,D)}catch(R){console.warn("Unable to compute style diff:",R),D=[{command:On.setStyle,args:[C]}]}return D}(this.serialize(),r).filter(b=>!(b.command in a_));if(0===p.length)return!1;const y=p.filter(b=>!(b.command in om));if(y.length>0)throw new Error(`Unimplemented: ${y.map(b=>b.command).join(", ")}.`);const v=[];return p.forEach(b=>{v.push(this[b.command](...b.args))}),l&&Promise.all(v).then(l).catch(l),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(r){if(0===r.size)return this;for(const[l,p]of r.entries()){if(this.getImage(l))return this.fire(new d.z(new Error(`An image with the name "${l.name}" already exists.`)));this.imageManager.addImage(l,this.scope,p),this._changes.updateImage(l,this.scope)}return this._updateWorkerImages(),this.fire(new d.A("data",{dataType:"style"})),this}addImage(r,l){return this.getImage(r)?this.fire(new d.z(new Error(`An image with the name "${r.name}" already exists.`))):(this.imageManager.addImage(r,this.scope,l),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new d.A("data",{dataType:"style"})),this)}updateImage(r,l,p=!1){this.imageManager.updateImage(r,this.scope,l),p&&(this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new d.A("data",{dataType:"style"})))}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new d.A("data",{dataType:"style"})),this):this.fire(new d.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(r){return this.modelManager.addModelURLs(r,this.scope),this._updateWorkerModels(),this.fire(new d.A("data",{dataType:"style"})),this}addModel(r,l,p={}){return this._checkLoaded(),this._validate(oe,`models.${r}`,l,null,p)||(this.modelManager.addModel(r,l,this.scope),this.fire(new d.A("data",{dataType:"style"}))),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope,!1,!0),this.fire(new d.A("data",{dataType:"style"})),this):this.fire(new d.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,l,p={}){if(this._checkLoaded(),void 0!==this.getOwnSource(r))throw new Error(`There is already a source with ID "${r}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(Ud,`sources.${r}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const y=Ou(r,l,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const v=b=>{const C=(b?"symbol:":"other:")+y.id,D=d.C(C,this.scope),R=this._sourceCaches[C]=new Ro(D,y,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=R,R.onAdd(this.map)};v(!1),"vector"!==l.type&&"geojson"!==l.type||v(!0),y.onAdd&&y.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const l=this.getOwnSource(r);if(!l)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===r)return this.fire(new d.z(new Error(`Source "${r}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new d.z(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find(([v,b])=>"source"===b.type&&b.source===r);if(y)return this.fire(new d.z(new Error(`Source "${r}" cannot be removed while iconset "${y[0]}" is using it.`)))}const p=this.getOwnSourceCaches(r);for(const y of p){const v=d.dj(y.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(y.id),y.fire(new d.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getOwnSource(r).setData(l),this._changes.setDirty()}getOwnSource(r){const l=this.getOwnSourceCache(r);return l&&l.getSource()}getOwnSources(){const r=[];for(const l in this._otherSourceCaches){const p=this.getOwnSourceCache(l);p&&r.push(p.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const l in r){const p=r[l]._tiles;for(const y in p){const v=p[y];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const v of r){if(this._validate(Ru,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const b=this.ambientLight;b.set(v),b.updateTransitions(l)}else this.ambientLight=new di(v,_n||(_n=new d.a7({color:new d.a8(d.a5.properties_light_ambient.color),"color-use-theme":new d.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new d.a8(d.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const b=this.directionalLight;b.set(v),b.updateTransitions(l)}else this.directionalLight=new di(v,ir||(ir=new d.a7({direction:new d.an(d.a5.properties_light_directional.direction),color:new d.a8(d.a5.properties_light_directional.color),"color-use-theme":new d.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new d.a8(d.a5.properties_light_directional.intensity),"cast-shadows":new d.a8(d.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new d.a8(d.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new d.a8(d.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=Object.assign(l,{worldview:this.map.getWorldview()}),y=new d.aa(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,l=this.ambientLight;if(!r||!l)return;const p=k=>.2126*(k[0]<=.03928?k[0]/12.92:Math.pow((k[0]+.055)/1.055,2.4))+.7152*(k[1]<=.03928?k[1]/12.92:Math.pow((k[1]+.055)/1.055,2.4))+.0722*(k[2]<=.03928?k[2]/12.92:Math.pow((k[2]+.055)/1.055,2.4)),y=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),v=r.properties.get("intensity"),b=r.properties.get("direction"),C=1-d.d1(b.x,b.y,b.z)[2]/90,D=p(y)*v*C,R=l.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),O=l.properties.get("intensity"),N=p(R)*O;return Number(((D+N)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(null==r||""===r&&this.isRootStyle())return this;if(d.dk(r)){const l=d.dl(r),p=this.fragments.find(({id:v})=>v===l);if(!p)return;const y=d.dj(r);return p.style.getFragmentStyle(y)}{const l=this.fragments.find(({id:p})=>p===r);return l?l.style:void 0}}setFeaturesetSelectors(r){if(!r)return;const l={},p=(y,v="")=>`${y}::${v}`;this._featuresetSelectors={};for(const y in r){const v=this._featuresetSelectors[y]=[];for(const b of r[y].selectors){if(b.featureNamespace){const D=this.getOwnLayer(b.layer);if(!D){d.w(`Layer is undefined for selector: ${b.layer}`);continue}const R=p(D.source,D.sourceLayer);if(R in l&&l[R]!==b.featureNamespace){d.w(`"featureNamespace ${b.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}l[R]=b.featureNamespace}let C;if(b.properties)for(const D in b.properties){const R=d.X(b.properties[D]);"success"===R.result&&(C=C||{},C[D]=R.value)}v.push({layerId:b.layer,namespace:b.featureNamespace,properties:C,uniqueFeatureID:b._uniqueFeatureID})}}}getFeaturesetDescriptors(r){const l=this.getFragmentStyle(r);if(!l||!l.stylesheet.featuresets)return[];const p=[];for(const y in l.stylesheet.featuresets)p.push({featuresetId:y,importId:l.scope?l.scope:void 0});return p}getFeaturesetLayers(r,l){const p=this.getFragmentStyle(l),y=p.stylesheet.featuresets;if(!y||!y[r])return this.fire(new d.z(new Error(`The featureset '${r}' does not exist in the map's style and cannot be queried.`))),[];const v=[];for(const b of y[r].selectors){const C=p.getOwnLayer(b.layer);C&&v.push(C)}return v}getConfigProperty(r,l){const p=this.getFragmentStyle(r);if(!p)return null;const y=d.C(l,p.scope),v=p.options.get(y),b=v?v.value||v.default:null;return b?b.serialize():null}setConfigProperty(r,l,p){const y=this.getFragmentStyle(r);if(!y)return;const v=y.stylesheet.indoor?im(y.stylesheet.schema):y.stylesheet.schema;if(!v||!v[l])return;const b=d.X(p);if("success"!==b.result)return void Xl(this,b.value);const C=b.value.expression,D=d.C(l,y.scope),R=y.options.get(D);if(!R)return;let O;const{minValue:N,maxValue:k,stepValue:B,type:H,values:U}=v[l],q=d.X(v[l].default);"success"===q.result&&(O=q.value.expression),O?(this.options.set(D,Object.assign({},R,{value:C,default:O,minValue:N,maxValue:k,stepValue:B,type:H,values:U})),this.updateConfigDependencies(l)):this.fire(new d.z(new Error(`No schema defined for the config option "${l}" in the "${r}" fragment.`)))}getConfig(r){const l=this.getFragmentStyle(r);if(!l)return null;const p=l.stylesheet.schema;if(!p)return null;const y={};for(const v in p){const b=d.C(v,l.scope),C=l.options.get(b),D=C?C.value||C.default:null;y[v]=D?D.serialize():null}return y}setConfig(r,l){const p=this.getFragmentStyle(r);p&&(p.updateConfig(l,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const l=this.getFragmentStyle(r);return l?l.stylesheet.schema:null}setSchema(r,l){const p=this.getFragmentStyle(r);p&&(p.stylesheet.schema=l,p.updateConfig(p._config,l),this.updateConfigDependencies())}updateConfig(r,l){if(this._config=r,r||l)if(l)for(const p in l){let y,v;const b=d.X(l[p].default);if("success"===b.result&&(y=b.value.expression),r&&void 0!==r[p]){const k=d.X(r[p]);"success"===k.result&&(v=k.value.expression)}const{minValue:C,maxValue:D,stepValue:R,type:O,values:N}=l[p];if(y){const k=d.C(p,this.scope);this.options.set(k,{default:y,value:v,minValue:C,maxValue:D,stepValue:R,type:O,values:N})}else this.fire(new d.z(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new d.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(r){for(const l of this._configDependentLayers){const p=this.getLayer(l);if(p){if(r&&!p.configDependencies.has(r))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(l=>{const p=l._styleColorTheme.colorThemeOverride?l._styleColorTheme.colorThemeOverride:l._styleColorTheme.colorTheme;if(p){const y=l._evaluateColorThemeData(p);(!l._styleColorTheme.lut&&""!==y||l._styleColorTheme.lut&&y!==l._styleColorTheme.lut.data)&&l.setColorTheme(p)}}),this._changes.setDirty()}addLayer(r,l,p={}){this._checkLoaded();const y=r.id;if(this._layers[y])return void this.fire(new d.z(new Error(`Layer with id "${y}" already exists on this map`)));let v;if("custom"===r.type){if(Xl(this,d.dm(r)))return;v=d.dn(r,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof r.source&&(this.addSource(y,r.source),r=d.di(r),r=d.h(r,{source:y})),this._validate(Rn,`layers.${y}`,r,{arrayIndex:-1},p))return;v=d.dn(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}})}0!==v.configDependencies.size&&this._configDependentLayers.add(v.fqid);let b=this._order.length;if(l){const O=this._order.indexOf(l);if(-1===O)return void this.fire(new d.z(new Error(`Layer with id "${l}" does not exist on this map.`)));v.slot===this._layers[l].slot?b=O:d.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,y),this._layerOrderChanged=!0,this._layers[y]=v;const C=this.getOwnLayerSourceCache(v),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&v.canCastShadows()&&D&&(C.castsShadows=!0);const R=this._changes.getRemovedLayer(v);if(R&&v.source&&C&&"custom"!==v.type){this._changes.discardLayerRemoval(v);const O=d.C(v.source,v.scope);R.type!==v.type?this._changes.updateSourceCache(O,"clear"):(this._changes.updateSourceCache(O,"reload"),C.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(r,l){this._checkLoaded();const p=this._checkLayer(r);if(!p||r===l)return;const y=this._order.indexOf(r);this._order.splice(y,1);let v=this._order.length;if(l){const b=this._order.indexOf(l);if(-1===b)return void this.fire(new d.z(new Error(`Layer with id "${l}" does not exist on this map.`)));p.slot===this._layers[l].slot?v=b:d.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const l=this._checkLayer(r);if(!l)return;l.setEventedParent(null);const p=this._order.indexOf(r);this._order.splice(p,1),delete this._layers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const y=this.getOwnLayerSourceCache(l);if(y&&y.castsShadows){let v=!1;for(const b in this._layers)if(this._layers[b].source===l.source&&this._layers[b].canCastShadows()){v=!0;break}y.castsShadows=v}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,p){this._checkLoaded();const y=this._checkLayer(r);y&&(y.minzoom===l&&y.maxzoom===p||(null!=l&&(y.minzoom=l),null!=p&&(y.maxzoom=p),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,l){this._checkLoaded();const p=this._checkLayer(r);p&&p.slot!==l&&(p.slot=l,this._updateLayer(p))}setFilter(r,l,p={}){this._checkLoaded();const y=this._checkLayer(r);if(y&&!d.bv(y.filter,l))return null==l?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(Pe,`layers.${y.id}.filter`,l,{layerType:y.type},p)||(y.filter=d.di(l),this._updateLayer(y)))}getFilter(r){const l=this._checkLayer(r);if(l)return d.di(l.filter)}setLayoutProperty(r,l,p,y={}){this._checkLoaded();const v=this._checkLayer(r);if(v&&!d.bv(v.getLayoutProperty(l),p)){if(null!=p&&(!y||!1!==y.validate)&&Xl(v,X.call(Ns,{key:`layers.${r}.layout.${l}`,layerType:v.type,objectKey:l,value:p,styleSpec:d.a5,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(l,p),0!==v.configDependencies.size&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(r,l){const p=this._checkLayer(r);if(p)return p.getLayoutProperty(l)}setPaintProperty(r,l,p,y={}){this._checkLoaded();const v=this._checkLayer(r);if(!v||d.bv(v.getPaintProperty(l),p)||null!=p&&(!y||!1!==y.validate)&&Xl(v,Z.call(Ns,{key:`layers.${r}.paint.${l}`,layerType:v.type,objectKey:l,value:p,styleSpec:d.a5})))return;const b=v.setPaintProperty(l,p);0!==v.configDependencies.size&&this._configDependentLayers.add(v.fqid),b&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(r,l){const p=this._checkLayer(r);if(p)return p.getPaintProperty(l)}setFeatureState(r,l){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:D,importId:R}=r.target,O=this.getFragmentStyle(R),N=O.getFeaturesetLayers(D);for(const{source:k,sourceLayer:B}of N)O.setFeatureState({id:r.id,source:k,sourceLayer:B},l)}else if("layerId"in r.target){const{layerId:D}=r.target,R=this.getLayer(D);this.setFeatureState({id:r.id,source:R.source,sourceLayer:R.sourceLayer},l)}return}const p=r.source,y=r.sourceLayer,v=this._checkSource(p);if(!v)return;const b=v.type;if("geojson"===b&&y)return void this.fire(new d.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===b&&!y)return void this.fire(new d.z(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new d.z(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(p);for(const D of C)D.setFeatureState(y,r.id,l)}removeFeatureState(r,l){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:D,importId:R}=r.target,O=this.getFragmentStyle(R),N=O.getFeaturesetLayers(D);for(const{source:k,sourceLayer:B}of N)O.removeFeatureState({id:r.id,source:k,sourceLayer:B},l)}else if("layerId"in r.target){const{layerId:D}=r.target,R=this.getLayer(D);this.removeFeatureState({id:r.id,source:R.source,sourceLayer:R.sourceLayer},l)}return}const p=r.source,y=this._checkSource(p);if(!y)return;const v=y.type,b="vector"===v?r.sourceLayer:void 0;if("vector"===v&&!b)return void this.fire(new d.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new d.z(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(p);for(const D of C)D.removeFeatureState(b,r.id,l)}getFeatureState(r){if(this._checkLoaded(),"target"in r){let v;if("featuresetId"in r.target){const{featuresetId:b,importId:C}=r.target,D=this.getFragmentStyle(C),R=D.getFeaturesetLayers(b);for(const{source:O,sourceLayer:N}of R){const k=D.getFeatureState({id:r.id,source:O,sourceLayer:N});if(k&&!v)v=k;else if(!d.bv(v,k))return void this.fire(new d.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in r.target){const{layerId:b}=r.target,C=this.getLayer(b);v=this.getFeatureState({id:r.id,source:C.source,sourceLayer:C.sourceLayer})}return v}const l=r.source,p=r.sourceLayer,y=this._checkSource(l);if(y){if("vector"!==y.type||p)return void 0===r.id&&this.fire(new d.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(p,r.id);this.fire(new d.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=d.h({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return d.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),l=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return d.dp({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>void 0!==p)}_updateFilteredLayers(r){for(const l of Object.values(this._mergedLayers))r(l)&&this._updateLayer(l)}_updateLayer(r){this._changes.updateLayer(r);const l=this.getLayerSourceCache(r),p=d.C(r.source,r.scope),y=this._changes.getUpdatedSourceCaches();r.source&&!y[p]&&l&&"raster"!==l.getSource().type&&(this._changes.updateSourceCache(p,"reload"),l.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const l=C=>this._mergedLayers[C].is3D(!!this.terrain),p=this.order,y={},v=[];for(let C=p.length-1;C>=0;C--){const D=p[C];if(l(D)){y[D]=C;for(const R of r){const O=R[D];if(O)for(const N of O)v.push(N)}}}v.sort((C,D)=>D.intersectionZ-C.intersectionZ);const b=[];for(let C=p.length-1;C>=0;C--){const D=p[C];if(l(D))for(let R=v.length-1;R>=0;R--){const O=v[R].feature;if(O.layer&&y[O.layer.id]<C)break;b.push(O),v.pop()}else for(const R of r){const O=R[D];if(O)for(const N of O)b.push(N.feature)}}return b}queryRenderedFeatures(r,l,p){let y;l&&!Array.isArray(l)&&l.filter&&(this._validate(Pe,"queryRenderedFeatures.filter",l.filter,null,l),y=d.b3(l.filter));const v={},b=O=>{if(Cf.has(O.type))return;const N=this.getOwnLayerSourceCache(O),k=v[N.id]=v[N.id]||{sourceCache:N,layers:{},has3DLayers:!1};O.is3D(!!this.terrain)&&(k.has3DLayers=!0),k.layers[O.fqid]=k.layers[O.fqid]||{styleLayer:O,targets:[]},k.layers[O.fqid].targets.push({filter:y})};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new d.z(new Error("parameters.layers must be an Array."))),[];for(const O of l.layers){const N=this._layers[O];if(!N)return this.fire(new d.z(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];b(N)}}else for(const O in this._layers)b(this._layers[O]);const C=this._queryRenderedFeatures(r,v,p),D=this._flattenAndSortRenderedFeatures(C),R=[];for(const O of D)d.dq(O.layer.id)===this.scope&&R.push(O);return R}queryRenderedFeatureset(r,l,p){let y;l&&!Array.isArray(l)&&l.filter&&(this._validate(Pe,"queryRenderedFeatures.filter",l.filter,null,l),y=d.b3(l.filter));const v="mock",b=[];if(l&&l.target)b.push(Object.assign({},l,{targetId:v,filter:y}));else{const O=this.getFeaturesetDescriptors();for(const N of O)b.push({targetId:v,filter:y,target:N});for(const{style:N}of this.fragments){const k=N.getFeaturesetDescriptors();for(const B of k)b.push({targetId:v,filter:y,target:B})}}const C=this.queryRenderedTargets(r,b,p),D=[],R=new Set;for(const O of C)for(const N of O.variants[v])yf(N,O,R)||D.push(new d.dr(O,N));return D}queryRenderedTargets(r,l,p){const y={},v=(C,D,R,O)=>{const N=y[D.id]=y[D.id]||{sourceCache:D,layers:{},has3DLayers:!1};if(N.layers[C.fqid]=N.layers[C.fqid]||{styleLayer:C,targets:[]},C.is3D(!!this.terrain)&&(N.has3DLayers=!0),!O)return R.uniqueFeatureID=!1,void N.layers[C.fqid].targets.push(R);N.layers[C.fqid].targets.push(Object.assign({},R,{namespace:O.namespace,properties:O.properties,uniqueFeatureID:O.uniqueFeatureID}))};for(const C of l)if("featuresetId"in C.target){const{featuresetId:D,importId:R}=C.target,O=this.getFragmentStyle(R);if(!O||!O._featuresetSelectors)continue;const N=O._featuresetSelectors[D];if(!N){this.fire(new d.z(new Error(`The featureset '${D}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const k of N){const B=O.getOwnLayer(k.layerId);B&&!Cf.has(B.type)&&v(B,O.getOwnLayerSourceCache(B),C,k)}}else if("layerId"in C.target){const{layerId:D}=C.target,R=this.getLayer(D);if(!R||Cf.has(R.type))continue;v(R,this.getLayerSourceCache(R),C)}const b=this._queryRenderedFeatures(r,y,p);return this._flattenAndSortRenderedFeatures(b)}_queryRenderedFeatures(r,l,p){const y=[],v=!!this.map._showQueryGeometry,b=Vn.createFromScreenPoints(r,p);for(const C in l){const D=Ra(b,l[C],this._availableImages,p,v);Object.keys(D).length&&y.push(D)}if(this.placement)for(const C in l){if(!l[C].sourceCache._onlySymbols)continue;const D=tl(b.screenGeometry,l[C],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(D).length&&y.push(D)}return y}querySourceFeatures(r,l){const p=l&&l.filter;p&&this._validate(Pe,"querySourceFeatures.filter",p,null,l);let y=[];const v=this.getOwnSourceCaches(r);for(const b of v)y=y.concat(ku(b,l));return y}addSourceType(r,l,p){return js.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(js.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,l,p={}){this._checkLoaded();const y=this.light.getLight();let v=!1;for(const C in r)if(!d.bv(r[C],y[C])){v=!0;break}if(!v)return;const b=this._getTransitionParameters();this.light.setLight(r,l,p),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=d.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&d.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,l=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===l&&delete this.terrain,null===r?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=r;const y=null==r.source;if(1===l){if(this.disableElevatedTerrain)return;if("object"==typeof p.source){const C="terrain-dem-src";this.addSource(C,p.source),p=d.di(p),p=d.h(p,{source:C})}const v=d.h({},p),b={};if(this.terrain&&y){v.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(b.style=C.serialize())}if(this._validate(Qe,"terrain",v,b))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&l!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,l),this.fire(new d.A("data",{dataType:"style"}))}else{const v=this.terrain,b=v.get();for(const C of Object.keys(d.a5.terrain))!p.hasOwnProperty(C)&&d.a5.terrain[C].default&&(p[C]=d.a5.terrain[C].default);for(const C in r)if(!d.bv(r[C],b[C])){v.set(r,this.options),this.stylesheet.terrain=r;const D=this._getTransitionParameters({duration:0});v.updateTransitions(D),this.fire(new d.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const l=this.fog=new mn(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_createSnow(r){const l=this.snow=new Ir(r,this.map.transform,this.scope,this.options);this.stylesheet.snow=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_createRain(r){const l=this.rain=new Nr(r,this.map.transform,this.scope,this.options);this.stylesheet.rain=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!d.bv(l.get(),r)){l.set(r,this.options),this.stylesheet.fog=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createFog(r);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(r){if(this._checkLoaded(),!r)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const l=this.snow;if(!d.bv(l.get(),r)){l.set(r,this.options),this.stylesheet.snow=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createSnow(r);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(r){if(this._checkLoaded(),!r)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const l=this.rain;if(!d.bv(l.get(),r)){l.set(r,this.options),this.stylesheet.rain=l.get();const p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createRain(r);this._markersNeedUpdate=!0}_reloadColorTheme(){const r=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},l=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!l)return this._styleColorTheme.lut=null,void r();const p=this._evaluateColorThemeData(l);this._loadColorTheme(p).then(()=>{this.fire(new d.A("colorthemeset")),r()}).catch(y=>{d.w(`Couldn't set color theme: ${y}`)})}setColorTheme(r){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&d.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=r,this._reloadColorTheme()}setImportColorTheme(r,l){const p=this.getFragmentStyle(r);p&&(p._styleColorTheme.colorThemeOverride=l,p._reloadColorTheme())}_getTransitionParameters(r){return{now:d.q.now(),transition:d.h(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],l=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?r.push(p):l.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){const p=this.terrain=new Te(r,l,this.scope,this.options,this.map.getWorldview());1===l&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});p.updateTransitions(y)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];"fill-extrusion"===l.type&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const l=this._layers[r];"symbol"===l.type&&this._updateLayer(l)}}_validate(r,l,p,y,v={}){if(v&&!1===v.validate)return!1;const b=d.h({},this.serialize());return Xl(this,r.call(Ns,d.h({key:l,style:b,value:p,styleSpec:d.a5},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.ds.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(r){const l=this.getSourceCaches(r);for(const p of l)p.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}clearLayers(){for(const r in this._mergedLayers){const l=this._mergedLayers[r];l._clear&&l._clear()}}reloadSource(r){const l=this.getSourceCaches(r);for(const p of l)p.resume(),p.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(r=>{r.modelManager.reloadModels(r.scope)})}updateSources(r){let l;this.directionalLight&&(l=Wl(this.directionalLight));const p=new Set;for(const y in this._mergedLayers){const v=this._mergedLayers[y];v.hasElevation()&&!p.has(v.source)&&p.add(v.source)}for(const y in this._mergedSourceCaches){const v=this._mergedSourceCaches[y],b=p.has(v._source.id);v.update(r,void 0,void 0,l,b)}}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,p,y,v,b,C=!1){let D=!1,R=!1;const O={},N={};for(const k of this._mergedOrder){const B=this._mergedLayers[k];if("symbol"!==B.type)continue;const H=d.C(B.source,B.scope);let U=O[H];if(!U){const $=this.getLayerSourceCache(B);if(!$)continue;const K=$.getRenderableIds(!0).map(ee=>$.getTileByID(ee));N[H]=K.slice(),U=O[H]=K.sort((ee,ne)=>ne.tileID.overscaledZ-ee.tileID.overscaledZ||(ee.tileID.isLessThan(ne.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(B,U,l.center.lng,l.projection);D=D||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),C=C||this._layerOrderChanged||0===y,this._layerOrderChanged&&this.fire(new d.A("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.q.now(),l.zoom))&&(this.pauseablePlacement=new Qp(l,this._mergedOrder,C,p,y,v,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,O,N,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.q.now()),R=!0),D&&this.pauseablePlacement.placement.setStale()),R||D){this._buildingIndex.onNewFrame(l.zoom);for(let k=0;k<this._mergedOrder.length;k++){const B=this._mergedLayers[this._mergedOrder[k]];if("symbol"!==B.type)continue;const H=this.isLayerClipped(B);this.placement.updateLayerOpacities(B,O[d.C(B.source,B.scope)],k,H?b:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.q.now())}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,l){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==p.findIndex(({id:v})=>v===r.id))return void this.fire(new d.z(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!l)return p.push(r),this._loadImports([r],!0);const y=p.findIndex(({id:v})=>v===l);return-1===y&&this.fire(new d.z(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,y).concat(r).concat(p.slice(y)),this._loadImports([r],!0,l)}updateImport(r,l){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(r);return-1===y?this:"string"==typeof l?(this.setImportUrl(r,l),this):(l.url&&l.url!==p[y].url&&this.setImportUrl(r,l.url),d.bv(l.config,p[y].config)||this.setImportConfig(r,l.config,l.data.schema),d.bv(l.data,p[y].data)||this.setImportData(r,l.data),this)}moveImport(r,l){this._checkLoaded();let p=this.stylesheet.imports||[];const y=this.getImportIndex(r);if(-1===y)return this;const v=this.getImportIndex(l);if(-1===v)return this;const b=p[y],C=this.fragments[y];return p=p.filter(({id:D})=>D!==r),this.fragments=this.fragments.filter(({id:D})=>D!==r),this.stylesheet.imports=p.slice(0,v).concat(b).concat(p.slice(v)),this.fragments=this.fragments.slice(0,v).concat(C).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(r,l){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(r);if(-1===y)return this;p[y].url=l;const v=this.fragments[y];return v.style=this._createFragmentStyle(p[y]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(l),this}setImportData(r,l){this._checkLoaded();const p=this.getImportIndex(r),y=this.stylesheet.imports||[];return-1===p?this:l?(this.fragments[p].style.setState(l),this._reloadImports(),this):(delete y[p].data,this.setImportUrl(r,y[p].url))}setImportConfig(r,l,p){this._checkLoaded();const y=this.getImportIndex(r),v=this.stylesheet.imports||[];if(-1===y)return this;l?v[y].config=l:delete v[y].config;const b=this.fragments[y];p&&b.style.stylesheet&&(b.style.stylesheet.schema=p);const C=b.style.stylesheet&&b.style.stylesheet.schema;return b.config=l,b.style.updateConfig(l,C),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const l=this.stylesheet.imports||[],p=this.getImportIndex(r);-1!==p&&(l.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(r){const l=(this.stylesheet.imports||[]).findIndex(p=>p.id===r);return-1===l&&this.fire(new d.z(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),l}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const l in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[l];p&&r.push(p.getSource())}return r}getSource(r,l){const p=this.getSourceCache(r,l);return p&&p.getSource()}getLayerSource(r){const l=this.getLayerSourceCache(r);return l&&l.getSource()}getSourceCache(r,l){const p=d.C(r,l);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(r){const l=d.C(r.source,r.scope);return"symbol"===r.type?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(r){if(null==r)return Object.values(this._mergedSourceCaches);const l=[];return this._mergedOtherSourceCaches[r]&&l.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&l.push(this._mergedSymbolSourceCaches[r]),l}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const l in r){const p=r[l];"reload"===p?this.reloadSource(l):"clear"===p&&this.clearSource(l)}}updateLayers(r){const l=this._changes.getUpdatedPaintProperties();for(const p of l){const y=this.getLayer(p);y&&y.updateTransitions(r)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(r){this.stylesheet.glyphs=r,this.glyphManager.setURL(r)}getImages(r,l,p){this.imageManager.getImages(l.images,l.scope,p),this._updateTilesForChangedImages();const y=b=>{if(b){const C=l.images.map(D=>d.I.toString(D));b.setDependencies(l.tileID.key,l.type,C)}},v=d.C(l.source,l.scope);y(this._mergedOtherSourceCaches[v]),y(this._mergedSymbolSourceCaches[v]),l.images.some(b=>b.iconsetId)&&this.fire(new d.A("data",{dataType:"style"}))}rasterizeImages(r,l,p){this.imageManager.rasterizeImages(l,p)}getGlyphs(r,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(r,l,p){return d.dt(l,p)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){const l=this.getOwnSourceCaches(r);return 0===l.length?(this.fire(new d.z(new Error(`There is no source with ID '${r}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,l){if(!this._clipLayerPresent&&"fill-extrusion"!==r.type&&"building"!==r.type)return!1;const p="fill-extrusion"===r.type&&("building"===r.sourceLayer||"procedural_buildings"===r.sourceLayer),y="building"===r.type;if(r.is3D(!!this.terrain)){if(p||y||l&&"batched-model"===l.type||"model"===r.type)return!0}else if("symbol"===r.type)return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}js.getSourceType=function(f){return _f[f]},js.setSourceType=function(f,r){_f[f]=r},js.registerForPluginStateChange=d.du;var sm="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Gu="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color,float height) {\n#ifdef INDICATOR_CUTOUT\nfloat verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",$u="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",am="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",th="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",Us="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Sf="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",ft="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Yl="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Df="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",If="#ifdef RENDER_SHADOWS\nprecision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {\n#ifdef CLIP_ZERO_TO_ONE\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);\n#else\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);\n#endif\nreturn texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;\n#ifdef SHADOWS_SINGLE_CASCADE\nvec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);\n#else\nlight_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\n{highp vec2 biasUV=vec2(\npos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const nh=[];ei(sm,nh),ei($u,nh),ei(Gu,nh);const dr={"_prelude_fog.vertex.glsl":Us,"_prelude_terrain.vertex.glsl":th,"_prelude_shadow.vertex.glsl":Df,"_prelude_fog.fragment.glsl":Sf,"_prelude_shadow.fragment.glsl":If,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":ft,"_prelude_raster_particle.glsl":Yl},Ks={};rn("",th),rn(Sf,Us),rn(If,Df),rn(ft,""),rn(Yl,"");const ih=rn(Gu,$u),Cn=sm;var wo={background:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),building:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nconst float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nin lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;\n#endif\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\nuniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}\n#ifdef BUILDING_FAUX_FACADE\nfloat hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;\n#if 0\nif (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;\n#else\nif (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;\n#endif\nreturn out_color;}\n#endif\nvec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;\n#ifdef BUILDING_FAUX_FACADE\nif (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}\n#endif\nvec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;\n#ifdef RENDER_SHADOWS\nshadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nshadowed_lighting_factor=dot(normal,u_lighting_directional_dir);\n#endif\ncolor.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));\n#endif\ncolor.rgb=linearTosRGB(color.rgb);color*=u_opacity;\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_pos.z);\n#endif\nglFragColor=color; \n#ifdef DEBUG_SHOW_NORMALS\ncolor.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nout lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nconst float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#ifdef BUILDING_FAUX_FACADE\nmat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}\n#endif\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive\nvoid main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;\n#ifdef BUILDING_FAUX_FACADE\nv_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}\n#endif\nv_pos=a_pos_3f;\n#ifdef RENDER_CUTOFF\nvec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=v_pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(v_pos);\n#endif\ngl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}'),buildingBloom:rn("in vec4 v_color_emissive;\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\nfloat saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;\n#ifdef HAS_ATTRIBUTE_a_bloom_attenuation\nfloat distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);\n#endif\nglFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}","in vec3 a_pos_3f;\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\nout vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\n#ifdef HAS_ATTRIBUTE_a_part_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);\n#else\nv_color_emissive=vec4(1.0);\n#endif\ngl_Position=u_matrix*vec4(a_pos_3f,1.0);}"),buildingDepth:rn("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? \nsmoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \nsmoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\n#ifdef ELEVATED_ROADS\nin float a_circle_z_offset;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\n#ifdef ELEVATED_ROADS\nworld_center.z+=a_circle_z_offset+ELEVATION_BIAS;\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:rn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:rn('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:rn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:rn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;\n#endif\nout float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);\n#ifdef PROJECTION_GLOBE_VIEW\n#ifndef PROJECTED_POS_ON_VIEWPORT\nvec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);\n#endif\n#endif\nvec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:rn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:rn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),elevatedStructuresDepth:rn("void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=vec4(0.);\n#endif\n}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:rn("#ifdef DEPTH_RECONSTRUCTION\nin float v_height;\n#endif\nvoid main() {\n#ifdef DEPTH_RECONSTRUCTION\nif (v_height >=0.0)\ndiscard;\n#endif\nglFragColor=vec4(1.0,0.0,0.0,1.0);}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;\n#ifdef DEPTH_RECONSTRUCTION\nout float v_height;\n#endif\nvoid main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);\n#ifdef DEPTH_RECONSTRUCTION\nif (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;\n#endif\ngl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}"),elevatedStructures:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin vec3 v_normal;in float v_height;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)\n{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nvec3 color=structure_color.xyz;\n#ifdef LIGHTING_3D_MODE\nvec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);\n#ifdef RENDER_SHADOWS\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);\n#else\ncolor=apply_lighting(color,transformed_normal);\n#endif\ncolor=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}\n#endif\n#ifdef FOG\ncolor=fog_apply(color,v_fog_pos);\n#endif\nvec4 out_color=vec4(color,1.0);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_height);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nv_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fill:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=opacity;\n#ifdef INDICATOR_CUTOUT\nif (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=z_offset;\n#endif\n}'),fillOutline:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef FLIP_Y\nv_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FLIP_Y\nv_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,h);\n#endif\n#ifdef FEATURE_CUTOUT\ncolor=apply_feature_cutout(color,gl_FragCoord);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);\n#ifdef CLIP_ZERO_TO_ONE\ncutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);\n#else\ncutoff=cutoff_opacity(u_cutoff_params,ground.z);\n#endif\nif (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:rn("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,height);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:rn('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:rn("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:rn("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\nin vec3 a_z_offset_width;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec3 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;\n#ifdef VARIABLE_LINE_WIDTH\nfloat left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;\n#else\nhalfwidth=(u_width_scale*width)/2.0;\n#endif\noffset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nhighp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\n#else\nv_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),linePattern:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;\n#ifdef LINE_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nuniform float u_emissive_strength;\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LINE_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}\n#endif\n#ifdef LINE_JOIN_NONE\nhighp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\ncolor.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\ncolor.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_z_offset);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin vec3 a_z_offset_width;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);\n#ifdef LINE_JOIN_NONE\nv_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),raster:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:rn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:rn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:rn('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:rn('#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nin highp float v_z_offset;\n#endif\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef TERRAIN\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#else\nout_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef ELEVATED_ROADS\nin vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nout highp float v_z_offset;\n#endif\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\n#ifdef PROJECTED_POS_ON_VIEWPORT\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\n#else\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \n#endif\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;\n#else\nz+=u_pitch_with_map ? z_offset : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\n#ifdef ELEVATED_ROADS\nvec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\npos=vec3(projected_pos.xy/projected_pos.w+offset,z);\n#endif\n#endif\ngl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=e;\n#else\n#ifdef RENDER_SHADOWS\nv_z_offset=e;\n#endif\n#endif\n}'),terrainRaster:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:rn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:rn('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',am),skyboxGradient:rn('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',am),skyboxCapture:rn("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nhighp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:rn('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:rn('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;\n#ifdef FLIP_Y\nT=-T;B=-B;\n#endif\nhighp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));\n#ifdef FLIP_Y\nn=normalize(cross(fdx,fdy));\n#else\nn=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor,v_position_height.w);\n#endif\n#ifdef FEATURE_CUTOUT\nfinalColor=apply_feature_cutout(finalColor,gl_FragCoord);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:rn("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:rn("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:rn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:rn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),vignette:rn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:rn("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function ei(f,r){const l=f.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let p of l)if(p=p.trim(),"#"===p[0]&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=p.split(" ");for(const v of y)r.includes(v)||r.push(v)}}function rn(f,r){const l=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let y=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);y&&(y=y.map(R=>{const O=R.split(" ");return O[O.length-1]}),y=[...new Set(y)]);const v={},b=[],C=[];if(f=f.replace(l,(R,O)=>(C.push(O),"")),(r=r.replace(l,(R,O)=>(b.push(O),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...nh];ei(f,D),ei(r,D);for(const R of[...b,...C])dr[R]||console.error(`Undefined include: ${R}`),Ks[R]||(Ks[R]=[],ei(dr[R],Ks[R])),D=[...D,...Ks[R]];return{fragmentSource:f=f.replace(p,(R,O,N,k,B)=>(v[B]=!0,"define"===O?`\n#ifndef HAS_UNIFORM_u_${B}\nin ${N} ${k} ${B};\n#else\nuniform ${N} ${k} u_${B};\n#endif\n`:"initialize"===O?`\n#ifdef HAS_UNIFORM_u_${B}\n    ${N} ${k} ${B} = u_${B};\n#endif\n`:"define-attribute"===O?`\n#ifdef HAS_ATTRIBUTE_a_${B}\n    in ${N} ${k} ${B};\n#endif\n`:"initialize-attribute"===O?"":void 0)),vertexSource:r=r.replace(p,(R,O,N,k,B)=>{const H="float"===k?"vec2":k,U=B.match(/color/)?"color":H;return"define-attribute-vertex-shader-only"===O?`\n#ifdef HAS_ATTRIBUTE_a_${B}\nin ${N} ${k} a_${B};\n#endif\n`:v[B]?"define"===O?`\n#ifndef HAS_UNIFORM_u_${B}\nuniform lowp float u_${B}_t;\nin ${N} ${H} a_${B};\nout ${N} ${k} ${B};\n#else\nuniform ${N} ${k} u_${B};\n#endif\n`:"initialize"===O?"vec4"===U?`\n#ifndef HAS_UNIFORM_u_${B}\n    ${B} = a_${B};\n#else\n    ${N} ${k} ${B} = u_${B};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${B}\n    ${B} = unpack_mix_${U}(a_${B}, u_${B}_t);\n#else\n    ${N} ${k} ${B} = u_${B};\n#endif\n`:"define-attribute"===O?`\n#ifdef HAS_ATTRIBUTE_a_${B}\n    in ${N} ${k} a_${B};\n    out ${N} ${k} ${B};\n#endif\n`:"initialize-attribute"===O?`\n#ifdef HAS_ATTRIBUTE_a_${B}\n    ${B} = a_${B};\n#endif\n`:void 0:"define"===O?`\n#ifndef HAS_UNIFORM_u_${B}\nuniform lowp float u_${B}_t;\nin ${N} ${H} a_${B};\n#else\nuniform ${N} ${k} u_${B};\n#endif\n`:"define-instanced"===O?"mat4"===U?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${B}0;\nin vec4 a_${B}1;\nin vec4 a_${B}2;\nin vec4 a_${B}3;\n#else\nuniform ${N} ${k} u_${B};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${N} ${H} a_${B};\n#else\nuniform ${N} ${k} u_${B};\n#endif\n`:"initialize-attribute-custom"===O?`\n#ifdef HAS_ATTRIBUTE_a_${B}\n    ${N} ${k} ${B} = a_${B};\n#endif\n`:"vec4"===U?`\n#ifndef HAS_UNIFORM_u_${B}\n    ${N} ${k} ${B} = a_${B};\n#else\n    ${N} ${k} ${B} = u_${B};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${B}\n    ${N} ${k} ${B} = unpack_mix_${U}(a_${B}, u_${B}_t);\n#else\n    ${N} ${k} ${B} = u_${B};\n#endif\n`}),staticAttributes:y,usedDefines:D,vertexIncludes:b,fragmentIncludes:C}}class ss{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,p,y,v,b,C,D){this.context=r;let R=this.boundPaintVertexBuffers.length!==y.length;for(let N=0;!R&&N<y.length;N++)this.boundPaintVertexBuffers[N]!==y[N]&&(R=!0);let O=this.boundDynamicVertexBuffers.length!==C.length;for(let N=0;!O&&N<C.length;N++)this.boundDynamicVertexBuffers[N]!==C[N]&&(O=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||R||O||this.boundIndexBuffer!==v||this.boundVertexOffset!==b)this.freshBind(l,p,y,v,b,C,D);else{r.bindVertexArrayOES.set(this.vao);for(const N of C)N&&(N.bind(),D&&N.instanceCount&&N.setVertexAttribDivisor(r.gl,l,D));v&&v.dynamicDraw&&v.bind()}}freshBind(r,l,p,y,v,b,C){const D=r.numAttributes,R=this.context,O=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=b,l.enableAttributes(O,r),l.bind(),l.setVertexAttribPointers(O,r,v);for(const N of p)N.enableAttributes(O,r),N.bind(),N.setVertexAttribPointers(O,r,v);for(const N of b)N&&(N.enableAttributes(O,r),N.bind(),N.setVertexAttribPointers(O,r,v),C&&N.instanceCount&&N.setVertexAttribDivisor(O,r,C));y&&y.bind(),R.currentNumAttributes=D}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Vc(f,r){const l=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new d.ac(0,p/l).toLngLat().lat,new d.ac(0,(p+1)/l).toLngLat().lat]}function Hs(f,r,l,p,y,v,b){const C=f.context,D=C.gl,R=l.hillshadeFBO;if(!R)return;f.prepareDrawTile();const O=f.isTileAffectedByFog(r),N=f.getOrCreateProgram("hillshade",{overrideFog:O});C.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,R.colorAttachment.get());const k=((q,$,K,ee)=>{const ne=K.paint.get("hillshade-shadow-color"),le="none"===K.paint.get("hillshade-shadow-color-use-theme").constantOr("default"),de=K.paint.get("hillshade-highlight-color"),pe="none"===K.paint.get("hillshade-highlight-color-use-theme").constantOr("default"),ae=K.paint.get("hillshade-accent-color"),ce="none"===K.paint.get("hillshade-accent-color-use-theme").constantOr("default"),ue=K.paint.get("hillshade-emissive-strength");let Me=d.al(K.paint.get("hillshade-illumination-direction"));if("viewport"===K.paint.get("hillshade-illumination-anchor"))Me-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){const Ue=q.style.directionalLight.properties.get("direction"),ke=d.d1(Ue.x,Ue.y,Ue.z);Me=d.al(ke[1])}const ve=!q.options.moving;return{u_matrix:ee||q.transform.calculateProjMatrix($.tileID.toUnwrapped(),ve),u_image:0,u_latrange:Vc(0,$.tileID),u_light:[K.paint.get("hillshade-exaggeration"),Me],u_shadow:ne.toPremultipliedRenderColor(le?null:K.lut),u_highlight:de.toPremultipliedRenderColor(pe?null:K.lut),u_emissive_strength:ue,u_accent:ae.toPremultipliedRenderColor(ce?null:K.lut)}})(f,l,p,f.terrain?r.projMatrix:null);f.uploadCommonUniforms(C,N,r.toUnwrapped());const{tileBoundsBuffer:B,tileBoundsIndexBuffer:H,tileBoundsSegments:U}=f.getTileBoundsBuffers(l);N.draw(f,D.TRIANGLES,y,v,b,Bt.disabled,k,p.id,B,H,U)}function Af(f,r,l){if(!r.needsDEMTextureUpload)return;const p=f.context,y=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||f.getTileTexture(l.stride);const v=l.getPixels();r.demTexture?r.demTexture.update(v,{premultiply:!1}):r.demTexture=new d.T(p,v,y.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function lm(f,r,l){const p=f.context,y=p.gl;if(!r.dem)return;const v=r.dem;if(p.activeTexture.set(y.TEXTURE1),Af(f,r,v),!r.demTexture)return;r.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const b=v.dim;p.activeTexture.set(y.TEXTURE0);let C=r.hillshadeFBO;if(!C){const k=new d.T(p,{width:b,height:b,data:null},y.RGBA8);k.bind(y.LINEAR,y.CLAMP_TO_EDGE),C=r.hillshadeFBO=p.createFramebuffer(b,b,!0,"renderbuffer"),C.colorAttachment.set(k.texture)}p.bindFramebuffer.set(C.framebuffer),p.viewport.set([0,0,b,b]);const{tileBoundsBuffer:D,tileBoundsIndexBuffer:R,tileBoundsSegments:O}=f.getMercatorTileBoundsBuffers(),N=[];f.linearFloatFilteringSupported()&&N.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:N}).draw(f,y.TRIANGLES,wt.disabled,Vt.disabled,ln.unblended,Bt.disabled,((k,B)=>{const H=B.stride,U=d.bz();return d.ca(U,0,d.aj,-d.aj,0,0,1),d.bo(U,U,[0,-d.aj,0]),{u_matrix:U,u_image:1,u_dimension:[H,H],u_zoom:k.overscaledZ}})(r.tileID,v),l.id,D,R,O),r.needsHillshadePrepare=!1}class Ii{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Iv extends Ii{getDefault(){return d.am.transparent.toNonPremultipliedRenderColor(null)}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Av extends Ii{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Br extends Ii{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class en extends Ii{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class ti extends Ii{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class kr extends Ii{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Es extends Ii{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class rh extends Ii{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Oo extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class Kl extends Ii{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Fr extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class La extends Ii{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Js extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class kn extends Ii{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Jl extends Ii{getDefault(){return d.am.transparent.toNonPremultipliedRenderColor(null)}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class oh extends Ii{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class ga extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class Vr extends Ii{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class jc extends Ii{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Uc=class extends Ii{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class as extends Ii{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Ql extends Ii{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class sh extends Ii{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Na extends Ii{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Qs extends Ii{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ol extends Ii{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class qu extends Ii{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class xi extends Ii{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class Mv extends Ii{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class ec extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class cm extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class ea extends Ii{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class Mf extends ea{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Hc extends ea{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Gc extends ea{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class ao extends Hc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const l_=(f,r,l)=>({u_matrix:f,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:l}),ko=(f,r,l,p,y,v,b,C,D,R,O,N,k,B,H,U)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:y,u_merc_center:v,u_image0:0,u_frustum_tl:b,u_frustum_tr:C,u_frustum_br:D,u_frustum_bl:R,u_globe_pos:O,u_globe_radius:N,u_viewport:k,u_grid_matrix:U?Float32Array.from(U):new Float32Array(9),u_skirt_height:B,u_far_z_cutoff:H});function Fo(f,r){return null!=f&&null!=r&&!(!f.hasData()||!r.hasData())&&null!=f.demTexture&&null!=r.demTexture&&f.tileID.key!==r.tileID.key}const sl=new class{constructor(){this.operations={}}newMorphing(f,r,l,p,y){if(f in this.operations){const v=this.operations[f];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[f]={startTime:p,phase:0,duration:y,from:r,to:l,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const r=this.operations[f];return{from:r.from,to:r.to,phase:r.phase}}update(f){for(const r in this.operations){const l=this.operations[r];for(l.phase=(f-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,f)){delete this.operations[r];break}}}_nextOp(f,r){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=r,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},tc={0:null,1:"TERRAIN_VERTEX_MORPHING"};function al(f,r,l){if(0===r)return 0;const p=r<1&&514===l?.25/r:1;return 6*Math.pow(1.5,22-f)*Math.max(r,1)*p}function ls(f,r){const l=1<<f.z;return!r&&(0===f.x||f.x===l-1)||0===f.y||f.y===l-1}const Wu=f=>({u_matrix:f});function cs(f,r,l,p,y){if(y>0){const v=d.q.now(),b=(v-f.timeAdded)/y,C=r?(v-r.timeAdded)/y:-1,D=l.getSource(),R=p.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),O=!r||Math.abs(r.tileID.overscaledZ-R)>Math.abs(f.tileID.overscaledZ-R),N=O&&f.refreshedUponExpiration?1:d.ay(O?b:1-C,0,1);return f.refreshedUponExpiration&&b>=1&&(f.refreshedUponExpiration=!1),r?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class um extends Ro{constructor(r){const l=Ou("mock-dem",{type:"raster-dem",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("mock-dem",l,!1),l.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class dm extends Ro{constructor(r){const l=Ou("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,p){if(r.freezeTileCoverage)return;this.transform=r;const y=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,b)=>{if(v[b.key]="",!this._tiles[b.key]){const C=new Dc(b,this._source.tileSize*b.overscaleFactor(),r.tileZoom,void 0,void 0,this._source.worldview);C.state="loaded",this._tiles[b.key]=C}return v},{});for(const v in this._tiles)v in y||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(r){const l=this.proxyCachedFBO[r];if(void 0!==l){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ah extends d.aM{constructor(r,l,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class Pf extends d.dF{constructor(r,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,y,v]=function(D){const R=new d.ba,O=new d.a_,N=131;R.reserve(17161),O.reserve(33800);const k=d.aj/128,B=d.aj+k/2,H=B+k;for(let q=-k;q<H;q+=k)for(let $=-k;$<H;$+=k){const K=$<0||$>B||q<0||q>B?24575:0,ee=d.ay(Math.round($),0,d.aj),ne=d.ay(Math.round(q),0,d.aj);R.emplaceBack(ee+K,ne)}const U=(q,$)=>{const K=$*N+q;O.emplaceBack(K+1,K,K+N),O.emplaceBack(K+N,K+N+1,K+1)};for(let q=1;q<129;q++)for(let $=1;$<129;$++)U($,q);return[0,129].forEach(q=>{for(let $=0;$<130;$++)U($,q),U(q,$)}),[R,O,32768]}(),b=r.context;this.gridBuffer=b.createVertexBuffer(p,d.bc.members),this.gridIndexBuffer=b.createIndexBuffer(y),this.gridSegments=d.bd.simpleSegment(0,0,p.length,y.length),this.gridNoSkirtSegments=d.bd.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new dm(l.map),this.orthoMatrix=d.bz(),d.ca(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,d.aj,0,d.aj,0,1);const C=b.gl;this._overlapStencilMode=new Vt({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new um(l.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,l,p){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const y=r.terrain.properties,v=0===r.terrain.drapeRenderMode,b=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=d.q.now();const C=r.terrain&&r.terrain.scope,D=y.get("source"),R=v?this._mockSourceCache:r.getSourceCache(D,C);if(!R)return void d.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=R,this._attenuationRange=r.terrain.getAttenuationRange(),this._exaggeration=b?this.calculateExaggeration(l):y.get("exaggeration"),!l.projection.requiresDraping&&b&&0===this._exaggeration)return void this._disable();this.enabled=!0;const O=()=>{this.sourceCache.used&&d.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const N=this.getScaledDemTileSize();this.sourceCache.update(l,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,O(),this._initializing=!0),O(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(r){if(this._attenuationRange&&r.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(r.zoom);const l=this._previousCameraAltitude,p=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=p;const y=null!=l?p-l:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const v=r.zoom,b=this._style.terrain;if(!this._previousUpdateTimestamp)return b.getExaggeration(v);let C=v-this._previousZoom;const D=this._previousUpdateTimestamp;let R=v;null!=this._evaluationZoom&&(R=this._evaluationZoom,Math.abs(v-R)>.5&&(C=.5*(v-R+C)),C*y<0&&(R+=C)),this._evaluationZoom=R;const O=b.getExaggeration(R),N=O===b.getExaggeration(Math.max(0,R-.1));if(N&&Math.abs(O-this._exaggeration)<.01)return O;let k=Math.min(.1,.00375*(this._updateTimestamp-D));return(N||O<.1||Math.abs(C)<1e-4)&&(k=Math.min(.2,4*k)),d.ai(this._exaggeration,O,k)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=0===p._centerAltitude&&-1===this.getAtPointOrZero(d.ac.fromLngLat(p.center),-1),this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=l.getIds().map(D=>{const R=l.getTileByID(D).tileID;return R.projMatrix=p.calculateProjMatrix(R.toUnwrapped()),R});!function(D,R){const O=R.transform.pointCoordinate(R.transform.getCameraPoint()),N=new d.P(O.x,O.y);D.sort((k,B)=>{if(B.overscaledZ-k.overscaledZ)return B.overscaledZ-k.overscaledZ;const H=new d.P(k.canonical.x+(1<<k.canonical.z)*k.wrap,k.canonical.y),U=new d.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),q=N.mult(1<<k.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(H)-q.distSqr(U)})}(y,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},y.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};const b=this._style._mergedSourceCaches;for(const D in b){const R=b[D];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,r[D],v),R.usedForTerrain))continue;const O=r[D];R.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[l.id]=y.map(D=>new ah(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const R=this.terrainTileForTile[D.key];if(!R)continue;const O=R.tileID.key;O in C||(this._visibleDemTiles.push(R),C[O]=O)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const p in this.terrainTileForTile){const y=this.terrainTileForTile[p],v=y.dem;!v||y.demTexture&&!y.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),Af(this.painter,y,v))}}_prepareDemTileUniforms(r,l,p,y){if(!l||null==l.demTexture)return!1;const v=r.tileID.canonical,b=Math.pow(2,l.tileID.canonical.z-v.z),C=y||"";return p[`u_dem_tl${C}`]=[v.x*b%1,v.y*b%1],p[`u_dem_scale${C}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const l=this._visibleDemTiles.reduce((p,y)=>{if(!y.dem)return p;const v=y.dem.tree.minimums[0];return v>0&&r++,p+v},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),y=new d.dG({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(y,{premultiply:!1}):v=this._emptyDEMTexture=new d.T(r,y,l.R32F,{premultiply:!1}),v}setupElevationDraw(r,l,p){const y=this.painter.context,v=y.gl,b={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};b.u_exaggeration=this.exaggeration();let C=null,D=null,R=1;if(p&&p.morphing&&this._useVertexMorphing){const B=p.morphing.srcDemTile,H=p.morphing.dstDemTile;R=p.morphing.phase,B&&H&&(this._prepareDemTileUniforms(r,B,b,"_prev")&&(D=B),this._prepareDemTileUniforms(r,H,b)&&(C=H))}const O=B=>B&&B.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST;let N=null;var k;if(this.enabled?D&&C?(N=C.demTexture,y.activeTexture.set(v.TEXTURE4),D.demTexture.bind(O(D),v.CLAMP_TO_EDGE),b.u_dem_lerp=R):(C=this.terrainTileForTile[r.tileID.key],N=this._prepareDemTileUniforms(r,C,b)?C.demTexture:this.emptyDEMTexture):N=this.emptyDEMTexture,y.activeTexture.set(v.TEXTURE2),N&&(b.u_dem_size=1===(k=N).size[0]?1:k.size[0]-2,N.bind(O(C),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,l,b),p&&p.useMeterToDem&&C){const B=(1<<C.tileID.canonical.z)*d.cb(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=B}if(p&&p.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(y,b),"globe"===this.painter.transform.projection.name){const B=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(y,B)}}globeUniformValues(r,l,p){const y=r.projection;return{u_tile_tl_up:y.upVector(l,0,0),u_tile_tr_up:y.upVector(l,d.aj,0),u_tile_br_up:y.upVector(l,d.aj,d.aj),u_tile_bl_up:y.upVector(l,0,d.aj),u_tile_up_scale:p?d.dH(1):y.upVectorScale(l,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const l=this.painter,p=this.painter.context;0!==r.length&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,v,b,C,D){if("globe"===y.transform.projection.name)!function(R,O,N,k,B){const H=R.context,U=H.gl;let q,$;const K=R.transform,ee=d.dy(R,H,K),ne=(Ue,ke)=>{if($===ke)return;const Ge=[tc[ke],"PROJECTION_GLOBE_VIEW"];ee&&Ge.push("CUSTOM_ANTIALIASING");const rt=R.isTileAffectedByFog(Ue);q=R.getOrCreateProgram("globeRaster",{defines:Ge,overrideFog:rt}),$=ke},le=R.colorModeForRenderPass(),de=new wt(U.LEQUAL,wt.ReadWrite,R.depthRangeFor3D);sl.update(B);const pe=d.dz(K),ae=[d.aD(K.center.lng),d.aH(K.center.lat)],ce=R.globeSharedBuffers,ue=[K.width*d.q.devicePixelRatio,K.height*d.q.devicePixelRatio],Me=Float32Array.from(K.globeMatrix),ve={useDenormalizedUpVectorScale:!0};{const Ue=R.transform,ke=al(Ue.zoom,O.exaggeration(),O.sourceCache._source.tileSize);$=-1;const Ge=U.TRIANGLES;for(const rt of k){const Ce=N.getTile(rt),_e=Vt.disabled,Ne=O.prevTerrainTileForTile[rt.key],Re=O.terrainTileForTile[rt.key];Fo(Ne,Re)&&sl.newMorphing(rt.key,Ne,Re,B,250),H.activeTexture.set(U.TEXTURE0),Ce.texture&&Ce.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const We=sl.getMorphValuesForProxy(rt.key),Ze=We?1:0;We&&d.L(ve,{morphing:{srcDemTile:We.from,dstDemTile:We.to,phase:d.dx(We.phase)}});const Ye=d.dA(rt.canonical),dt=d.dB(Ye.getCenter().lat),Pt=d.dC(rt.canonical,Ye,dt,Ue.worldSize/Ue._pixelsPerMercatorPixel),Ft=d.bh(d.dD(rt.canonical)),vt=ko(Ue.expandedFarZProjMatrix,Me,pe,Ft,d.ah(Ue.zoom),ae,Ue.frustumCorners.TL,Ue.frustumCorners.TR,Ue.frustumCorners.BR,Ue.frustumCorners.BL,Ue.globeCenterInViewSpace,Ue.globeRadius,ue,ke,Ue._farZ,Pt);if(ne(rt,Ze),q&&(O.setupElevationDraw(Ce,q,ve),R.uploadCommonUniforms(H,q,rt.toUnwrapped()),ce)){const[Ot,Rt,Xt]=ce.getGridBuffers(dt,0!==ke);q.draw(R,Ge,de,_e,le,Bt.backCCW,vt,"globe_raster",Ot,Rt,Xt)}}}if(ce&&(R.renderDefaultNorthPole||R.renderDefaultSouthPole)){const Ue=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ee&&Ue.push("CUSTOM_ANTIALIASING"),q=R.getOrCreateProgram("globeRaster",{defines:Ue});for(const ke of k){const{x:Ge,y:rt,z:Ce}=ke.canonical,_e=0===rt,Ne=rt===(1<<Ce)-1,[Re,We,Ze,Ye]=ce.getPoleBuffers(Ce,!1);if(Ye&&(_e||Ne)){const dt=N.getTile(ke);H.activeTexture.set(U.TEXTURE0),dt.texture&&dt.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let Pt=d.dE(Ce,Ge,K);const Ft=d.bh(d.dD(ke.canonical)),vt=(Ot,Rt)=>Ot.draw(R,U.TRIANGLES,de,Vt.disabled,le,Bt.disabled,ko(K.expandedFarZProjMatrix,Pt,Pt,Ft,0,ae,K.frustumCorners.TL,K.frustumCorners.TR,K.frustumCorners.BR,K.frustumCorners.BL,K.globeCenterInViewSpace,K.globeRadius,ue,0,K._farZ),"globe_pole_raster",Rt,Ze,Ye);O.setupElevationDraw(dt,q,ve),R.uploadCommonUniforms(H,q,ke.toUnwrapped()),_e&&R.renderDefaultNorthPole&&vt(q,Re),Ne&&R.renderDefaultSouthPole&&(Pt=d.cP(d.bz(),Pt,[1,-1,1]),vt(q,We))}}}}(y,v,b,C,D);else{const R=y.context,O=R.gl;let N,k;const B=y.shadowRenderer,H=xo(y,y.longestCutoffRange),U=le=>{if(k===le)return;const de=[];de.push(tc[le]),H.shouldRenderCutoff&&de.push("RENDER_CUTOFF"),B&&(de.push("RENDER_SHADOWS","DEPTH_TEXTURE"),B.useNormalOffset&&de.push("NORMAL_OFFSET")),N=y.getOrCreateProgram("terrainRaster",{defines:de}),k=le},q=y.colorModeForRenderPass(),$=new wt(O.LEQUAL,wt.ReadWrite,y.depthRangeFor3D);sl.update(D);const K=y.transform,ee=al(K.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let ne=[0,0,0];if(B){const le=y.style.directionalLight,de=y.style.ambientLight;le&&de&&(ne=il(y.style,le,de))}{k=-1;const le=O.TRIANGLES,[de,pe]=[v.gridIndexBuffer,v.gridSegments];for(const ae of C){const ce=b.getTile(ae),ue=Vt.disabled,Me=v.prevTerrainTileForTile[ae.key],ve=v.terrainTileForTile[ae.key];Fo(Me,ve)&&sl.newMorphing(ae.key,Me,ve,D,250),R.activeTexture.set(O.TEXTURE0),ce.texture&&ce.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const Ue=sl.getMorphValuesForProxy(ae.key),ke=Ue?1:0;let Ge;Ue&&(Ge={morphing:{srcDemTile:Ue.from,dstDemTile:Ue.to,phase:d.dx(Ue.phase)}});const rt=l_(ae.projMatrix,ls(ae.canonical,K.renderWorldCopies)?ee/10:ee,ne);if(U(ke),!N)continue;v.setupElevationDraw(ce,N,Ge);const Ce=ae.toUnwrapped();B&&B.setupShadows(Ce,N),y.uploadCommonUniforms(R,N,Ce,null,H),N.draw(y,le,$,ue,q,Bt.backCCW,rt,"terrain_raster",v.gridBuffer,de,pe)}}}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,y=this.proxySourceCache,v=this.proxiedCoords[y.id],b=this._drapedRenderBatches.shift(),C=l.style.order,D=[];let R=0;for(const O of v){const N=y.getTileByID(O.proxyTileKey),k=y.proxyCachedFBO[O.key]?y.proxyCachedFBO[O.key][r]:void 0,B=void 0!==k?y.renderCache[k]:this.pool[R++],H=void 0!==k;if(N.texture=B.tex,H&&!B.dirty){D.push(N.tileID);continue}let U;p.bindFramebuffer.set(B.fb.framebuffer),this.renderedToTile=!1,B.dirty&&(p.clear({color:d.am.transparent,stencil:0}),B.dirty=!1);for(let q=b.start;q<=b.end;++q){const $=l.style._mergedLayers[C[q]];if($.isHidden(l.transform.zoom))continue;const K=l.style.getLayerSourceCache($),ee=K?this.proxyToSource[O.key][K.id]:[O];if(!ee)continue;const ne=ee;p.viewport.set([0,0,B.fb.width,B.fb.height]),U!==(K?K.id:null)&&(this._setupStencil(B,ee,$,K),U=K?K.id:null),l.renderLayer(l,K,$,ne)}if(0===this._drapedRenderBatches.length)for(const q of this._pendingGroundEffectLayers){const $=l.style._mergedLayers[C[q]];if($.isHidden(l.transform.zoom))continue;const K=l.style.getLayerSourceCache($),ee=K?this.proxyToSource[O.key][K.id]:[O];if(!ee)continue;const ne=ee;p.viewport.set([0,0,B.fb.width,B.fb.height]),U!==(K?K.id:null)&&(this._setupStencil(B,ee,$,K),U=K?K.id:null),l.renderLayer(l,K,$,ne)}this.renderedToTile?(B.dirty=!0,D.push(N.tileID)):H||--R,5===R&&(R=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),b.end+1}postRender(){}isLayerOrderingCorrect(r){const l=r.order.length;let p=-1,y=l;for(let v=0;v<l;++v)this._style.isLayerDraped(r._mergedLayers[r.order[v]])?p=Math.max(p,v):y=Math.min(y,v);return y>p}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,l,p){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const b=v.tileID,C=1<<b.overscaledZ,{x:D,y:R}=b.canonical,O=D/C,N=(D+1)/C,k=R/C,B=(R+1)/C;return{minx:O,miny:k,maxx:N,maxy:B,t:v.dem.tree.raycastRoot(O,k,N,B,r,l,p),tile:v}});y.sort((v,b)=>(null!==v.t?v.t:Number.MAX_VALUE)-(null!==b.t?b.t:Number.MAX_VALUE));for(const v of y){if(null==v.t)return null;const b=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,r,l,p);if(null!=b)return b}return null}_createFBO(){const r=this.painter.context,l=r.gl,p=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const y=new d.T(r,{width:p[0],height:p[1],data:null},l.RGBA8);y.bind(l.LINEAR,l.CLAMP_TO_EDGE);const v=r.createFramebuffer(p[0],p[1],!0,null);return v.colorAttachment.set(y.texture),v.depthAttachment=new ao(r,v.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:v,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._mergedLayers[r],p=l.isHidden(this.painter.transform.zoom);return"hillshade"===l.type||"custom"===l.type?!p&&l.shouldRedrape():!p&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const p of this._style.getSources())if(p instanceof Hd){r=!0;break}if(!r)return;const l={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],v=this._style.getLayerSourceCache(y);if(v&&!l[v.id]&&!y.isHidden(this.painter.transform.zoom)&&"line"===y.type&&y.widthExpression()instanceof d.ab){l[v.id]=!0;for(const b of this.proxyCoords){const C=this.proxyToSource[b.key][v.id];if(C)for(const D of C)this._clearRenderCacheForTile(v.id,D)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof so){r=!0;break}if(!r)return;const l={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],v=this._style.getLayerSourceCache(y);if(!v||l[v.id]||y.isHidden(this.painter.transform.zoom)||"raster"!==y.type)continue;const b=y.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const D=this.proxyToSource[C.key][v.id];if(D)for(const R of D){const O=cs(v.getTile(R),v.findLoadedParent(R,0),v,this.painter.transform,b);(1!==O.opacity||0!==O.mix)&&this._clearRenderCacheForTile(v.id,R)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const r=this._style.order,l=r.length;if(0===l)return;const p=[];this._pendingGroundEffectLayers=[];let y,v=0,b=this._style._mergedLayers[r[v]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++v<l;)b=this._style._mergedLayers[r[v]];for(;v<l;++v){const C=this._style._mergedLayers[r[v]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?void 0===y&&(y=v):("fill-extrusion"===C.type&&this._pendingGroundEffectLayers.push(v),void 0!==y&&(p.push({start:y,end:v-1}),y=void 0)))}if(void 0!==y&&p.push({start:y,end:v-1}),0!==p.length){const C=p[p.length-1];this._pendingGroundEffectLayers.every(D=>D>C.end)||d.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const b=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let C=0;C<b.length;++C){const D=Object.values(b[C]);l.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,y=this._tilesDirty;for(let b=p.length-1;b>=0;b--){const C=p[b];if(l.getTileByID(C.key),void 0!==l.proxyCachedFBO[C.key]){const D=r[C.key],R=this.proxyToSource[C.key];let O=0;for(const N in R){const k=R[N],B=D[N];if(!B||B.length!==k.length||k.some((H,U)=>H!==B[U]||y[N]&&y[N].hasOwnProperty(H.key))){O=-1;break}++O}for(const N in l.proxyCachedFBO[C.key])l.renderCache[l.proxyCachedFBO[C.key][N]].dirty=O<0||O!==Object.values(D).length}}const v=[...this._drapedRenderBatches];v.sort((b,C)=>C.end-C.start-(b.end-b.start));for(const b of v)for(const C of p){if(l.proxyCachedFBO[C.key])continue;let D=l.renderCachePool.pop();void 0===D&&l.renderCache.length<50&&(D=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==D&&(l.proxyCachedFBO[C.key]={},l.proxyCachedFBO[C.key][b.start]=D,l.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,p,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,b=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let C;if(p.isTileClipped())C=l.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):Vt.disabled}_renderTileClippingMasks(r,l){const p=this.painter,y=this.painter.context,v=y.gl;p._tileClippingMaskIDs={},y.setColorMode(ln.disabled),y.setDepthMode(wt.disabled);const b=p.getOrCreateProgram("clippingMask");for(const C of r){const D=p._tileClippingMaskIDs[C.key]=--l;b.draw(p,v.TRIANGLES,wt.disabled,new Vt({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),ln.disabled,Bt.disabled,Wu(C.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const p=[r.x,r.y,1,1];d.aA(p,p,l.pixelMatrixInverse),d.cH(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const y=l._camera.position,v=d.cb(1,l.center.lat),b=[y[0],y[1],y[2]/v,0],C=d.d7([],p.slice(0,3),b);d.au(C,C);const D=this.raycast(b,C,this._exaggeration);return null!==D&&D?(d.bE(b,b,C,D),b[3]=b[2],b[2]*=v,b):null}_setupProxiedCoordsForOrtho(r,l,p){if(r.getSource()instanceof d.aP)return this._setupProxiedCoordsForImageSource(r,l,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const y=this.proxiedCoords[r.id]=[],v=this.proxyCoords;for(let D=0;D<v.length;D++){const R=v[D],O=this._findTileCoveringTileID(R,r);if(O){const N=this._createProxiedId(R,O,p[R.key]&&p[R.key][r.id]);y.push(N),this.proxyToSource[R.key][r.id]=[N]}}let b=!1;const C=new Set;for(let D=0;D<l.length;D++){const R=r.getTile(l[D]);if(!R||!R.hasData())continue;const O=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==R.tileID.canonical.z){const N=this.proxyToSource[O.tileID.key][r.id],k=this._createProxiedId(O.tileID,R,p[O.tileID.key]&&p[O.tileID.key][r.id]);N?N.splice(N.length-1,0,k):this.proxyToSource[O.tileID.key][r.id]=[k];const B=this.proxyToSource[O.tileID.key][r.id];C.has(B)||C.add(B),y.push(k),b=!0}}if(this._sourceTilesOverlap[r.id]=b,b&&this._debugParams.sortTilesHiZFirst)for(const D of C)D.sort((R,O)=>O.overscaledZ-R.overscaledZ)}_setupProxiedCoordsForImageSource(r,l,p){if(!r.getSource().loaded())return;const y=this.proxiedCoords[r.id]=[],v=this.proxyCoords,b=r.getSource(),C=b.tileID;if(!C)return;const D=new d.P(C.x,C.y)._div(1<<C.z),R=b.coordinates.map(d.ac.fromLngLat).reduce((N,k)=>(N.min.x=Math.min(N.min.x,k.x-D.x),N.min.y=Math.min(N.min.y,k.y-D.y),N.max.x=Math.max(N.max.x,k.x-D.x),N.max.y=Math.max(N.max.y,k.y-D.y),N),{min:new d.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(N,k)=>{const B=N.wrap+N.canonical.x/(1<<N.canonical.z),H=N.canonical.y/(1<<N.canonical.z),U=d.aj/(1<<N.canonical.z),q=k.wrap+k.canonical.x/(1<<k.canonical.z),$=k.canonical.y/(1<<k.canonical.z);return B+U<q+R.min.x||B>q+R.max.x||H+U<$+R.min.y||H>$+R.max.y};for(let N=0;N<v.length;N++){const k=v[N];for(let B=0;B<l.length;B++){const H=r.getTile(l[B]);if(!H||!H.hasData()||O(k,H.tileID))continue;const U=this._createProxiedId(k,H,p[k.key]&&p[k.key][r.id]),q=this.proxyToSource[k.key][r.id];q?q.push(U):this.proxyToSource[k.key][r.id]=[U],y.push(U)}}}_createProxiedId(r,l,p){let y=this.orthoMatrix;if(p){const v=p.find(b=>b.key===l.tileID.key);if(v)return v}if(l.tileID.key!==r.key){const v=r.canonical.z-l.tileID.canonical.z;let b,C,D;y=d.bz();const R=l.tileID.wrap-r.wrap<<r.overscaledZ;v>0?(b=d.aj>>v,C=b*((l.tileID.canonical.x<<v)-r.canonical.x+R),D=b*((l.tileID.canonical.y<<v)-r.canonical.y)):(b=d.aj<<-v,C=d.aj*(l.tileID.canonical.x-(r.canonical.x+R<<-v)),D=d.aj*(l.tileID.canonical.y-(r.canonical.y<<-v))),d.ca(y,0,b,0,b,0,1),d.bo(y,y,[C,D,0])}return new ah(l.tileID,r.key,y)}_findTileCoveringTileID(r,l){let p=l.getTile(r);if(p&&p.hasData())return p;const y=this._findCoveringTileCache[l.id],v=y[r.key];if(p=v?l.getTileByID(v):null,p&&p.hasData()||null===v)return p;let b=p?p.tileID:r,C=b.overscaledZ;const D=l.getSource().minzoom,R=[];if(!v){const N=l.getSource().maxzoom;if(r.canonical.z>=N){const k=r.canonical.z-N;l.getSource().reparseOverscaled?(C=Math.max(r.canonical.z+2,l.transform.tileZoom),b=new d.aM(C,r.wrap,N,r.canonical.x>>k,r.canonical.y>>k)):0!==k&&(C=N,b=new d.aM(C,r.wrap,N,r.canonical.x>>k,r.canonical.y>>k))}b.key!==r.key&&(R.push(b.key),p=l.getTile(b))}const O=N=>{R.forEach(k=>{y[k]=N}),R.length=0};for(C-=1;C>=D&&(!p||!p.hasData());C--){p&&O(p.tileID.key);const N=b.calculateScaledKey(C);if(p=l.getTileByID(N),p&&p.hasData())break;const k=y[N];if(null===k)break;void 0===k?R.push(N):p=l.getTileByID(k)}return O(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[l.key]=!0}}function c_(f,r,l){const p=function(C,D,R){const O=d.bG(D,C),N=d.bG(R,[.2126,.7152,.0722]),k=(H,U,q)=>(1-q)*H+q*U,B=k(1-.3*Math.min(N,1),1,Math.min(O+1,1));return k(.92,1,Math.asin(d.ay(D[2],-1,1))/Math.PI+.5)*B}(f,[0,0,1],r),y=[0,0,0];d.c1(y,l.slice(0,3),p);const v=[0,0,0];d.c1(v,r.slice(0,3),f[2]);const b=[0,0,0];return d.d5(b,y,v),d.d8(b)}const u_=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],hm=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class fm{static cacheKey(r,l,p,y){let v=`${l}${y?y.cacheKey:""}`;for(const b of p)r.usedDefines.includes(b)&&(v+=`/${b}`);return v}constructor(r,l,p,y,v,b){const C=r.gl;this.program=C.createProgram(),this.configuration=y,this.name=l,this.fixedDefines=[...b];const D=y?y.getBinderAttributes():[],R=(p.staticAttributes||[]).concat(D);let O=y?y.defines():[];O=O.concat(b.map(q=>`#define ${q}`));const N="#version 300 es\n";let k=N+O.concat("precision mediump float;",Cn,ih.fragmentSource).join("\n");for(const q of p.fragmentIncludes)k+=`\n${dr[q]}`;k+=`\n${p.fragmentSource}`;let B=N+O.concat("precision highp float;",Cn,ih.vertexSource).join("\n");for(const q of p.vertexIncludes)B+=`\n${dr[q]}`;this.forceManualRenderingForInstanceIDShaders=r.forceManualRenderingForInstanceIDShaders&&-1!==p.vertexSource.indexOf("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&(B+="\nuniform int u_instanceID;\n"),B+=`\n${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(B=B.replaceAll("gl_InstanceID","u_instanceID"));const H=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(H,k),C.compileShader(H),C.attachShader(this.program,H);const U=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(U,B),C.compileShader(U),C.attachShader(this.program,U),this.attributes={},this.numAttributes=R.length;for(let q=0;q<this.numAttributes;q++)if(R[q]){const $=R[q].startsWith("a_")?R[q]:`a_${R[q]}`;C.bindAttribLocation(this.program,q,$),this.attributes[$]=q}C.linkProgram(this.program),C.deleteShader(U),C.deleteShader(H),this.fixedUniforms=v(r),this.binderUniforms=y?y.getUniforms(r):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms={u_instanceID:new d.cd(r)}),(b.includes("TERRAIN")||-1!==l.indexOf("symbol")||-1!==l.indexOf("circle"))&&(this.terrainUniforms={u_dem:new d.cd(q=r),u_dem_prev:new d.cd(q),u_dem_tl:new d.cg(q),u_dem_scale:new d.cf(q),u_dem_tl_prev:new d.cg(q),u_dem_scale_prev:new d.cf(q),u_dem_size:new d.cf(q),u_dem_lerp:new d.cf(q),u_exaggeration:new d.cf(q),u_depth:new d.cd(q),u_depth_size_inv:new d.cg(q),u_depth_range_unpack:new d.cg(q),u_occluder_half_size:new d.cf(q),u_occlusion_depth_offset:new d.cf(q),u_meter_to_dem:new d.cf(q),u_label_plane_matrix_inv:new d.ch(q)}),b.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new d.ce(q),u_tile_tr_up:new d.ce(q),u_tile_br_up:new d.ce(q),u_tile_bl_up:new d.ce(q),u_tile_up_scale:new d.cf(q)}))(r)),b.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new d.ch(q),u_fog_range:new d.cg(q),u_fog_color:new d.d0(q),u_fog_horizon_blend:new d.cf(q),u_fog_vertical_limit:new d.cg(q),u_fog_temporal_offset:new d.cf(q),u_frustum_tl:new d.ce(q),u_frustum_tr:new d.ce(q),u_frustum_br:new d.ce(q),u_frustum_bl:new d.ce(q),u_globe_pos:new d.ce(q),u_globe_radius:new d.cf(q),u_globe_transition:new d.cf(q),u_is_globe:new d.cd(q),u_viewport:new d.cg(q)}))(r)),b.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(q=>({u_cutoff_params:new d.d0(q)}))(r)),b.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(q=>({u_lighting_ambient_color:new d.ce(q),u_lighting_directional_dir:new d.ce(q),u_lighting_directional_color:new d.ce(q),u_ground_radiance:new d.ce(q)}))(r)),b.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(q=>({u_light_matrix_0:new d.ch(q),u_light_matrix_1:new d.ch(q),u_fade_range:new d.cg(q),u_shadow_normal_offset:new d.ce(q),u_shadow_intensity:new d.cf(q),u_shadow_texel_size:new d.cf(q),u_shadow_map_resolution:new d.cf(q),u_shadow_direction:new d.ce(q),u_shadow_bias:new d.ce(q),u_shadowmap_0:new d.cd(q),u_shadowmap_1:new d.cd(q)}))(r))}var q}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in l)p[y]&&p[y].set(this.program,y,l[y])}}setGlobeUniformValues(r,l){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in l)p[y]&&p[y].set(this.program,y,l[y])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in l)p[y].set(this.program,y,l[y])}}setCutoffUniformValues(r,l){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in l)p[y].set(this.program,y,l[y])}}setLightsUniformValues(r,l){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in l)p[y].set(this.program,y,l[y])}}setShadowUniformValues(r,l){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;r.program.set(this.program);for(const y in l)p[y].set(this.program,y,l[y])}_drawDebugWireframe(r,l,p,y,v,b,C,D,R,O){const N=r.options.wireframe;if(!1===N.terrain&&!1===N.layers2D&&!1===N.layers3D)return;const k=r.context;if(!(()=>!(!N.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!N.layers2D||r._terrain&&r._terrain.renderingToTexture||!u_.includes(this.name))||!(!N.layers3D||!hm.includes(this.name)))())return;const B=k.gl,H=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,v,k);if(!H)return;const U=[...this.fixedDefines];U.push("DEBUG_WIREFRAME");const q=r.getOrCreateProgram(this.name,{config:this.configuration,defines:U});k.program.set(q.program);const $=(ne,le,de)=>{if(le[ne]&&de[ne])for(const pe in le[ne])de[ne][pe]&&de[ne][pe].set(de.program,pe,le[ne][pe].current)};R&&R.setUniforms(q.program,k,q.binderUniforms,C,{zoom:D}),$("fixedUniforms",this,q),$("terrainUniforms",this,q),$("globeUniforms",this,q),$("fogUniforms",this,q),$("lightsUniforms",this,q),$("shadowUniforms",this,q),H.bind(),k.setColorMode(new ln([B.ONE,B.ONE_MINUS_SRC_ALPHA,B.ZERO,B.ONE],d.am.transparent,[!0,!0,!0,!1])),k.setDepthMode(new wt(l.func===B.LESS?B.LEQUAL:l.func,wt.ReadOnly,l.range)),k.setStencilMode(Vt.disabled);const K=3*b.primitiveLength*2,ee=3*b.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ne=O||1;for(let le=0;le<ne;++le)q.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",le),B.drawElements(B.LINES,K,B.UNSIGNED_SHORT,ee)}else O&&O>1?B.drawElementsInstanced(B.LINES,K,B.UNSIGNED_SHORT,ee,O):B.drawElements(B.LINES,K,B.UNSIGNED_SHORT,ee);v.bind(),k.program.set(this.program),k.setDepthMode(l),k.setStencilMode(p),k.setColorMode(y)}checkUniforms(r,l,p){if(this.fixedDefines.includes(l))for(const y of Object.keys(p))if(!p[y].initialized)throw new Error(`Program '${this.name}', from draw '${r}': uniform ${y} not set but required by ${l} being defined`)}draw(r,l,p,y,v,b,C,D,R,O,N,k,B,H,U,q){const $=r.context,K=$.gl;if(this.failedToCreate)return;$.program.set(this.program),$.setDepthMode(p),$.setStencilMode(y),$.setColorMode(v),$.setCullFace(b);for(const le of Object.keys(this.fixedUniforms))this.fixedUniforms[le].set(this.program,le,C[le]);H&&H.setUniforms(this.program,$,this.binderUniforms,k,{zoom:B});const ee={[K.POINTS]:1,[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[l];this.checkUniforms(D,"RENDER_SHADOWS",this.shadowUniforms);const ne=q&&q>0?1:void 0;for(const le of N.get()){const de=le.vaos||(le.vaos={});if((de[D]||(de[D]=new ss)).bind($,this,R,H?H.getPaintVertexBuffers():[],O,le.vertexOffset,U||[],ne),this.forceManualRenderingForInstanceIDShaders){const pe=q||1;for(let ae=0;ae<pe;++ae)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ae),O?K.drawElements(l,le.primitiveLength*ee,K.UNSIGNED_SHORT,le.primitiveOffset*ee*2):K.drawArrays(l,le.vertexOffset,le.vertexLength)}else q&&q>1?K.drawElementsInstanced(l,le.primitiveLength*ee,K.UNSIGNED_SHORT,le.primitiveOffset*ee*2,q):O?K.drawElements(l,le.primitiveLength*ee,K.UNSIGNED_SHORT,le.primitiveOffset*ee*2):K.drawArrays(l,le.vertexOffset,le.vertexLength);l===K.TRIANGLES&&O&&this._drawDebugWireframe(r,p,y,v,O,le,k,B,H,q)}}}function pm(f,r,l=0){const p=Math.pow(2,r.tileID.overscaledZ),y=r.tileSize*Math.pow(2,f.transform.tileZoom)/p,v=y*(r.tileID.canonical.x+r.tileID.wrap*p),b=y*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/d.aw(r,1,f.transform.tileZoom),u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b],u_pattern_transition:l}}const Zu={terrain:0,flat:1},d_=d.bz(),h_=(f,r,l,p,y,v,b,C,D,R,O,N,k,B,H,U,q,$)=>{const K=r.style.light,ee=K.properties.get("position"),ne=[ee.x,ee.y,ee.z],le=d.dJ();"viewport"===K.properties.get("anchor")&&(d.dK(le,-r.transform.angle),d.dL(ne,ne,le));const de=K.properties.get("color").toPremultipliedRenderColor(null),pe=r.transform,ae={u_matrix:f,u_lightpos:ne,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:d_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Zu[R],u_base_type:Zu[O],u_ao:y,u_edge_radius:v,u_width_scale:b,u_flood_light_color:H,u_vertical_scale:U,u_flood_light_intensity:q,u_ground_shadow_factor:$};return"globe"===pe.projection.name&&(ae.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],ae.u_zoom_transition=N,ae.u_inv_rot_matrix=B,ae.u_merc_center=k,ae.u_up_dir=pe.projection.upVector(new d.cA(0,0,0),k[0]*d.aj,k[1]*d.aj),ae.u_height_lift=D),ae},Pv=(f,r,l,p,y,v)=>({u_matrix:f,u_edge_radius:r,u_width_scale:l,u_vertical_scale:p,u_height_type:Zu[y],u_base_type:Zu[v]}),lh=(f,r,l,p,y,v,b,C,D,R,O,N,k,B,H,U,q,$)=>{const K=h_(f,r,l,p,y,v,b,C,R,O,N,k,B,H,U,q,1,[0,0,0]),ee={u_height_factor:-Math.pow(2,C.overscaledZ)/D.tileSize/8};return d.h(K,pm(r,D,$),ee)},Rv=(f,r,l)=>({u_matrix:f,u_emissive_strength:r,u_ground_shadow_factor:l}),Ov=(f,r,l,p,y,v=0)=>d.h(Rv(f,r,y),pm(l,p,v)),f_=(f,r,l,p)=>({u_matrix:f,u_world:l,u_emissive_strength:r,u_ground_shadow_factor:p}),p_=(f,r,l,p,y,v,b=0)=>d.h(Ov(f,r,l,p,v,b),{u_world:y}),sb=(f,r)=>({u_matrix:f,u_ground_shadow_factor:r}),mm=(f,r,l,p,y)=>({u_matrix:f,u_camera_pos:[r[0],r[1],r[2]],u_depth_bias:l,u_height_scale:p,u_reset_depth:y}),m_=(f,r)=>({u_matrix:f,u_normal_matrix:r,u_opacity:1}),ll=f=>({u_matrix:f}),cl=f=>({u_matrix:f}),ch=(f,r,l,p,y,v,b,C)=>{const D=d.aj/v.tileSize;return{u_matrix:f,u_inv_rot_matrix:r,u_camera_to_center_distance:l.getCameraToCenterDistance(C),u_extrude_scale:[l.pixelsToGLUnits[0]/D,l.pixelsToGLUnits[1]/D],u_zoom_transition:p,u_tile_id:b,u_merc_center:y}},g_=(f,r,l=1)=>({u_matrix:f,u_color:r,u_overlay:0,u_overlay_scale:l}),Eo=d.bz(),uh=(f,r,l,p,y,v,b)=>{const C=f.transform,D="globe"===C.projection.name,R=D?d.dM(C.zoom,r.canonical)*C._pixelsPerMercatorPixel:d.aw(l,1,v),O={u_matrix:r.projMatrix,u_extrude_scale:R,u_intensity:b,u_inv_rot_matrix:Eo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){O.u_inv_rot_matrix=p,O.u_merc_center=y,O.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],O.u_zoom_transition=d.ah(C.zoom);const N=y[0]*d.aj,k=y[1]*d.aj;O.u_up_dir=C.projection.upVector(new d.cA(0,0,0),N,k)}return O};function us(f,[r,l,p,y],[v,b]){if(v===b)return[0,0,0,0];const C=255*(f-1)/(f*(b-v));return[r*C,l*C,p*C,y*C]}function ul(f,r,[l,p]){return l===p?0:.5/f+(r-l)*(f-1)/(f*(p-l))}const Rf=(f,r,l,p,y,v,b,C,D,R,O,N,k,B,H,U,q,$,K,ee,ne)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:v,u_scale_parent:R,u_fade_t:O.mix,u_opacity:O.opacity*N.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:N.paint.get("raster-brightness-min"),u_brightness_high:N.paint.get("raster-brightness-max"),u_saturation_factor:d.dO(N.paint.get("raster-saturation")),u_contrast_factor:d.dN(N.paint.get("raster-contrast")),u_spin_weights:dl(N.paint.get("raster-hue-rotate")),u_perspective_transform:k,u_raster_elevation:B,u_zoom_transition:b,u_merc_center:C,u_cutoff_params:D,u_colorization_mix:us(d.dP,U,$),u_colorization_offset:ul(d.dP,q,$),u_color_ramp:H,u_texture_offset:[ee/(K+2*ee),K/(K+2*ee)],u_texture_res:[K+2*ee,K+2*ee],u_emissive_strength:ne});function dl(f){f*=Math.PI/180;const r=Math.sin(f),l=Math.cos(f);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const hl=.05,Xu=(f,r,l,p,y,v,b,C,D,R,O,N)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:v,u_scale_parent:R,u_fade_t:O.mix,u_opacity:O.opacity,u_image0:0,u_image1:1,u_raster_elevation:N,u_zoom_transition:b,u_merc_center:C,u_cutoff_params:D}),gm=(f,r,l,p,y,v,b,C,D,R)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_tile_offset:l,u_velocity:p,u_color_ramp:v,u_velocity_res:y,u_max_speed:b,u_uv_offset:C,u_data_scale:[255*D[0],255*D[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[hl,hl]}),Of=(f,r,l,p,y,v,b,C,D,R)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_velocity:l,u_velocity_res:p,u_max_speed:y,u_speed_factor:v,u_reset_rate:b,u_rand_seed:Math.random(),u_uv_offset:C,u_data_scale:[255*D[0],255*D[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[hl,hl]}),Yu=d.bz(),dh=(f,r,l,p,y,v,b,C,D,R,O,N,k,B,H,U,q,$,K,ee,ne,le,de,pe)=>{const ae=y.transform,ce={u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:ae.getCameraToCenterDistance(K),u_rotate_symbol:+l,u_aspect_ratio:ae.width/ae.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:b,u_coord_matrix:C,u_is_text:+R,u_elevation_from_sea:D?1:0,u_pitch_with_map:+p,u_texsize:O,u_texsize_icon:N,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Yu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Yu,u_up_vector:[0,-1,0],u_color_adj_mat:le,u_icon_transition:de||0,u_gamma_scale:p?y.transform.getCameraToCenterDistance(K)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:d.q.devicePixelRatio,u_is_halo:1,u_scale_factor:pe||1,u_ground_shadow_factor:ee,u_inv_matrix:d.bi(d.bz(),b),u_normal_scale:ne};return"globe"===K.name&&(ce.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],ce.u_zoom_transition=H,ce.u_inv_rot_matrix=q,ce.u_merc_center=U,ce.u_camera_forward=ae._camera.forward(),ce.u_ecef_origin=d.dQ(ae.globeMatrix,B.toUnwrapped()),ce.u_tile_matrix=Float32Array.from(ae.globeMatrix),ce.u_up_vector=$),ce},_m=(f,r,l,p)=>({u_matrix:f,u_emissive_strength:r,u_opacity:l,u_color:p}),kf=(f,r,l,p,y,v,b,C,D)=>d.h(function(R,O,N,k,B,H){const{width:U,height:q}=k.imageManager.getPixelSize(O),$=Math.pow(2,H.tileID.overscaledZ),K=H.tileSize*Math.pow(2,k.transform.tileZoom)/$,ee=K*(H.tileID.canonical.x+H.tileID.wrap*$),ne=K*H.tileID.canonical.y;return{u_image:0,u_pattern_tl:N.tl,u_pattern_br:N.br,u_texsize:[U,q],u_pattern_size:N.displaySize,u_pattern_units_to_pixels:B?[k.transform.width,-1*k.transform.height]:[1/d.aw(H,1,k.transform.tileZoom),1/d.aw(H,1,k.transform.tileZoom)],u_pixel_coord_upper:[ee>>16,ne>>16],u_pixel_coord_lower:[65535&ee,65535&ne]}}(0,v,b,p,C,D),{u_matrix:f,u_emissive_strength:r,u_opacity:l}),za=new Float32Array(d.bx([])),$c=(f,r,l,p,y,v,b,C,D,R,O,N,k,B=[0,0,0],H)=>{const U=y.style.light,q=U.properties.get("position"),$=[-q.x,-q.y,q.z],K=d.dJ();"viewport"===U.properties.get("anchor")&&(d.dK(K,-y.transform.angle),d.dL($,$,K));const ee="MASK"===O.alphaMode,ne=U.properties.get("color").toNonPremultipliedRenderColor(null),le=k.paint.get("model-ambient-occlusion-intensity"),de=k.paint.get("model-color").constantOr(d.am.white).toNonPremultipliedRenderColor(null);return de.a=k.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:f,u_lighting_matrix:r,u_normal_matrix:l,u_node_matrix:p||za,u_lightpos:$,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_camera_pos:B,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+ee,u_alphaCutoff:O.alphaCutoff,u_baseColorFactor:b.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:C.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:D,u_roughnessFactor:R,u_baseColorTexture:Jr.BaseColor,u_metallicRoughnessTexture:Jr.MetallicRoughness,u_normalTexture:Jr.Normal,u_occlusionTexture:Jr.Occlusion,u_emissionTexture:Jr.Emission,u_lutTexture:Jr.LUT,u_color_mix:de.toArray01(),u_aoIntensity:le,u_emissive_strength:N,u_occlusionTextureTransform:H||[0,0,0,0]}},qc=(f,r=za,l=za)=>({u_matrix:f,u_instance:r,u_node_matrix:l}),ym={fillExtrusion:f=>({u_matrix:new d.ch(f),u_lightpos:new d.ce(f),u_lightintensity:new d.cf(f),u_lightcolor:new d.ce(f),u_vertical_gradient:new d.cf(f),u_opacity:new d.cf(f),u_edge_radius:new d.cf(f),u_width_scale:new d.cf(f),u_ao:new d.cg(f),u_height_type:new d.cd(f),u_base_type:new d.cd(f),u_tile_id:new d.ce(f),u_zoom_transition:new d.cf(f),u_inv_rot_matrix:new d.ch(f),u_merc_center:new d.cg(f),u_up_dir:new d.ce(f),u_height_lift:new d.cf(f),u_flood_light_color:new d.ce(f),u_vertical_scale:new d.cf(f),u_flood_light_intensity:new d.cf(f),u_ground_shadow_factor:new d.ce(f)}),fillExtrusionDepth:f=>({u_matrix:new d.ch(f),u_edge_radius:new d.cf(f),u_width_scale:new d.cf(f),u_vertical_scale:new d.cf(f),u_height_type:new d.cd(f),u_base_type:new d.cd(f)}),fillExtrusionPattern:f=>({u_matrix:new d.ch(f),u_lightpos:new d.ce(f),u_lightintensity:new d.cf(f),u_lightcolor:new d.ce(f),u_vertical_gradient:new d.cf(f),u_height_factor:new d.cf(f),u_edge_radius:new d.cf(f),u_width_scale:new d.cf(f),u_ao:new d.cg(f),u_height_type:new d.cd(f),u_base_type:new d.cd(f),u_tile_id:new d.ce(f),u_zoom_transition:new d.cf(f),u_inv_rot_matrix:new d.ch(f),u_merc_center:new d.cg(f),u_up_dir:new d.ce(f),u_height_lift:new d.cf(f),u_image:new d.cd(f),u_texsize:new d.cg(f),u_pixel_coord_upper:new d.cg(f),u_pixel_coord_lower:new d.cg(f),u_tile_units_to_pixels:new d.cf(f),u_opacity:new d.cf(f),u_pattern_transition:new d.cf(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new d.ch(f),u_opacity:new d.cf(f),u_ao_pass:new d.cf(f),u_meter_to_tile:new d.cf(f),u_ao:new d.cg(f),u_flood_light_intensity:new d.cf(f),u_flood_light_color:new d.ce(f),u_attenuation:new d.cf(f),u_edge_radius:new d.cf(f),u_fb:new d.cd(f),u_fb_size:new d.cf(f),u_dynamic_offset:new d.cf(f)}),fill:f=>({u_matrix:new d.ch(f),u_emissive_strength:new d.cf(f),u_ground_shadow_factor:new d.ce(f)}),fillPattern:f=>({u_matrix:new d.ch(f),u_emissive_strength:new d.cf(f),u_image:new d.cd(f),u_texsize:new d.cg(f),u_pixel_coord_upper:new d.cg(f),u_pixel_coord_lower:new d.cg(f),u_tile_units_to_pixels:new d.cf(f),u_ground_shadow_factor:new d.ce(f),u_pattern_transition:new d.cf(f)}),fillOutline:f=>({u_matrix:new d.ch(f),u_emissive_strength:new d.cf(f),u_world:new d.cg(f),u_ground_shadow_factor:new d.ce(f)}),fillOutlinePattern:f=>({u_matrix:new d.ch(f),u_emissive_strength:new d.cf(f),u_world:new d.cg(f),u_image:new d.cd(f),u_texsize:new d.cg(f),u_pixel_coord_upper:new d.cg(f),u_pixel_coord_lower:new d.cg(f),u_tile_units_to_pixels:new d.cf(f),u_ground_shadow_factor:new d.ce(f),u_pattern_transition:new d.cf(f)}),building:f=>({u_matrix:new d.ch(f),u_normal_matrix:new d.ch(f),u_opacity:new d.cf(f)}),buildingBloom:f=>({u_matrix:new d.ch(f)}),buildingDepth:f=>({u_matrix:new d.ch(f)}),elevatedStructuresDepth:f=>({u_matrix:new d.ch(f),u_depth_bias:new d.cf(f)}),elevatedStructures:f=>({u_matrix:new d.ch(f),u_ground_shadow_factor:new d.ce(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new d.ch(f),u_camera_pos:new d.ce(f),u_depth_bias:new d.cf(f),u_height_scale:new d.cf(f),u_reset_depth:new d.cf(f)}),circle:d.dT,collisionBox:f=>({u_matrix:new d.ch(f),u_inv_rot_matrix:new d.ch(f),u_camera_to_center_distance:new d.cf(f),u_extrude_scale:new d.cg(f),u_zoom_transition:new d.cf(f),u_merc_center:new d.cg(f),u_tile_id:new d.ce(f)}),collisionCircle:f=>({u_matrix:new d.ch(f),u_inv_matrix:new d.ch(f),u_camera_to_center_distance:new d.cf(f),u_viewport_size:new d.cg(f)}),debug:f=>({u_color:new d.dv(f),u_matrix:new d.ch(f),u_overlay:new d.cd(f),u_overlay_scale:new d.cf(f)}),clippingMask:f=>({u_matrix:new d.ch(f)}),heatmap:f=>({u_extrude_scale:new d.cf(f),u_intensity:new d.cf(f),u_matrix:new d.ch(f),u_inv_rot_matrix:new d.ch(f),u_merc_center:new d.cg(f),u_tile_id:new d.ce(f),u_zoom_transition:new d.cf(f),u_up_dir:new d.ce(f)}),heatmapTexture:f=>({u_image:new d.cd(f),u_color_ramp:new d.cd(f),u_opacity:new d.cf(f)}),hillshade:f=>({u_matrix:new d.ch(f),u_image:new d.cd(f),u_latrange:new d.cg(f),u_light:new d.cg(f),u_shadow:new d.dv(f),u_highlight:new d.dv(f),u_emissive_strength:new d.cf(f),u_accent:new d.dv(f)}),hillshadePrepare:f=>({u_matrix:new d.ch(f),u_image:new d.cd(f),u_dimension:new d.cg(f),u_zoom:new d.cf(f)}),line:d.dS,linePattern:d.dR,raster:f=>({u_matrix:new d.ch(f),u_normalize_matrix:new d.ch(f),u_globe_matrix:new d.ch(f),u_merc_matrix:new d.ch(f),u_grid_matrix:new d.dw(f),u_tl_parent:new d.cg(f),u_scale_parent:new d.cf(f),u_fade_t:new d.cf(f),u_opacity:new d.cf(f),u_image0:new d.cd(f),u_image1:new d.cd(f),u_brightness_low:new d.cf(f),u_brightness_high:new d.cf(f),u_saturation_factor:new d.cf(f),u_contrast_factor:new d.cf(f),u_spin_weights:new d.ce(f),u_perspective_transform:new d.cg(f),u_raster_elevation:new d.cf(f),u_zoom_transition:new d.cf(f),u_merc_center:new d.cg(f),u_cutoff_params:new d.d0(f),u_colorization_mix:new d.d0(f),u_colorization_offset:new d.cf(f),u_color_ramp:new d.cd(f),u_texture_offset:new d.cg(f),u_texture_res:new d.cg(f),u_emissive_strength:new d.cf(f)}),rasterParticle:f=>({u_matrix:new d.ch(f),u_normalize_matrix:new d.ch(f),u_globe_matrix:new d.ch(f),u_merc_matrix:new d.ch(f),u_grid_matrix:new d.dw(f),u_tl_parent:new d.cg(f),u_scale_parent:new d.cf(f),u_fade_t:new d.cf(f),u_opacity:new d.cf(f),u_image0:new d.cd(f),u_image1:new d.cd(f),u_raster_elevation:new d.cf(f),u_zoom_transition:new d.cf(f),u_merc_center:new d.cg(f),u_cutoff_params:new d.d0(f)}),rasterParticleTexture:f=>({u_texture:new d.cd(f),u_opacity:new d.cf(f)}),rasterParticleDraw:f=>({u_particle_texture:new d.cd(f),u_particle_texture_side_len:new d.cf(f),u_tile_offset:new d.cg(f),u_velocity:new d.cd(f),u_color_ramp:new d.cd(f),u_velocity_res:new d.cg(f),u_max_speed:new d.cf(f),u_uv_offset:new d.cg(f),u_data_scale:new d.cg(f),u_data_offset:new d.cf(f),u_particle_pos_scale:new d.cf(f),u_particle_pos_offset:new d.cg(f)}),rasterParticleUpdate:f=>({u_particle_texture:new d.cd(f),u_particle_texture_side_len:new d.cf(f),u_velocity:new d.cd(f),u_velocity_res:new d.cg(f),u_max_speed:new d.cf(f),u_speed_factor:new d.cf(f),u_reset_rate:new d.cf(f),u_rand_seed:new d.cf(f),u_uv_offset:new d.cg(f),u_data_scale:new d.cg(f),u_data_offset:new d.cf(f),u_particle_pos_scale:new d.cf(f),u_particle_pos_offset:new d.cg(f)}),symbol:f=>({u_is_size_zoom_constant:new d.cd(f),u_is_size_feature_constant:new d.cd(f),u_size_t:new d.cf(f),u_size:new d.cf(f),u_camera_to_center_distance:new d.cf(f),u_rotate_symbol:new d.cd(f),u_aspect_ratio:new d.cf(f),u_fade_change:new d.cf(f),u_matrix:new d.ch(f),u_label_plane_matrix:new d.ch(f),u_coord_matrix:new d.ch(f),u_is_text:new d.cd(f),u_elevation_from_sea:new d.cd(f),u_pitch_with_map:new d.cd(f),u_texsize:new d.cg(f),u_texsize_icon:new d.cg(f),u_texture:new d.cd(f),u_texture_icon:new d.cd(f),u_gamma_scale:new d.cf(f),u_device_pixel_ratio:new d.cf(f),u_tile_id:new d.ce(f),u_zoom_transition:new d.cf(f),u_inv_rot_matrix:new d.ch(f),u_merc_center:new d.cg(f),u_camera_forward:new d.ce(f),u_tile_matrix:new d.ch(f),u_up_vector:new d.ce(f),u_ecef_origin:new d.ce(f),u_is_halo:new d.cd(f),u_icon_transition:new d.cf(f),u_color_adj_mat:new d.ch(f),u_scale_factor:new d.cf(f),u_ground_shadow_factor:new d.ce(f),u_inv_matrix:new d.ch(f),u_normal_scale:new d.cf(f)}),background:f=>({u_matrix:new d.ch(f),u_emissive_strength:new d.cf(f),u_opacity:new d.cf(f),u_color:new d.dv(f)}),backgroundPattern:f=>({u_matrix:new d.ch(f),u_emissive_strength:new d.cf(f),u_opacity:new d.cf(f),u_image:new d.cd(f),u_pattern_tl:new d.cg(f),u_pattern_br:new d.cg(f),u_texsize:new d.cg(f),u_pattern_size:new d.cg(f),u_pixel_coord_upper:new d.cg(f),u_pixel_coord_lower:new d.cg(f),u_pattern_units_to_pixels:new d.cg(f)}),terrainRaster:f=>({u_matrix:new d.ch(f),u_image0:new d.cd(f),u_skirt_height:new d.cf(f),u_ground_shadow_factor:new d.ce(f)}),skybox:f=>({u_matrix:new d.ch(f),u_sun_direction:new d.ce(f),u_cubemap:new d.cd(f),u_opacity:new d.cf(f),u_temporal_offset:new d.cf(f)}),skyboxGradient:f=>({u_matrix:new d.ch(f),u_color_ramp:new d.cd(f),u_center_direction:new d.ce(f),u_radius:new d.cf(f),u_opacity:new d.cf(f),u_temporal_offset:new d.cf(f)}),skyboxCapture:f=>({u_matrix_3f:new d.dw(f),u_sun_direction:new d.ce(f),u_sun_intensity:new d.cf(f),u_color_tint_r:new d.d0(f),u_color_tint_m:new d.d0(f),u_luminance:new d.cf(f)}),globeRaster:f=>({u_proj_matrix:new d.ch(f),u_globe_matrix:new d.ch(f),u_normalize_matrix:new d.ch(f),u_merc_matrix:new d.ch(f),u_zoom_transition:new d.cf(f),u_merc_center:new d.cg(f),u_image0:new d.cd(f),u_grid_matrix:new d.dw(f),u_skirt_height:new d.cf(f),u_far_z_cutoff:new d.cf(f),u_frustum_tl:new d.ce(f),u_frustum_tr:new d.ce(f),u_frustum_br:new d.ce(f),u_frustum_bl:new d.ce(f),u_globe_pos:new d.ce(f),u_globe_radius:new d.cf(f),u_viewport:new d.cg(f)}),globeAtmosphere:f=>({u_frustum_tl:new d.ce(f),u_frustum_tr:new d.ce(f),u_frustum_br:new d.ce(f),u_frustum_bl:new d.ce(f),u_horizon:new d.cf(f),u_transition:new d.cf(f),u_fadeout_range:new d.cf(f),u_color:new d.d0(f),u_high_color:new d.d0(f),u_space_color:new d.d0(f),u_temporal_offset:new d.cf(f),u_horizon_angle:new d.cf(f)}),model:f=>({u_matrix:new d.ch(f),u_lighting_matrix:new d.ch(f),u_normal_matrix:new d.ch(f),u_node_matrix:new d.ch(f),u_lightpos:new d.ce(f),u_lightintensity:new d.cf(f),u_lightcolor:new d.ce(f),u_camera_pos:new d.ce(f),u_opacity:new d.cf(f),u_baseColorFactor:new d.d0(f),u_emissiveFactor:new d.d0(f),u_metallicFactor:new d.cf(f),u_roughnessFactor:new d.cf(f),u_baseTextureIsAlpha:new d.cd(f),u_alphaMask:new d.cd(f),u_alphaCutoff:new d.cf(f),u_baseColorTexture:new d.cd(f),u_metallicRoughnessTexture:new d.cd(f),u_normalTexture:new d.cd(f),u_occlusionTexture:new d.cd(f),u_emissionTexture:new d.cd(f),u_lutTexture:new d.cd(f),u_color_mix:new d.d0(f),u_aoIntensity:new d.cf(f),u_emissive_strength:new d.cf(f),u_occlusionTextureTransform:new d.d0(f)}),modelDepth:f=>({u_matrix:new d.ch(f),u_instance:new d.ch(f),u_node_matrix:new d.ch(f)}),groundShadow:f=>({u_matrix:new d.ch(f),u_ground_shadow_factor:new d.ce(f)}),stars:f=>({u_matrix:new d.ch(f),u_up:new d.ce(f),u_right:new d.ce(f),u_intensity_multiplier:new d.cf(f)}),snowParticle:f=>({u_modelview:new d.ch(f),u_projection:new d.ch(f),u_time:new d.cf(f),u_cam_pos:new d.ce(f),u_velocityConeAperture:new d.cf(f),u_velocity:new d.cf(f),u_horizontalOscillationRadius:new d.cf(f),u_horizontalOscillationRate:new d.cf(f),u_boxSize:new d.cf(f),u_billboardSize:new d.cf(f),u_simpleShapeParameters:new d.cg(f),u_screenSize:new d.cg(f),u_thinningCenterPos:new d.cg(f),u_thinningShape:new d.ce(f),u_thinningAffectedRatio:new d.cf(f),u_thinningParticleOffset:new d.cf(f),u_particleColor:new d.d0(f),u_direction:new d.ce(f)}),rainParticle:f=>({u_modelview:new d.ch(f),u_projection:new d.ch(f),u_time:new d.cf(f),u_cam_pos:new d.ce(f),u_texScreen:new d.cd(f),u_velocityConeAperture:new d.cf(f),u_velocity:new d.cf(f),u_boxSize:new d.cf(f),u_rainDropletSize:new d.cg(f),u_distortionStrength:new d.cf(f),u_rainDirection:new d.ce(f),u_color:new d.d0(f),u_screenSize:new d.cg(f),u_thinningCenterPos:new d.cg(f),u_thinningShape:new d.ce(f),u_thinningAffectedRatio:new d.cf(f),u_thinningParticleOffset:new d.cf(f),u_shapeDirectionalPower:new d.cf(f),u_shapeNormalPower:new d.cf(f),u_mode:new d.cf(f)}),vignette:f=>({u_vignetteShape:new d.ce(f),u_vignetteColor:new d.d0(f)}),occlusion:f=>({u_matrix:new d.ch(f),u_anchorPos:new d.ce(f),u_screenSizePx:new d.cg(f),u_occluderSizePx:new d.cg(f),u_color:new d.d0(f)})};let kv=(()=>{class f{constructor(l,p,y,v){this.id=f.uniqueIdxCounter,f.uniqueIdxCounter++,this.context=l;const b=l.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||v||p.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){this.id=f.uniqueIdxCounter,f.uniqueIdxCounter++;const p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return f.uniqueIdxCounter=0,f})();const __={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class y_{constructor(r,l,p,y,v,b){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=y,this.instanceCount=b,this.context=r;const C=r.gl;this.buffer=C.createBuffer(),r.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||v||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let p=0;p<this.attributes.length;p++){const y=l.attributes[this.attributes[p].name];void 0!==y&&r.enableVertexAttribArray(y)}}setVertexAttribPointers(r,l,p){for(let y=0;y<this.attributes.length;y++){const v=this.attributes[y],b=l.attributes[v.name];void 0!==b&&r.vertexAttribPointer(b,v.components,r[__[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(r,l,p){for(let y=0;y<this.attributes.length;y++){const v=l.attributes[this.attributes[y].name];void 0!==v&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(v,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wc{constructor(r,l,p,y,v){this.context=r,this.width=l,this.height=p;const b=this.framebuffer=r.gl.createFramebuffer();y&&(this.colorAttachment=new Mf(r,b)),v&&(this.depthAttachmentType=v,this.depthAttachment="renderbuffer"===v?new Hc(r,b):new Gc(r,b))}destroy(){const r=this.context.gl;if(this.colorAttachment){const l=this.colorAttachment.get();l&&r.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const l=this.depthAttachment.get();l&&r.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&r.deleteTexture(l)}r.deleteFramebuffer(this.framebuffer)}}class Ff{constructor(r,l){this.gl=r,this.clearColor=new Iv(this),this.clearDepth=new Av(this),this.clearStencil=new Br(this),this.colorMask=new en(this),this.depthMask=new ti(this),this.stencilMask=new kr(this),this.stencilFunc=new Es(this),this.stencilOp=new rh(this),this.stencilTest=new Oo(this),this.depthRange=new Kl(this),this.depthTest=new Fr(this),this.depthFunc=new La(this),this.blend=new Js(this),this.blendFunc=new kn(this),this.blendColor=new Jl(this),this.blendEquation=new oh(this),this.cullFace=new ga(this),this.cullFaceSide=new Vr(this),this.frontFace=new jc(this),this.program=new Uc(this),this.activeTexture=new as(this),this.viewport=new Ql(this),this.bindFramebuffer=new sh(this),this.bindRenderbuffer=new Na(this),this.bindTexture=new Qs(this),this.bindVertexBuffer=new ol(this),this.bindElementBuffer=new qu(this),this.bindVertexArrayOES=new xi(this),this.pixelStoreUnpack=new Mv(this),this.pixelStoreUnpackPremultiplyAlpha=new ec(this),this.pixelStoreUnpackFlipY=new cm(this),this.options=l?Object.assign({},l):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=l&&!!l.forceManualRenderingForInstanceIDShaders||this.renderer&&-1!==this.renderer.indexOf("PowerVR"),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l,p){return new kv(this,r,l,p)}createVertexBuffer(r,l,p,y,v){return new y_(this,r,l,p,y,v)}createRenderbuffer(r,l,p){const y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,r,l,p),this.bindRenderbuffer.set(null),v}createFramebuffer(r,l,p,y){return new Wc(this,r,l,p,y)}clear({color:r,depth:l,stencil:p,colorMask:y}){const v=this.gl;let b=0;r&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(r.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),void 0!==l&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==p&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),v.clear(b)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){d.bv(r.blendFunction,ln.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Zc;function Lf(f,r,l,p,y,v,b){const C=f.context,D=C.gl,R=f.transform,O=[d.aD(R.center.lng),d.aH(R.center.lat)],N=l.layout.get("symbol-placement"),k=l.layout.get("text-variable-anchor"),B="map"===l.layout.get("icon-rotation-alignment"),H="map"===l.layout.get("text-rotation-alignment"),U="point"!==N,q=[];let $=0,K=0;for(let ce=0;ce<p.length;ce++){const ue=p[ce],Me=r.getTile(ue),ve=Me.getBucket(l);if(!ve)continue;const Ue=ve.getProjection().createInversionMatrix(R,ue.canonical),ke=[],Ge=Tv(ue,ve,R),rt=!b&&B&&U,Ce=b&&H&&U,_e=k&&ve.hasTextData(),Ne=ve.hasIconTextFit()&&_e&&ve.hasIconData(),Re=rt||Ce||b&&_e||Ne,We="globe"===ve.projection.name,Ze=We?d.ah(R.zoom):0;We&&(ke.push("PROJECTION_GLOBE_VIEW"),Re&&ke.push("PROJECTED_POS_ON_VIEWPORT"));const Ye=f.getOrCreateProgram("collisionBox",{defines:ke});let dt=Ge;0===y[0]&&0===y[1]||(dt=f.translatePosMatrix(Ge,Me,y,v));const Pt=b?ve.textCollisionBox:ve.iconCollisionBox,Ft=ve.collisionCircleArray;if(Ft.length>0){const Ot=d.bz(),Rt=dt;d.cM(Ot,ve.placementInvProjMatrix,R.glCoordMatrix),d.cM(Ot,Ot,ve.placementViewportMatrix),q.push({circleArray:Ft,circleOffset:K,transform:Rt,invTransform:Ot,projection:ve.getProjection()}),$+=Ft.length/4,K=$}if(!Pt)continue;f.terrain&&f.terrain.setupElevationDraw(Me,Ye);const vt=We?[ue.canonical.x,ue.canonical.y,1<<ue.canonical.z]:[0,0,0];Ye.draw(f,D.LINES,wt.disabled,Vt.disabled,f.colorModeForRenderPass(),Bt.disabled,ch(dt,Ue,R,Ze,O,Me,vt,ve.getProjection()),l.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segments,null,R.zoom,null,[Pt.collisionVertexBuffer,Pt.collisionVertexBufferExt])}if(!b||!q.length)return;const ee=f.getOrCreateProgram("collisionCircle"),ne=new d.dU;ne.resize(4*$),ne._trim();let le=0;for(const ce of q)for(let ue=0;ue<ce.circleArray.length/4;ue++){const Me=4*ue,ve=ce.circleArray[Me+0],Ue=ce.circleArray[Me+1],ke=ce.circleArray[Me+2],Ge=ce.circleArray[Me+3];ne.emplace(le++,ve,Ue,ke,Ge,0),ne.emplace(le++,ve,Ue,ke,Ge,1),ne.emplace(le++,ve,Ue,ke,Ge,2),ne.emplace(le++,ve,Ue,ke,Ge,3)}(!Zc||Zc.length<2*$)&&(Zc=function(ce){const ue=2*ce,Me=new d.a_;Me.resize(ue),Me._trim();for(let ve=0;ve<ue;ve++){const Ue=6*ve;Me.uint16[Ue+0]=4*ve+0,Me.uint16[Ue+1]=4*ve+1,Me.uint16[Ue+2]=4*ve+2,Me.uint16[Ue+3]=4*ve+2,Me.uint16[Ue+4]=4*ve+3,Me.uint16[Ue+5]=4*ve+0}return Me}($));const de=C.createIndexBuffer(Zc,!0),pe=C.createVertexBuffer(ne,d.dV.members,!0);for(const ce of q){const ue={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(ae=R).getCameraToCenterDistance(ce.projection),u_viewport_size:[ae.width,ae.height]};ee.draw(f,D.TRIANGLES,wt.disabled,Vt.disabled,f.colorModeForRenderPass(),Bt.disabled,ue,l.id,pe,de,d.bd.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,R.zoom)}var ae;pe.destroy(),de.destroy()}const fl=d.bz();function hh(f){const r=f._camera.getWorldToCamera(f.worldSize,1),l=d.az([],r,f.globeMatrix);d.bi(l,l);const p=[0,0,0],y=[0,1,0,0];return d.aA(y,y,l),p[0]=y[0],p[1]=y[1],p[2]=y[2],d.au(p,p),p}function fh({width:f,height:r,anchor:l,textOffset:p,textScale:y},v){const{horizontalAlign:b,verticalAlign:C}=d.bZ(l),D=-(b-.5)*f,R=-(C-.5)*r,O=d.b_(l,p);return new d.P((D/y+O[0])*v,(R/y+O[1])*v)}function Fv(f,r,l,p,y,v,b,C,D,R){const O=f.text.placedSymbolArray,N=f.text.dynamicLayoutVertexArray,k=f.icon.dynamicLayoutVertexArray,B={},H=f.getProjection(),U=Jp(b,H,y),q=y.elevation,$=H.upVectorScale(b.canonical,y.center.lat,y.worldSize).metersToTile;N.clear();for(let K=0;K<O.length;K++){const ee=O.get(K),{tileAnchorX:ne,tileAnchorY:le,numGlyphs:de}=ee,pe=ee.hidden||!ee.crossTileID||f.allowVerticalPlacement&&!ee.placedOrientation?null:p[ee.crossTileID];if(pe){let ae=0,ce=0,ue=0;if(q){const Ne=q?q.getAtTileOffset(b,ne,le):0,[Re,We,Ze]=H.upVector(b.canonical,ne,le);ae=Ne*Re*$,ce=Ne*We*$,ue=Ne*Ze*$}let[Me,ve,Ue,ke]=yn(ee.projectedAnchorX+ae,ee.projectedAnchorY+ce,ee.projectedAnchorZ+ue,l?U:v);const Ge=i_(y.getCameraToCenterDistance(H),ke);let rt=d.bJ(f.textSizeData,D,ee)*Ge/d.bU;l&&(rt*=f.tilePixelRatio/C);const Ce=fh(pe,rt);l?(({x:Me,y:ve,z:Ue}=H.projectTilePoint(ne+Ce.x,le+Ce.y,b.canonical)),[Me,ve,Ue]=yn(Me+ae,ve+ce,Ue+ue,v)):(r&&Ce._rotate(-y.angle),Me+=Ce.x,ve+=Ce.y,Ue=0);const _e=f.allowVerticalPlacement&&ee.placedOrientation===d.bI.vertical?Math.PI/2:0;for(let Ne=0;Ne<de;Ne++)d.bL(N,Me,ve,Ue,_e);R&&ee.associatedIconIndex>=0&&(B[ee.associatedIconIndex]={x:Me,y:ve,z:Ue,angle:_e})}else ju(de,N)}if(R){k.clear();const K=f.icon.placedSymbolArray;for(let ee=0;ee<K.length;ee++){const ne=K.get(ee),{numGlyphs:le}=ne,de=B[ee];if(ne.hidden||!de)ju(le,k);else{const{x:pe,y:ae,z:ce,angle:ue}=de;for(let Me=0;Me<le;Me++)d.bL(k,pe,ae,ce,ue)}}f.icon.dynamicLayoutVertexBuffer.updateData(k)}f.text.dynamicLayoutVertexBuffer.updateData(N)}function v_(f,r,l,p,y,v,b={}){const C=l.paint.get("icon-translate"),D=l.paint.get("text-translate"),R=l.paint.get("icon-translate-anchor"),O=l.paint.get("text-translate-anchor"),N=l.layout.get("icon-rotation-alignment"),k=l.layout.get("text-rotation-alignment"),B=l.layout.get("icon-pitch-alignment"),H=l.layout.get("text-pitch-alignment"),U=l.layout.get("icon-keep-upright"),q=l.layout.get("text-keep-upright"),$=l.paint.get("icon-color-saturation"),K=l.paint.get("icon-color-contrast"),ee=l.paint.get("icon-color-brightness-min"),ne=l.paint.get("icon-color-brightness-max"),le="sea"===l.layout.get("symbol-elevation-reference"),de=f.context,pe=de.gl,ae=f.transform,ce="map"===N,ue="map"===k,Me="map"===B,ve="map"===H,Ue=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let ke=!1;const Ge=f.depthModeForSublayer(0,wt.ReadOnly),rt=new wt(f.context.gl.LEQUAL,wt.ReadOnly,f.depthRangeFor3D),Ce=[d.aD(ae.center.lng),d.aH(ae.center.lat)],_e=l.layout.get("text-variable-anchor"),Ne="globe"===ae.projection.name,Re=[],We=[0,-1,0];for(const Ze of p){const Ye=r.getTile(Ze),dt=Ye.getBucket(l);if(!dt||"mercator"===dt.projection.name&&Ne||dt.fullyClipped)continue;const Pt="globe"===dt.projection.name,Ft=Pt?d.ah(ae.zoom):0,vt=Jp(Ze,dt.getProjection(),ae),Ot=ae.calculatePixelsToTileUnitsMatrix(Ye),Rt=_e&&dt.hasTextData(),Xt=dt.hasIconTextFit()&&Rt&&dt.hasIconData(),tn=dt.getProjection().createInversionMatrix(ae,Ze.canonical),gn=(1<<Ye.tileID.canonical.z)*d.aj/f.transform.worldSize,Dn=ii=>{let qn=[0,0,0];if(ii){const Ni=f.style.directionalLight,Pn=f.style.ambientLight;Ni&&Pn&&(qn=il(f.style,Ni,Pn))}return qn},Jt=ii=>{ae.depthOcclusionForSymbolsAndCircles&&(l.hasInitialOcclusionOpacityProperties||f.terrain)&&(ii.push("DEPTH_D24"),ii.push("DEPTH_OCCLUSION"))},Mn=()=>{const ii=ce&&"point"!==l.layout.get("symbol-placement"),qn=[];Jt(qn);const Ni=ii||Xt,Pn="road"===dt.elevationType,Zn=f.shadowRenderer,hi=Pn&&Me&&!!Zn&&Zn.enabled,xr=Dn(hi),fr=Pn&&Me&&!f.terrain?rt:Ge,or=l.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Me&&qn.push("PITCH_WITH_MAP_TERRAIN"),Pt&&(qn.push("PROJECTION_GLOBE_VIEW"),Ni&&qn.push("PROJECTED_POS_ON_VIEWPORT")),or>0&&dt.hasAnySecondaryIcon&&qn.push("ICON_TRANSITION"),!dt.icon.zOffsetVertexBuffer||Pn&&f.terrain||qn.push("Z_OFFSET"),0===$&&0===K&&0===ee&&1===ne||qn.push("COLOR_ADJUSTMENT"),dt.sdfIcons&&qn.push("RENDER_SDF"),hi&&qn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Pn&&Me&&!f.terrain&&dt.icon.orientationVertexBuffer&&qn.push("ELEVATED_ROADS");const qr=dt.icon.programConfigurations.get(l.id),ba=f.getOrCreateProgram("symbol",{config:qr,defines:qn}),No=Ye.imageAtlasTexture?Ye.imageAtlasTexture.size:[0,0],qs=dt.iconSizeData,uo=d.bH(qs,ae.zoom),ia=Me||!ae.isOrthographic,ra=Zd(vt,Ye.tileID.canonical,Me,ce,ae,dt.getProjection(),Ot),Do=Yr(vt,Ye.tileID.canonical,Me,ce,ae,dt.getProjection(),Ot),Qi=f.translatePosMatrix(Do,Ye,C,R,!0),rr=f.translatePosMatrix(vt,Ye,C,R),Ei=Ni?fl:ra,Sr=ce&&!Me&&!ii;let ho=We;!Ne&&!ae.mercatorFromTransition||ce||(ho=hh(ae));const pr=Pt?ho:We,oa=l.getColorAdjustmentMatrix($,K,ee,ne),ud=dh(qs.kind,uo,Sr,Me,f,rr,Ei,Qi,le,!1,No,[0,0],0,Ze,Ft,Ce,tn,pr,dt.getProjection(),xr,gn,oa,or,null),su=Ye.imageAtlasTexture?Ye.imageAtlasTexture:null,dd=1!==l.layout.get("icon-size").constantOr(0)||dt.iconsNeedLinear,vl=dt.sdfIcons||f.options.rotating||f.options.zooming||dd||ia?pe.LINEAR:pe.NEAREST,Zo=dt.sdfIcons&&0!==l.paint.get("icon-halo-width").constantOr(1),wa=f.terrain&&Me&&ii?d.bi(d.bz(),ra):fl;if(ii&&dt.icon){const Mr=ae.elevation,As=Mr?Mr.getAtTileOffsetFunc(Ze,ae.center.lat,ae.worldSize,dt.getProjection()):null,sa=Xd(vt,Ye.tileID.canonical,Me,ce,ae,dt.getProjection(),Ot);zu(dt,vt,f,!1,sa,Do,Me,U,As,Ze)}return{program:ba,buffers:dt.icon,uniformValues:ud,atlasTexture:su,atlasTextureIcon:null,atlasInterpolation:vl,atlasInterpolationIcon:null,isSDF:dt.sdfIcons,hasHalo:Zo,depthMode:fr,tile:Ye,renderWithShadows:hi,labelPlaneMatrixInv:wa}},Fn=()=>{const ii=ue&&"point"!==l.layout.get("symbol-placement"),qn=[],Ni=ii||_e||Xt,Pn="road"===dt.elevationType,Zn=f.shadowRenderer,hi=Pn&&ve&&!!Zn&&Zn.enabled,xr=Dn(hi),fr=Pn&&ve&&!f.terrain?rt:Ge;f.terrainRenderModeElevated()&&ve&&qn.push("PITCH_WITH_MAP_TERRAIN"),Pt&&(qn.push("PROJECTION_GLOBE_VIEW"),Ni&&qn.push("PROJECTED_POS_ON_VIEWPORT")),!dt.text.zOffsetVertexBuffer||Pn&&f.terrain||qn.push("Z_OFFSET"),dt.iconsInText&&qn.push("RENDER_TEXT_AND_SYMBOL"),qn.push("RENDER_SDF"),hi&&qn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Pn&&ve&&!f.terrain&&dt.text.orientationVertexBuffer&&qn.push("ELEVATED_ROADS"),Jt(qn);const or=dt.text.programConfigurations.get(l.id),qr=f.getOrCreateProgram("symbol",{config:or,defines:qn});let ba,No=[0,0],qs=null;const uo=dt.textSizeData;dt.iconsInText&&(No=Ye.imageAtlasTexture?Ye.imageAtlasTexture.size:[0,0],qs=Ye.imageAtlasTexture?Ye.imageAtlasTexture:null,ba=ve||!ae.isOrthographic||f.options.rotating||f.options.zooming||"composite"===uo.kind||"camera"===uo.kind?pe.LINEAR:pe.NEAREST);const ia=Ye.glyphAtlasTexture?Ye.glyphAtlasTexture.size:[0,0],ra=l.layout.get("text-size-scale-range"),Do=d.ay(f.scaleFactor,ra[0],ra[1]),Qi=d.bH(uo,ae.zoom,Do),rr=Zd(vt,Ye.tileID.canonical,ve,ue,ae,dt.getProjection(),Ot),Ei=Yr(vt,Ye.tileID.canonical,ve,ue,ae,dt.getProjection(),Ot),Sr=f.translatePosMatrix(Ei,Ye,D,O,!0),ho=f.translatePosMatrix(vt,Ye,D,O),pr=Ni?fl:rr,oa=ue&&!ve&&!ii;let ud=We;!Ne&&!ae.mercatorFromTransition||ue||(ud=hh(ae));const su=dh(uo.kind,Qi,oa,ve,f,ho,pr,Sr,le,!0,ia,No,0,Ze,Ft,Ce,tn,Pt?ud:We,dt.getProjection(),xr,gn,null,null,Do),dd=Ye.glyphAtlasTexture?Ye.glyphAtlasTexture:null,vl=pe.LINEAR,Zo=0!==l.paint.get("text-halo-width").constantOr(1),wa=f.terrain&&ve&&ii?d.bi(d.bz(),rr):fl;if(ii&&dt.text){const Mr=ae.elevation,As=Mr?Mr.getAtTileOffsetFunc(Ze,ae.center.lat,ae.worldSize,dt.getProjection()):null,sa=Xd(vt,Ye.tileID.canonical,ve,ue,ae,dt.getProjection(),Ot);zu(dt,vt,f,!0,sa,Ei,ve,q,As,Ze)}return{program:qr,buffers:dt.text,uniformValues:su,atlasTexture:dd,atlasTextureIcon:qs,atlasInterpolation:vl,atlasInterpolationIcon:ba,isSDF:!0,hasHalo:Zo,depthMode:fr,tile:Ye,renderWithShadows:hi,labelPlaneMatrixInv:wa}},ni=dt.icon.segments.get().length,dn=dt.text.segments.get().length,Ln=ni&&!b.onlyText?Mn():null,zn=dn&&!b.onlyIcons?Fn():null,In=l.paint.get("icon-opacity").constantOr(1),an=l.paint.get("text-opacity").constantOr(1);if(Ue&&dt.canOverlap){ke=!0;const ii=In&&!b.onlyText?dt.icon.segments.get():[],qn=an&&!b.onlyIcons?dt.text.segments.get():[];for(const Ni of ii)Re.push({segments:new d.bd([Ni]),sortKey:Ni.sortKey,state:Ln});for(const Ni of qn)Re.push({segments:new d.bd([Ni]),sortKey:Ni.sortKey,state:zn})}else b.onlyText||Re.push({segments:In?dt.icon.segments:new d.bd([]),sortKey:0,state:Ln}),b.onlyIcons||Re.push({segments:an?dt.text.segments:new d.bd([]),sortKey:0,state:zn})}ke&&Re.sort((Ze,Ye)=>Ze.sortKey-Ye.sortKey);for(const Ze of Re){const Ye=Ze.state;if(Ye)if(f.terrain?f.terrain.setupElevationDraw(Ye.tile,Ye.program,{useDepthForOcclusion:ae.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ye.labelPlaneMatrixInv}):f.setupDepthForOcclusion(ae.depthOcclusionForSymbolsAndCircles,Ye.program),de.activeTexture.set(pe.TEXTURE0),Ye.atlasTexture&&Ye.atlasTexture.bind(Ye.atlasInterpolation,pe.CLAMP_TO_EDGE,!0),Ye.atlasTextureIcon&&(de.activeTexture.set(pe.TEXTURE1),Ye.atlasTextureIcon&&Ye.atlasTextureIcon.bind(Ye.atlasInterpolationIcon,pe.CLAMP_TO_EDGE,!0)),Ye.renderWithShadows&&f.shadowRenderer.setupShadows(Ye.tile.tileID.toUnwrapped(),Ye.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,Ye.program),Ye.hasHalo){const dt=Ye.uniformValues;dt.u_is_halo=1,nc(Ye.buffers,Ze.segments,l,f,Ye.program,Ye.depthMode,y,v,dt,2),dt.u_is_halo=0}else{if(Ye.isSDF){const dt=Ye.uniformValues;Ye.hasHalo&&(dt.u_is_halo=1,nc(Ye.buffers,Ze.segments,l,f,Ye.program,Ye.depthMode,y,v,dt,1)),dt.u_is_halo=0}nc(Ye.buffers,Ze.segments,l,f,Ye.program,Ye.depthMode,y,v,Ye.uniformValues,1)}}}function nc(f,r,l,p,y,v,b,C,D,R){const O=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];y.draw(p,p.context.gl.TRIANGLES,v,b,C,Bt.disabled,D,l.id,f.layoutVertexBuffer,f.indexBuffer,r,l.paint,p.transform.zoom,f.programConfigurations.get(l.id),O,R)}function Ku(f,r){const l=1<<f.canonical.z,p=(r.x*l-f.canonical.x-f.wrap*l)*d.aj,y=(r.y*l-f.canonical.y)*d.aj,v=d.e2(r.z,r.y);return d.d2(p,y,v)}function Et(f,r,l,p,y){if(!l.layout||"none"===l.layout.get("fill-elevation-reference"))return;const v=f.context.gl,b=new wt(f.context.gl.LEQUAL,wt.ReadWrite,f.depthRangeFor3D),C=new wt(f.context.gl.GREATER,wt.ReadWrite,f.depthRangeFor3D),D=function(B){const H=d.cU(B.pitch);let U=.01;return B.isOrthographic&&(U=d.ai(1e-4,U,d.cZ(H>=15?1:H/15))),2*U}(f.transform),R=f.transform.getFreeCameraOptions().position,O="elevatedStructuresDepthReconstruct",N=f.getOrCreateProgram(O,{defines:["DEPTH_RECONSTRUCTION"]}),k=f.getOrCreateProgram(O);for(const B of p){const H=r.getTile(B),U=H.getBucket(l);if(!U)continue;const q=U.elevatedStructures;if(!q)continue;const $=U.elevationBufferData.heightRange,K=Ku(B.toUnwrapped(),R),ee=f.translatePosMatrix(B.projMatrix,H,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));let ne,le,de,pe;if("initialize"===y){if(!$||$.min>=1||0===q.depthSegments.segments[0].primitiveLength)continue;ne=mm(ee,K,D,1,0),le=b,de=q.depthSegments,pe=N}else if("reset"===y){if(!$||$.min>=0||0===q.maskSegments.segments[0].primitiveLength)continue;ne=mm(ee,K,0,0,1),le=C,de=q.maskSegments,pe=N}else if("geometry"===y){if(0===q.depthSegments.segments[0].primitiveLength)continue;ne=mm(ee,K,D,1,0),le=b,de=q.depthSegments,pe=k}pe.draw(f,v.TRIANGLES,le,Vt.disabled,ln.disabled,Bt.disabled,ne,l.id,q.vertexBuffer,q.indexBuffer,de,l.paint,f.transform.zoom)}}function Nf(f,r,l){const{painter:p,sourceCache:y,layer:v,coords:b,colorMode:C,elevationType:D,terrainEnabled:R,pass:O}=f,N=p.context.gl,k=v.paint.get("fill-pattern"),B=v.paint.get("fill-pattern-cross-fade"),H=k.constantOr(null);let U=D;"road"!==D||r&&!R||(U="none");const q="road"===U,$=f.painter.shadowRenderer,K=q&&!!$&&$.enabled,ee=new wt(p.context.gl.LEQUAL,wt.ReadOnly,p.depthRangeFor3D);let ne=[0,0,0];if(K){const pe=p.style.directionalLight,ae=p.style.ambientLight;pe&&ae&&(ne=il(p.style,pe,ae))}const le=k&&k.constantOr(1),de=(pe,ae)=>{let ce,ue,Me,ve,Ue;ae?(ce=le&&!v.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Me=N.LINES):(ce=le?"fillPattern":"fill",Me=N.TRIANGLES);for(const ke of b){const Ge=y.getTile(ke);if(le&&!Ge.patternsLoaded())continue;const rt=Ge.getBucket(v);if(!rt)continue;const Ce=r?rt.elevationBufferData:rt.bufferData;if(Ce.isEmpty())continue;p.prepareDrawTile();const _e=Ce.programConfigurations.get(v.id),Ne=p.isTileAffectedByFog(ke),Re=[],We=[];q&&(Re.push("ELEVATED_ROADS"),We.push(Ce.elevatedLayoutVertexBuffer)),K&&Re.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),le&&(p.context.activeTexture.set(N.TEXTURE0),Ge.imageAtlasTexture&&Ge.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),_e.updatePaintBuffers());let Ze=!1;if(H&&Ge.imageAtlas){const vt=Ge.imageAtlas,Ot=d.dZ.from(H),Rt=Ot.getPrimary().scaleSelf(d.q.devicePixelRatio).toString(),Xt=Ot.getSecondary(),tn=vt.patternPositions.get(Rt),gn=Xt?vt.patternPositions.get(Xt.scaleSelf(d.q.devicePixelRatio).toString()):null;Ze=!!tn&&!!gn,tn&&_e.setConstantPatternPositions(tn,gn)}B>0&&(Ze||_e.getPatternTransitionVertexBuffer("fill-pattern"))&&Re.push("FILL_PATTERN_TRANSITION");const Ye=p.getOrCreateProgram(ce,{config:_e,overrideFog:Ne,defines:Re}),dt=p.translatePosMatrix(ke.projMatrix,Ge,v.paint.get("fill-translate"),v.paint.get("fill-translate-anchor"));K&&$.setupShadows(Ge.tileID.toUnwrapped(),Ye,"vector-tile");const Pt=v.paint.get("fill-emissive-strength");if(ae){ve=Ce.lineIndexBuffer,Ue=Ce.lineSegments;const vt=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[N.drawingBufferWidth,N.drawingBufferHeight];ue="fillOutlinePattern"===ce&&le?p_(dt,Pt,p,Ge,vt,ne,B):f_(dt,Pt,vt,ne)}else ve=Ce.indexBuffer,Ue=Ce.triangleSegments,ue=le?Ov(dt,Pt,p,Ge,ne,B):Rv(dt,Pt,ne);p.uploadCommonUniforms(p.context,Ye,ke.toUnwrapped());let Ft=pe;("road"===D&&!R||"offset"===D)&&(Ft=ee),Ye.draw(p,Me,Ft,l||p.stencilModeForClipping(ke),C,Bt.disabled,ue,v.id,Ce.layoutVertexBuffer,ve,Ue,v.paint,p.transform.zoom,_e,We)}};p.renderPass===O&&de(p.depthModeForSublayer(1,"opaque"===p.renderPass?wt.ReadWrite:wt.ReadOnly),!1),"none"===U&&"translucent"===p.renderPass&&v.paint.get("fill-antialias")&&de(p.depthModeForSublayer(v.getPaintProperty("fill-outline-color")?2:0,wt.ReadOnly),!0)}function ph(f,r,l,p,y,v,b,C){l.resetLayerRenderingStats(f);const D=f.context,R=D.gl,O=f.transform,N=l.paint.get("fill-extrusion-pattern"),k=l.paint.get("fill-extrusion-pattern-cross-fade"),B=N.constantOr(null),H=N.constantOr(1),U=l.paint.get("fill-extrusion-opacity"),q=f.style.enable3dLights(),$=l.paint.get(q&&!H?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),K=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),$],ee=l.layout.get("fill-extrusion-edge-radius"),ne=ee>0&&!l.paint.get("fill-extrusion-rounded-roof"),le=ne?0:ee,de="globe"===O.projection.name?d.e5():0,pe="globe"===O.projection.name,ae=pe?d.ah(O.zoom):0,ce=[d.aD(O.center.lng),d.aH(O.center.lat)],ue="none"===l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),Me=l.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ue?null:l.lut).toArray01().slice(0,3),ve=l.paint.get("fill-extrusion-flood-light-intensity"),Ue=l.paint.get("fill-extrusion-vertical-scale"),ke=0!==l.paint.get("fill-extrusion-line-width").constantOr(1),Ge=l.paint.get("fill-extrusion-height-alignment"),rt=l.paint.get("fill-extrusion-base-alignment"),Ce=xo(f,l.paint.get("fill-extrusion-cutoff-fade-range")),_e=[];let Ne;pe&&_e.push("PROJECTION_GLOBE_VIEW"),K[0]>0&&_e.push("FAUX_AO"),ne&&_e.push("ZERO_ROOF_RADIUS"),C&&_e.push("HAS_CENTROID"),ve>0&&_e.push("FLOOD_LIGHT"),Ce.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),ke&&_e.push("RENDER_WALL_MODE");const Re="shadow"===f.renderPass,We=f.shadowRenderer,Ze=Re&&!!We,Ye=Re?Bt.disabled:Bt.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let dt=[0,0,0];if(We){const vt=f.style.directionalLight,Ot=f.style.ambientLight;vt&&Ot&&(dt=il(f.style,vt,Ot)),Re||(_e.push("RENDER_SHADOWS","DEPTH_TEXTURE"),We.useNormalOffset&&_e.push("NORMAL_OFFSET")),Ne=_e.concat(["SHADOWS_SINGLE_CASCADE"])}const Pt=Ze?"fillExtrusionDepth":H?"fillExtrusionPattern":"fillExtrusion",Ft=l.getLayerRenderingStats();for(const vt of p){const Ot=r.getTile(vt),Rt=Ot.getBucket(l);if(!Rt||Rt.projection.name!==O.projection.name)continue;let Xt=!1;We&&(Xt=0===We.getMaxCascadeForTile(vt.toUnwrapped()));const tn=f.isTileAffectedByFog(vt),gn=Rt.programConfigurations.get(l.id);let Dn=!1;if(B&&Ot.imageAtlas){const zn=Ot.imageAtlas,In=d.dZ.from(B),an=In.getPrimary().scaleSelf(d.q.devicePixelRatio).toString(),ii=In.getSecondary(),qn=zn.patternPositions.get(an),Ni=ii?zn.patternPositions.get(ii.scaleSelf(d.q.devicePixelRatio).toString()):null;Dn=!!qn&&!!Ni,qn&&gn.setConstantPatternPositions(qn,Ni)}k>0&&(Dn||gn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&_e.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Jt=f.getOrCreateProgram(Pt,{config:gn,defines:Xt?Ne:_e,overrideFog:tn});if(f.terrain&&f.terrain.setupElevationDraw(Ot,Jt,{useMeterToDem:!0}),!Rt.centroidVertexBuffer){const zn=Jt.attributes.a_centroid_pos;void 0!==zn&&R.vertexAttrib2f(zn,0,0)}!Re&&We&&We.setupShadows(Ot.tileID.toUnwrapped(),Jt,"vector-tile"),H&&(f.context.activeTexture.set(R.TEXTURE0),Ot.imageAtlasTexture&&Ot.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),gn.updatePaintBuffers());const Mn=l.paint.get("fill-extrusion-vertical-gradient"),Fn=1/Rt.tileToMeter;let ni;if(Re&&We){if(Bf(Ot.tileID,Rt.maxHeight,f))continue;const zn=We.calculateShadowPassMatrixFromTile(Ot.tileID.toUnwrapped());ni=Pv(zn,le,Fn,Ue,Ge,rt)}else{const zn=f.translatePosMatrix(vt.expandedProjMatrix,Ot,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),In=O.projection.createInversionMatrix(O,vt.canonical);ni=H?lh(zn,f,Mn,U,K,le,Fn,vt,Ot,de,Ge,rt,ae,ce,In,Me,Ue,k):h_(zn,f,Mn,U,K,le,Fn,vt,de,Ge,rt,ae,ce,In,Me,Ue,ve,dt)}f.uploadCommonUniforms(D,Jt,vt.toUnwrapped(),null,Ce);let dn=Rt.segments;if("mercator"===O.projection.name&&!Re&&(dn=Rt.getVisibleSegments(Ot.tileID,f.terrain,f.transform.getFrustum(0)),!dn.get().length))continue;if(Ft)if(Re)for(const zn of dn.get())Ft.numRenderedVerticesInShadowPass+=zn.primitiveLength;else for(const zn of dn.get())Ft.numRenderedVerticesInTransparentPass+=zn.primitiveLength;const Ln=[];(f.terrain||C)&&Ln.push(Rt.centroidVertexBuffer),pe&&Ln.push(Rt.layoutVertexExtBuffer),ke&&Ln.push(Rt.wallVertexBuffer),Jt.draw(f,D.gl.TRIANGLES,y,v,b,Ye,ni,l.id,Rt.layoutVertexBuffer,Rt.indexBuffer,dn,l.paint,f.transform.zoom,gn,Ln)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class pl{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function qo(f,r,l,p,y,v,b,C,D,R,O,N,k,B,H,U,q,$,K,ee){const ne=r.context,le=ne.gl,de=r.transform,pe=r.transform.zoom,ae=[],ce=f.translate,ue=f.translateAnchor,Me=f.edgeRadius,ve=xo(r,f.cutoffFadeRange);"clear"===O?(ae.push("CLEAR_SUBPASS"),ee&&(ae.push("CLEAR_FROM_TEXTURE"),ne.activeTexture.set(le.TEXTURE0),ee.bind(le.LINEAR,le.CLAMP_TO_EDGE))):"sdf"===O&&ae.push("SDF_SUBPASS"),$&&ae.push("HAS_CENTROID"),ve.shouldRenderCutoff&&ae.push("RENDER_CUTOFF");const Ue=(ke,Ge,rt,Ce,_e)=>{const Ne=Ge.programConfigurations.get(p.id),Re=r.isTileAffectedByFog(ke),We=r.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ne,defines:ae,overrideFog:Re}),Ze={u_matrix:Ce,u_opacity:N,u_ao_pass:R?1:0,u_meter_to_tile:_e,u_ao:[k,B*_e],u_flood_light_intensity:H,u_flood_light_color:U,u_attenuation:q,u_edge_radius:pe>=17?0:Me*_e,u_fb:0,u_fb_size:ee?ee.size[0]:0,u_dynamic_offset:1},Ye=[];$&&Ye.push(Ge.hiddenByLandmarkVertexBuffer),r.uploadCommonUniforms(ne,We,ke.toUnwrapped(),null,ve),We.draw(r,ne.gl.TRIANGLES,v,b,C,D,Ze,p.id,Ge.vertexBuffer,Ge.indexBuffer,rt,p.paint,pe,Ne,Ye)};for(const ke of y){const Ge=l.getTile(ke),rt=Ge.getBucket(p);if(!rt||rt.projection.name!==de.projection.name||!rt.groundEffect||rt.groundEffect&&!rt.groundEffect.hasData())continue;const Ce=rt.groundEffect,_e=1/rt.tileToMeter;{const Ne=r.translatePosMatrix(ke.projMatrix,Ge,ce,ue),Re=Ce.getDefaultSegment();Ue(ke,Ce,Re,Ne,_e)}if(K)for(let Ne=0;Ne<4;Ne++){const Re=d.e3[Ne](ke),We=l.getTile(Re);if(!We)continue;const Ze=We.getBucket(p);if(!Ze||Ze.projection.name!==de.projection.name||!Ze.groundEffect||Ze.groundEffect&&!Ze.groundEffect.hasData())continue;const Ye=Ze.groundEffect;let dt,Pt;0===Ne?(dt=[-d.aj,0,0],Pt=1):1===Ne?(dt=[d.aj,0,0],Pt=0):2===Ne?(dt=[0,-d.aj,0],Pt=3):(dt=[0,d.aj,0],Pt=2);const Ft=Ye.regionSegments[Pt];if(!Ft)continue;const vt=new Float32Array(16);d.bo(vt,ke.projMatrix,dt),Ue(ke,Ye,Ft,r.translatePosMatrix(vt,Ge,ce,ue),_e)}}}function jt(f,r,l,p,y,v,b){0===p.centroidVertexArray.length&&p.createCentroidsBuffer();const C=v?v.findDEMTileFor(l):null;if(!(C&&C.dem||b))return;v&&C&&C.dem&&p.selfDEMTileTimestamp!==C.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=C.dem._timestamp);const D=$=>new d.P(Math.ceil(($+d.e7)*d.e8),0),R=$=>{const K=r.getSource().minzoom,ee=le=>{const de=r.getTileByID(le);if(de&&de.hasData())return de.getBucket(y)},ne=[0,-1,1];for(const le of ne){if($.overscaledZ+le<K)continue;const de=ee($.calculateScaledKey($.overscaledZ+le));if(de)return de}},O=[0,0,0],N=($,K)=>(O[0]=Math.min($.min.y,K.min.y),O[1]=Math.max($.max.y,K.max.y),O[2]=d.aj-K.min.x>$.max.x?K.min.x-d.aj:$.max.x,O),k=($,K)=>(O[0]=Math.min($.min.x,K.min.x),O[1]=Math.max($.max.x,K.max.x),O[2]=d.aj-K.min.y>$.max.y?K.min.y-d.aj:$.max.y,O),B=[($,K)=>N($,K),($,K)=>N(K,$),($,K)=>k($,K),($,K)=>k(K,$)],H=($,K,ee,ne,le,de,pe)=>{if(!v)return 0;const ae=[[de?ee:$,de?$:ee,0],[de?ee:K,de?K:ee,0]],ce=pe<0?d.aj+pe:pe,ue=[de?ce:($+K)/2,de?($+K)/2:ce,0];return 0===ee&&pe<0||0!==ee&&pe>0?v.getForTilePoints(le,[ue],!0,ne):ae.push(ue),v.getForTilePoints(l,ae,!0,C),Math.max(ae[0][2],ae[1][2],ue[2])/v.exaggeration()};for(let $=0;$<4;$++){const K=p.borderFeatureIndices[$];if(0===K.length)continue;const ee=d.e3[$](l),ne=R(ee);if(!(ne&&ne instanceof d.e4))continue;const le=v?v.findDEMTileFor(ee):null;if(!(le&&le.dem||b)||(v&&le&&le.dem&&p.borderDEMTileTimestamp[$]!==le.dem._timestamp&&(p.borderDoneWithNeighborZ[$]=-1,p.borderDEMTileTimestamp[$]=le.dem._timestamp),p.borderDoneWithNeighborZ[$]===ne.canonical.z))continue;0===ne.centroidVertexArray.length&&ne.createCentroidsBuffer();const de=($<2?1:5)-$,pe=ne.borderDoneWithNeighborZ[de]!==p.canonical.z,ae=ne.borderFeatureIndices[de];let ce=0;if(p.canonical.z!==ne.canonical.z){for(const ue of K)p.showCentroid(p.featuresOnBorder[ue]);if(pe)for(const ue of ae)ne.showCentroid(ne.featuresOnBorder[ue]);p.borderDoneWithNeighborZ[$]=ne.canonical.z,ne.borderDoneWithNeighborZ[de]=p.canonical.z}for(const ue of K){const Me=p.featuresOnBorder[ue],ve=p.centroidData[Me.centroidDataIndex],Ue=Me.borders[$];let ke;for(;ce<ae.length;){ke=ne.featuresOnBorder[ae[ce]];const Ge=ke.borders[de];if(Ge[1]>Ue[0]+3||Ge[0]>Ue[0]-3)break;ne.showCentroid(ke),ce++}if(ke&&ce<ae.length){const Ge=ce;let rt=0;for(;!(ke.borders[de][0]>Ue[1]-3)&&(rt++,++ce!==ae.length);)ke=ne.featuresOnBorder[ae[ce]];ke=ne.featuresOnBorder[ae[Ge]];let Ce=!1;if(rt>=1){const Re=ke.borders[de];Math.abs(Ue[0]-Re[0])<3&&Math.abs(Ue[1]-Re[1])<3&&(rt=1,Ce=!0,ce=Ge+1)}else if(0===rt){p.showCentroid(Me);continue}const _e=ne.centroidData[ke.centroidDataIndex];b&&Ce&&(((U=ve).flags|(q=_e).flags)&d.e6?(U.flags|=d.e6,q.flags|=d.e6):(U.flags&=~d.e6,q.flags&=~d.e6));const Ne=Me.intersectsCount()>1||ke.intersectsCount()>1;if(rt>1)ce=Ge,ve.centroidXY=_e.centroidXY=new d.P(0,0);else if(le&&le.dem&&!Ne){const Re=B[$](ve,_e),We=$%2?d.aj-1:0,Ze=H(Re[0],Math.min(d.aj-1,Re[1]),We,le,ee,$<2,Re[2]);ve.centroidXY=_e.centroidXY=D(Ze)}else Ne?ve.centroidXY=_e.centroidXY=new d.P(0,0):(ve.centroidXY=p.encodeBorderCentroid(Me),_e.centroidXY=ne.encodeBorderCentroid(ke));p.writeCentroidToBuffer(ve),ne.writeCentroidToBuffer(_e)}else p.showCentroid(Me)}p.borderDoneWithNeighborZ[$]=ne.canonical.z,ne.borderDoneWithNeighborZ[de]=p.canonical.z}var U,q;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&0!==p.centroidVertexArray.length)&&p.uploadCentroid(f)}const zf=[1,0,0],Lv=[0,1,0],ab=[0,0,1];function Bf(f,r,l){const p=l.transform,y=l.shadowRenderer;if(!y)return!0;const v=f.toUnwrapped(),b=p.tileSize*y._cascades[l.currentShadowCascade].scale;let C=r;if(p.elevation){const U=p.elevation.getMinMaxForTile(f);U&&(C+=U.max)}const D=[...y.shadowDirection];D[2]=-D[2];const R=y.computeSimplifiedTileShadowVolume(v,C,b,D);if(!R)return!1;const O=[zf,Lv,ab,D,[D[0],0,D[2]],[0,D[1],D[2]]],N="globe"===p.projection.name,k=p.scaleZoom(b),B=d.cy.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,k,!N),H=y.getCurrentCascadeFrustum();return 0===B.intersectsPrecise(R.vertices,R.planes,O)||0===H.intersectsPrecise(R.vertices,R.planes,O)}function ta(f){const{painter:r,source:l,layer:p,coords:y}=f,v=f.defines,b=r.context,C="shadow"===r.renderPass,D="light-beam"===r.renderPass,R=r.shadowRenderer;let O;R&&(O=v.concat(["SHADOWS_SINGLE_CASCADE"]));const N=d.e9(r.transform.center.lat,r.transform.zoom);for(const k of y){const B=l.getTile(k),H=B.getBucket(p);if(!H)continue;let U=!1;R&&(U=0===R.getMaxCascadeForTile(k.toUnwrapped()));const q=H.programConfigurations.get(p.id);let $,K,ee=r.translatePosMatrix(k.expandedProjMatrix,B,[0,0],"map");if(ee=d.cP(d.bz(),ee,[1,1,f.verticalScale]),C&&R){if(Bf(B.tileID,H.maxHeight*N,r))continue;let ne=R.calculateShadowPassMatrixFromTile(B.tileID.toUnwrapped());ne=d.cP(d.bz(),ne,[1,1,f.verticalScale]),K=cl(ne),$=r.getOrCreateProgram("buildingDepth",{config:q,defines:U?O:v,overrideFog:!1})}else if(D)$=r.getOrCreateProgram("buildingBloom",{config:q,defines:U?O:v,overrideFog:!1}),K=ll(ee);else{const ne=r.transform.calculatePosMatrix(k.toUnwrapped(),r.transform.worldSize);d.cP(ne,ne,[1,1,f.verticalScale]);const le=d.bz();d.cP(le,ne,[1,-1,1/N]),d.bi(le,le),d.ea(le,le),K=m_(ee,le),$=r.getOrCreateProgram("building",{config:q,defines:U?O:v,overrideFog:!1}),R&&R.setupShadowsFromMatrix(ne,$,!0)}if(r.uploadCommonUniforms(b,$,k.toUnwrapped(),null,null),D){const ne=H.bloomGeometry;$.draw(r,b.gl.TRIANGLES,f.depthMode,Vt.disabled,f.blendMode,Bt.disabled,K,p.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segmentsBucket,p.paint,r.transform.zoom,q,[ne.layoutAttenuationBuffer,ne.layoutColorBuffer])}else $.draw(r,b.gl.TRIANGLES,f.depthMode,Vt.disabled,f.blendMode,C?Bt.disabled:Bt.backCW,K,p.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,p.paint,r.transform.zoom,q,[H.layoutNormalBuffer,H.layoutColorBuffer])}}function vm(f){return[f[0]*d.eb,f[1]*d.eb,f[2]*d.eb,0]}function Vf(f,r,l,p,y,v,b,C,D){const R=p.getSource(),O=l.globeSharedBuffers;if(!O)return;let N,k,B;if(r&&(N=p.getTile(r)),R instanceof d.aP?(k=R.texture,B=d.dE(0,0,l.transform)):N&&r&&(k=N.texture,B=d.dE(r.canonical.z,r.canonical.x,l.transform)),!k||!B)return;f||(B=d.cP(d.bz(),B,[1,-1,1]));const H=l.context,U=H.gl,q="nearest"===y.paint.get("raster-resampling")?U.NEAREST:U.LINEAR,$=l.colorModeForDrapableLayerRenderPass(v),K=b.defines;K.push("GLOBE_POLES");const ee=new wt(U.LEQUAL,wt.ReadWrite,l.depthRangeFor3D),ne=Float32Array.from(l.transform.expandedFarZProjMatrix),le=Float32Array.from(d.bh(d.dD(new d.cA(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),H.activeTexture.set(U.TEXTURE0),k.bind(q,U.CLAMP_TO_EDGE),H.activeTexture.set(U.TEXTURE1),k.bind(q,U.CLAMP_TO_EDGE),"useMipmap"in k&&H.extTextureFilterAnisotropic&&l.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);const[de,pe,ae,ce]=r?O.getPoleBuffers(r.canonical.z,!1):O.getPoleBuffers(0,!0),ue=y.paint.get("raster-elevation");let Me;f?(Me=de,l.renderDefaultNorthPole=0!==ue):(Me=pe,l.renderDefaultSouthPole=0!==ue);const ve=vm(b.mix),Ue=(Ge=ne,rt=le,Ce=B,_e=d.ah(l.transform.zoom),Re=y,Ze=ue,dt=ve,Pt=b.offset,Ft=b.range,vt=v,Rf(Ge,rt,Ce,new Float32Array(16),new Float32Array(9),[0,0],_e,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Re,[0,0],Ze,2,dt,Pt,Ft,1,0,vt)),ke=l.getOrCreateProgram("raster",{defines:K});var Ge,rt,Ce,_e,Re,Ze,dt,Pt,Ft,vt;l.uploadCommonUniforms(H,ke,null),ke.draw(l,U.TRIANGLES,ee,D,$,C,Ue,y.id,Me,ae,ce)}function Nv(f){const r=f._nearZ,l=f.projection.farthestPixelDistance(f),p=l-r,y=.2*f.height,v=r+y;return[r,l,(v-y-r)/p,(v-r)/p]}function x_(f,r,l,p){if(f)return r instanceof Hl&&f instanceof Ki?r.getTextureDescriptor(f,l,!0):{texture:f.texture,mix:vm(p.mix),offset:p.offset,buffer:0,tileSize:1}}var ds=d.ec([{name:"a_index",type:"Int16",components:1}]);class xm{constructor(r,l,p,y){const v={width:p[0],height:p[1],data:null},b=r.gl;this.targetColorTexture=new d.T(r,v,b.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new d.T(r,v,b.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(l,y),this.lastInvalidatedAt=0}updateParticleTexture(r,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,y=l.width*l.height;this.particleTexture0=new d.T(this.context,l,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new d.T(this.context,l,p.RGBA8,{premultiply:!1,useMipmap:!1});const v=new d.ed;v.reserve(y);for(let b=0;b<y;b++)v.emplaceBack(b);this.particleIndexBuffer=this.context.createVertexBuffer(v,ds.members,!0),this.particleSegment=d.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=d.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function To(f,r,l){if(!f)return null;const p=r.getTextureDescriptor(f,l,!0);if(!p)return null;let{texture:y,mix:v,offset:b,tileSize:C,buffer:D,format:R}=p;if(!y||!R)return null;let O=!1;return"uint32"===R&&(O=!0,v[3]=0,v=us(d.ee,v,[0,l.paint.get("raster-particle-max-speed")]),b=ul(d.ee,b,[0,l.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[D/(C+2*D),C/(C+2*D)],tileSize:C,scalarData:O,scale:v,offset:b,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[R]]}}function ic(f){const r=f._nearZ,l=f.projection.farthestPixelDistance(f),p=l-r,y=.2*f.height,v=r+y;return[r,l,(v-y-r)/p,(v-r)/p]}const _a=new d.am(1,0,0,1),jf=new d.am(0,1,0,1),Uf=new d.am(0,0,1,1),hr=new d.am(1,0,1,1),Hf=new d.am(0,1,1,1);function Gs(f,r,l,p,y,v){for(let b=0;b<l.length;b++)if(y){const R=new d.am(.8*p.r,.8*p.g,.8*p.b,1);Tn(f,r,l[b],p,-1,-1,v),Tn(f,r,l[b],p,-1,1,v),Tn(f,r,l[b],p,1,1,v),Tn(f,r,l[b],p,1,-1,v),Tn(f,r,l[b],R,0,0,v)}else Tn(f,r,l[b],p,0,0,v)}function Tn(f,r,l,p,y,v,b){const C=f.context,D=f.transform,R=C.gl,O="globe"===D.projection.name,N=O?["PROJECTION_GLOBE_VIEW"]:[];let k=d.bw(l.projMatrix);if(O&&d.ah(D.zoom)>0){const ve=d.bg(l.canonical,D),Ue=d.ef(ve);k=d.az(new Float32Array(16),D.globeMatrix,Ue),d.az(k,D.projMatrix,k)}const B=d.bz();B[12]+=2*y/(d.q.devicePixelRatio*D.width),B[13]+=2*v/(d.q.devicePixelRatio*D.height),d.az(k,B,k);const H=f.getOrCreateProgram("debug",{defines:N}),U=r.getTileByID(l.key);f.terrain&&f.terrain.setupElevationDraw(U,H);const q=wt.disabled,$=Vt.disabled,K=f.colorModeForRenderPass();C.activeTexture.set(R.TEXTURE0),f.emptyTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),O?U._makeGlobeTileDebugBuffers(f.context,D):U._makeDebugTileBoundsBuffers(f.context,D.projection);const ne=U._tileDebugBuffer||f.debugBuffer,le=U._tileDebugIndexBuffer||f.debugIndexBuffer,de=U._tileDebugSegments||f.debugSegments;if(H.draw(f,R.LINE_STRIP,q,$,K,Bt.disabled,g_(k,p.toPremultipliedRenderColor(null)),"$debug",ne,le,de,null,null,null,[U._globeTileDebugBorderBuffer]),b){const ve=U.latestRawTileData,Ue=Math.floor((ve&&ve.byteLength||0)/1024);let ke=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ke+=` => ${l.overscaledZ}`),ke+=` ${U.state}`,ke+=` ${Ue}kb`,function(Ge,rt){Ge.initDebugOverlayCanvas();const Ce=Ge.debugOverlayCanvas,_e=Ge.context.gl,Ne=Ge.debugOverlayCanvas.getContext("2d");Ne.clearRect(0,0,Ce.width,Ce.height),Ne.shadowColor="white",Ne.shadowBlur=2,Ne.lineWidth=1.5,Ne.strokeStyle="white",Ne.textBaseline="top",Ne.font="bold 36px Open Sans, sans-serif",Ne.fillText(rt,5,5),Ne.strokeText(rt,5,5),Ge.debugOverlayTexture.update(Ce),Ge.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}(f,ke)}const pe=r.getTile(l).tileSize,ae=512/Math.min(pe,512)*(l.overscaledZ/D.zoom)*.5,ce=U._tileDebugTextBuffer||f.debugBuffer,ue=U._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Me=U._tileDebugTextSegments||f.debugSegments;H.draw(f,R.TRIANGLES,q,$,ln.alphaBlended,Bt.disabled,g_(k,d.am.transparent.toPremultipliedRenderColor(null),ae),"$debug",ce,ue,Me,null,null,null,[U._globeTileDebugTextBuffer])}function mh(f,r,l,p){Ba(f,0,r+l/2,f.transform.width,l,p)}function gh(f,r,l,p){Ba(f,r-l/2,0,l,f.transform.height,p)}function Ba(f,r,l,p,y,v){const b=f.context,C=b.gl;C.enable(C.SCISSOR_TEST),C.scissor(r*d.q.devicePixelRatio,l*d.q.devicePixelRatio,p*d.q.devicePixelRatio,y*d.q.devicePixelRatio),b.clear({color:v}),C.disable(C.SCISSOR_TEST)}const Ts=d.ec([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:b_}=Ts;function rc(f,r,l,p){f.emplaceBack(r,l,p)}class Xc{constructor(r){this.vertexArray=new d.eg,this.indices=new d.a_,rc(this.vertexArray,-1,-1,1),rc(this.vertexArray,1,-1,1),rc(this.vertexArray,-1,1,1),rc(this.vertexArray,1,1,1),rc(this.vertexArray,-1,-1,-1),rc(this.vertexArray,1,-1,-1),rc(this.vertexArray,-1,1,-1),rc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,b_),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=d.bd.simpleSegment(0,0,36,12)}}function Co(f,r,l,p,y,v){const b=f.context.gl,C=r.paint.get("sky-atmosphere-color"),D=r.paint.get("sky-atmosphere-halo-color"),R=r.paint.get("sky-atmosphere-sun-intensity"),O=(N=d.ei(d.dJ(),p),k=y,B=R,H=C.toPremultipliedRenderColor(null),U=D.toPremultipliedRenderColor(null),{u_matrix_3f:N,u_sun_direction:k,u_sun_intensity:B,u_color_tint_r:[H.r,H.g,H.b,H.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5});var N,k,B,H,U;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+v,r.skyboxTexture,0),l.draw(f,b.TRIANGLES,wt.disabled,Vt.disabled,ln.unblended,Bt.frontCW,O,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const it=d.ec([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class _t{constructor(r){const l=new d.ej;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new d.a_;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,it.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=d.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Yc=d.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ji{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Se{constructor(r){this.colorModeAlphaBlendedWriteRGB=new ln([1,771,1,771],d.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new ln([1,0,1,0],d.am.transparent,[!1,!1,!1,!0]),this.params=new Ji,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const l=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new _t(l);const p=this.params.sizeRange,y=this.params.intensityRange,v=function(O){const N=d.el(30),k=[];for(let B=0;B<O;++B){const H=2*Math.PI*N(),U=Math.acos(1-2*N())-.5*Math.PI;k.push(d.d2(Math.cos(U)*Math.cos(H),Math.cos(U)*Math.sin(H),Math.sin(U)))}return k}(this.params.starsCount),b=d.el(300),C=new d.ek,D=new d.a_;let R=0;for(let O=0;O<v.length;++O){const N=d.c1([],v[O],200),k=Math.max(0,1+.01*p*(1*b()-.5)),B=Math.max(0,1+.01*y*(1*b()-.5));C.emplaceBack(N[0],N[1],N[2],-1,-1,k,B),C.emplaceBack(N[0],N[1],N[2],1,-1,k,B),C.emplaceBack(N[0],N[1],N[2],1,1,k,B),C.emplaceBack(N[0],N[1],N[2],-1,1,k,B),D.emplaceBack(R+0,R+1,R+2),D.emplaceBack(R+0,R+2,R+3),R+=4}this.starsVx=l.createVertexBuffer(C,Yc.members),this.starsIdx=l.createIndexBuffer(D),this.starsSegments=d.bd.simpleSegment(0,0,C.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,l){const p=r.context,y=p.gl,v=r.transform,b=new wt(y.LEQUAL,wt.ReadOnly,[0,1]),C=d.ah(v.zoom),D=r.style.getLut(l.scope),R="none"===l.properties.get("color-use-theme"),O=l.properties.get("color").toNonPremultipliedRenderColor(R?null:D).toArray01(),N="none"===l.properties.get("high-color-use-theme"),k=l.properties.get("high-color").toNonPremultipliedRenderColor(N?null:D).toArray01(),B="none"===l.properties.get("space-color-use-theme"),H=l.properties.get("space-color").toNonPremultipliedRenderColor(B?null:D).toArray01(),U=5e-4,q=d.em(l.properties.get("horizon-blend"),0,1,U,.25),$=d.dy(r,p,v)&&q===U?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,K=r.frameCounter/1e3%1,ee=d.ae(v.globeCenterInViewSpace),ne=Math.sqrt(Math.pow(ee,2)-Math.pow($,2)),le=Math.acos(ne/ee),de=pe=>{const ae="globe"===v.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];pe&&ae.push("ALPHA_PASS");const ce=r.getOrCreateProgram("globeAtmosphere",{defines:ae}),ue={u_frustum_tl:v.frustumCorners.TL,u_frustum_tr:v.frustumCorners.TR,u_frustum_br:v.frustumCorners.BR,u_frustum_bl:v.frustumCorners.BL,u_horizon:v.frustumCorners.horizon,u_transition:C,u_fadeout_range:q,u_color:O,u_high_color:k,u_space_color:H,u_temporal_offset:K,u_horizon_angle:le};r.uploadCommonUniforms(p,ce);const Me=this.atmosphereBuffer;Me&&ce.draw(r,y.TRIANGLES,b,Vt.disabled,pe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Bt.backCW,ue,pe?"atmosphere_glow_alpha":"atmosphere_glow",Me.vertexBuffer,Me.indexBuffer,Me.segments)};de(!1),de(!0)}drawStars(r,l){const p=d.ay(l.properties.get("star-intensity"),0,1);if(0===p)return;const y=r.context,v=y.gl,b=r.transform,C=r.getOrCreateProgram("stars"),D=d.c3([]);d.c5(D,D,-b._pitch),d.c4(D,D,-b.angle),d.c5(D,D,d.al(b._center.lat)),d.en(D,D,-d.al(b._center.lng));const R=d.c8(new Float32Array(16),D),O=d.az([],b.starsProjMatrix,R),N=d.ei([],R),k=d.eo([],N),B=[0,1,0];d.dL(B,B,k),d.c1(B,B,this.params.sizeMultiplier);const H=[1,0,0];d.dL(H,H,k),d.c1(H,H,this.params.sizeMultiplier);const U=(q=B,$=H,K=p,{u_matrix:Float32Array.from(O),u_up:q,u_right:$,u_intensity_multiplier:K});var q,$,K;r.uploadCommonUniforms(y,C),this.starsVx&&this.starsIdx&&C.draw(r,v.TRIANGLES,wt.disabled,Vt.disabled,this.colorModeAlphaBlendedWriteRGB,Bt.disabled,U,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class w_{constructor(){this.visibleTiles=[]}updateBorders(r,l){const p=[],y=[],v=r._getRenderableCoordinates(!1,!0);for(const D of v){const R=r.getTile(D);if(!R.hasData())continue;const O=R.getBucket(l);O&&(O.isEmpty()||(p.push(D.key),y.push({bucket:O,tileID:D.canonical})))}let b=p.length!==this.visibleTiles.length;if(!b){p.sort();for(let D=0;D<p.length;D++)if(p[D]!==this.visibleTiles[D]){b=!0;break}}if(!b)return;const C=new Set;this.visibleTiles=p,y.sort((D,R)=>D.tileID.z-R.tileID.z||D.tileID.x-R.tileID.x||D.tileID.y-R.tileID.y);for(const D of y){const R=new Array,O=new Array,N=D.bucket;for(const k of N.featuresOnBorder)C.has(k.featureId)?O.push(k.footprintIndex):(C.add(k.featureId),R.push(k.footprintIndex));N.updateFootprintHiddenFlags(R,d.ep,!1),N.updateFootprintHiddenFlags(O,d.ep,!0)}}}function Sn(f,r){const l=[...f],p=r.cameraWorldSizeForFog/r.worldSize,y=d.bx([]);return d.cP(y,y,[p,p,1]),d.az(l,y,l),d.az(l,r.worldToFogMatrix,l),l}function Ju(f,r,l,p,y){const v=l.material,b=p.context,{baseColorTexture:C,metallicRoughnessTexture:D}=v.pbrMetallicRoughness,{normalTexture:R,occlusionTexture:O,emissionTexture:N}=v;function k(H,U,q){if(H&&(f.push(U),b.activeTexture.set(b.gl.TEXTURE0+q),H.gfxTexture)){const{minFilter:$,magFilter:K,wrapS:ee,wrapT:ne}=H.sampler;H.gfxTexture.bindExtraParam($,K,ee,ne)}}k(C,"HAS_TEXTURE_u_baseColorTexture",Jr.BaseColor),k(D,"HAS_TEXTURE_u_metallicRoughnessTexture",Jr.MetallicRoughness),k(R,"HAS_TEXTURE_u_normalTexture",Jr.Normal),k(O,"HAS_TEXTURE_u_occlusionTexture",Jr.Occlusion),k(N,"HAS_TEXTURE_u_emissionTexture",Jr.Emission),y&&(y.texture||(y.texture=new d.et(p.context,y.image,[y.image.height,y.image.height,y.image.height],b.gl.RGBA8)),b.activeTexture.set(b.gl.TEXTURE0+Jr.LUT),y.texture&&y.texture.bind(b.gl.LINEAR,b.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(l.texcoordBuffer)),l.colorBuffer&&(f.push(12===l.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(l.colorBuffer)),l.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(l.normalBuffer)),l.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(l.pbrBuffer)),"OPAQUE"!==v.alphaMode&&"MASK"!==v.alphaMode||f.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||f.push("DIFFUSE_SHADED");const B=p.shadowRenderer;B&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),B.useNormalOffset&&f.push("NORMAL_OFFSET"))}function _h(f,r,l,p,y,v){const b=l.paint.get("model-opacity").constantOr(1),C=r.context,D=new wt(r.context.gl.LEQUAL,wt.ReadWrite,r.depthRangeFor3D),R=r.transform,O=f.mesh,N=O.material,k=N.pbrMetallicRoughness,B=r.style.fog;let H;H="pixels"===r.transform.projection.zAxisUnit?[...f.nodeModelMatrix]:d.az([],p.zScaleMatrix,f.nodeModelMatrix),d.az(H,p.negCameraPosMatrix,H);const U=d.bi([],H);d.ea(U,U);const q="none"===l.paint.get("model-color-use-theme").constantOr("default"),$=l.paint.get("model-emissive-strength").constantOr(0),K=$c(new Float32Array(f.worldViewProjection),new Float32Array(H),new Float32Array(U),null,r,b,k.baseColorFactor,N.emissiveFactor,k.metallicFactor,k.roughnessFactor,N,$,l),ee={defines:[]},ne=[],le=r.shadowRenderer;le&&(le.useNormalOffset=!1),Ju(ee.defines,ne,O,r,q?null:l.lut);let de=null;if(B){const ce=Sn(f.nodeModelMatrix,r.transform);if(de=new Float32Array(ce),"globe"!==R.projection.name){const ue=O.aabb.min,Me=O.aabb.max,[ve,Ue]=B.getOpacityForBounds(ce,ue[0],ue[1],Me[0],Me[1]);ee.overrideFog=ve>=qe||Ue>=qe}}const pe=xo(r,l.paint.get("model-cutoff-fade-range"));pe.shouldRenderCutoff&&ee.defines.push("RENDER_CUTOFF");const ae=r.getOrCreateProgram("model",ee);r.uploadCommonUniforms(C,ae,null,de,pe),"shadow"!==r.renderPass&&le&&le.setupShadowsFromMatrix(f.nodeModelMatrix,ae),ae.draw(r,C.gl.TRIANGLES,D,y,v,O.material.doubleSided?Bt.disabled:Bt.backCCW,K,l.id,O.vertexBuffer,O.indexBuffer,O.segments,l.paint,r.transform.zoom,void 0,ne)}function bm(f,r,l,p,y,v,b){let C;C="globe"===f.projection.name?d.er(l,f):[...l],d.az(C,C,r.matrix);const D=d.az([],p,C);if(r.meshes)for(const R of r.meshes){if("BLEND"!==R.material.alphaMode){b.push({mesh:R,depth:0,modelIndex:y,worldViewProjection:D,nodeModelMatrix:C});continue}const O=d.ad([],R.centroid,D);!f.isOrthographic&&O[2]<=0||v.push({mesh:R,depth:O[2],modelIndex:y,worldViewProjection:D,nodeModelMatrix:C})}if(r.children)for(const R of r.children)bm(f,R,l,p,y,v,b)}function Gf(f,r,l,p){const y=l.shadowRenderer;if(!y)return;const v=y.getShadowPassDepthMode(),b=y.getShadowPassColorMode(),C=y.calculateShadowPassMatrixFromMatrix(r),D=qc(C);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,v,Vt.disabled,b,Bt.backCCW,D,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,l.transform.zoom,void 0,void 0)}function Qu(f,r,l){const p=r.updateZoomBasedPaintProperties(),y=function(v,b,C){let D,R,O,N=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&N>0){const k=v.terrain,B=k.findDEMTileFor(C);B&&B.dem?D=d.eu.create(k,C,B):N=0}if(0===N&&(b.terrainElevationMin=0,b.terrainElevationMax=0),N===b.validForExaggeration&&(0===N||D&&D._demTile&&D._demTile.tileID===b.validForDEMTile.id&&D._dem._timestamp===b.validForDEMTile.timestamp))return!1;for(const k in b.instancesPerModel){const B=b.instancesPerModel[k];for(let H=0;H<B.instancedDataArray.length;++H){const U=(D?N*D.getElevationAt(0|B.instancedDataArray.float32[16*H],0|B.instancedDataArray.float32[16*H+1],!0,!0):0)+B.instancesEvaluatedElevation[H];B.instancedDataArray.float32[16*H+6]=U,R=R?Math.min(b.terrainElevationMin,U):U,O=O?Math.max(b.terrainElevationMax,U):U}}return b.terrainElevationMin=R||0,b.terrainElevationMax=O||0,b.validForExaggeration=N,b.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,r,l);(p||y)&&(r.uploaded=!1,r.upload(f.context))}const ya={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new d.d6([0,0,0],[d.aj,d.aj,0])};function ed(f,r){const l=1<<f.canonical.z,p=r.getFreeCameraOptions().position,y=r.elevation,v=f.canonical.x/l,b=(f.canonical.x+1)/l,C=f.canonical.y/l,D=(f.canonical.y+1)/l;let R=r._centerAltitude;if(y){const B=y.getMinMaxForTile(f);B&&B.max>R&&(R=B.max)}const O=d.ay(p.x,v,b)-p.x,N=d.ay(p.y,C,D)-p.y,k=d.cb(R,r.center.lat)-p.z;return r._zoomFromMercatorZ(Math.sqrt(O*O+N*N+k*k))}function wm(f,r,l,p,y,v,b){const C=f.context,D="shadow"===f.renderPass,R=f.shadowRenderer,O=D&&R?R.getShadowPassDepthMode():new wt(C.gl.LEQUAL,wt.ReadWrite,f.depthRangeFor3D),N=f.isTileAffectedByFog(v);if(l.meshes)for(const k of l.meshes){const B=["MODEL_POSITION_ON_GPU"],H=[];let U,q,$;p.instancedDataArray.length>20&&B.push("INSTANCED_ARRAYS");const K=xo(f,r.paint.get("model-cutoff-fade-range"));if(K.shouldRenderCutoff&&B.push("RENDER_CUTOFF"),D&&R)U=f.getOrCreateProgram("modelDepth",{defines:B}),q=qc(b.shadowTileMatrix,b.shadowTileMatrix,Float32Array.from(l.matrix)),$=R.getShadowPassColorMode();else{Ju(B,H,k,f,"none"===r.paint.get("model-color-use-theme").constantOr("default")?null:r.lut),U=f.getOrCreateProgram("model",{defines:B,overrideFog:N});const ne=k.material,le=ne.pbrMetallicRoughness,de=r.paint.get("model-opacity").constantOr(1),pe=r.paint.get("model-emissive-strength").constantOr(0);q=$c(v.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,f,de,le.baseColorFactor,ne.emissiveFactor,le.metallicFactor,le.roughnessFactor,ne,pe,r,y),R&&(b.shadowUniformsInitialized?U.setShadowUniformValues(C,R.getShadowUniformValues()):(R.setupShadows(v.toUnwrapped(),U,"model-tile"),b.shadowUniformsInitialized=!0)),$=K.shouldRenderCutoff||de<1||"OPAQUE"!==ne.alphaMode?ln.alphaBlended:ln.unblended}f.uploadCommonUniforms(C,U,v.toUnwrapped(),null,K);const ee=k.material.doubleSided?Bt.disabled:Bt.backCCW;if(p.instancedDataArray.length>20)H.push(p.instancedDataBuffer),U.draw(f,C.gl.TRIANGLES,O,Vt.disabled,$,ee,q,r.id,k.vertexBuffer,k.indexBuffer,k.segments,r.paint,f.transform.zoom,void 0,H,p.instancedDataArray.length);else{const ne=D?"u_instance":"u_normal_matrix";for(let le=0;le<p.instancedDataArray.length;++le)q[ne]=new Float32Array(p.instancedDataArray.arrayBuffer,64*le,16),U.draw(f,C.gl.TRIANGLES,O,Vt.disabled,$,ee,q,r.id,k.vertexBuffer,k.indexBuffer,k.segments,r.paint,f.transform.zoom,void 0,H)}}if(l.children)for(const k of l.children)wm(f,r,k,p,y,v,b)}const $f=[1,-1,1];function Em(f,r,l,p){if(!l.modelManager)return!0;const y=l.modelManager;if(!l.shadowRenderer)return!0;const v=l.shadowRenderer,b=r.aabb;let C=!0,D=f.maxHeight;if(0===D){let O=0;for(const N in f.instancesPerModel){const k=y.getModel(N,p);k?O=Math.max(O,Math.max(Math.max(k.aabb.max[0],k.aabb.max[1]),k.aabb.max[2])):C=!1}D=f.maxScale*O*1.41+f.maxVerticalOffset,C&&(f.maxHeight=D)}b.max[2]=D,b.min[2]+=f.terrainElevationMin,b.max[2]+=f.terrainElevationMax,d.ad(b.min,b.min,r.tileMatrix),d.ad(b.max,b.max,r.tileMatrix);const R=b.intersects(v.getCurrentCascadeFrustum());return 0===l.currentShadowCascade&&(f.isInsideFirstShadowMapFrustum=2===R),0===R}function E_(f,r){const l=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],y=f.uniformValues.u_cutoff_params[2],v=f.uniformValues.u_cutoff_params[3];return p===l||v===y?1:d.ay(((r-l)/(p-l)-y)/(v-y),0,1)}function T_(f,r,l,p){if(r.pitch<20)return 1;const y=r.getWorldToCameraMatrix();d.az(y,y,f);const v=d.bR(l.min[0],l.min[1],l.min[2],1);let b=d.aA(d.ev(),v,y),C=b,D=b;v[1]=l.max[1],b=d.aA(d.ev(),v,y),C=b[1]<C[1]?b:C,D=b[1]>D[1]?b:D,v[0]=l.max[0],b=d.aA(d.ev(),v,y),C=b[1]<C[1]?b:C,D=b[1]>D[1]?b:D,v[1]=l.min[1],b=d.aA(d.ev(),v,y),C=b[1]<C[1]?b:C,D=b[1]>D[1]?b:D;const R=d.ay(p[0],0,1),O=100*r.pixelsPerMeter*d.ay(p[1],0,1),N=d.ay(p[2],0,1),k=d.ew(d.ev(),C,D,R),B=Math.tan(.5*r.fovX),H=-k[2]*B;if(0===O)return k[1]<-Math.abs(H)?N:1;const U=(-Math.abs(H)-k[1])/O,q=(K,ee,ne)=>(1-ne)*K+ne*ee,$=d.ay(q(1,N,U),N,1);return q(1,$,d.ay((r.pitch-20)/20,0,1))}class Mt{}class bi{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,l,p){{const N=this._storage.get(l.id);if(N)return N.lastUsedFrameIdx=r,N.buf}const y=p.gl,v=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),b=new ArrayBuffer(v),C=new Int16Array(b);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(b));const D=new d.ey;for(let N=0;N<v/2;N+=3){const k=C[N],B=C[N+1],H=C[N+2];D.emplaceBack(k,B),D.emplaceBack(B,H),D.emplaceBack(H,k)}const R=p.bindVertexArrayOES.current,O=new Mt;return O.buf=new kv(p,D),O.lastUsedFrameIdx=r,this._storage.set(l.id,O),p.bindVertexArrayOES.set(R),O.buf}update(r){for(const[l,p]of this._storage)r-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(l))}destroy(){for(const[r,l]of this._storage)l.buf.destroy(),this._storage.delete(r)}}class td{constructor(r){this.occluderSize=30,this.depthOffset=-1e-4,r.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const C_=d.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Lo{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class So{constructor(r,l){this.revealStart=11,this.revealRange=2,r.registerParameter(this,[...l,"Reveal"],"revealStart",{min:0,max:17,step:.05}),r.registerParameter(this,[...l,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const yh=d.ec([{type:"Float32",name:"a_pos_2f",components:2}]);class Cs{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(r,l){const p=r.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const b=new d.ez,C=new d.a_;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(1,1),b.emplaceBack(-1,1),C.emplaceBack(0,1,2),C.emplaceBack(0,2,3),this.vignetteVx=r.context.createVertexBuffer(b,yh.members),this.vignetteIdx=r.context.createIndexBuffer(C)}const y=d.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){r.uploadCommonUniforms(r.context,p);const b={u_vignetteShape:(v={vignetteShape:[l.start,l.range,Math.pow(10,l.fadePower)],vignetteColor:[l.color.r,l.color.g,l.color.b,l.color.a*l.strength]}).vignetteShape,u_vignetteColor:v.vignetteColor};p.draw(r,r.context.gl.TRIANGLES,wt.disabled,Vt.disabled,ln.alphaBlended,Bt.disabled,b,"vignette",this.vignetteVx,this.vignetteIdx,y)}var v}}class wi{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(r,l){const p=r.getFreeCameraOptions().position,y=p.toAltitude(),v=p.toLngLat(),b=d.al(v.lng),C=d.al(v.lat),D=r.pixelsPerMeter/l,R=b*d.eB,O=d.eB*Math.log(Math.tan(Math.PI/4+C/2));if(void 0===this._offsetXPrev)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const N=-this._offsetYPrev+O,k=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+R)*D,this._accumulatedOffsetY+=N*D,this._accumulatedElevation+=k*D,this._offsetXPrev=R,this._offsetYPrev=O,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function En(f,r){return[-(f[0]-Math.floor(f[0]/r)*r),-(f[1]-Math.floor(f[1]/r)*r),-(f[2]-Math.floor(f[2]/r)*r)]}function Tm(f){const r=d.el(1323123451230),l=[];for(let p=0;p<f;++p){const y=2*r()-1,v=2*r()-1,b=2*r()-1;l.push(d.d2(y,v,b))}return l}function Ss(f,r,l,p,y){const v=d.ay((y-l)/(p-l),0,1);return(1-v)*f+v*r}class Kc{constructor(r){this._movement=new wi,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Cs,this._ppmScaleFactor=r}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(r,l){const p=r.transform;this._movement.update(p,this._ppmScaleFactor);const y=p.starsProjMatrix,v=d.c3([]);d.c5(v,v,d.al(90)-p._pitch),d.c4(v,v,-p.angle);const b=d.c8(new Float32Array(16),v),C=d.eA(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),D=d.ea([],C),R=d.az([],D,b),O=Date.now()/1e3;return this._accumulatedTimeFromStart+=(O-this._prevTime)*l,this._prevTime=O,{projectionMatrix:y,modelviewMatrix:R}}}class to extends Kc{constructor(r){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new So(r.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(r){const l=r.context;if(!this.particlesVx){const p=Tm(this.particlesCount),y=new d.eC,v=new d.a_;let b=0;const C=d.el(1323123451230);for(let D=0;D<p.length;++D){const R=p[D],O=[2*C()-1,C(),C(),C()];y.emplaceBack(R[0],R[1],R[2],-1,-1,...O),y.emplaceBack(R[0],R[1],R[2],1,-1,...O),y.emplaceBack(R[0],R[1],R[2],1,1,...O),y.emplaceBack(R[0],R[1],R[2],-1,1,...O),v.emplaceBack(b+0,b+1,b+2),v.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=l.createVertexBuffer(y,C_.members),this.particlesIdx=l.createIndexBuffer(v)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.rain)return;const l=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=r.transform.zoom;if(l.revealStart>p)return;const y=Ss(0,1,l.revealStart,l.revealStart+l.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const v=structuredClone(this._params);let b=[-v.direction.x,v.direction.y,-100];d.au(b,b);const C=structuredClone(this._vignetteParams);C.strength*=y,v.overrideStyleParameters||(v.intensity=r.style.rain.state.density,v.timeFactor=r.style.rain.state.intensity,v.color=structuredClone(r.style.rain.state.color),b=structuredClone(r.style.rain.state.direction),v.screenThinning.intensity=r.style.rain.state.centerThinning,v.dropletSizeX=r.style.rain.state.dropletSize[0],v.dropletSizeYScale=r.style.rain.state.dropletSize[1]/r.style.rain.state.dropletSize[0],v.distortionStrength=100*r.style.rain.state.distortionStrength,C.strength=1,C.color=structuredClone(r.style.rain.state.vignetteColor));const D=this.updateOnRender(r,v.timeFactor),R=r.context,O=R.gl,N=r.transform;this.screenTexture&&this.screenTexture.size[0]===r.width&&this.screenTexture.size[1]===r.height||(this.screenTexture=new d.T(R,{width:r.width,height:r.height,data:null},O.RGBA8)),v.distortionStrength>0&&(R.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),O.copyTexSubImage2D(O.TEXTURE_2D,0,0,0,0,0,r.width,r.height));const k=r.getOrCreateProgram("rainParticle");r.uploadCommonUniforms(R,k),R.activeTexture.set(O.TEXTURE0),this.screenTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const B=[v.color.r,v.color.g,v.color.b,v.color.a],H=(U,q)=>{const $=En(this._movement.getPosition(),U),K=v.dropletSizeX,ee=v.dropletSizeX*v.dropletSizeYScale,ne=r.width/2,le=r.height/2,de=Ss(0,v.screenThinning.start,0,1,v.screenThinning.intensity),pe=Ss(.001,v.screenThinning.range,0,1,v.screenThinning.intensity),ae=Ss(0,v.screenThinning.particleOffset,0,1,v.screenThinning.intensity),ce=(ue={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:$,velocityConeAperture:v.velocityConeAperture,velocity:v.velocity,boxSize:U,rainDropletSize:[K,ee],distortionStrength:v.distortionStrength,rainDirection:b,color:B,screenSize:[N.width,N.height],thinningCenterPos:[ne,le],thinningShape:[de,pe,Math.pow(10,v.screenThinning.fadePower)],thinningAffectedRatio:v.screenThinning.affectedRatio,thinningParticleOffset:ae,shapeDirectionalPower:v.shapeDirPower,shapeNormalPower:v.shapeNormalPower,mode:q?0:1},{u_modelview:Float32Array.from(ue.modelview),u_projection:Float32Array.from(ue.projection),u_time:ue.time,u_cam_pos:ue.camPos,u_texScreen:0,u_velocityConeAperture:ue.velocityConeAperture,u_velocity:ue.velocity,u_boxSize:ue.boxSize,u_rainDropletSize:ue.rainDropletSize,u_distortionStrength:ue.distortionStrength,u_rainDirection:ue.rainDirection,u_color:ue.color,u_screenSize:ue.screenSize,u_thinningCenterPos:ue.thinningCenterPos,u_thinningShape:ue.thinningShape,u_thinningAffectedRatio:ue.thinningAffectedRatio,u_thinningParticleOffset:ue.thinningParticleOffset,u_shapeDirectionalPower:ue.shapeDirectionalPower,u_shapeNormalPower:ue.shapeNormalPower,u_mode:ue.mode});var ue;const Me=Math.round(v.intensity*this.particlesCount),ve=d.bd.simpleSegment(0,0,4*Me,2*Me);k.draw(r,O.TRIANGLES,wt.disabled,Vt.disabled,ln.alphaBlended,Bt.disabled,ce,"rain_particles",this.particlesVx,this.particlesIdx,ve)};v.distortionStrength>0&&H(v.boxSize,!0),H(v.boxSize,!1),this._vignette.draw(r,C)}}const hs=d.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class qf extends Kc{constructor(r){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new So(r.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(r){const l=r.context;if(!this.particlesVx){const p=Tm(this.particlesCount),y=new d.eD,v=new d.a_;let b=0;const C=d.el(1323123451230);for(let D=0;D<p.length;++D){const R=p[D],O=C(),N=C(),k=C(),B=[D/p.length,O,N,k],H=[C(),C()];y.emplaceBack(R[0],R[1],R[2],-1,-1,...B,...H),y.emplaceBack(R[0],R[1],R[2],1,-1,...B,...H),y.emplaceBack(R[0],R[1],R[2],1,1,...B,...H),y.emplaceBack(R[0],R[1],R[2],-1,1,...B,...H),v.emplaceBack(b+0,b+1,b+2),v.emplaceBack(b+0,b+2,b+3),b+=4}this.particlesVx=l.createVertexBuffer(y,hs.members),this.particlesIdx=l.createIndexBuffer(v)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.snow)return;const l=structuredClone(this._params);let p=[-l.direction.x,l.direction.y,-100];d.au(p,p);const y=structuredClone(this._vignetteParams),v=l.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},b=r.transform.zoom;if(v.revealStart>b)return;const C=Ss(0,1,v.revealStart,v.revealStart+v.revealRange,b);y.strength*=C,l.overrideStyleParameters||(l.intensity=r.style.snow.state.density,l.timeFactor=r.style.snow.state.intensity,l.color=structuredClone(r.style.snow.state.color),p=structuredClone(r.style.snow.state.direction),l.screenThinning.intensity=r.style.snow.state.centerThinning,l.billboardSize=2.79*r.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(r.style.snow.state.vignetteColor));const D=this.updateOnRender(r,l.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const R=r.context,O=R.gl,N=r.transform,k=r.getOrCreateProgram("snowParticle");r.uploadCommonUniforms(R,k),((B,H,U)=>{const q=En(this._movement.getPosition(),B),$=N.width/2,K=N.height/2,ee=Ss(0,U.screenThinning.start,0,1,U.screenThinning.intensity),ne=Ss(.001,U.screenThinning.range,0,1,U.screenThinning.intensity),le=Ss(0,U.screenThinning.particleOffset,0,1,U.screenThinning.intensity),de=(pe={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:q,velocityConeAperture:U.velocityConeAperture,velocity:U.velocity,horizontalOscillationRadius:U.horizontalOscillationRadius,horizontalOscillationRate:U.horizontalOscillationRate,boxSize:B,billboardSize:1*U.billboardSize,simpleShapeParameters:[U.shapeFadeStart,U.shapeFadePower],screenSize:[N.width,N.height],thinningCenterPos:[$,K],thinningShape:[ee,ne,Math.pow(10,U.screenThinning.fadePower)],thinningAffectedRatio:U.screenThinning.affectedRatio,thinningParticleOffset:le,color:[U.color.r,U.color.g,U.color.b,U.color.a],direction:p},{u_modelview:Float32Array.from(pe.modelview),u_projection:Float32Array.from(pe.projection),u_time:pe.time,u_cam_pos:pe.camPos,u_velocityConeAperture:pe.velocityConeAperture,u_velocity:pe.velocity,u_horizontalOscillationRadius:pe.horizontalOscillationRadius,u_horizontalOscillationRate:pe.horizontalOscillationRate,u_boxSize:pe.boxSize,u_billboardSize:pe.billboardSize,u_simpleShapeParameters:pe.simpleShapeParameters,u_screenSize:pe.screenSize,u_thinningCenterPos:pe.thinningCenterPos,u_thinningShape:pe.thinningShape,u_thinningAffectedRatio:pe.thinningAffectedRatio,u_thinningParticleOffset:pe.thinningParticleOffset,u_particleColor:pe.color,u_direction:pe.direction});var pe;const ae=Math.round(U.intensity*this.particlesCount),ce=d.bd.simpleSegment(0,0,4*ae,2*ae);this.particlesVx&&this.particlesIdx&&k.draw(r,O.TRIANGLES,wt.disabled,Vt.disabled,ln.alphaBlended,Bt.disabled,de,"snow_particles",this.particlesVx,this.particlesIdx,ce)})(l.boxSize,0,l),this._vignette.draw(r,y)}}const oc={symbol:function(f,r,l,p,y){if("translucent"!==f.renderPass)return;const v=Vt.disabled,b=f.colorModeForRenderPass(),C=l.layout.get("text-variable-anchor"),D=l.layout.get("text-size-scale-range"),R=d.ay(f.scaleFactor,D[0],D[1]);C&&function(k,B,H,U,q,$,K,ee){const ne=B.transform,le="map"===q,de="map"===$;for(const pe of k){const ae=U.getTile(pe),ce=ae.getBucket(H);if(!ce||!ce.text||!ce.text.segments.get().length)continue;const ue=d.bH(ce.textSizeData,ne.zoom,ee),Me=Jp(pe,ce.getProjection(),ne),ve=ne.calculatePixelsToTileUnitsMatrix(ae),Ue=Zd(Me,ae.tileID.canonical,de,le,ne,ce.getProjection(),ve),ke=ce.hasIconTextFit()&&ce.hasIconData();ue&&Fv(ce,le,de,K,ne,Ue,pe,Math.pow(2,ne.zoom-ae.tileID.overscaledZ),ue,ke)}}(p,f,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),y,R);const O=0!==l.paint.get("icon-opacity").constantOr(1),N=0!==l.paint.get("text-opacity").constantOr(1);void 0!==l.layout.get("symbol-sort-key").constantOr(1)&&(O||N)?v_(f,r,l,p,v,b):(O&&v_(f,r,l,p,v,b,{onlyIcons:!0}),N&&v_(f,r,l,p,v,b,{onlyText:!0})),r.map.showCollisionBoxes&&(Lf(f,r,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Lf(f,r,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(f,r,l,p){if("translucent"!==f.renderPass)return;const y=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),b=l.paint.get("circle-stroke-opacity"),C=void 0!==l.layout.get("circle-sort-key").constantOr(1),D=l.paint.get("circle-emissive-strength");if(0===y.constantOr(1)&&(0===v.constantOr(1)||0===b.constantOr(1)))return;const R=f.context,O=R.gl,N=f.transform,k=!(!f.terrain||!f.terrain.enabled),B=l.layout.get("circle-elevation-reference"),H=f.depthModeForSublayer(0,wt.ReadOnly),U=new wt(f.context.gl.LEQUAL,wt.ReadOnly,f.depthRangeFor3D),q="none"===B||k?H:U,$=Vt.disabled,K=f.colorModeForDrapableLayerRenderPass(D),ee="globe"===N.projection.name,ne=[d.aD(N.center.lng),d.aH(N.center.lat)],le=[];for(let pe=0;pe<p.length;pe++){const ae=p[pe],ce=r.getTile(ae),ue=ce.getBucket(l);if(!ue||ue.projection.name!==N.projection.name)continue;const Me=ue.programConfigurations.get(l.id),ve=ue.layoutVertexBuffer,Ue=ue.globeExtVertexBuffer,ke=ue.indexBuffer,Ge=d.dW(l),rt=[Ue],Ce=f.isTileAffectedByFog(ae);ee&&Ge.push("PROJECTION_GLOBE_VIEW"),Ge.push("DEPTH_D24"),f.terrain&&N.depthOcclusionForSymbolsAndCircles&&Ge.push("DEPTH_OCCLUSION"),ue.hasElevation&&!f.terrain&&(Ge.push("ELEVATED_ROADS"),rt.push(ue.elevatedLayoutVertexBuffer));const _e=f.getOrCreateProgram("circle",{config:Me,defines:Ge,overrideFog:Ce}),Ne=N.projection.createInversionMatrix(N,ae.canonical),Re={programConfiguration:Me,program:_e,layoutVertexBuffer:ve,dynamicBuffers:rt,indexBuffer:ke,uniformValues:d.dX(f,ae,ce,Ne,ne,l),tile:ce};if(C){const We=ue.segments.get();for(const Ze of We)le.push({segments:new d.bd([Ze]),sortKey:Ze.sortKey,state:Re})}else le.push({segments:ue.segments,sortKey:0,state:Re})}C&&le.sort((pe,ae)=>pe.sortKey-ae.sortKey);const de={useDepthForOcclusion:N.depthOcclusionForSymbolsAndCircles};for(const pe of le){const{programConfiguration:ae,program:ce,layoutVertexBuffer:ue,dynamicBuffers:Me,indexBuffer:ve,uniformValues:Ue,tile:ke}=pe.state,Ge=pe.segments;f.terrain&&f.terrain.setupElevationDraw(ke,ce,de),f.uploadCommonUniforms(R,ce,ke.tileID.toUnwrapped()),ce.draw(f,O.TRIANGLES,q,$,K,Bt.disabled,Ue,l.id,ue,ve,Ge,l.paint,N.zoom,ae,Me)}},heatmap:function(f,r,l,p){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const y=f.context,v=y.gl,b=Vt.disabled,C=new ln([v.ONE,v.ONE,v.ONE,v.ONE],d.am.transparent,[!0,!0,!0,!0]);(function(B,H,U,q){const $=B.gl,K=H.width*q,ee=H.height*q;B.activeTexture.set($.TEXTURE1),B.viewport.set([0,0,K,ee]);let ne=U.heatmapFbo;if(!ne||ne&&(ne.width!==K||ne.height!==ee)){ne&&ne.destroy();const le=$.createTexture();$.bindTexture($.TEXTURE_2D,le),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),ne=U.heatmapFbo=B.createFramebuffer(K,ee,!0,null),function(de,pe,ae,ce,ue,Me){const ve=de.gl;ve.texImage2D(ve.TEXTURE_2D,0,de.extRenderToTextureHalfFloat?ve.RGBA16F:ve.RGBA,ue,Me,0,ve.RGBA,de.extRenderToTextureHalfFloat?ve.HALF_FLOAT:ve.UNSIGNED_BYTE,null),ce.colorAttachment.set(ae)}(B,0,le,ne,K,ee)}else $.bindTexture($.TEXTURE_2D,ne.colorAttachment.get()),B.bindFramebuffer.set(ne.framebuffer)})(y,f,l,"globe"===f.transform.projection.name?.5:.25),y.clear({color:d.am.transparent});const D=f.transform,R="globe"===D.projection.name,O=R?["PROJECTION_GLOBE_VIEW"]:[],N=R?Bt.frontCCW:Bt.disabled,k=[d.aD(D.center.lng),d.aH(D.center.lat)];for(let B=0;B<p.length;B++){const H=p[B];if(r.hasRenderableParent(H))continue;const U=r.getTile(H),q=U.getBucket(l);if(!q||q.projection.name!==D.projection.name)continue;const $=f.isTileAffectedByFog(H),K=q.programConfigurations.get(l.id),ee=f.getOrCreateProgram("heatmap",{config:K,defines:O,overrideFog:$}),{zoom:ne}=f.transform;f.terrain&&f.terrain.setupElevationDraw(U,ee),f.uploadCommonUniforms(y,ee,H.toUnwrapped());const le=D.projection.createInversionMatrix(D,H.canonical);ee.draw(f,v.TRIANGLES,wt.disabled,b,C,N,uh(f,H,U,le,k,ne,l.paint.get("heatmap-intensity")),l.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,l.paint,f.transform.zoom,K,R?[q.globeExtVertexBuffer]:null)}y.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,v){const b=y.context,C=b.gl,D=v.heatmapFbo;if(!D)return;b.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,D.colorAttachment.get()),b.activeTexture.set(C.TEXTURE1);let R=v.colorRampTexture;R||(R=v.colorRampTexture=new d.T(b,v.colorRamp,C.RGBA8)),R.bind(C.LINEAR,C.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,C.TRIANGLES,wt.disabled,Vt.disabled,y.colorModeForRenderPass(),Bt.disabled,{u_image:0,u_color_ramp:1,u_opacity:v.paint.get("heatmap-opacity")},v.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,v.paint,y.transform.zoom)}(f,l))},line:function(f,r,l,p){if("translucent"!==f.renderPass)return;const y=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(0===y.constantOr(1)||0===v.constantOr(1))return;const b=l.paint.get("line-emissive-strength"),C=l.paint.get("line-occlusion-opacity"),D=l.layout.get("line-elevation-reference"),R="meters"===l.layout.get("line-width-unit"),O="sea"===D,N=!(!f.terrain||!f.terrain.enabled),k=f.context,B=k.gl;if(l.hasElevatedBuckets&&"globe"===f.transform.projection.name)return;const H=l.layout.get("line-cross-slope"),U=void 0!==H,q=H<1,$=f.colorModeForDrapableLayerRenderPass(b),K=f.terrain&&f.terrain.renderingToTexture,ee=K?1:d.q.devicePixelRatio,ne=l.paint.get("line-dasharray"),le=ne.constantOr(1),de=l.layout.get("line-cap"),pe=ne.constantOr(null),ae=de.constantOr(null),ce=l.paint.get("line-pattern"),ue=ce.constantOr(1),Me=l.paint.get("line-pattern-cross-fade"),ve=ce.constantOr(null),Ue=l.paint.get("line-opacity").constantOr(1);let ke=!ue&&1!==Ue||f.depthOcclusion&&C>0&&C<1;const Ge=l.paint.get("line-gradient"),rt=ue?"linePattern":"line",Ce=d.dY(l);let _e;if(K&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(ke=!1),0!==C&&f.depthOcclusion){const Ze=l.paint._values["line-opacity"];Ze&&Ze.value&&"constant"===Ze.value.kind?_e=Ze.value:d.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}"constant"!==v.value.kind&&!1===v.value.isLineProgressConstant&&Ce.push("VARIABLE_LINE_WIDTH");const Ne=(Ze,Ye,dt,Pt,Ft,vt)=>{for(const Ot of Ze){const Rt=r.getTile(Ot);if(ue&&!Rt.patternsLoaded())continue;const Xt=Rt.getBucket(l);if(!Xt||"none"!==Xt.elevationType&&!Ft||"none"===Xt.elevationType&&Ft)continue;f.prepareDrawTile();const tn=[...Ye],gn=f.shadowRenderer,Dn="road"===Xt.elevationType&&!!gn&&gn.enabled;let Jt=[0,0,0];if(Dn){const Pn=f.style.directionalLight,Zn=f.style.ambientLight;Pn&&Zn&&(Jt=il(f.style,Pn,Zn)),tn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Mn=Xt.programConfigurations.get(l.id);let Fn=!1;if(ve&&Rt.imageAtlas){const Pn=d.dZ.from(ve),Zn=Pn.getPrimary().scaleSelf(ee).toString(),hi=Rt.imageAtlas.patternPositions.get(Zn),xr=Pn.getSecondary(),fr=xr?Rt.imageAtlas.patternPositions.get(xr.scaleSelf(ee).toString()):null;Fn=!!hi&&!!fr,hi&&Mn.setConstantPatternPositions(hi,fr)}Me>0&&(Fn||Mn.getPatternTransitionVertexBuffer("line-pattern"))&&tn.push("LINE_PATTERN_TRANSITION");const ni=f.isTileAffectedByFog(Ot),dn=f.getOrCreateProgram(rt,{config:Mn,defines:tn,overrideFog:ni});if(!ue&&pe&&ae&&Rt.lineAtlas){const Pn=Rt.lineAtlas.getDash(pe,ae);Pn&&Mn.setConstantPatternPositions(Pn)}Dn&&gn.setupShadows(Rt.tileID.toUnwrapped(),dn,"vector-tile");let[Ln,zn]=l.paint.get("line-trim-offset");("round"===ae||"square"===ae)&&Ln!==zn&&(0===Ln&&(Ln-=1),1===zn&&(zn+=1));const In=K?Ot.projMatrix:null,an=R?1/Xt.tileToMeter/d.aw(Rt,1,f.transform.zoom):1,ii=R?1/Xt.tileToMeter/d.aw(Rt,1,Math.floor(f.transform.zoom)):1,qn=ue?d.d_(f,Rt,l,In,ee,an,ii,[Ln,zn],Jt,Me):d.d$(f,Rt,l,In,Xt.lineClipsArray.length,ee,an,ii,[Ln,zn],Jt);if(Ge){const Pn=Xt.gradients[l.id];let Zn=Pn.texture;if(l.gradientVersion!==Pn.version){let hi=256;if(l.stepInterpolant){const xr=r.getSource().maxzoom,fr=Ot.canonical.z===xr?Math.ceil(1<<f.transform.maxZoom-Ot.canonical.z):1;hi=d.ay(d.e0(Xt.maxLineLength/d.aj*1024*fr),256,k.maxTextureSize)}Pn.gradient=d.e1({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:hi,image:Pn.gradient||void 0,clips:Xt.lineClipsArray}),Pn.texture?Pn.texture.update(Pn.gradient):Pn.texture=new d.T(k,Pn.gradient,B.RGBA8),Pn.version=l.gradientVersion,Zn=Pn.texture}k.activeTexture.set(B.TEXTURE1),Zn.bind(l.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}le&&(k.activeTexture.set(B.TEXTURE0),Rt.lineAtlasTexture&&Rt.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),Mn.updatePaintBuffers()),ue&&(k.activeTexture.set(B.TEXTURE0),Rt.imageAtlasTexture&&Rt.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Mn.updatePaintBuffers()),Ft&&!O&&f.terrain.setupElevationDraw(Rt,dn),f.uploadCommonUniforms(k,dn,Ot.toUnwrapped());const Ni=Pn=>{null!=_e&&(_e.value=Ue*C),dn.draw(f,B.TRIANGLES,dt,Pn,$,Bt.disabled,qn,l.id,Xt.layoutVertexBuffer,Xt.indexBuffer,Xt.segments,l.paint,f.transform.zoom,Mn,[Xt.layoutVertexBuffer2,Xt.patternVertexBuffer,Xt.zOffsetVertexBuffer]),null!=_e&&(_e.value=Ue)};if(ke&&!Ft){const Pn=f.stencilModeForClipping(Ot).ref;0===Pn&&K&&k.clear({stencil:0});const Zn={func:B.EQUAL,mask:255};qn.u_alpha_discard_threshold=.8,Ni(new Vt(Zn,Pn,255,B.KEEP,B.KEEP,B.INVERT)),qn.u_alpha_discard_threshold=0,Ni(new Vt(Zn,Pn,255,B.KEEP,B.KEEP,B.KEEP))}else qn.u_alpha_discard_threshold=ke&&Ft&&vt?.8:0,Ni(Ft?Pt:f.stencilModeForClipping(Ot))}};let Re=f.depthModeForSublayer(0,wt.ReadOnly);const We=new wt(f.depthOcclusion?B.GREATER:B.LEQUAL,wt.ReadOnly,f.depthRangeFor3D);if(l.hasNonElevatedBuckets){const Ze=!K&&f.terrain;0!==C&&Ze?d.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ze?d.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${l.id}.`):Ne(p,Ce,Re,Vt.disabled,!1,!0)}if(l.hasElevatedBuckets){"hd-road-markup"===D?N||(Re=We,Ce.push("ELEVATED_ROADS")):(Ce.push("ELEVATED"),Re=We,U&&Ce.push(q?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),O&&Ce.push("ELEVATION_REFERENCE_SEA"));const Ze=ke?f.stencilModeFor3D():Vt.disabled;f.forceTerrainMode=!0,Ne(p,Ce,Re,Ze,!0,!0),ke&&Ne(p,Ce,Re,Ze,!0,!1),f.forceTerrainMode=!1}ke&&(f.resetStencilClippingMasks(),K&&k.clear({stencil:0})),0===C||f.depthOcclusion||K||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,r,l,p){const y=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(0===v.constantOr(1))return;const b=l.paint.get("fill-emissive-strength"),C=f.colorModeForDrapableLayerRenderPass(b),D=l.paint.get("fill-pattern"),R=f.opaquePassEnabledForLayer()&&!D.constantOr(1)&&1===y.constantOr(d.am.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";let O="none";"none"!==l.layout.get("fill-elevation-reference")?O="road":0!==l.paint.get("fill-z-offset").constantOr(1)&&(O="offset");const N=!(!f.terrain||!f.terrain.enabled),k={painter:f,sourceCache:r,layer:l,coords:p,colorMode:C,elevationType:O,terrainEnabled:N,pass:R};if("shadow"!==f.renderPass)if("offset"!==O){if(Nf(k,!1),"road"===O){const B=!N&&"translucent"===f.renderPass;B&&Et(f,r,l,p,"geometry"),Nf(k,!0,Vt.disabled),B&&function(H){const{painter:U,sourceCache:q,layer:$,coords:K,colorMode:ee}=H,ne=U.context.gl,le=H.painter.shadowRenderer,de=!!le&&le.enabled,pe=new wt(U.context.gl.LEQUAL,wt.ReadOnly,U.depthRangeFor3D);let ae=[0,0,0];if(de){const ue=U.style.directionalLight,Me=U.style.ambientLight;ue&&Me&&(ae=il(U.style,ue,Me))}const ce=ue=>{for(const Me of K){const ve=q.getTile(Me),Ue=ve.getBucket($);if(!Ue)continue;const ke=Ue.elevatedStructures;if(!ke)continue;let Ge,rt;if(ue?(Ge=ke.renderableBridgeSegments,rt=ke.bridgeProgramConfigurations.get($.id)):(Ge=ke.renderableTunnelSegments,rt=ke.tunnelProgramConfigurations.get($.id)),!Ge||0===Ge.segments[0].primitiveLength)continue;rt.updatePaintBuffers(),U.prepareDrawTile();const Ce=U.isTileAffectedByFog(Me),_e=[];de&&_e.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ne=U.getOrCreateProgram("elevatedStructures",{config:rt,overrideFog:Ce,defines:_e}),Re=U.translatePosMatrix(Me.projMatrix,ve,$.paint.get("fill-translate"),$.paint.get("fill-translate-anchor"));de&&le.setupShadows(ve.tileID.toUnwrapped(),Ne,"vector-tile");const We=sb(Re,ae);U.uploadCommonUniforms(U.context,Ne,Me.toUnwrapped()),Ne.draw(U,ne.TRIANGLES,pe,Vt.disabled,ee,Bt.backCCW,We,$.id,ke.vertexBuffer,ke.indexBuffer,Ge,$.paint,U.transform.zoom,rt,[ke.vertexBufferNormal])}};ce(!0),ce(!1)}(k)}}else Nf(k,!1,f.stencilModeFor3D());else f.shadowRenderer&&"road"===O&&!N&&function(B){const{painter:H,sourceCache:U,layer:q,coords:$}=B,K=H.context.gl,ee=B.painter.shadowRenderer;for(const ne of $){const le=U.getTile(ne),de=le.getBucket(q);if(!de)continue;const pe=de.elevatedStructures;if(!pe||!pe.shadowCasterSegments||0===pe.shadowCasterSegments.segments[0].primitiveLength)continue;H.prepareDrawTile();const ae=de.bufferData.programConfigurations.get(q.id),ce=H.isTileAffectedByFog(ne),ue=H.getOrCreateProgram("elevatedStructuresDepth",{config:ae,overrideFog:ce}),Me=ee.calculateShadowPassMatrixFromTile(le.tileID.toUnwrapped());H.uploadCommonUniforms(H.context,ue,ne.toUnwrapped());const ve={u_matrix:Me,u_depth_bias:0};ue.draw(H,K.TRIANGLES,ee.getShadowPassDepthMode(),Vt.disabled,ee.getShadowPassColorMode(),Bt.disabled,ve,q.id,pe.vertexBuffer,pe.indexBuffer,pe.shadowCasterSegments,q.paint,H.transform.zoom,ae)}}(k)},"fill-extrusion":function(f,r,l,p){const y=l.paint.get("fill-extrusion-opacity"),v=f.context,b=v.gl,C=f.terrain,D=C&&C.renderingToTexture;if(0===y)return;const R=f.conflationActive&&f.style.isLayerClipped(l,r.getSource()),O=f.style.order.indexOf(l.fqid);if(R&&function(N,k,B,H,U){for(const q of H){const $=k.getTile(q).getBucket(B);$&&($.updateReplacement(q,N.replacementSource,U),$.uploadCentroid(N.context))}}(f,r,l,p,O),C||R)for(const N of p){const k=r.getTile(N).getBucket(l);k&&jt(f.context,r,N,k,l,C,R)}if("shadow"===f.renderPass&&f.shadowRenderer){const N=f.shadowRenderer;if(C&&y<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof d.ab)return;const k=N.getShadowPassDepthMode(),B=N.getShadowPassColorMode();ph(f,r,l,p,k,Vt.disabled,B,R)}else if("translucent"===f.renderPass){const N=!l.paint.get("fill-extrusion-pattern").constantOr(1),k=l.paint.get("fill-extrusion-color").constantOr(d.am.white);if(!D&&0!==k.a){const B=new wt(f.context.gl.LEQUAL,wt.ReadWrite,f.depthRangeFor3D);1===y&&N?ph(f,r,l,p,B,Vt.disabled,ln.unblended,R):(ph(f,r,l,p,B,Vt.disabled,ln.disabled,R),ph(f,r,l,p,B,f.stencilModeFor3D(),f.colorModeForRenderPass(),R),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&N&&(!C&&"globe"!==f.transform.projection.name||D)){const B=l.paint.get("fill-extrusion-opacity"),H=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),U=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),q=l.paint.get("fill-extrusion-flood-light-intensity"),$="none"===l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),K=l.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor($?null:l.lut).toArray01().slice(0,3),ee=H>0&&U>0,ne=q>0,le=(ae,ce,ue)=>(1-ue)*ae+ue*ce,de=new pl;de.translate=l.paint.get("fill-extrusion-translate"),de.translateAnchor=l.paint.get("fill-extrusion-translate-anchor"),de.edgeRadius=l.layout.get("fill-extrusion-edge-radius"),de.cutoffFadeRange=l.paint.get("fill-extrusion-cutoff-fade-range");const pe=ae=>{const ce=f.depthModeForSublayer(1,wt.ReadOnly,b.LEQUAL,!0),ue=l.paint.get(ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Me=le(.1,3,ue),ve=f._showOverdrawInspector;if(!ve){const Ue=new Vt({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),ke=new ln([b.ONE,b.ONE,b.ONE,b.ONE],d.am.transparent,[!1,!1,!1,!0],b.MIN);qo(de,f,r,l,p,ce,Ue,ke,Bt.disabled,ae,"sdf",B,H,U,q,K,Me,R,!1)}{const Ue=ve?Vt.disabled:new Vt({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),ke=ve?f.colorModeForRenderPass():new ln([b.ONE_MINUS_DST_ALPHA,b.DST_ALPHA,b.ONE,b.ONE],d.am.transparent,[!0,!0,!0,!0]);qo(de,f,r,l,p,ce,Ue,ke,Bt.disabled,ae,"color",B,H,U,q,K,Me,R,!1)}};if(D){const ae=(ce,ue,Me)=>{const ve=f.depthModeForSublayer(1,wt.ReadOnly,b.LEQUAL,!1),Ue=l.paint.get(ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ke=le(.1,3,Ue);{const Ge=new ln([b.ONE,b.ONE,b.ONE,b.ONE],d.am.transparent,[!1,!1,!1,!0]);qo(de,f,r,l,p,ve,Vt.disabled,Ge,Bt.disabled,ce,"clear",B,H,U,q,K,ke,R,ue)}{const Ge=new Vt({func:b.ALWAYS,mask:255},255,255,b.KEEP,b.KEEP,b.REPLACE),rt=new ln([b.ONE,b.ONE,b.ONE,b.ONE],d.am.transparent,[!1,!1,!1,!0],b.MIN);qo(de,f,r,l,p,ve,Ge,rt,Bt.disabled,ce,"sdf",B,H,U,q,K,ke,R,ue)}{const Ge=ce?b.ZERO:b.ONE_MINUS_DST_ALPHA,rt=new Vt({func:b.EQUAL,mask:255},255,255,b.KEEP,b.DECR,b.DECR),Ce=new ln([Ge,b.DST_ALPHA,b.ONE_MINUS_DST_ALPHA,b.ZERO],d.am.transparent,[!0,!0,!0,!0]);qo(de,f,r,l,p,ve,rt,Ce,Bt.disabled,ce,"color",B,H,U,q,K,ke,R,ue)}{const Ge=new ln([b.ONE,b.ONE,b.ONE,ce?b.ZERO:b.ONE],d.am.transparent,[!1,!1,!1,!0],ce?b.FUNC_ADD:b.MAX);qo(de,f,r,l,p,ve,Vt.disabled,Ge,Bt.disabled,ce,"clear",B,H,U,q,K,ke,R,ue,Me)}};if(ee||ne){let ce;if(f.prepareDrawTile(),C){const ue=C.drapeBufferSize[0],Me=C.drapeBufferSize[1];ce=C.framebufferCopyTexture,ce&&(!ce||ce.size[0]===ue&&ce.size[1]===Me)||(ce&&ce.destroy(),ce=C.framebufferCopyTexture=new d.T(v,new d.r({width:ue,height:Me}),b.RGBA8)),ce.bind(b.LINEAR,b.CLAMP_TO_EDGE),b.copyTexSubImage2D(b.TEXTURE_2D,0,0,0,0,0,ue,Me)}ee&&ae(!0,!1,ce),ne&&ae(!1,!0,ce)}}else ee&&pe(!0),ne&&pe(!1),(ee||ne)&&f.resetStencilClippingMasks()}}},building:function(f,r,l,p){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const y=l.paint.get("building-ambient-occlusion-ground-intensity"),v=l.paint.get("building-ambient-occlusion-ground-radius"),b=l.paint.get("building-ambient-occlusion-ground-attenuation");let C=y>0&&v>0,D=!0;const R=l.paint.get("building-vertical-scale");R<1&&(D=!1);const O=f.conflationActive&&f.style.isLayerClipped(l,r.getSource()),N=f.style.order.indexOf(l.fqid);if(function(k,B,H,U,q,$){for(const K of $){const ee=B.getTile(K).getBucket(H);ee&&(q&&ee.updateReplacement(K,k.replacementSource,U),ee.uploadUpdatedIndexBuffer(k.context))}}(f,r,l,N,O,p),function(k,B,H,U){for(const q of U){const $=B.getTile(q).getBucket(H);$&&$.needsEvaluation(k,H)&&($.evaluate(H),$.uploadUpdatedColorBuffer(k.context))}}(f,r,l,p),l.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),"shadow"===f.renderPass&&f.shadowRenderer){const k=f.shadowRenderer,B=[],H=k.getShadowPassDepthMode();ta({painter:f,source:r,layer:l,coords:p,defines:B,blendMode:k.getShadowPassColorMode(),depthMode:H,verticalScale:R})}else if("translucent"===f.renderPass){C&&function(U,q,$,K,ee,ne,le,de,pe,ae,ce,ue,Me){const ve=U.context.gl,Ue=U.depthModeForSublayer(1,wt.ReadOnly,ve.LEQUAL,!0),ke=.1*(1-(Ge=ce))+3*Ge;var Ge;const rt=U._showOverdrawInspector,Ce=ue,_e=new pl;rt||qo(_e,U,q,$,K,Ue,new Vt({func:ve.ALWAYS,mask:255},255,255,ve.KEEP,ve.KEEP,ve.REPLACE),new ln([ve.ONE,ve.ONE,ve.ONE,ve.ONE],d.am.transparent,[!1,!1,!1,!0],ve.MIN),Bt.disabled,true,"sdf",1,le,de,0,ae,ke,Ce,!1);{const Ne=rt?Vt.disabled:new Vt({func:ve.EQUAL,mask:255},255,255,ve.KEEP,ve.DECR,ve.DECR),Re=rt?U.colorModeForRenderPass():new ln([ve.ONE_MINUS_DST_ALPHA,ve.DST_ALPHA,ve.ONE,ve.ONE],d.am.transparent,[!0,!0,!0,!0]);qo(_e,U,q,$,K,Ue,Ne,Re,Bt.disabled,true,"color",1,le,de,0,ae,ke,Ce,!1)}}(f,r,l,p,0,0,y,v,0,[0,0,0],b,O);let k=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];D&&(k=k.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer.useNormalOffset&&(k=k.concat("NORMAL_OFFSET"));const B=new wt(f.context.gl.LEQUAL,wt.ReadWrite,f.depthRangeFor3D),H=f.colorModeForRenderPass();ta({painter:f,source:r,layer:l,coords:p,defines:k,blendMode:H,depthMode:B,verticalScale:R})}else if("light-beam"===f.renderPass){const k=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],B=new wt(f.context.gl.LEQUAL,wt.ReadOnly,f.depthRangeFor3D);ta({painter:f,source:r,layer:l,coords:p,defines:k,blendMode:ln.alphaBlended,depthMode:B,verticalScale:R})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,r,l,p){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass||f.style.disableElevatedTerrain)return;const y=f.context,v=f.terrain&&f.terrain.renderingToTexture,[b,C]="translucent"!==f.renderPass||v?[{},p]:f.stencilConfigForOverlap(p);for(const D of C){const R=r.getTile(D);if(R.needsHillshadePrepare&&"offscreen"===f.renderPass)lm(f,R,l);else if("translucent"===f.renderPass){const O=f.depthModeForSublayer(0,wt.ReadOnly),N=l.paint.get("hillshade-emissive-strength"),k=f.colorModeForDrapableLayerRenderPass(N),B=v&&f.terrain?f.terrain.stencilModeForRTTOverlap(D):b[D.overscaledZ];Hs(f,D,R,l,O,B,k)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,r,l,p,y,v){if("translucent"!==f.renderPass||0===l.paint.get("raster-opacity"))return;const b="globe"===f.transform.projection.name,C=0!==l.paint.get("raster-elevation"),D=C&&b;if(f.renderElevatedRasterBackface&&!D)return;const R=f.context,O=R.gl,N=r.getSource(),k=function(de,pe,ae,ce){const ue=pe.paint.get("raster-color"),Me="raster-array"===de.type,ve=[],Ue=pe.paint.get("raster-resampling"),ke=pe.paint.get("raster-color-mix");let Ge=pe.paint.get("raster-color-range");const rt=[ke[0],ke[1],ke[2],0],Ce=ke[3];let _e="nearest"===Ue?ce.NEAREST:ce.LINEAR;if(Me&&(ve.push("RASTER_ARRAY"),ue||ve.push("RASTER_COLOR"),"linear"===Ue&&ve.push("RASTER_ARRAY_LINEAR"),_e=ce.NEAREST,!Ge&&de.rasterLayers)){const Ne=de.rasterLayers.find(({id:Re})=>Re===pe.sourceLayer);Ne&&Ne.fields&&Ne.fields.range&&(Ge=Ne.fields.range)}if(Ge=Ge||[0,1],ue){ve.push("RASTER_COLOR"),ae.activeTexture.set(ce.TEXTURE2),pe.updateColorRamp(Ge);let Ne=pe.colorRampTexture;Ne||(Ne=pe.colorRampTexture=new d.T(ae,pe.colorRamp,ce.RGBA8)),Ne.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}return{mix:rt,range:Ge,offset:Ce,defines:ve,resampling:_e}}(N,l,R,O);if(N instanceof d.aP&&!p.length&&!b)return;const B=l.paint.get("raster-emissive-strength"),H=f.colorModeForDrapableLayerRenderPass(B),U=f.terrain&&f.terrain.renderingToTexture,q=!f.options.moving,$="nearest"===l.paint.get("raster-resampling")?O.NEAREST:O.LINEAR;if(N instanceof d.aP&&!p.length&&(N.onNorthPole||N.onSouthPole)){const de=C?f.stencilModeFor3D():Vt.disabled;return void Vf(!!N.onNorthPole,null,f,r,l,B,k,Bt.disabled,de)}if(!p.length)return;const[K,ee]=N instanceof d.aP||U?[{},p]:f.stencilConfigForOverlap(p),ne=ee[ee.length-1].overscaledZ;D&&k.defines.push("PROJECTION_GLOBE_VIEW"),C&&k.defines.push("RENDER_CUTOFF");const le=(de,pe,ae)=>{for(const ce of de){const ue=ce.toUnwrapped(),Me=r.getTile(ce);if(U&&(!Me||!Me.hasData()))continue;R.activeTexture.set(O.TEXTURE0);const ve=x_(Me,N,l,k);if(!ve||!ve.texture)continue;const{texture:Ue,mix:ke,offset:Ge,tileSize:rt,buffer:Ce}=ve;let _e,Ne;U?(_e=wt.disabled,Ne=ce.projMatrix):C?(_e=new wt(O.LEQUAL,wt.ReadWrite,f.depthRangeFor3D),Ne=b?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(ue,q)):(_e=f.depthModeForSublayer(ce.overscaledZ-ne,1===l.paint.get("raster-opacity")?wt.ReadWrite:wt.ReadOnly,O.LESS),Ne=f.transform.calculateProjMatrix(ue,q));const Re=f.terrain&&U?f.terrain.stencilModeForRTTOverlap(ce):K[ce.overscaledZ],We=v?0:l.paint.get("raster-fade-duration");Me.registerFadeDuration(We);const Ze=r.findLoadedParent(ce,0),Ye=cs(Me,Ze,r,f.transform,We);let dt,Pt;f.terrain&&f.terrain.prepareDrawTile(),R.activeTexture.set(O.TEXTURE0),Ue.bind($,O.CLAMP_TO_EDGE),R.activeTexture.set(O.TEXTURE1),Ze?(Ze.texture&&Ze.texture.bind($,O.CLAMP_TO_EDGE),dt=Math.pow(2,Ze.tileID.overscaledZ-Me.tileID.overscaledZ),Pt=[Me.tileID.canonical.x*dt%1,Me.tileID.canonical.y*dt%1]):Ue.bind($,O.CLAMP_TO_EDGE),"useMipmap"in Ue&&R.extTextureFilterAnisotropic&&f.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Ft=f.transform;let vt;const Ot=C?Nv(Ft):[0,0,0,0];let Rt,Xt,tn,gn,Dn,Jt=0;if(D&&N instanceof d.aP&&N.coordinates.length>3)Rt=Float32Array.from(d.bh(d.dD(new d.cA(0,0,0)))),Xt=Float32Array.from(Ft.globeMatrix),tn=Float32Array.from(d.dz(Ft)),gn=[d.aD(Ft.center.lng),d.aH(Ft.center.lat)],vt=N.elevatedGlobePerspectiveTransform,Dn=N.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){const dn=d.dA(ce.canonical);Jt=d.dB(dn.getCenter().lat),Rt=Float32Array.from(d.bh(d.dD(ce.canonical))),Xt=Float32Array.from(Ft.globeMatrix),tn=Float32Array.from(d.dz(Ft)),gn=[d.aD(Ft.center.lng),d.aH(Ft.center.lat)],vt=[0,0],Dn=Float32Array.from(d.dC(ce.canonical,dn,Jt,Ft.worldSize/Ft._pixelsPerMercatorPixel))}else vt=N instanceof d.aP?N.perspectiveTransform:[0,0],Rt=new Float32Array(16),Xt=new Float32Array(9),tn=new Float32Array(16),gn=[0,0],Dn=new Float32Array(9);const Mn=Rf(Ne,Rt,Xt,tn,Dn,Pt||[0,0],d.ah(f.transform.zoom),gn,Ot,dt||1,Ye,l,vt,C?l.paint.get("raster-elevation"):0,2,ke,Ge,k.range,rt,Ce,B),Fn=f.isTileAffectedByFog(ce),ni=f.getOrCreateProgram("raster",{defines:k.defines,overrideFog:Fn});if(f.uploadCommonUniforms(R,ni,ue),N instanceof d.aP){const dn=N.elevatedGlobeVertexBuffer,Ln=N.elevatedGlobeIndexBuffer;if(U||!b)N.boundsBuffer&&N.boundsSegments&&ni.draw(f,O.TRIANGLES,_e,Vt.disabled,H,Bt.disabled,Mn,l.id,N.boundsBuffer,f.quadTriangleIndexBuffer,N.boundsSegments);else if(dn&&Ln){const zn=Ft.zoom<=d.cX?N.elevatedGlobeSegments:N.getSegmentsForLongitude(Ft.center.lng);zn&&ni.draw(f,O.TRIANGLES,_e,Vt.disabled,H,pe,Mn,l.id,dn,Ln,zn)}}else if(D){_e=new wt(O.LEQUAL,wt.ReadOnly,f.depthRangeFor3D);const dn=f.globeSharedBuffers;if(dn){const[Ln,zn,In]=dn.getGridBuffers(Jt,!1);ni.draw(f,O.TRIANGLES,_e,ae||Re,f.colorModeForRenderPass(),pe,Mn,l.id,Ln,zn,In)}}else{const{tileBoundsBuffer:dn,tileBoundsIndexBuffer:Ln,tileBoundsSegments:zn}=f.getTileBoundsBuffers(Me);ni.draw(f,O.TRIANGLES,_e,Re,H,Bt.disabled,Mn,l.id,dn,Ln,zn)}}if(!(N instanceof d.aP)&&D)for(const ce of de){const ue=ce.canonical.y===(1<<ce.canonical.z)-1;0===ce.canonical.y&&Vf(!0,ce,f,r,l,B,k,pe,ae||Vt.disabled),ue&&Vf(!1,ce,f,r,l,B,k,pe===Bt.frontCW?Bt.backCW:Bt.frontCW,ae||Vt.disabled)}};D?le(ee,f.renderElevatedRasterBackface?Bt.backCW:Bt.frontCW,f.stencilModeFor3D()):le(ee,Bt.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,r,l,p,y,v){"offscreen"===f.renderPass&&function(b,C,D,R){if(!R.length)return;const O=b.context,N=O.gl,k=C.getSource();if(!(k instanceof Hl))return;const B=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count")));let H=D.particlePositionRGBAImage;if(!H||H.width!==B){const ee=function(ne){const le=ne*ne,de=new Uint8Array(4*le),pe=function(ce){return ce|=0,ce=Math.imul(2747636419^ce,2654435769),ce=Math.imul(ce^ce>>>16,2654435769),((ce=Math.imul(ce^ce>>>16,2654435769))>>>0)/4294967296},ae=1/1.1;for(let ce=0;ce<le;ce++){const ue=ae*(pe(2*ce+0)+hl),Me=ae*(pe(2*ce+1)+hl),ve=255*ue%1,Ue=255*Me%1,ke=ve,Ge=Me-Ue/255,rt=Ue;de[4*ce+0]=255*(ue-ve/255),de[4*ce+1]=255*ke,de[4*ce+2]=255*Ge,de[4*ce+3]=255*rt}return de}(B);H=D.particlePositionRGBAImage=new d.r({width:B,height:B},ee)}let U=D.particleFramebuffer;U?U.width!==B&&(U.destroy(),U=D.particleFramebuffer=O.createFramebuffer(B,B,!0,null)):U=D.particleFramebuffer=O.createFramebuffer(B,B,!0,null);const q=[];for(const ee of R){const ne=C.getTile(ee);if(!(ne instanceof Ki))continue;const le=To(ne,k,D);if(!le)continue;const de=[ne.tileSize,ne.tileSize];let pe=D.tileFramebuffer;pe||(pe=D.tileFramebuffer=O.createFramebuffer(de[0],de[1],!0,null));let ae=ne.rasterParticleState;ae||(ae=ne.rasterParticleState=new xm(O,ee,de,H));const ce=ae.update(D.lastInvalidatedAt);ae.particleTextureDimension!==B&&ae.updateParticleTexture(ee,H);const ue=ae.targetColorTexture;ae.targetColorTexture=ae.backgroundColorTexture,ae.backgroundColorTexture=ue;const Me=ae.particleTexture0;ae.particleTexture0=ae.particleTexture1,ae.particleTexture1=Me,q.push([ee,le,ae,ce])}if(0===q.length)return;const $=d.q.now(),K=D.previousDrawTimestamp?.001*($-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=$,D.hasColorMap()){O.activeTexture.set(N.TEXTURE0+2);let ee=D.colorRampTexture;ee||(ee=D.colorRampTexture=new d.T(O,D.colorRamp,N.RGBA8)),ee.bind(N.LINEAR,N.CLAMP_TO_EDGE)}O.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(ee,ne,le){const de=ee.context,pe=de.gl,ae=ne.tileFramebuffer;de.activeTexture.set(pe.TEXTURE0);const ce={u_texture:0,u_opacity:1.05*(Me=ne.paint.get("raster-particle-fade-opacity-factor"))/(Me+.05)},ue=ee.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Me;for(const ve of le){const[,,Ue,ke]=ve;ae.colorAttachment.set(Ue.targetColorTexture.texture),de.viewport.set([0,0,ae.width,ae.height]),de.clear({color:d.am.transparent}),ke&&(Ue.backgroundColorTexture.bind(pe.NEAREST,pe.CLAMP_TO_EDGE),ue.draw(ee,pe.TRIANGLES,wt.disabled,Vt.disabled,ln.alphaBlended,Bt.disabled,ce,ne.id,ee.viewportBuffer,ee.quadTriangleIndexBuffer,ee.viewportSegments))}}(b,D,q),function(ee,ne,le,de){const pe=ee.context,ae=pe.gl,ce=le.tileFramebuffer,ue="globe"===ee.transform.projection.name,Me=le.paint.get("raster-particle-max-speed");for(const ve of de){const[Ue,ke,Ge]=ve;pe.activeTexture.set(ae.TEXTURE0+0),ke.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),ce.colorAttachment.set(Ge.targetColorTexture.texture);const rt=ee.getOrCreateProgram("rasterParticleDraw",{defines:ke.defines,overrideFog:!1});pe.activeTexture.set(ae.TEXTURE0+1);const Ce=ke.scalarData?[]:[0,1,2,3].map(Re=>d.e3[Re](Ue));Ce.push(Ue);const _e=Ue.canonical.x,Ne=Ue.canonical.y;for(const Re of Ce){const We=ne.getTile(ue?Re.wrapped():Re);if(!We)continue;const Ze=We.rasterParticleState;if(!Ze)continue;const Ye=Re.canonical.x+(1<<Re.canonical.z)*(Re.wrap-Ue.wrap),dt=Re.canonical.y;Ze.particleTexture0.bind(ae.NEAREST,ae.CLAMP_TO_EDGE);const Pt=gm(1,Ze.particleTexture0.size[0],[Ye-_e,dt-Ne],0,ke.texture.size,2,Me,ke.textureOffset,ke.scale,ke.offset);rt.draw(ee,ae.POINTS,wt.disabled,Vt.disabled,ln.alphaBlended,Bt.disabled,Pt,le.id,Ze.particleIndexBuffer,void 0,Ze.particleSegment)}}}(b,C,D,q),O.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(ee,ne,le,de){const pe=ee.context,ae=pe.gl,ce=ne.paint.get("raster-particle-max-speed"),ue=de*ne.paint.get("raster-particle-speed-factor")*.15,Me=(Ue=.01+1*ne.paint.get("raster-particle-reset-rate-factor"),Math.pow(Ue,6)),ve=ne.particleFramebuffer;var Ue;pe.viewport.set([0,0,ve.width,ve.height]);for(const Ue of le){const[,ke,Ge]=Ue;pe.activeTexture.set(ae.TEXTURE0+0),ke.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),pe.activeTexture.set(ae.TEXTURE0+1);const rt=Ge.particleTexture0;rt.bind(ae.NEAREST,ae.CLAMP_TO_EDGE);const Ce=Of(1,rt.size[0],0,ke.texture.size,ce,ue,Me,ke.textureOffset,ke.scale,ke.offset);ve.colorAttachment.set(Ge.particleTexture1.texture),pe.clear({color:d.am.transparent}),ee.getOrCreateProgram("rasterParticleUpdate",{defines:ke.defines}).draw(ee,ae.TRIANGLES,wt.disabled,Vt.disabled,ln.unblended,Bt.disabled,Ce,ne.id,ee.viewportBuffer,ee.quadTriangleIndexBuffer,ee.viewportSegments)}}(b,D,q,K)}(f,r,l,p),"translucent"===f.renderPass&&(function(b,C,D,R,O){const N=b.context,k=N.gl,B=C.getSource().tileSize,H=5*(1-d.af(d.cI,d.cI+1,b.transform.zoom))*B+D.paint.get("raster-particle-elevation"),U=!b.options.moving,q="globe"===b.transform.projection.name;if(!R.length)return;const[$,K]=b.stencilConfigForOverlap(R),ee=[];q&&ee.push("PROJECTION_GLOBE_VIEW");const ne=b.stencilModeFor3D();for(const le of K){const de=le.toUnwrapped(),pe=C.getTile(le);if(!pe.rasterParticleState)continue;const ae=pe.rasterParticleState,ce=100;pe.registerFadeDuration(ce);const ue=C.findLoadedParent(le,0),Me=cs(pe,ue,C,b.transform,ce);let ve,Ue;b.terrain&&b.terrain.prepareDrawTile(),N.activeTexture.set(k.TEXTURE0),ae.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),N.activeTexture.set(k.TEXTURE1),ue&&ue.rasterParticleState?(ue.rasterParticleState.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ve=Math.pow(2,ue.tileID.overscaledZ-pe.tileID.overscaledZ),Ue=[pe.tileID.canonical.x*ve%1,pe.tileID.canonical.y*ve%1]):ae.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const ke=q?Float32Array.from(b.transform.expandedFarZProjMatrix):b.transform.calculateProjMatrix(de,U),Ge=b.transform,rt=ic(Ge),Ce=d.dA(le.canonical),_e=d.dB(Ce.getCenter().lat);let Ne,Re,We,Ze,Ye;q?(Ne=Float32Array.from(d.bh(d.dD(le.canonical))),Re=Float32Array.from(Ge.globeMatrix),We=Float32Array.from(d.dz(Ge)),Ze=[d.aD(Ge.center.lng),d.aH(Ge.center.lat)],Ye=Float32Array.from(d.dC(le.canonical,Ce,_e,Ge.worldSize/Ge._pixelsPerMercatorPixel))):(Ne=new Float32Array(16),Re=new Float32Array(9),We=new Float32Array(16),Ze=[0,0],Ye=new Float32Array(9));const dt=Xu(ke,Ne,Re,We,Ye,Ue||[0,0],d.ah(b.transform.zoom),Ze,rt,ve||1,Me,H),Pt=b.isTileAffectedByFog(le),Ft=b.getOrCreateProgram("rasterParticle",{defines:ee,overrideFog:Pt});if(b.uploadCommonUniforms(N,Ft,de),q){const vt=new wt(k.LEQUAL,wt.ReadOnly,b.depthRangeFor3D),Ot=0,Rt=b.globeSharedBuffers;if(Rt){const[Xt,tn,gn]=Rt.getGridBuffers(_e,0!==Ot);Ft.draw(b,k.TRIANGLES,vt,ne,ln.alphaBlended,b.renderElevatedRasterBackface?Bt.frontCCW:Bt.backCCW,dt,D.id,Xt,tn,gn)}}else{const vt=b.depthModeForSublayer(0,wt.ReadOnly),Ot=$[le.overscaledZ],{tileBoundsBuffer:Rt,tileBoundsIndexBuffer:Xt,tileBoundsSegments:tn}=b.getTileBoundsBuffers(pe);Ft.draw(b,k.TRIANGLES,vt,Ot,ln.alphaBlended,Bt.disabled,dt,D.id,Rt,Xt,tn)}}b.resetStencilClippingMasks()}(f,r,l,p),f.style.map.triggerRepaint())},background:function(f,r,l,p){const y=l.paint.get("background-color"),v="none"===l.paint.get("background-color-use-theme").constantOr("default"),b=l.paint.get("background-opacity"),C=l.paint.get("background-emissive-strength"),D="viewport"===l.paint.get("background-pitch-alignment");if(0===b)return;const R=f.context,O=R.gl,N=f.transform,k=N.tileSize,B=l.paint.get("background-pattern");let H;if(void 0!==B&&(null===B||(H=f.imageManager.getPattern(d.I.from(B.toString()),l.scope,f.style.getLut(l.scope)),!H)))return;const U=!B&&1===y.a&&1===b&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==U)return;const q=Vt.disabled,$=f.depthModeForSublayer(0,"opaque"===U?wt.ReadWrite:wt.ReadOnly),K=f.colorModeForDrapableLayerRenderPass(C),ee=B?"backgroundPattern":"background";let ne,le=p;if(le||(ne=f.getBackgroundTiles(),le=Object.values(ne).map(de=>de.tileID)),B&&(R.activeTexture.set(O.TEXTURE0),f.imageManager.bind(f.context,l.scope)),D){const de=f.getOrCreateProgram(ee,{overrideFog:!1,overrideRtt:!0}),pe=new Float32Array(d.bx([])),ae=new d.aM(0,0,0,0,0),ce=B?kf(pe,C,b,f,0,l.scope,H,D,{tileID:ae,tileSize:k}):_m(pe,C,b,y.toPremultipliedRenderColor(v?null:l.lut));de.draw(f,O.TRIANGLES,$,q,K,Bt.disabled,ce,l.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const de of le){const pe=f.isTileAffectedByFog(de),ae=f.getOrCreateProgram(ee,{overrideFog:pe}),ce=de.toUnwrapped(),ue=p?de.projMatrix:f.transform.calculateProjMatrix(ce);f.prepareDrawTile();const Me=r?r.getTile(de):ne?ne[de.key]:new Dc(de,k,N.zoom,f),ve=B?kf(ue,C,b,f,0,l.scope,H,D,{tileID:de,tileSize:k}):_m(ue,C,b,y.toPremultipliedRenderColor(v?null:l.lut));f.uploadCommonUniforms(R,ae,ce);const{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:ke,tileBoundsSegments:Ge}=f.getTileBoundsBuffers(Me);ae.draw(f,O.TRIANGLES,$,q,K,Bt.disabled,ve,l.id,Ue,ke,Ge)}},sky:function(f,r,l){const p=f._atmosphere?d.ah(f.transform.zoom):1,y=l.paint.get("sky-opacity")*p;if(0===y)return;const v=f.context,b=l.paint.get("sky-type"),C=new wt(v.gl.LEQUAL,wt.ReadOnly,[0,1]),D=f.frameCounter/1e3%1;"atmosphere"===b?"offscreen"===f.renderPass?l.needsSkyboxCapture(f)&&(function(R,O,N,k){const B=R.context,H=B.gl;let U=O.skyboxFbo;if(!U){U=O.skyboxFbo=B.createFramebuffer(32,32,!0,null),O.skyboxGeometry=new Xc(B),O.skyboxTexture=B.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,O.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let ee=0;ee<6;++ee)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}B.bindFramebuffer.set(U.framebuffer),B.viewport.set([0,0,32,32]);const q=O.getCenter(R,!0),$=R.getOrCreateProgram("skyboxCapture"),K=new Float64Array(16);d.bx(K),d.eh(K,K,.5*-Math.PI),Co(R,O,$,K,q,0),d.bx(K),d.eh(K,K,.5*Math.PI),Co(R,O,$,K,q,1),d.bx(K),d.cR(K,K,.5*-Math.PI),Co(R,O,$,K,q,2),d.bx(K),d.cR(K,K,.5*Math.PI),Co(R,O,$,K,q,3),d.bx(K),Co(R,O,$,K,q,4),d.bx(K),d.eh(K,K,Math.PI),Co(R,O,$,K,q,5),B.viewport.set([0,0,R.width,R.height])}(f,l),l.markSkyboxValid(f)):"sky"===f.renderPass&&function(R,O,N,k,B){const H=R.context,U=H.gl,q=R.transform,$=R.getOrCreateProgram("skybox");H.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_CUBE_MAP,O.skyboxTexture);const K={u_matrix:q.skyboxMatrix,u_sun_direction:O.getCenter(R,!1),u_cubemap:0,u_opacity:k,u_temporal_offset:B};R.uploadCommonUniforms(H,$),$.draw(R,U.TRIANGLES,N,Vt.disabled,R.colorModeForRenderPass(),Bt.backCW,K,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(f,l,C,y,D):"gradient"===b&&"sky"===f.renderPass&&function(R,O,N,k,B){const H=R.context,U=H.gl,q=R.transform,$=R.getOrCreateProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new Xc(H)),H.activeTexture.set(U.TEXTURE0);let K=O.colorRampTexture;K||(K=O.colorRampTexture=new d.T(H,O.colorRamp,U.RGBA8)),K.bind(U.LINEAR,U.CLAMP_TO_EDGE);const ee=(ne=q.skyboxMatrix,le=O.getCenter(R,!1),de=O.paint.get("sky-gradient-radius"),pe=k,ae=B,{u_matrix:ne,u_color_ramp:0,u_center_direction:le,u_radius:d.al(de),u_opacity:pe,u_temporal_offset:ae});var ne,le,de,pe,ae;R.uploadCommonUniforms(H,$),$.draw(R,U.TRIANGLES,N,Vt.disabled,R.colorModeForRenderPass(),Bt.backCW,ee,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(f,l,C,y,D)},custom:function(f,r,l,p){const y=f.context,v=l.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||"offscreen"===f.renderPass)&&l.isDraped(r)){if("offscreen"===f.renderPass){const b=v.prerender;if(b){if(f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),"globe"===f.transform.projection.name){const C=f.transform.pointMerc;b.call(v,y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),d.ah(f.transform.zoom),[C.x,C.y],f.transform.pixelsPerMeterRatio)}else b.call(v,y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState()}}else if("translucent"===f.renderPass){if(f.terrain&&f.terrain.renderingToTexture){const C=v.renderToTile;if(C){const D=p[0].canonical,R={x:D.x+p[0].wrap*(v.wrapTileId?0:1<<D.z),y:D.y,z:D.z};y.setDepthMode(wt.disabled),y.setStencilMode(Vt.disabled),y.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),C.call(v,y.gl,R),y.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),y.setStencilMode(Vt.disabled);const b="3d"===v.renderingMode?new wt(f.context.gl.LEQUAL,wt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,wt.ReadOnly);if(y.setDepthMode(b),"globe"===f.transform.projection.name){const C=f.transform.pointMerc;v.render(y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),d.ah(f.transform.zoom),[C.x,C.y],f.transform.pixelsPerMeterRatio)}else v.render(y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState(),y.bindFramebuffer.set(null)}}else d.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,r,l,p){if("opaque"===f.renderPass)return;const y=l.paint.get("model-opacity").constantOr(1);if(0===y)return;const v=l.paint.get("model-cast-shadows");if("shadow"===f.renderPass&&(!v||f.terrain&&y<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof d.ab))return;const b=f.shadowRenderer,C=l.paint.get("model-receive-shadows");b&&(b.useNormalOffset=!0,C||(b.enabled=!1));const D=()=>{b&&(b.useNormalOffset=!0,C||(b.enabled=!0))},R=r.getSource();if("light-beam"===f.renderPass&&"batched-model"!==R.type)return;if("vector"===R.type||"geojson"===R.type)return function($,K,ee,ne,le){const de=$.transform;if("mercator"!==de.projection.name)return void d.w(`Drawing 3D models for ${de.projection.name} projection is not yet implemented`);const pe=de.getFreeCameraOptions().position;if(!$.modelManager)return;const ae=$.modelManager;ee.modelManager=ae;const ce=$.shadowRenderer;if(!ee._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ue=ee._unevaluatedLayout._values["model-id"],Me=Object.assign({},ee.layout.get("model-id").parameters),ve=$.style.order.indexOf(ee.fqid);for(const Ue of ne){const ke=K.getTile(Ue).getBucket(ee);if(!ke||ke.projection.name!==de.projection.name)continue;const Ge=ke.getModelUris();Ge&&!ke.modelsRequested&&(ae.addModelsFromBucket(Ge,le),ke.modelsRequested=!0);const rt=ed(Ue,de);Me.zoom=rt;const Ce=ue.possiblyEvaluate(Me);if(Qu($,ke,Ue),ya.shadowUniformsInitialized=!1,ya.useSingleShadowCascade=!!ce&&0===ce.getMaxCascadeForTile(Ue.toUnwrapped()),"shadow"===$.renderPass&&ce){if(1===$.currentShadowCascade&&ke.isInsideFirstShadowMapFrustum)continue;const Re=de.calculatePosMatrix(Ue.toUnwrapped(),de.worldSize);if(ya.tileMatrix.set(Re),ya.shadowTileMatrix=Float32Array.from(ce.calculateShadowPassMatrixFromMatrix(Re)),ya.aabb.min.fill(0),ya.aabb.max[0]=ya.aabb.max[1]=d.aj,ya.aabb.max[2]=0,Em(ke,ya,$,ee.scope))continue}const _e=1<<Ue.canonical.z,Ne=[((pe.x-Ue.wrap)*_e-Ue.canonical.x)*d.aj,(pe.y*_e-Ue.canonical.y)*d.aj,pe.z*_e*d.aj];$.conflationActive&&Object.keys(ke.instancesPerModel).length>0&&$.style.isLayerClipped(ee,K.getSource())&&ke.updateReplacement(Ue,$.replacementSource,ve,le)&&(ke.uploaded=!1,ke.upload($.context));for(let Re in ke.instancesPerModel){const We=ke.instancesPerModel[Re];We.features.length>0&&(Re=Ce.evaluate(We.features[0].feature,{}));const Ze=ae.getModel(Re,le);if(Ze||ae.hasURLBeenRequested(Re)||ke.modelUris.includes(Re)||(ke.modelUris.push(Re),ke.modelsRequested=!1),Ze&&Ze.uploaded)for(const Ye of Ze.nodes)wm($,ee,Ye,We,Ne,Ue,ya)}}}(f,r,l,p,"vector"===R.type?l.scope:""),void D();if(!R.loaded())return;if("batched-model"===R.type)return function($,K,ee,ne){ee.resetLayerRenderingStats($);const le=$.context,de=$.transform,pe=$.style.fog,ae=$.shadowRenderer;if("mercator"!==de.projection.name)return void d.w(`Drawing 3D landmark models for ${de.projection.name} projection is not yet implemented`);const ce=$.transform.getFreeCameraOptions().position,ue=d.c1([],[ce.x,ce.y,ce.z],$.transform.worldSize),Me=d.eq([],ue),ve=d.bx([]),Ue=d.e9(de.center.lat,de.zoom),ke=d.bn([],[1,1,1/Ue]);d.bo(ve,ve,Me);const Ge=ee.paint.get("model-opacity").constantOr(1),rt=new wt(le.gl.LEQUAL,wt.ReadWrite,$.depthRangeFor3D),Ce=new wt(le.gl.LEQUAL,wt.ReadOnly,$.depthRangeFor3D),_e=new d.d6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ne="shadow"===$.renderPass,Re=Ne&&ae?ae.getCurrentCascadeFrustum():de.getFrustum(de.scaleZoom(de.worldSize)),We=ee.paint.get("model-front-cutoff"),Ze=We[2]<1,Ye=xo($,ee.paint.get("model-cutoff-fade-range")),dt=ee.getLayerRenderingStats();(function(Pt,Ft,vt,Ot){const Rt=Pt.terrain?Pt.terrain.exaggeration():0,Xt=Pt.transform.zoom;for(const tn of Ot){const gn=Ft.getTile(tn).getBucket(vt);gn&&(gn.setFilter(vt.filter),Pt.conflationActive&&gn.updateReplacement(tn,Pt.replacementSource),gn.evaluateTransform(Pt,vt),Pt.terrain&&Rt>0&&gn.elevationUpdate(Pt.terrain,Rt,tn,vt.source),gn.needsReEvaluation(Pt,Xt,vt)&&gn.evaluate(vt))}})($,K,ee,ne),function(){let Pt,Ft,vt;Ze?(Pt=ne.length-1,Ft=-1,vt=-1):(Pt=0,Ft=ne.length,vt=1);const Ot=new Float64Array(16),Rt=d.cx(),Xt=new d.P(0,0);for(let tn=Pt;tn!==Ft;tn+=vt){const gn=ne[tn],Dn=K.getTile(gn).getBucket(ee);if(!Dn||!Dn.uploaded)continue;let Jt=!1;ae&&(Jt=0===ae.getMaxCascadeForTile(gn.toUnwrapped()));const Mn=de.calculatePosMatrix(gn.toUnwrapped(),de.worldSize),Fn=Dn.modelTraits;!Ne&&Ze&&(d.bi(Ot,Mn),d.ad(Rt,ue,Ot),Xt.x=Rt[0],Xt.y=Rt[1]);const ni=[];Dn.setFilter(ee.filter);for(const dn of Dn.getNodesInfo()){if(dn.hiddenByReplacement||!dn.node.meshes)continue;const Ln=dn.node;let zn=0;$.terrain&&Ln.elevation&&(zn=Ln.elevation*$.terrain.exaggeration());const In=(()=>{const qr=dn.aabb;return _e.min=[...qr.min],_e.max=[...qr.max],_e.min[2]+=zn,_e.max[2]+=zn,d.ad(_e.min,_e.min,Mn),d.ad(_e.max,_e.max,Mn),_e})(),an=dn.evaluatedScale;if(an[0]<=1&&an[1]<=1&&an[2]<=1&&0===In.intersects(Re))continue;if(!Ne&&Ze){const qr=.16666666666666666;dn.cameraCollisionOpacity=ue[0]>In.min[0]&&ue[0]<In.max[0]&&ue[1]>In.min[1]&&ue[1]<In.max[1]&&ue[2]*Ue<In.max[2]&&Ln.footprint&&d.bY(Xt,Ln.footprint)?Math.max(dn.cameraCollisionOpacity-qr,0):Math.min(1,dn.cameraCollisionOpacity+qr)}const ii=[...Mn],qn=1/d.d4(gn.canonical),Ni=Ln.anchor?Ln.anchor[0]:0,Pn=Ln.anchor?Ln.anchor[1]:0;d.bo(ii,ii,[Ni*(an[0]-1)+dn.evaluatedTranslation[0]*qn,Pn*(an[1]-1)+dn.evaluatedTranslation[1]*qn,zn+dn.evaluatedTranslation[2]]),d.cn(an,d.es)||d.cP(ii,ii,an);const Zn=d.az([],ii,Ln.matrix),hi=d.az([],de.expandedFarZProjMatrix,Zn),xr=d.az([],de.expandedFarZProjMatrix,ii),fr=d.aA([],[Ni,Pn,zn,1],hi)[2];Ln.hidden=!1;let or=Ge;Ne||(Ze&&(or*=dn.cameraCollisionOpacity,or*=T_(ii,de,dn.aabb,We)),or*=E_(Ye,fr)),0!==or?ni.push({nodeInfo:dn,depth:fr,opacity:or,wvpForNode:hi,wvpForTile:xr,nodeModelMatrix:Zn,tileModelMatrix:ii}):Ln.hidden=!0}Ne||ni.sort((dn,Ln)=>!Ze||1===dn.opacity&&1===Ln.opacity?dn.depth<Ln.depth?-1:1:1===dn.opacity?-1:1===Ln.opacity?1:dn.depth>Ln.depth?-1:1);for(const dn of ni){const Ln=dn.nodeInfo,zn=Ln.node;let In=d.az([],ke,dn.tileModelMatrix);d.az(In,ve,In);const an=d.bi([],In);d.ea(an,an),d.cP(an,an,$f),In=d.az(In,In,zn.matrix);const ii="light-beam"===$.renderPass,qn="none"===ee.paint.get("model-color-use-theme").constantOr("default"),Ni=Fn&d.ex.HasMapboxMeshFeatures,Pn=Ni?0:Ln.evaluatedRMEA[0][2];for(let Zn=0;Zn<zn.meshes.length;++Zn){const hi=zn.meshes[Zn],xr=Zn===zn.lightMeshIndex;let fr=dn.wvpForNode;if(xr){if(!ii&&!$.terrain&&$.shadowRenderer){$.currentLayer<$.firstLightBeamLayer&&($.firstLightBeamLayer=$.currentLayer);continue}fr=dn.wvpForTile}else if(ii)continue;const or={defines:[]},qr=[];if(!Ne&&ae&&(ae.useNormalOffset=!!hi.normalBuffer),Ju(or.defines,qr,hi,$,qn?null:ee.lut),Ni||or.defines.push("DIFFUSE_SHADED"),Jt&&or.defines.push("SHADOWS_SINGLE_CASCADE"),dt&&(Ne?dt.numRenderedVerticesInShadowPass+=hi.vertexArray.length:dt.numRenderedVerticesInTransparentPass+=hi.vertexArray.length),Ne){Gf(hi,dn.nodeModelMatrix,$,ee);continue}let ba=null;if(pe){const Do=Sn(dn.nodeModelMatrix,$.transform);if(ba=new Float32Array(Do),"globe"!==de.projection.name){const Qi=hi.aabb.min,rr=hi.aabb.max,[Ei,Sr]=pe.getOpacityForBounds(Do,Qi[0],Qi[1],rr[0],rr[1]);or.overrideFog=Ei>=qe||Sr>=qe}}const No=hi.material;let qs;No.occlusionTexture&&No.occlusionTexture.offsetScale&&(qs=No.occlusionTexture.offsetScale,or.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const uo=$.getOrCreateProgram("model",or);!Ne&&ae&&ae.setupShadowsFromMatrix(dn.tileModelMatrix,uo,ae.useNormalOffset),$.uploadCommonUniforms(le,uo,null,ba);const ia=No.pbrMetallicRoughness;ia.metallicFactor=.9,ia.roughnessFactor=.5;const ra=$c(new Float32Array(fr),new Float32Array(In),new Float32Array(an),new Float32Array(zn.matrix),$,dn.opacity,ia.baseColorFactor,No.emissiveFactor,ia.metallicFactor,ia.roughnessFactor,No,Pn,ee,[0,0,0],qs);!xr&&(Ln.hasTranslucentParts||dn.opacity<1)&&uo.draw($,le.gl.TRIANGLES,rt,Vt.disabled,ln.disabled,Bt.backCCW,ra,ee.id,hi.vertexBuffer,hi.indexBuffer,hi.segments,ee.paint,$.transform.zoom,void 0,qr),uo.draw($,le.gl.TRIANGLES,xr?Ce:rt,Vt.disabled,xr||dn.opacity<1||Ln.hasTranslucentParts?ln.alphaBlended:ln.unblended,Bt.backCCW,ra,ee.id,hi.vertexBuffer,hi.indexBuffer,hi.segments,ee.paint,$.transform.zoom,void 0,qr)}}}}()}(f,r,l,p),void D();if("model"!==R.type)return;const O=R.getModels(),N=[],k=f.transform.getFreeCameraOptions().position,B=d.c1([],[k.x,k.y,k.z],f.transform.worldSize);d.eq(B,B);const H=[],U=[];let q=0;for(const $ of O){const K=l.paint.get("model-rotation").constantOr(null),ee=l.paint.get("model-scale").constantOr(null),ne=l.paint.get("model-translation").constantOr(null);$.computeModelMatrix(f,K,ee,ne,!0,!0,!1);const le=d.bx([]),de=d.e9($.position.lat,f.transform.zoom),pe=d.bn([],[1,1,1/de]);d.bo(le,le,B),N.push({zScaleMatrix:pe,negCameraPosMatrix:le});for(const ae of $.nodes)bm(f.transform,ae,$.matrix,f.transform.expandedFarZProjMatrix,q,H,U);q++}if(H.sort(($,K)=>K.depth-$.depth),"shadow"!==f.renderPass){if(1===y)for(const $ of U)_h($,f,l,N[$.modelIndex],Vt.disabled,f.colorModeForRenderPass());else{for(const $ of U)_h($,f,l,N[$.modelIndex],Vt.disabled,ln.disabled);for(const $ of U)_h($,f,l,N[$.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const $ of H)_h($,f,l,N[$.modelIndex],Vt.disabled,f.colorModeForRenderPass());D()}else{for(const $ of U)Gf($.mesh,$.nodeModelMatrix,f,l);for(const $ of H)Gf($.mesh,$.nodeModelMatrix,f,l);D()}}},na={line:function(f,r,l){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,void 0!==f._unevaluatedLayout.getValue("line-elevation-reference")||void 0!==f._unevaluatedLayout.getValue("line-z-offset")){if(r){const p=r.getVisibleCoordinates();for(const y of p){const v=r.getTile(y).getBucket(f);if(v&&("none"!==v.elevationType?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,r,l){const p=r.getSource();if(!p.loaded())return;if("vector"===p.type||"geojson"===p.type)return void(l.modelManager&&l.modelManager.upload(l,"vector"===p.type?f.scope:""));if("batched-model"===p.type||"model"!==p.type)return;const y=p.getModels();for(const v of y)v.upload(l.context)},raster:function(f,r,l){const p=r.getSource();if(!(p instanceof Hl&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const v=f.paint.get("raster-array-band")||p.getInitialBand(y);if(null==v)return;const b=r.getIds().map(C=>r.getTileByID(C));for(const C of b)C.updateNeeded(f.id,v)&&p.prepareTile(C,y,f.id,v)},"raster-particle":function(f,r,l){const p=r.getSource();if(!(p instanceof Hl&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const v=f.paint.get("raster-particle-array-band")||p.getInitialBand(y);if(null==v)return;const b=r.getIds().map(C=>r.getTileByID(C));for(const C of b)C.updateNeeded(f.id,v)&&p.prepareTile(C,y,f.id,v)}},Wf={fill:Et},Ds={fill:function(f,r,l,p){if(!l.layout||"none"===l.layout.get("fill-elevation-reference"))return;const y=f.context.gl,v=new wt(y.LEQUAL,wt.ReadOnly,f.depthRangeFor3D),b=new Vt({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),C=f.transform.getFreeCameraOptions().position,D=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const R of p){const O=r.getTile(R),N=O.getBucket(l);if(!N)continue;const k=N.elevatedStructures;if(!k||0===k.depthSegments.segments[0].primitiveLength)continue;const B=Ku(R.toUnwrapped(),C),H=f.translatePosMatrix(R.projMatrix,O,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),U=mm(H,B,0,1,0);D.draw(f,y.TRIANGLES,v,b,ln.disabled,Bt.disabled,U,l.id,k.vertexBuffer,k.indexBuffer,k.depthSegments,l.paint,f.transform.zoom)}}};class sc{constructor(r,l,p,y,v,b){this.context=new Ff(r,l),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=d.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const C=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const R of C)this._debugParams.enabledLayers[R]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const R of C)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],R);this.occlusionParams=new td(v),this.setup(),this.numSublayers=Ro.maxUnderzooming+Ro.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new d.eE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new qi(this),this._wireframeDebugCache=new bi,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const D=new d.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new d.T(this.context,D,r.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=b}updateTerrain(r,l){const p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Pf(this,r));const y=this._terrain;this.transform.elevation=p?y:null,y.update(r,this.transform,l),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(r){const l=r.fog;if(!l||"globe"===this.transform.projection.name||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,y]=l.getFovAdjustedRange(this.transform._fov);if(p>y)return void(this.transform.fogCullDistSq=null);const v=p+.78*(y-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new Pf(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,l){if(this.width=r*d.q.devicePixelRatio,this.height=l*d.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const r=this.context,l=new d.ba;l.emplaceBack(0,0),l.emplaceBack(d.aj,0),l.emplaceBack(0,d.aj),l.emplaceBack(d.aj,d.aj),this.tileExtentBuffer=r.createVertexBuffer(l,d.bc.members),this.tileExtentSegments=d.bd.simpleSegment(0,0,4,2);const p=new d.ba;p.emplaceBack(0,0),p.emplaceBack(d.aj,0),p.emplaceBack(0,d.aj),p.emplaceBack(d.aj,d.aj),this.debugBuffer=r.createVertexBuffer(p,d.bc.members),this.debugSegments=d.bd.simpleSegment(0,0,4,5);const y=new d.ba;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(y,d.bc.members),this.viewportSegments=d.bd.simpleSegment(0,0,4,2);const v=new d.aZ;v.emplaceBack(0,0,0,0),v.emplaceBack(d.aj,0,d.aj,0),v.emplaceBack(0,d.aj,0,d.aj),v.emplaceBack(d.aj,d.aj,d.aj,d.aj),this.mercatorBoundsBuffer=r.createVertexBuffer(v,d.bf.members),this.mercatorBoundsSegments=d.bd.simpleSegment(0,0,4,2);const b=new d.a_;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(b);const C=new d.bb;for(const R of[0,1,3,2,0])C.emplaceBack(R);this.debugIndexBuffer=r.createIndexBuffer(C),this.emptyTexture=new d.T(r,new d.r({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=d.bz();const D=this.context.gl;this.stencilClearMode=new Vt({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,wt.disabled,this.stencilClearMode,ln.disabled,Bt.disabled,Wu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,p){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!p||0===p.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const D of p)if(void 0===this._tileClippingMaskIDs[D.key]){C=!0;break}if(!C)return}this.currentStencilSource=l.id;const y=this.context,v=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode(ln.disabled),y.setDepthMode(wt.disabled);const b=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of p){const D=l.getTile(C),R=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:N,tileBoundsSegments:k}=this.getTileBoundsBuffers(D);b.draw(this,v.TRIANGLES,wt.disabled,new Vt({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),ln.disabled,Bt.disabled,Wu(C.projMatrix),"$clipping",O,N,k)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new Vt({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new Vt({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,p=r.sort((b,C)=>C.overscaledZ-b.overscaledZ),y=p[p.length-1].overscaledZ,v=p[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const b={};for(let C=0;C<v;C++)b[C+y]=new Vt({func:l.GEQUAL,mask:255},C+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[b,p]}return[{[y]:Vt.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new ln([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new d.am(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?ln.unblended:ln.alphaBlended}colorModeForDrapableLayerRenderPass(r){const l=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new ln([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new d.am(0,0,0,void 0===r?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,l,p,y=!1){if(this.depthOcclusion)return new wt(this.context.gl.GREATER,wt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return wt.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new wt(p||this.context.gl.LEQUAL,l,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,l=Math.ceil(this.width),p=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),v=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===l&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==l&&0!==p&&(this.depthFBO=new Wc(this.context,l,p,!1,"texture"),this.depthTexture=new d.T(this.context,{width:l,height:p,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),r.bindTexture(r.TEXTURE_2D,v),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,l,p,0,0,l,p,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,l)=>r+l/this._fpsHistory.length,0))}render(r,l){const p=d.q.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=l;const y=this.style._mergedLayers,v=!(!this.terrain||!this.terrain.enabled),b=()=>this.style._getOrder(v).filter(Ce=>{const _e=y[Ce];return!(_e.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[_e.type]});let C=b(),D=!1,R=!1,O=null;for(const Ce of C){const _e=y[Ce];"circle"===_e.type?D=!0:"building"===_e.type?O=_e:"symbol"===_e.type&&(_e.hasInitialOcclusionOpacityProperties?R=!0:D=!0)}let N=C.map(Ce=>y[Ce]);const k=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(d.q.now()),this.imageManager.beginFrame();let B=0,H=!1;for(const Ce in k){const _e=k[Ce];_e.used&&(_e.prepare(this.context),_e.getSource().usedInConflation&&++B)}let U=!1;for(const Ce of N)Ce.isHidden(this.transform.zoom)||("clip"===Ce.type&&(U=!0),this.prepareLayer(Ce));const q={},$={},K={},ee={},ne={};for(const Ce in k){const _e=k[Ce];q[Ce]=_e.getVisibleCoordinates(),$[Ce]=q[Ce].slice().reverse(),K[Ce]=_e.getVisibleCoordinates(!0).reverse(),ee[Ce]=_e.getShadowCasterCoordinates(),ne[Ce]=_e.sortCoordinatesByDistance(q[Ce])}const le=Ce=>{const _e=this.style.getLayerSourceCache(Ce);return _e&&_e.used?_e.getSource():null};if(B||U||this._clippingActiveLastFrame){const Ce=[],_e=[];let Ne=0;for(const Re of N)this.isSourceForClippingOrConflation(Re,le(Re))&&(Ce.push(Re),_e.push(Ne)),Ne++;if(Ce&&(U||Ce.length>1)||this._clippingActiveLastFrame){U=!1;const Re=[];for(let We=0;We<Ce.length;We++){const Ze=Ce[We],Ye=_e[We],dt=this.style.getLayerSourceCache(Ze);if(!dt||!dt.used||!dt.getSource().usedInConflation&&"clip"!==Ze.type&&"building"!==Ze.type)continue;let Pt=d.eF,Ft=d.bW.None;const vt=[];let Ot=!0;if("building"===Ze.type)Pt=d.eH;else if("clip"===Ze.type){Pt=Ye;for(const Rt of Ze.layout.get("clip-layer-types"))Ft|="model"===Rt?d.bW.Model:"symbol"===Rt?d.bW.Symbol:d.bW.FillExtrusion;for(const Rt of Ze.layout.get("clip-layer-scope"))vt.push(Rt);Ze.isHidden(this.transform.zoom)?Ot=!1:U=!0}Ot&&Re.push({layer:Ze.fqid,cache:dt,order:Pt,clipMask:Ft,clipScope:vt})}this.replacementSource.setSources(Re),H=!0}}this._clippingActiveLastFrame=U,H||this.replacementSource.clear(),this.conflationActive=H,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ce=0;Ce<N.length;Ce++){const _e=N[Ce],Ne=_e.cutoffRange();if(this.longestCutoffRange=Math.max(Ne,this.longestCutoffRange),Ne>0){const Re=le(_e);Re&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom)),_e.minzoom&&(this.minCutoffZoom=Math.max(_e.minzoom,this.minCutoffZoom))}_e.is3D(v)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ce),this._lastOcclusionLayer=Ce)}const de=this.style&&this.style.fog;de?(this._fogVisible=0!==de.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=de.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(K),this.opaquePassCutoff=0,C=b(),N=C.map(Ce=>y[Ce]));const pe=this._shadowRenderer;if(pe){pe.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ce in k)for(const _e of q[Ce]){let Ne={min:0,max:0};this.terrain&&(Ne=this.terrain.getMinMaxForTile(_e)||Ne),pe.addShadowReceiver(_e.toUnwrapped(),Ne.min,Ne.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new d.eG(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Se(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ae=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ce=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ae&&!this._snow&&(this._snow=new qf(this)),!ae&&this._snow&&(this._snow.destroy(),delete this._snow),ce&&!this._rain&&(this._rain=new to(this)),!ce&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),O){this.buildingTileBorderManager||(this.buildingTileBorderManager=new w_);const Ce=this.style.getLayerSourceCache(O);this.buildingTileBorderManager.updateBorders(Ce,O)}if(!Mo.has(this.context.gl))return;this.renderPass="offscreen";for(const Ce of N){const _e=r.getLayerSourceCache(Ce);if(!Ce.hasOffscreenPass()||Ce.isHidden(this.transform.zoom))continue;const Ne=_e?$[_e.id]:void 0;("custom"===Ce.type||"raster"===Ce.type||"raster-particle"===Ce.type||Ce.isSky()||Ne&&Ne.length)&&this.renderLayer(this,_e,Ce,Ne)}this.depthRangeFor3D=[0,1-(N.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ee)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ue="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),Me=(()=>{if(l.showOverdrawInspector)return d.am.black;const Ce=this.style.fog;if(Ce&&this.transform.projection.supportsFog){const _e=this.style.getLut(Ce.scope);if(!ue){const Ne="none"===Ce.properties.get("color-use-theme"),Re=Ce.properties.get("color").toNonPremultipliedRenderColor(Ne?null:_e).toArray01();return new d.am(...Re)}if(ue){const Ne="none"===Ce.properties.get("space-color-use-theme"),Re=Ce.properties.get("space-color").toNonPremultipliedRenderColor(Ne?null:_e).toArray01();return new d.am(...Re)}}return d.am.transparent})();if(this.context.clear({color:Me,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ue&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const Ce=N[this.currentLayer],_e=r.getLayerSourceCache(Ce);if(Ce.isSky())continue;const Ne=_e?(Ce.is3D(v)?ne:$)[_e.id]:void 0;this._renderTileClippingMasks(Ce,_e,Ne),this.renderLayer(this,_e,Ce,Ne)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ue&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||d.ah(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const Ce=N[this.currentLayer],_e=r.getLayerSourceCache(Ce);Ce.isSky()&&this.renderLayer(this,_e,Ce,_e?$[_e.id]:void 0)}function ve(Ce,_e){let Ne;return _e&&(Ne=("symbol"===Ce.type?K:Ce.is3D(v)?ne:$)[_e.id]),Ne}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<C.length;){const Ce=N[this.currentLayer];if("raster"===Ce.type||"raster-particle"===Ce.type){const _e=r.getLayerSourceCache(Ce);this.renderLayer(this,_e,Ce,ve(Ce,_e))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ue=0;pe&&(Ue=pe.getShadowCastingLayerCount());let ke=!1,Ge=-1;for(let Ce=0;Ce<C.length;++Ce){const _e=N[Ce];_e.isHidden(this.transform.zoom)||_e.is3D(v)&&(Ge=Ce)}R&&-1===Ge&&(D=!0);let rt=!1;for(;this.currentLayer<C.length;){const Ce=N[this.currentLayer],_e=r.getLayerSourceCache(Ce);if(Ce.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ce)){if(Ce.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!rt&&Ce.is3D(v)&&!v){const Ne=this.currentLayer,Re=We=>{for(this.currentLayer=0;this.currentLayer<N.length;this.currentLayer++){const Ze=N[this.currentLayer];if(Wf[Ze.type]){const Ye=this.style.getLayerSourceCache(Ze);Wf[Ze.type](this,Ye,Ze,ve(Ze,Ye),We)}}};Re("initialize"),Re("reset"),this.currentLayer=Ne,rt=!0}if(D&&!ke&&this.terrain&&!this.transform.isOrthographic&&(ke=!0,this.blitDepth()),R&&-1!==Ge&&this.currentLayer===Ge+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ce,_e,_e?q[_e.id]:void 0),this.renderLayer(this,_e,Ce,ve(Ce,_e)),!this.terrain&&pe&&Ue>0&&Ce.hasShadowPass()&&0==--Ue){{this.clearStencil(),this.resetStencilClippingMasks();const Ne=this.currentLayer;for(this.currentLayer=0;this.currentLayer<N.length;this.currentLayer++){const Re=N[this.currentLayer];if(Ds[Re.type]){const We=this.style.getLayerSourceCache(Re);Ds[Re.type](this,We,Re,ve(Re,We))}}this.currentLayer=Ne}if(pe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Ne=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ne;this.currentLayer++){const Re=N[this.currentLayer];if(!Re.hasLightBeamPass())continue;const We=r.getLayerSourceCache(Re);this.renderLayer(this,We,Re,We?$[We.id]:void 0)}this.currentLayer=Ne,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ne=this.currentLayer;this.depthOcclusion=!0;for(const Re of this.layersWithOcclusionOpacity){this.currentLayer=Re;const We=N[this.currentLayer],Ze=r.getLayerSourceCache(We),Ye=Ze?$[Ze.id]:void 0;this.terrain||this._renderTileClippingMasks(We,Ze,Ze?q[Ze.id]:void 0),this.renderLayer(this,Ze,We,Ye)}this.depthOcclusion=!1,this.currentLayer=Ne,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ce=null;N.forEach(_e=>{const Ne=r.getLayerSourceCache(_e);Ne&&!_e.isHidden(this.transform.zoom)&&Ne.getVisibleCoordinates().length&&(!Ce||Ce.getSource().maxzoom<Ne.getSource().maxzoom)&&(Ce=Ne)}),Ce&&this.options.showTileBoundaries&&Gs(this,Ce,Ce.getVisibleCoordinates(),d.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Gs(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new d.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ce){const _e=Ce.transform.padding;mh(Ce,Ce.transform.height-(_e.top||0),3,_a),mh(Ce,_e.bottom||0,3,jf),gh(Ce,_e.left||0,3,Uf),gh(Ce,Ce.transform.width-(_e.right||0),3,hr);const Ne=Ce.transform.centerPoint;var Re,We,Ze,Ye;Ba(Re=Ce,(We=Ne.x)-1,(Ze=Ce.transform.height-Ne.y)-10,2,20,Ye=Hf),Ba(Re,We-10,Ze-1,20,2,Ye)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),H||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:l}=this.transform.projection,p=!l||!l.includes(r.type);if(na[r.type]&&(p||this.terrain&&"custom"===r.type)){const y=this.style.getLayerSourceCache(r);na[r.type](r,y,this)}this.gpuTimingEnd()}renderLayer(r,l,p,y){p.isHidden(this.transform.zoom)||("background"===p.type||"sky"===p.type||"custom"===p.type||"model"===p.type||"raster"===p.type||"raster-particle"===p.type||y&&y.length)&&(this.id=p.id,this.gpuTimingStart(p),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(p.type)&&(!r.terrain||"custom"!==p.type)||"clip"===p.type||oc[p.type](r,l,p,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,p=this.context.gl;let y=this.gpuTimers[r.id];y||(y=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:p.createQuery()}),y.calls++,p.beginQuery(l.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,l=this.context.gl,p=l.createQuery();this.deferredRenderGpuTimeQueries.push(p),l.beginQuery(r.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const l={};for(const p in r){const y=r[p],v=this.context.extTimerQuery,b=v.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(y.query),l[p]=b}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.gl;let p=0;for(const y of r)p+=l.getQueryParameter(y,l.QUERY_RESULT)/1e6,l.deleteQuery(y);return p}translatePosMatrix(r,l,p,y,v){if(!p[0]&&!p[1])return r;const b=v?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(b){const R=Math.sin(b),O=Math.cos(b);p=[p[0]*O-p[1]*R,p[0]*R+p[1]*O]}const C=[v?p[0]:d.aw(l,p[0],this.transform.zoom),v?p[1]:d.aw(l,p[1],this.transform.zoom),0],D=new Float32Array(16);return d.bo(D,r,C),D}saveTileTexture(r){if(r.context!==this.context)return;const l=r.size[0],p=this._tileTextures[l];p?p.push(r):this._tileTextures[l]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(r,l,p){const y=void 0===p?this.terrain&&this.terrain.renderingToTexture:p,v=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===r||"terrainRaster"===r?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||v.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||v.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&v.push("GLOBE"),!this._fogVisible||y||void 0!==l&&!l||v.push("FOG","FOG_DITHERING"),y&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(r,l){this.cache=this.cache||{};const p=l&&l.defines||[],y=l&&l.config,v=this.currentGlobalDefines(r,l&&l.overrideFog,l&&l.overrideRtt).concat(p),b=fm.cacheKey(wo[r],r,v,y);return this.cache[b]||(this.cache[b]=new fm(this.context,r,wo[r],y,ym[r],v)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,l){if(this.style.enable3dLights()){const p=this.style.directionalLight,y=this.style.ambientLight;if(p&&y){const v=((b,C,D)=>{const R=b.properties.get("direction"),O="none"===b.properties.get("color-use-theme"),N=b.properties.get("color").toNonPremultipliedRenderColor(O?null:D.getLut(b.scope)).toArray01(),k=b.properties.get("intensity"),B="none"===C.properties.get("color-use-theme"),H=C.properties.get("color").toNonPremultipliedRenderColor(B?null:D.getLut(C.scope)).toArray01(),U=C.properties.get("intensity"),q=[R.x,R.y,R.z],$=d.dI(H,U),K=d.dI(N,k);return{u_lighting_ambient_color:$,u_lighting_directional_dir:q,u_lighting_directional_color:K,u_ground_radiance:c_(q,K,$)}})(p,y,this.style);l.setLightsUniformValues(r,v)}}}uploadCommonUniforms(r,l,p,y,v){if(this.uploadCommonLightUniforms(r,l),this.terrain&&this.terrain.renderingToTexture)return;const b=this.style.fog;if(b){const C=b.getOpacity(this.transform.pitch),D=((R,O,N,k,B,H,U,q,$,K,ee,ne)=>{const le=R.transform,de="none"===O.properties.get("color-use-theme"),pe=O.properties.get("color").toNonPremultipliedRenderColor(de?null:R.style.getLut(O.scope)).toArray01();pe[3]=k;const ae=R.frameCounter/1e3%1,[ce,ue]=O.properties.get("vertical-range");return{u_fog_matrix:N?le.calculateFogTileMatrix(N):ne||R.identityMat,u_fog_range:O.getFovAdjustedRange(le._fov),u_fog_color:pe,u_fog_horizon_blend:O.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ce,ue),ue],u_fog_temporal_offset:ae,u_frustum_tl:B,u_frustum_tr:H,u_frustum_br:U,u_frustum_bl:q,u_globe_pos:$,u_globe_radius:K,u_viewport:ee,u_globe_transition:d.ah(le.zoom),u_is_globe:+("globe"===le.projection.name)}})(this,b,p,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*d.q.devicePixelRatio,this.transform.height*d.q.devicePixelRatio],y);l.setFogUniformValues(r,D)}v&&l.setCutoffUniformValues(r,v.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const y of p)l[y.key]=r[y.key]||new Dc(y,512,this.transform.tileZoom,this,void 0,this.worldview);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,l){return!(!r.is3D(!(!this.terrain||!this.terrain.enabled))||"clip"!==r.type&&"building"!==r.type&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==r.sourceLayer&&"procedural_buildings"!==r.sourceLayer)&&(!l||"batched-model"!==l.type)))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let l=this._cachedTileFogOpacities[r.key];return l||(this._cachedTileFogOpacities[r.key]=l=this.style.fog.getOpacityForTile(r)),l[0]>=qe||l[1]>=qe}setupDepthForOcclusion(r,l,p){const y=this.context,v=y.gl,b=!!p;var C;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(v.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((C=this.depthRangeFor3D)[1]-C[0]),-1-2*C[0]/(C[1]-C[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),y.activeTexture.set(v.TEXTURE0),b||l.setTerrainUniformValues(y,p)}}function nd(f,r){let l=!1,p=null;const y=()=>{p=null,l&&(f(),p=setTimeout(y,r),l=!1)};return()=>(l=!0,p||y(),p)}class id{constructor(r){this._hashName=r&&encodeURIComponent(r),d.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=nd(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const l=rd(r);if(this._hashName){const p=this._hashName;let y=!1;const v=location.hash.slice(1).split("&").map(b=>{const C=b.split("=")[0];return C===p?(y=!0,`${C}=${l}`):b}).filter(b=>b);return y||v.push(`${p}=${l}`),`#${v.join("&")}`}return`#${l}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(Number(p)))){const p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function rd(f,r){const l=f.getCenter(),p=Math.round(100*f.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,y),b=Math.round(l.lng*v)/v,C=Math.round(l.lat*v)/v,D=f.getBearing(),R=f.getPitch();let O=r?`/${b}/${C}/${p}`:`${p}/${C}/${b}`;return(D||R)&&(O+="/"+Math.round(10*D)/10),R&&(O+=`/${Math.round(R)}`),O}const Jc={linearity:.3,easing:d.eI(0,0,.3,1)},Va=d.h({deceleration:2500,maxSpeed:1400},Jc),Cm=d.h({deceleration:20,maxSpeed:1400},Jc),va=d.h({deceleration:1e3,maxSpeed:360},Jc),vh=d.h({deceleration:1e3,maxSpeed:90},Jc);class xh{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.q.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=d.q.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(l.pan.mag()){const v=eu(l.pan.mag(),p,d.h({},Va,r||{}));y.offset=l.pan.mult(v.amount/l.pan.mag()),y.center=this._map.transform.center,Qc(y,v)}if(l.zoom){const v=eu(l.zoom,p,Cm);y.zoom=this._map.transform.zoom+v.amount,Qc(y,v)}if(l.bearing){const v=eu(l.bearing,p,va);y.bearing=this._map.transform.bearing+d.ay(v.amount,-179,179),Qc(y,v)}if(l.pitch){const v=eu(l.pitch,p,vh);y.pitch=this._map.transform.pitch+v.amount,Qc(y,v)}if(y.zoom||y.bearing){const v=void 0===l.pinchAround?l.around:l.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Qc(f,r){(!f.duration||f.duration<r.duration)&&(f.duration=r.duration,f.easing=r.easing)}function eu(f,r,l){const{maxSpeed:p,linearity:y,deceleration:v}=l,b=d.ay(f*y/(r/1e3),-p,p),C=Math.abs(b)/(v*y);return{easing:l.easing,duration:1e3*C,amount:b*(C/2)}}class Pi extends d.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p,y={}){const v=da(l.getCanvasContainer(),p),b=l.unproject(v);super(r,d.h({point:v,lngLat:b,originalEvent:p},y)),this._defaultPrevented=!1,this.target=l}}class ac extends d.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,p){const y="touchend"===r?p.changedTouches:p.touches,v=Ia(l.getCanvasContainer(),y),b=v.map(D=>l.unproject(D)),C=v.reduce((D,R,O,N)=>D.add(R.div(N.length)),new d.P(0,0));super(r,{points:v,point:C,lngLats:b,lngLat:l.unproject(C),originalEvent:p}),this._defaultPrevented=!1}}class Sm extends d.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class Dm{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Sm(this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new Pi(r.type,this._map,r))}mouseup(r){this._map.fire(new Pi(r.type,this._map,r))}preclick(r){const l=d.h({},r);l.type="preclick",this._map.fire(new Pi(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Pi(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Pi(r.type,this._map,r))}mouseover(r){this._map.fire(new Pi(r.type,this._map,r))}mouseout(r){this._map.fire(new Pi(r.type,this._map,r))}touchstart(r){return this._firePreventable(new ac(r.type,this._map,r))}touchmove(r){this._map.fire(new ac(r.type,this._map,r))}touchend(r){this._map.fire(new ac(r.type,this._map,r))}touchcancel(r){this._map.fire(new ac(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $r{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Pi(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Pi(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ml{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&0===r.button&&(vs(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const p=l,y=this._startPos,v=this._lastPos;if(!y||!v||v.equals(p)||!this._box&&p.dist(y)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=pn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const b=Math.min(y.x,p.x),C=Math.max(y.x,p.x),D=Math.min(y.y,p.y),R=Math.max(y.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${D}px)`,this._box.style.width=C-b+"px",this._box.style.height=R-D+"px")})}mouseupWindow(r,l){if(!this._active)return;const p=this._startPos,y=l;if(p&&0===r.button){if(this.reset(),Bl(),p.x!==y.x||p.y!==y.y)return this._map.fire(new d.A("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Zs(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new d.A(r,{originalEvent:l}))}}function yr(f,r){const l={};for(let p=0;p<f.length;p++)l[f[p].identifier]=r[p];return l}class Im{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){const v=new d.P(0,0);for(const b of y)v._add(b);return v.div(y.length)}(l),this.touches=yr(p,l)))}touchmove(r,l,p){if(this.aborted||!this.centroid)return;const y=yr(p,l);for(const v in this.touches){const b=y[v];(!b||b.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(r,l,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class lc{constructor(r){this.singleTap=new Im(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,p){this.singleTap.touchstart(r,l,p)}touchmove(r,l,p){this.singleTap.touchmove(r,l,p)}touchend(r,l,p){const y=this.singleTap.touchend(r,l,p);if(y){const v=r.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(y)<30;if(v&&b||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Am{constructor(){this._zoomIn=new lc({numTouches:1,numTaps:2}),this._zoomOut=new lc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,p){this._zoomIn.touchstart(r,l,p),this._zoomOut.touchstart(r,l,p)}touchmove(r,l,p){this._zoomIn.touchmove(r,l,p),this._zoomOut.touchmove(r,l,p)}touchend(r,l,p){const y=this._zoomIn.touchend(r,l,p),v=this._zoomOut.touchend(r,l,p);return y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(y)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Mm={0:1,2:2},bh={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class tu{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const p=ff(r);this._correctButton(r,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(r,l){const p=this._lastPoint;if(p)if(r.preventDefault(),null!=this._eventButton&&function(y,v){const b=Mm[v];return void 0===y.buttons||(y.buttons&b)!==b}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}mouseupWindow(r){this._lastPoint&&ff(r)===this._eventButton&&(this._moved&&Bl(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class od extends tu{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return 0===l&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class xa extends tu{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?bh[r.pitchRotateKey]:void 0}_correctButton(r,l){return this._pitchRotateKey?0===l&&r[this._pitchRotateKey]:0===l&&r.ctrlKey||2===l}_move(r,l){const p=.8*(l.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class Pm extends tu{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?bh[r.pitchRotateKey]:void 0}_correctButton(r,l){return this._pitchRotateKey?0===l&&r[this._pitchRotateKey]:0===l&&r.ctrlKey||2===l}_move(r,l){const p=-.5*(l.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class wh{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),d.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}touchstart(r,l,p){return this._calculateTransform(r,l,p)}touchmove(r,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===p.length&&!d.eJ())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,p)}}touchend(r,l,p){this._calculateTransform(r,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,p){p.length>0&&(this._active=!0);const y=yr(p,l),v=new d.P(0,0),b=new d.P(0,0);let C=0;for(const R in y){const O=y[R],N=this._touches[R];N&&(v._add(O),b._add(O.sub(N)),C++,y[R]=O)}if(this._touches=y,C<this._minTouches||!b.mag())return;const D=b.div(C);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(C),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=pn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class nu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,p){return{}}touchstart(r,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,p){const y=this._firstTwoTouches;if(!y)return;r.preventDefault();const[v,b]=y,C=cc(p,l,v),D=cc(p,l,b);if(!C||!D)return;const R=this._aroundCenter?null:C.add(D).div(2);return this._move([C,D],R,r)}touchend(r,l,p){if(!this._firstTwoTouches)return;const[y,v]=this._firstTwoTouches,b=cc(p,l,y),C=cc(p,l,v);b&&C||(this._active&&Bl(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function cc(f,r,l){for(let p=0;p<f.length;p++)if(f[p].identifier===l)return r[p]}function Eh(f,r){return Math.log(f/r)/Math.LN2}class Rm extends nu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Eh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Eh(this._distance,p),pinchAround:l}}}function Zf(f,r){return 180*f.angleWith(r)/Math.PI}class S_ extends nu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Zf(this._vector,p),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const y=Zf(r,p);return Math.abs(y)<l}}function gl(f){return Math.abs(f.y)>Math.abs(f.x)}class sd extends nu{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,gl(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,p){const y=this._lastPoints;if(!y)return;const v=r[0].sub(y[0]),b=r[1].sub(y[1]);return this._map._cooperativeGestures&&!d.eJ()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(v,b,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(v.y+b.y)/2*-.5})}gestureBeginsVertically(r,l,p){if(void 0!==this._valid)return this._valid;const y=r.mag()>=2,v=l.mag()>=2;if(!y&&!v)return;if(!y||!v)return null==this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const b=r.y>0==l.y>0;return gl(r)&&gl(l)&&b}}const D_={panStep:100,bearingStep:15,pitchStep:10};class zv{constructor(){const r=D_;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,p=0,y=0,v=0,b=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?y=1:(r.preventDefault(),b=-1);break;case 40:r.shiftKey?y=-1:(r.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:C=>{const D=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Xf,zoom:l?Math.round(D)+l*(r.shiftKey?2:1):D,bearing:C.getBearing()+p*this._bearingStep,pitch:C.getPitch()+y*this._pitchStep,offset:[-v*this._panStep,-b*this._panStep],center:C.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xf(f){return f*(2-f)}const Bv=4.000244140625;class jv{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||d.eJ()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=d.q.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==l&&l%Bv==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=l,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(y*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=da(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;"wheel"===this._type&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const R="wheel"===this._type&&Math.abs(this._delta)>Bv?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&0!==O&&(O=1/O);const N=l(),k=Math.pow(2,N),B="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):k;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(B*O))),"wheel"===this._type&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p="number"==typeof this._targetZoom?this._targetZoom:l(),y=this._startZoom,v=this._easing;let b,C=!1;if("wheel"===this._type&&y&&v){const R=Math.min((d.q.now()-this._lastWheelEventTime)/200,1),O=v(R);b=d.ai(y,p,O),R<1?this._frameId||(this._frameId=!0):C=!0}else b=p,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=b-l();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=d.eK;if(this._prevEase){const p=this._prevEase,y=(d.q.now()-p.start)/p.duration,v=p.easing(y+.01)-p.easing(y),b=.27/Math.sqrt(v*v+1e-4)*.01,C=Math.sqrt(.0729-b*b);l=d.eI(b,C,.25,1)}return this._prevEase={start:d.q.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=pn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Wi{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Uv{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Om{constructor(){this._tap=new lc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,l,p))}touchmove(r,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=l[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,l,p)}touchend(r,l,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(r,l,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class iu{constructor(r,l,p){this._el=r,this._mousePan=l,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hv{constructor(r,l,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _l{constructor(r,l,p,y){this._el=r,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ru=f=>f.zoom||f.drag||f.pitch||f.rotate;class ad extends d.A{}class km{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const p=d.at([],l,r);this.radius=d.ae(p[2]<0?d.eM([],p,this.constants):[p[0],p[1],0])}projectRay(r){d.eM(r,r,this.constants),d.au(r,r),d.eN(r,r,this.constants);const l=d.c1([],r,this.radius);if(l[2]>0){const p=d.c1([],[0,0,1],d.bG(l,[0,0,1])),y=d.c1([],d.au([],[l[0],l[1],0]),this.radius),v=d.d5([],l,d.c1([],d.at([],d.d5([],y,p),l),2));l[0]=v[0],l[1]=v[1]}return l}}function $s(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Th{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xh(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new km,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),d.aV(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,v,b]of this._listeners){const C=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(v,C,b)}}destroy(){for(const[r,l,p]of this._listeners){const y=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(l,y,p)}}_addDefaultHandlers(r){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new Dm(l,r));const y=l.boxZoom=new ml(l,r);this._add("boxZoom",y);const v=new Am,b=new Uv;l.doubleClickZoom=new Wi(b,v),this._add("tapZoom",v),this._add("clickZoom",b);const C=new Om;this._add("tapDragZoom",C);const D=l.touchPitch=new sd(l);this._add("touchPitch",D);const R=new xa(r),O=new Pm(r);l.dragRotate=new Hv(r,R,O),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const N=new od(r),k=new wh(l,r);l.dragPan=new iu(p,N,k),this._add("mousePan",N),this._add("touchPan",k,["touchZoom","touchRotate"]);const B=new S_,H=new Rm;l.touchZoomRotate=new _l(p,H,B,C),this._add("touchRotate",B,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new $r(l));const U=l.scrollZoom=new jv(l,this);this._add("scrollZoom",U,["mousePan"]);const q=l.keyboard=new zv;this._add("keyboard",q);for(const $ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[$]&&l[$].enable(r[$])}_add(r,l,p){this._handlers.push({handlerName:r,handler:l,allowed:p}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ru(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,l,p){for(const y in r)if(y!==p&&(!l||l.indexOf(y)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const p of r)this._el.contains(p.target)&&l.push(p);return l}handleEvent(r,l){this._updatingCamera=!0;const p="renderFrame"===r.type,y=p?void 0:r,v={needsRenderFrame:!1},b={},C={},D=r.touches?this._getMapTouches(r.touches):void 0,R=D?Ia(this._el,D):p?void 0:da(this._el,r);for(const{handlerName:k,handler:B,allowed:H}of this._handlers){if(!B.isEnabled())continue;let U;this._blockedByActive(C,H,k)?B.reset():B[l||r.type]&&(U=B[l||r.type](r,R,D),this.mergeHandlerResult(v,b,U,k,y),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||B.isActive())&&(C[k]=B)}const O={};for(const k in this._previousActiveHandlers)C[k]||(O[k]=y);this._previousActiveHandlers=C,(Object.keys(O).length||$s(v))&&(this._changes.push([v,b,O]),this._triggerRenderFrame()),(Object.keys(C).length||$s(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=v;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(r,l,p,y,v){if(!p)return;d.h(r,p);const b={handlerName:y,originalEvent:p.originalEvent||v};void 0!==p.zoomDelta&&(l.zoom=b),void 0!==p.panDelta&&(l.drag=b),void 0!==p.pitchDelta&&(l.pitch=b),void 0!==p.bearingDelta&&(l.rotate=b)}_applyChanges(){const r={},l={},p={};for(const[y,v,b]of this._changes)y.panDelta&&(r.panDelta=(r.panDelta||new d.P(0,0))._add(y.panDelta)),y.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(r.around=y.around),void 0!==y.aroundCoord&&(r.aroundCoord=y.aroundCoord),void 0!==y.pinchAround&&(r.pinchAround=y.pinchAround),y.noInertia&&(r.noInertia=y.noInertia),d.h(l,v),d.h(p,b);this._updateMapTransform(r,l,p),this._changes=[]}_updateMapTransform(r,l,p){const y=this._map,v=y.transform,b=K=>[K.x,K.y,K.z];if((K=>{const ee=this._eventsInProgress.drag;return ee&&!this._handlersById[ee.handlerName].isActive()})()&&!$s(r)){const K=v.zoom;v.cameraElevationReference="sea",null!=this._originalZoom&&v._orthographicProjectionAtLowPitch&&"globe"!==v.projection.name&&0===v.pitch?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),K!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&y._stop(!0),!$s(r))return void this._fireEvents(l,p,!0);let{panDelta:C,zoomDelta:D,bearingDelta:R,pitchDelta:O,around:N,aroundCoord:k,pinchAround:B}=r;v._isCameraConstrained&&(D>0&&(D=0),v._isCameraConstrained=!1),void 0!==B&&(N=B),(D||(K=>l[K]&&!this._eventsInProgress[K])("drag"))&&N&&(this._dragOrigin=b(v.pointCoordinate3D(N)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",y._stop(!0),N=N||y.transform.centerPoint,R&&(v.bearing+=R),O&&(v.pitch+=O),v._updateCameraState();const H=[0,0,0];if(C)if("mercator"===v.projection.name){const K=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(N).dir),ee=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(N.sub(C)).dir);H[0]=ee[0]-K[0],H[1]=ee[1]-K[1]}else{const K=v.pointCoordinate(N);if("globe"===v.projection.name){C=C.rotate(-v.angle);const ee=v._pixelsPerMercatorPixel/v.worldSize;H[0]=-C.x*d.eL(d.aY(K.y))*ee,H[1]=-C.y*d.eL(v.center.lat)*ee}else{const ee=v.pointCoordinate(N.sub(C));K&&ee&&(H[0]=ee.x-K.x,H[1]=ee.y-K.y)}}const U=v.zoom,q=[0,0,0];if(D){const K=b(k||v.pointCoordinate3D(N)),ee={dir:d.au([],d.at([],K,v._camera.position))};if(ee.dir[2]<0){const ne=v.zoomDeltaToMovement(K,D);d.c1(q,ee.dir,ne)}}const $=d.d5(H,H,q);v._translateCameraConstrained($),D&&Math.abs(v.zoom-U)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,p,!0)}_fireEvents(r,l,p){const y=ru(this._eventsInProgress),v=ru(r),b={};for(const O in r){const{originalEvent:N}=r[O];this._eventsInProgress[O]||(b[`${O}start`]=N),this._eventsInProgress[O]=r[O]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(const O in b)this._fireEvent(O,b[O]);v&&this._fireEvent("move",v.originalEvent);for(const O in r){const{originalEvent:N}=r[O];this._fireEvent(O,N)}const C={};let D;for(const O in this._eventsInProgress){const{handlerName:N,originalEvent:k}=this._eventsInProgress[O];this._handlersById[N].isActive()||(delete this._eventsInProgress[O],D=l[N]||k,C[`${O}end`]=D)}for(const O in C)this._fireEvent(O,C[O]);const R=ru(this._eventsInProgress);if(p&&(y||v)&&!R){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=k=>0!==k&&-this._bearingSnap<k&&k<this._bearingSnap;O?(N(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:D})):(this._map.fire(new d.A("moveend",{originalEvent:D})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new d.A(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new ad("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const vr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class lo extends d.E{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=!1!==l.respectPrefersReducedMotion,d.aV(["_renderFrameCallback"],this)}getCenter(){return new d.ci(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,p){return r=d.P.convert(r).mult(-1),this.panTo(this.transform.center,d.h({offset:r},l),p)}panTo(r,l,p){return this.easeTo(d.h({center:r},l),p)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,p){return this.easeTo(d.h({zoom:r},l),p)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,p){return this.easeTo(d.h({bearing:r},l),p)}resetNorth(r,l){return this.rotateTo(0,d.h({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(d.h({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=d.aG.convert(r);const p=l&&l.bearing||0,y=l&&l.pitch||0,v=r.getNorthWest(),b=r.getSouthEast();return this._cameraForBounds(this.transform,v,b,p,y,l)}_extendPadding(r){const l={top:0,right:0,bottom:0,left:0};return null==r?d.h({},l,this.transform.padding):"number"==typeof r?{top:r,bottom:r,right:r,left:r}:d.h({},l,r)}_extendCameraOptions(r){return(r=d.h({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,l){const p=l.max[0]-l.min[0],y=l.max[1]-l.min[1];return p/y>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):y/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,l,p,y,v,b){const C=r.clone(),D=this._extendCameraOptions(b);C.bearing=y,C.pitch=v;const R=d.ci.convert(l),O=d.ci.convert(p),N=.5*(R.lat+O.lat),k=.5*(R.lng+O.lng),B=d.eO(N,k),H=d.au([],B),U=d.au([],d.bF([],H,[0,1,0])),q=d.bF([],U,H),$=[U[0],U[1],U[2],0,q[0],q[1],q[2],0,H[0],H[1],H[2],0,0,0,0,1],K=[B,d.eO(R.lat,R.lng),d.eO(O.lat,R.lng),d.eO(O.lat,O.lng),d.eO(R.lat,O.lng),d.eO(N,R.lng),d.eO(N,O.lng),d.eO(R.lat,k),d.eO(O.lat,k)];let ee=d.d6.fromPoints(K.map(Re=>[d.bG(U,Re),d.bG(q,Re),d.bG(H,Re)]));const ne=d.ad([],ee.center,$);0===d.eP(ne)&&d.eQ(ne,0,0,1),d.au(ne,ne),d.c1(ne,ne,d.aB),C.center=d.eR(ne);const le=C.getWorldToCameraMatrix(),de=d.bi(new Float64Array(16),le);ee=d.d6.applyTransform(ee,d.az([],le,$));const pe=this._extendAABB(ee,C,D,y);if(!pe)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ee=pe,d.ad(ne,ne,le);const ae=.5*(ee.max[2]-ee.min[2]),ce=this._minimumAABBFrustumDistance(C,ee),ue=d.c1([],[0,0,1],ae),Me=d.d5(ue,ne,ue),ve=ce+(0===C.pitch?0:d.bD(ne,Me)),Ue=C.globeCenterInViewSpace,ke=d.at([],ne,[Ue[0],Ue[1],Ue[2]]);d.au(ke,ke),d.c1(ke,ke,ve);const Ge=d.d5([],ne,ke);d.ad(Ge,Ge,de);const rt=d.eB/d.aB,Ce=d.ae(Ge),_e=d.cb(Math.max(Ce*rt-d.eB,Number.EPSILON),0),Ne=Math.min(C.zoomFromMercatorZAdjusted(_e),D.maxZoom);return Ne>.5*(d.cX+d.cI)?(C.setProjection({name:"mercator"}),C.zoom=Ne,this._cameraForBounds(C,l,p,y,v,b)):{center:C.center,zoom:Ne,bearing:y,pitch:v}}_extendAABB(r,l,p,y){const v=.5*((p.padding.left||0)+(p.padding.right||0)),b=.5*((p.padding.top||0)+(p.padding.bottom||0)),C=b,D=v,R=v,O=b,N=l.width-(D+R),k=l.height-(C+O),B=d.at([],r.max,r.min),H=Math.min(N/B[0],k/B[1]),U=Math.min(l.scaleZoom(l.scale*H),p.maxZoom);if(isNaN(U))return null;const q=l.scale/l.zoomScale(U),$=new d.d6([r.min[0]-D*q,r.min[1]-O*q,r.min[2]],[r.max[0]+R*q,r.max[1]+C*q,r.max[2]]),K=("number"==typeof p.offset.x&&"number"==typeof p.offset.y?new d.P(p.offset.x,p.offset.y):d.P.convert(p.offset)).rotate(-d.al(y));return $.center[0]-=K.x*q,$.center[1]+=K.y*q,$}queryTerrainElevation(r,l){const p=this.transform.elevation;return p?(l=d.h({},{exaggerated:!0},l),p.getAtPoint(d.ac.fromLngLat(r),null,l.exaggerated)):null}_cameraForBounds(r,l,p,y,v,b){if("globe"===r.projection.name)return this._cameraForBoundsOnGlobe(r,l,p,y,v,b);const C=r.clone(),D=this._extendCameraOptions(b);C.bearing=y,C.pitch=v;const R=d.ci.convert(l),O=d.ci.convert(p),N=new d.ci(R.lng,O.lat),k=new d.ci(O.lng,R.lat),B=C.project(R),H=C.project(O),U=this.queryTerrainElevation(R),q=this.queryTerrainElevation(O),$=this.queryTerrainElevation(N),K=this.queryTerrainElevation(k),ee=[[B.x,B.y,Math.min(U||0,q||0,$||0,K||0)],[H.x,H.y,Math.max(U||0,q||0,$||0,K||0)]];let ne=d.d6.fromPoints(ee);const le=C.getWorldToCameraMatrix(),de=d.bi(new Float64Array(16),le);ne=d.d6.applyTransform(ne,le);const pe=this._extendAABB(ne,C,D,y);if(!pe)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=pe;const ae=.5*d.at([],ne.max,ne.min)[2],ce=this._minimumAABBFrustumDistance(C,ne),ue=[0,0,1,0];d.aA(ue,ue,le),d.eS(ue,ue);const Me=d.c1([],ue,ce+ae),ve=d.d5([],ne.center,Me);d.ad(ne.center,ne.center,de),d.ad(ve,ve,de);const Ue=C.unproject(new d.P(ne.center[0],ne.center[1])),ke=d.eT(C.projection,Ue),Ge=Math.pow(2,ke),rt=Math.min(C._zoomFromMercatorZ(ve[2]*C.pixelsPerMeter*Ge/C.worldSize),D.maxZoom);return C.mercatorFromTransition&&rt<.5*(d.cX+d.cI)?(C.setProjection({name:"globe"}),C.zoom=rt,this._cameraForBounds(C,l,p,y,v,b)):{center:Ue,zoom:rt,bearing:y,pitch:v}}fitBounds(r,l,p){const y=this.cameraForBounds(r,l);return this._fitInternal(y,l,p)}fitScreenCoordinates(r,l,p,y,v){const b=d.P.convert(r),C=d.P.convert(l),D=new d.P(Math.min(b.x,C.x),Math.min(b.y,C.y)),R=new d.P(Math.max(b.x,C.x),Math.max(b.y,C.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(b,C))return this;const O=this.transform.pointLocation3D(D),N=this.transform.pointLocation3D(R),k=this.transform.pointLocation3D(new d.P(D.x,R.y)),B=this.transform.pointLocation3D(new d.P(R.x,D.y)),H=[Math.min(O.lng,N.lng,k.lng,B.lng),Math.min(O.lat,N.lat,k.lat,B.lat)],U=[Math.max(O.lng,N.lng,k.lng,B.lng),Math.max(O.lat,N.lat,k.lat,B.lat)],q=y&&y.pitch?y.pitch:this.getPitch(),$=this._cameraForBounds(this.transform,H,U,p,q,y);return this._fitInternal($,y,v)}_fitInternal(r,l,p){return r?(l=d.h(r,l)).linear?this.easeTo(l,p):this.flyTo(l,p):this}jumpTo(r,l){this.stop();const p=r.preloadOnly?this.transform.clone():this.transform;let y=!1,v=!1,b=!1;"zoom"in r&&p.zoom!==+r.zoom&&(y=!0,p.zoom=+r.zoom),void 0!==r.center&&(p.center=d.ci.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(v=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(b=!0,p.pitch=+r.pitch);const C="number"==typeof r.padding?this._extendPadding(r.padding):r.padding;if(null!=r.padding&&!p.isPaddingEqual(C))if(!1===r.retainPadding){const D=p.clone();D.padding=C,p.setLocationAtPoint(p.center,D.centerPoint)}else p.padding=C;return r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new d.A("movestart",l)).fire(new d.A("move",l)),y&&this.fire(new d.A("zoomstart",l)).fire(new d.A("zoom",l)).fire(new d.A("zoomend",l)),v&&this.fire(new d.A("rotatestart",l)).fire(new d.A("rotate",l)).fire(new d.A("rotateend",l)),b&&this.fire(new d.A("pitchstart",l)).fire(new d.A("pitch",l)).fire(new d.A("pitchend",l)),this.fire(new d.A("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||d.w(vr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return d.w(vr),this;this.stop();const y=p.zoom,v=p.pitch,b=p.bearing;p.setFreeCameraOptions(r);const C=y!==p.zoom,D=v!==p.pitch,R=b!==p.bearing;return this.fire(new d.A("movestart",l)).fire(new d.A("move",l)),C&&this.fire(new d.A("zoomstart",l)).fire(new d.A("zoom",l)).fire(new d.A("zoomend",l)),R&&this.fire(new d.A("rotatestart",l)).fire(new d.A("rotate",l)).fire(new d.A("rotateend",l)),D&&this.fire(new d.A("pitchstart",l)).fire(new d.A("pitch",l)).fire(new d.A("pitchend",l)),this.fire(new d.A("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),(!1===(r=d.h({offset:[0,0],duration:500,easing:d.eK},r)).animate||this._prefersReducedMotion(r))&&(r.duration=0);const p=this.transform,y=this.getZoom(),v=this.getBearing(),b=this.getPitch(),C=this.getPadding(),D="zoom"in r?+r.zoom:y,R="bearing"in r?this._normalizeBearing(r.bearing,v):v,O="pitch"in r?+r.pitch:b,N=this._extendPadding(r.padding),k=d.P.convert(r.offset);let B,H,U;if("globe"===p.projection.name){const ue=d.ac.fromLngLat(p.center),Me=k.rotate(-p.angle);ue.x+=Me.x/p.worldSize,ue.y+=Me.y/p.worldSize;const ve=ue.toLngLat(),Ue=d.ci.convert(r.center||ve);this._normalizeCenter(Ue),B=p.centerPoint.add(Me),H=new d.P(ue.x,ue.y).mult(p.worldSize),U=new d.P(d.aD(Ue.lng),d.aH(Ue.lat)).mult(p.worldSize).sub(H)}else{B=p.centerPoint.add(k);const ue=p.pointLocation(B),Me=d.ci.convert(r.center||ue);this._normalizeCenter(Me),H=p.project(ue),U=p.project(Me).sub(H)}const q=p.zoomScale(D-y);let $,K;r.around&&($=d.ci.convert(r.around),K=p.locationPoint($));const ee=this._zooming||D!==y,ne=this._rotating||v!==R,le=this._pitching||O!==b,de=!p.isPaddingEqual(N),pe=!1===r.retainPadding?p.clone():p,ae=ue=>Me=>{if(ee&&(ue.zoom=d.ai(y,D,Me)),ne&&(ue.bearing=d.ai(v,R,Me)),le&&(ue.pitch=d.ai(b,O,Me)),de&&(pe.interpolatePadding(C,N,Me),B=pe.centerPoint.add(k)),$)ue.setLocationAtPoint($,K);else{const ve=ue.zoomScale(ue.zoom-y),Ue=D>y?Math.min(2,q):Math.max(.5,q),ke=Math.pow(Ue,1-Me),Ge=ue.unproject(H.add(U.mult(Me*ke)).mult(ve));ue.setLocationAtPoint(ue.renderWorldCopies?Ge.wrap():Ge,B)}return r.preloadOnly||this._fireMoveEvents(l),ue};if(r.preloadOnly){const ue=this._emulate(ae,r.duration,p);return this._preloadTiles(ue),this}const ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ee,this._rotating=ne,this._pitching=le,this._padding=de,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,ce),this._ease(ae(p),ue=>{"sea"===p.cameraElevationReference&&p.recenterOnTerrain(),this._afterEase(l,ue)},r),this}_prepareEase(r,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),l||p.moving||this.fire(new d.A("movestart",r)),this._zooming&&!p.zooming&&this.fire(new d.A("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new d.A("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new d.A("pitchstart",r))}_fireMoveEvents(r){this.fire(new d.A("move",r)),this._zooming&&this.fire(new d.A("zoom",r)),this._rotating&&this.fire(new d.A("rotate",r)),this._pitching&&this.fire(new d.A("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new d.A("zoomend",r)),y&&this.fire(new d.A("rotateend",r)),v&&this.fire(new d.A("pitchend",r)),this.fire(new d.A("moveend",r))}flyTo(r,l){if(this._prefersReducedMotion(r)){const Re=d.aF(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Re,l)}this.stop(),r=d.h({offset:[0,0],speed:1.2,curve:1.42,easing:d.eK},r);const p=this.transform,y=this.getZoom(),v=this.getBearing(),b=this.getPitch(),C=this.getPadding(),D="zoom"in r?d.ay(+r.zoom,p.minZoom,p.maxZoom):y,R="bearing"in r?this._normalizeBearing(r.bearing,v):v,O="pitch"in r?+r.pitch:b,N=this._extendPadding(r.padding),k=p.zoomScale(D-y),B=d.P.convert(r.offset);let H=p.centerPoint.add(B);const U=p.pointLocation(H),q=d.ci.convert(r.center||U);this._normalizeCenter(q);const $=p.project(U),K=p.project(q).sub($);let ee=r.curve;const ne=Math.max(p.width,p.height),le=ne/k,de=K.mag();if("minZoom"in r){const Re=d.ay(Math.min(r.minZoom,y,D),p.minZoom,p.maxZoom),We=ne/p.zoomScale(Re-y);ee=Math.sqrt(We/de*2)}const pe=ee*ee;function ae(Re){const We=(le*le-ne*ne+(Re?-1:1)*pe*pe*de*de)/(2*(Re?le:ne)*pe*de);return Math.log(Math.sqrt(We*We+1)-We)}function ce(Re){return(Math.exp(Re)-Math.exp(-Re))/2}function ue(Re){return(Math.exp(Re)+Math.exp(-Re))/2}const Me=ae(0);let ve=function(Re){return ue(Me)/ue(Me+ee*Re)},Ue=function(Re){return ne*((ue(Me)*(ce(We=Me+ee*Re)/ue(We))-ce(Me))/pe)/de;var We},ke=(ae(1)-Me)/ee;if(Math.abs(de)<1e-6||!isFinite(ke)){if(Math.abs(ne-le)<1e-6)return this.easeTo(r,l);const Re=le<ne?-1:1;ke=Math.abs(Math.log(le/ne))/ee,Ue=function(){return 0},ve=function(We){return Math.exp(Re*ee*We)}}r.duration="duration"in r?+r.duration:1e3*ke/("screenSpeed"in r?+r.screenSpeed/ee:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Ge=v!==R,rt=O!==b,Ce=!p.isPaddingEqual(N),_e=!1===r.retainPadding?p.clone():p,Ne=Re=>We=>{const Ze=We*ke,Ye=1/ve(Ze);Re.zoom=1===We?D:y+Re.scaleZoom(Ye),Ge&&(Re.bearing=d.ai(v,R,We)),rt&&(Re.pitch=d.ai(b,O,We)),Ce&&(_e.interpolatePadding(C,N,We),H=_e.centerPoint.add(B));const dt=1===We?q:Re.unproject($.add(K.mult(Ue(Ze))).mult(Ye));return Re.setLocationAtPoint(Re.renderWorldCopies?dt.wrap():dt,H),Re._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),Re};if(r.preloadOnly){const Re=this._emulate(Ne,r.duration,p);return this._preloadTiles(Re),this}return this._zooming=!0,this._rotating=Ge,this._pitching=rt,this._padding=Ce,this._prepareEase(l,!1),this._ease(Ne(p),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,l,p){!1===p.animate||0===p.duration?(r(1),l()):(this._easeStart=d.q.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((d.q.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=d.bQ(r,-180,180);const p=Math.abs(r-l);return Math.abs(r-360-l)<p&&(r-=360),Math.abs(r+360-l)<p&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(l.maxBounds||"globe"!==l.projection.name&&!l.renderWorldCopies)return;const p=r.lng-l.center.lng;r.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&d.q.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,l,p){const y=Math.ceil(15*l/1e3),v=[],b=r(p.clone());for(let C=0;C<=y;C++){const D=b(C/y);v.push(D.clone())}return v}_preloadTiles(r,l){}}class ld{constructor(r={}){this.options=r,d.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact,p=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=pn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=pn("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const y=pn("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",p),this._innerContainer=pn("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.e.ACCESS_TOKEN}];if(r){const p=l.reduce((y,v,b)=>(v.value&&(y+=`${v.key}=${v.value}${b<l.length-1?"&":""}`),y),"?");r.href=`${d.e.FEEDBACK_URL}/${p}#${rd(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const l=this._map.style._mergedSourceCaches;for(const y in l){const v=l[y];if(v.used){const b=v.getSource();b.attribution&&r.indexOf(b.attribution)<0&&r.push(b.attribution)}}r.sort((y,v)=>y.length-v.length),r=r.filter((y,v)=>{for(let b=v+1;b<r.length;b++)if(r[b].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class uc{constructor(){d.aV(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=pn("div","mapboxgl-ctrl");const l=pn("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const l in r){const p=r[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Ch{constructor(){d.aV(["_onIndoorUpdate"],this)}onAdd(r){return this._map=r,this._container=pn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",l=>this._onIndoorUpdate({selectedFloorId:l.selectedFloorId,floors:l.floors})),this._container}_createButton(r,l){const p=pn("button",r,this._container);return p.type="button",p.addEventListener("click",l),p}_setButtonTitle(r,l){this._map&&(r.setAttribute("aria-label",l),r.innerHTML=`<strong>${l}</strong>`,r.firstElementChild&&r.firstElementChild.setAttribute("title",l))}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(r){if(!r||!r.floors)return void(this._container.style.display="none");const l=this._model;this._model=r,this._container.style.display="inline-block";const p=r.floors.sort((y,v)=>y.levelOrder-v.levelOrder);l?(Array.from(this._container.children).forEach(y=>y.remove()),this.addCurrentFloors(p)):this.addCurrentFloors(p)}addCurrentFloors(r){for(const l of r){const p=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(l.id),Array.from(this._container.children).forEach(y=>{y.classList.remove("mapboxgl-ctrl-level-button-selected")}),p.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(p,l.shortName),this._model&&l.id===this._model.selectedFloorId&&(this._map._selectIndoorFloor(l.id),p.classList.add("mapboxgl-ctrl-level-button-selected")),this._container.append(p)}}}class Fm{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const y of p)if(y.id===r)return void(y.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class dc{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=d.dx((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,p){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+p}}const Lm={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class I_ extends d.A{constructor(r,l,p,y){const{point:v,lngLat:b,originalEvent:C,target:D}=r;super(r.type,{point:v,lngLat:b,originalEvent:C,target:D}),this.preventDefault=()=>{r.preventDefault()},this.id=l,this.interaction=p,this.feature=y}}class Yf{constructor(r){this.map=r,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(r,l){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);const p=l.filter;let y=l.type;p&&this.filters.set(r,d.b3(p)),"mouseover"===y&&(y="mouseenter"),"mouseout"===y&&(y="mouseleave");const v=this.interactionsByType.get(y)||new Map;"mouseenter"===y||"mouseleave"===y?(0===this.delegatedInteractions.size&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(r,l)):0===v.size&&this.map.on(y,this.handleType),0===v.size&&this.interactionsByType.set(y,v),v.set(r,l),this.typeById.set(r,y)}get(r){const l=this.typeById.get(r);if(!l)return;const p=this.interactionsByType.get(l);return p?p.get(r):void 0}remove(r){const l=this.typeById.get(r);if(!l)return;this.typeById.delete(r),this.filters.delete(r);const p=this.interactionsByType.get(l);p&&(p.delete(r),"mouseenter"===l||"mouseleave"===l?(this.delegatedInteractions.delete(r),0===this.delegatedInteractions.size&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):0===p.size&&this.map.off(l,this.handleType))}queryTargets(r,l){const p=[];for(const[y,v]of l)v.target&&p.push({targetId:y,target:v.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(r,p,this.map.transform)}handleMove(r){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const l=this.queryTargets(r.point,Array.from(this.delegatedInteractions).reverse());l.length&&(r.type="mouseenter",this.handleType(r,l));const p=new Map;for(const[y,{feature:v}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||p.set(v.id,v);p.size&&(r.type="mouseleave",this.handleType(r,Array.from(p.values())))}handleOut(r){const l=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);l.length&&(r.type="mouseleave",this.handleType(r,l)),this.hoveredFeatures.clear()}handleType(r,l){const p="mouseenter"===r.type;if(p&&!this.interactionsByType.has(r.type))return void d.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(r.type)).reverse(),v=!!l;l=l||this.queryTargets(r.point,y);let b=!1;const C=new Set;for(const D of l){for(const[R,O]of y){if(!O.target)continue;const N=D.variants?D.variants[R]:null;if(N){for(const k of N){if(yf(k,D,C,R))continue;const B=new d.dr(D,k),H=Gd(k,D,R);v&&(B.state=this.map.getFeatureState(B));const U=p?this.prevHoveredFeatures.get(H):null,q=new I_(r,R,O,B),$=U?U.stop:O.handler(q);if(p&&this.hoveredFeatures.set(H,{feature:D,stop:$}),!1!==$){b=!0;break}}if(b)break}}if(b)break}if(!b)for(const[D,R]of y){const{handler:O,target:N}=R;if(!N&&!1!==O(new I_(r,D,R,null)))break}}}function Kf(f,r){if(Array.isArray(f)&&Array.isArray(r)){const l=new Set(f),p=new Set(r);return l.size===p.size&&f.every(y=>p.has(y))}return d.bv(f,r)}const cd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},ou={showCompass:!0,showZoom:!0,visualizePitch:!1};class yl{constructor(r,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new xa({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new Pm({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),d.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),vs()}move(r,l){const p=this.map,y=this.mouseRotate.mousemoveWindow(r,l),v=y&&y.bearingDelta;if(v&&p.setBearing(p.getBearing()+v),this.mousePitch){const b=this.mousePitch.mousemoveWindow(r,l),C=b&&b.pitchDelta;C&&p.setPitch(p.getPitch()+C)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Zs(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(d.h({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),da(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,da(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ia(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=Ia(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function fs(f,r,l){if(f=new d.ci(f.lng,f.lat),r){const p=new d.ci(f.lng-360,f.lat),y=new d.ci(f.lng+360,f.lat),v=360*Math.ceil(Math.abs(f.lng-l.center.lng)/360),b=l.locationPoint3D(f).distSqr(r),C=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint3D(p).distSqr(r)<b&&(C||Math.abs(p.lng-l.center.lng)<v)?f=p:l.locationPoint3D(y).distSqr(r)<b&&(C||Math.abs(y.lng-l.center.lng)<v)&&(f=y)}for(;Math.abs(f.lng-l.center.lng)>180;){const p=l.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;f.lng>l.center.lng?f.lng-=360:f.lng+=360}return f}const co={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Wo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Is extends d.E{constructor(r,l){super(),(r instanceof HTMLElement||l)&&(r=d.h({element:r},l)),d.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:y="#3FB1CE",scale:v=1,draggable:b=!1,clickTolerance:C=0,rotation:D=Wo.rotation,rotationAlignment:R=Wo.rotationAlignment,pitchAlignment:O=Wo.pitchAlignment,occludedOpacity:N=Wo.occludedOpacity,altitude:k=Wo.altitude}=r||{};this._anchor=p,this._color=y,this._scale=v,this._draggable=b,this._clickTolerance=C,this._rotation=D,this._rotationAlignment=R,this._pitchAlignment=O,this._occludedOpacity=N,this._altitude=k,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),r&&r.element?(this._element=r.element,this._offset=d.P.convert(r&&r.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=d.P.convert(r&&r.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",U=>{U.preventDefault()}),this._element.addEventListener("mousedown",U=>{U.preventDefault()});const B=this._element.classList;for(const U in co)B.remove(`mapboxgl-marker-anchor-${U}`);B.add(`mapboxgl-marker-anchor-${this._anchor}`);const H=r&&r.className?r.className.trim().split(/\s+/):[];B.add(...H),this._popup=null}_createDefaultMarker(){const r=pn("div"),l=ts("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},r);if(0===this._altitude){const p=ts("radialGradient",{id:"shadowGradient"},ts("defs",{},l));ts("stop",{offset:"10%","stop-opacity":.4},p),ts("stop",{offset:"100%","stop-opacity":.05},p),ts("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},l)}return ts("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},l),ts("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},l),ts("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},l),r}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=d.ci.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(r){return r===this._altitude||(this._defaultMarker&&(0===this._altitude&&0!==r||0!==this._altitude&&0===r)&&(this._element=this._createDefaultMarker()),this._altitude=r||Wo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(24.6+y)],"bottom-right":[-y,-1*(24.6+y)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,r._marker=this,r._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const l=r.code,p=r.charCode||r.keyCode;"Space"!==l&&"Enter"!==l&&32!==p&&13!==p||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,l=this._pos;if(!r||!l)return!1;const p=r.unproject(l,this._altitude),y=r.getFreeCameraOptions();if(!y.position)return!1;const v=y.position.toLngLat();return v.distanceTo(p)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();const p=r.unproject(l,this._altitude);let y;r._showingGlobe()&&d.eW(r.transform,this._lngLat)?y=0:(y=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${r.x}px,${r.y}px)\n            ${co[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${l.x}px,${l.y}px)\n        `}_calculateXYTransform(){const r=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!r||"map"!==p)return"";if(!l._showingGlobe()){const D=l.getPitch();return D?`rotateX(${D}deg)`:""}const y=d.cU(d.eX(l.transform,this._lngLat)),v=r.sub(d.eY(l.transform)),b=Math.abs(v.x)+Math.abs(v.y);if(0===b)return"";const C=y/b;return`rotateX(${-v.y*C}deg) rotateY(${v.x*C}deg)`}_calculateZTransform(){const r=this._pos,l=this._map;if(!l||!r)return"";let p=0;const y=this.getRotationAlignment();if("map"===y)if(l._showingGlobe()){const v=l.project(new d.ci(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),b=l.project(new d.ci(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(v);p=d.cU(Math.atan2(b.y,b.x))-90}else p=-l.getBearing();else if("horizon"===y){const v=d.af(4,6,l.getZoom()),b=d.eY(l.transform);b.y+=v*l.transform.height;const C=r.sub(b),D=d.cU(Math.atan2(C.y,C.x));p=(D>90?D-270:D+90)*(1-v)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=fs(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat,this._altitude),!0===r?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=d.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const l=this._map;if(!l)return;const p=this._pointerdownPos,y=this._positionDelta;if(p&&y){if(!this._isDragging){const v=this._clickTolerance||l._clickTolerance;if(r.point.dist(p)<v)return;this._isDragging=!0}this._pos=r.point.sub(y),this._lngLat=l.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.A("dragstart"))),this.fire(new d.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new d.A("dragend")),this._state="inactive"}_addDragHandler(r){const l=this._map,p=this._pos;l&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||Wo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||Wo.rotationAlignment,this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||Wo.pitchAlignment,this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||Wo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const A_={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Sh={maxWidth:100,unit:"metric"},Gv={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ps={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},M_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Zi(f=new d.P(0,0),r="bottom"){if("number"==typeof f){const l=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(r){case"top":return new d.P(0,f);case"top-left":return new d.P(l,l);case"top-right":return new d.P(-l,l);case"bottom":return new d.P(0,-f);case"bottom-left":return new d.P(l,-l);case"bottom-right":return new d.P(-l,-l);case"left":return new d.P(f,0);case"right":return new d.P(-f,0)}return new d.P(0,0)}return f instanceof d.P||Array.isArray(f)?d.P.convert(f):d.P.convert(f[r]||[0,0])}return{version:tr,supported:Nl.supported,setRTLTextPlugin:d.f0,getRTLTextPluginStatus:d.e$,Map:class extends lo{constructor(f){Da.mark(Ui.create);const r=f;if(null!=(f=d.h({},cd,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&d.eU(window)&&(f.antialias=!1,d.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new tm(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new Fm,this._domRenderTaskQueue=new Fm,this._controls=[],this._markers=[],this._popups=[],this._mapId=d.a$(),this._locale=d.h({},Lm,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new dc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new gr(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},"string"==typeof f.container){const l=document.getElementById(f.container);if(!l)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=l}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&d.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,d.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Lo),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Th(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||d.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this.indoor=new s_(this),f.hash&&(this._hash=new id("string"==typeof f.hash&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==r.center&&null==r.zoom||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const l=f.bounds;l&&(this.resize(),this.fitBounds(l,d.h({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new ld({customAttribution:f.customAttribution})),this._logoControl=new uc,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",l=>{this._update("style"===l.dataType),this.fire(new d.A(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new d.A(`${l.dataType}dataloading`,l))}),this._interactions=new Yf(this)}_getMapId(){return this._mapId}addControl(f,r){if(void 0===r&&(r=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[r];return-1!==r.indexOf("bottom")?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(f);return r>-1&&this._controls.splice(r,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new d.A("movestart",f)).fire(new d.A("move",f)),this.fire(new d.A("resize",f)),r&&this.fire(new d.A("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(d.aG.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new d.A("zoomstart")).fire(new d.A("zoom")).fire(new d.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new d.A("zoomstart")).fire(new d.A("zoom")).fire(new d.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new d.A("pitchstart")).fire(new d.A("pitch")).fire(new d.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new d.A("pitchstart")).fire(new d.A("pitch")).fire(new d.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(r=>"symbol"===r.type),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return"auto"===f?navigator.language:Array.isArray(f)?0===f.length?void 0:f.map(r=>"auto"===r?navigator.language:r):f}setLanguage(f){const r=this._parseLanguage(f);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(f){return this._lazyInitEmptyStyle(),f?"string"==typeof f&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const f=this.transform,r=f.projection.name;let l;"globe"===r&&f.zoom>=d.cI?(f.setMercatorFromTransition(),l=!0):"mercator"===r&&f.zoom<d.cI&&(f.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,r){return this._updateProjection(f||r||{name:"mercator"})}_updateProjection(f){let r;return r="globe"===f.name&&this.transform.zoom>=d.cI?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,r){return this.transform.locationPoint3D(d.ci.convert(f),r)}unproject(f,r){return this.transform.pointLocation3D(d.P.convert(f),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,r,l){const p=y=>{let v=[];if(Array.isArray(r)){const b=r.filter(C=>this.getLayer(C));v=b.length?this.queryRenderedFeatures(y,{layers:b}):[]}else v=this.queryRenderedFeatures(y,{target:r});return v};if("mouseenter"===f||"mouseover"===f){let y=!1;return{listener:l,targets:r,delegates:{mousemove:b=>{const C=p(b.point);C.length?y||(y=!0,l.call(this,new Pi(f,this,b.originalEvent,{features:C}))):y=!1},mouseout:()=>{y=!1}}}}if("mouseleave"===f||"mouseout"===f){let y=!1;return{listener:l,targets:r,delegates:{mousemove:C=>{p(C.point).length?y=!0:y&&(y=!1,l.call(this,new Pi(f,this,C.originalEvent)))},mouseout:C=>{y&&(y=!1,l.call(this,new Pi(f,this,C.originalEvent)))}}}}{const y=v=>{const b=p(v.point);b.length&&(v.features=b,l.call(this,v),delete v.features)};return{listener:l,targets:r,delegates:{[f]:y}}}}on(f,r,l){if("function"==typeof r||void 0===l)return super.on(f,r);if("string"==typeof r&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._createDelegatedListener(f,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(f,r,l){if("function"==typeof r||void 0===l)return super.once(f,r);if("string"==typeof r&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._createDelegatedListener(f,r,l);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(f,r,l){if("function"==typeof r||void 0===l)return super.off(f,r);if("string"==typeof r&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(y=>{for(let v=0;v<y.length;v++){const b=y[v];if(b.listener===l&&Kf(b.targets,r)){for(const C in b.delegates)this.off(C,b.delegates[C]);return y.splice(v,1),this}}})(p),this}queryRenderedFeatures(f,r){if(!this.style)return[];if(void 0===f||f instanceof d.P||Array.isArray(f)||void 0!==r||(r=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!r){const v=this.style.queryRenderedFeatures(f,void 0,this.transform),b=this.style.queryRenderedFeatureset(f,void 0,this.transform);return v.concat(b)}let l=!0;if(r.target&&(l=this._isTargetValid(r.target),l&&!r.layers))return this.style.queryRenderedFeatureset(f,r,this.transform);let p=!0;if(r.layers&&Array.isArray(r.layers)){for(const v of r.layers)if(!this._isValidId(v)){p=!1;break}if(p&&!r.target)return this.style.queryRenderedFeatures(f,r,this.transform)}let y=[];return p&&(y=y.concat(this.style.queryRenderedFeatures(f,r,this.transform))),l&&(y=y.concat(this.style.queryRenderedFeatureset(f,r,this.transform))),y}querySourceFeatures(f,r){return!f||"string"==typeof f&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,r)}isPointOnSurface(f){const{name:r}=this.transform.projection;return"globe"!==r&&"mercator"!==r&&d.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(d.P.convert(f))}addInteraction(f,r){return this._interactions.add(f,r),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,r){return r=d.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&f&&!1!==r.diff&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(f,(l,p)=>{if(l){const y="string"==typeof l?l:l instanceof Error?l.message:l.error;d.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(f,r)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(f,r))}_getUIString(f){const r=this._locale[f];if(null==r)throw new Error(`Missing UI string '${f}'`);return r}_updateStyle(f,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const l=d.h({},r);r&&r.config&&(l.initialConfig=r.config,delete l.config),this.style=new js(this,l).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new js(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(d.w("There is no style added to the map."),!1)}_isValidId(f){return null==f?(this.fire(new d.z(new Error("IDs can't be empty."))),!1):!d.dk(f)||(this.fire(new d.z(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const r of f)if(!this._isValidId(r))return!1;return!0}return this._isTargetValid(f)}addSource(f,r){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,r),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(f,r,l)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,r,{pixelRatio:l=1,sdf:p=!1,stretchX:y,stretchY:v,content:b}={}){this._lazyInitEmptyStyle();const C=d.I.from(f);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:D,height:R,data:O}=d.q.getImageData(r);this.style.addImage(C,{data:new d.r({width:D,height:R},O),pixelRatio:l,stretchX:y,stretchY:v,content:b,sdf:p,version:0,usvg:!1})}else if(void 0===r.width||void 0===r.height)this.fire(new d.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:D,height:R}=r,O=r;this.style.addImage(C,{data:new d.r({width:D,height:R},new Uint8Array(O.data)),pixelRatio:l,stretchX:y,stretchY:v,content:b,sdf:p,usvg:!1,version:0,userImage:O}),O.onAdd&&O.onAdd(this,f)}}updateImage(f,r){this._lazyInitEmptyStyle();const l=d.I.from(f),p=this.style.getImage(l);if(!p)return void this.fire(new d.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?d.q.getImageData(r):r,{width:v,height:b,data:C}=y;if(void 0===v||void 0===b)return void this.fire(new d.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||b!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new d.z(new Error(`The width and height of the updated image (${v}, ${b})\n                must be that same as the previous version of the image\n                (${p.data.width}, ${p.data.height})`)));const D=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let R=!1;p.usvg?(p.data=new d.r({width:v,height:b},new Uint8Array(C)),p.usvg=!1,p.icon=void 0,R=!0):p.data.replace(C,D),this.style.updateImage(l,p,R)}hasImage(f){return f?!!this.style&&!!this.style.getImage(d.I.from(f)):(this.fire(new d.z(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(d.I.from(f))}loadImage(f,r){d.o(this._requestManager.transformRequest(f,d.R.Image),(l,p)=>{r(l,p instanceof HTMLImageElement?d.q.getImageData(p):p)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,r){this._lazyInitEmptyStyle(),this.style.addModel(f,r)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new d.z(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,r){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,r),this._update(!0)):this}getSlot(f){const r=this.getLayer(f);return r&&r.slot||null}setSlot(f,r){return this.style.setSlot(f,r),this.style.mergeLayers(),this._update(!0)}addImport(f,r){return this.style.addImport(f,r).catch(l=>this.fire(new d.z(new Error("Failed to add import",l)))),this}updateImport(f,r){return"string"!=typeof r&&r.id!==f?(this.removeImport(f),this.addImport(r)):(this.style.updateImport(f,r),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,r){return this.style.moveImport(f,r),this._update(!0)}moveLayer(f,r){return this._isValidId(f)?(this.style.moveLayer(f,r),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const r=this.style.getOwnLayer(f);return r?"custom"===r.type?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,r,l){return this._isValidId(f)?(this.style.setLayerZoomRange(f,r,l),this._update(!0)):this}setFilter(f,r,l={}){return this._isValidId(f)?(this.style.setFilter(f,r,l),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,r,l,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,r,l,p),this._update(!0)):this}getPaintProperty(f,r){return this._isValidId(f)?this.style.getPaintProperty(f,r):null}setLayoutProperty(f,r,l,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,r,l,p),this._update(!0)):this}getLayoutProperty(f,r){return this._isValidId(f)?this.style.getLayoutProperty(f,r):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,r){return this.style.setSchema(f,r),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,r){return this.style.setConfig(f,r),this._update(!0)}getConfigProperty(f,r){return this.style.getConfigProperty(f,r)}setConfigProperty(f,r,l){return this.style.setConfigProperty(f,r,l),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&1===f.length&&"flat"===f[0].type){const r=f[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return 0===f.length&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,r){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,r),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===f["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.ci.convert(f),this.transform):0}setFeatureState(f,r){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,r),this._update())}removeFeatureState(f,r){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,r),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.indoor.selectFloor(f)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Ch),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let l,p,y,v=this._container;for(;v&&(!p||!y);){const b=window.getComputedStyle(v).transform;b&&"none"!==b&&(l=b.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&"0"!==l[0]&&"1"!==l[0]&&(p=l[0]),l[3]&&"0"!==l[3]&&"1"!==l[3]&&(y=l[3])),v=v.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=y?Math.abs(r/y):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=pn("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=pn("div","mapboxgl-canvas-container",f);this._canvas=pn("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=pn("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{p[y]=pn("div",`mapboxgl-ctrl-${y}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,r){const l=d.q.devicePixelRatio||1;this._canvas.width=l*Math.ceil(f),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${r}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const r=this._markers.indexOf(f);-1!==r&&this._markers.splice(r,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const r=this._popups.indexOf(f);-1!==r&&this._popups.splice(r,1)}_setupPainter(){const f=d.h({},Nl.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",f);r?(Ma(r,!0),this.painter=new sc(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",l=>{"source"===l.dataType&&this.painter.setTileLoadedFlag(!0)}),d.l.testSupport(r)):this.fire(new d.z(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.A("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new d.A("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let r;this.fire(new d.A("renderstart")),++this._frameId;const l=this.painter.context.extTimerQuery,p=d.q.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=y.createQuery(),y.beginQuery(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,O=this.transform.pitch,N=d.q.now(),k=new d.aa(R,{now:N,fadeDuration:v,pitch:O,transition:this.style.transition,worldview:this._worldview});this.style.update(k)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(p);const C=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),C&&(this._placementDirty=C.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Da.mark(Ui.load),this.fire(new d.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const R=d.q.now()-p;y.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{const O=y.getQueryParameter(r,y.QUERY_RESULT)/1e6;y.deleteQuery(r),this.fire(new d.A("gpu-timing-frame",{cpuTime:R,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(R);this.fire(new d.A("gpu-timing-layer",{layerTimes:O}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const O=this.painter.queryGpuTimeDeferredRender(R);this.fire(new d.A("gpu-timing-deferred-render",{gpuTime:O}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(D||this._repaint)this.triggerRepaint();else{const R=this.idle();if(R&&(b=this._updateAverageElevation(p,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new d.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new d.A("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,Da.mark(Ui.fullLoad),this._performanceMetricsCollection&&gi(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const r of this._markers)f&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!f||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(f,r=!1){const l=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(r||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const y=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=f;const b=Math.abs(y-v);if(b>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(v),l(v);this._averageElevation.easeTo(v,f,300)}else if(b>1e-4)return this._averageElevation.jumpTo(v),l(v)}return!!this._averageElevation.isEasing(f)&&l(this._averageElevation.getValue(f))}_authenticate(){lr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===go||401===f.status)){const r=this.painter.context.gl;Ma(r,!1),this._logoControl instanceof uc&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),mf(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Mi(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function y(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);const b=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,b),b}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(y(f),r.canvasCopies.map(y),r.timeStamps)}_canvasPixelComparison(f,r,l){let p=l[1]-l[0];const y=f.length/4;for(let v=0;v<r.length;v++){const b=r[v];let C=0;for(let D=0;D<b.length;D+=4)b[D]===f[D]&&b[D+1]===f[D+1]&&b[D+2]===f[D+2]&&b[D+3]===f[D+3]&&(C+=1);p+=(l[v+2]-l[v+1])*(1-C/y)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Mo.delete(this.painter.context.gl),nr.remove(),Iu.remove(),this._removed=!0,this.fire(new d.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=d.q.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(f){const r=this.style?this.style.getSourceCaches():[];return d.bt(r,(l,p)=>l._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,r){d.eV(f,r)}get version(){return tr}},NavigationControl:class{constructor(f={}){this.options=d.h({},ou,f),this._container=pn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(d.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),pn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),pn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(d.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=pn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const r=f.getZoom(),l=r===f.getMaxZoom(),p=r===f.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yl(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,r){const l=pn("button",f,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(f,r){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${r}`);f.setAttribute("aria-label",l),f.firstElementChild&&f.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends d.E{constructor(f={}){super();const r=navigator.geolocation;this.options=d.h({geolocation:r},A_,f),d.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=nd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=pn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const r=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,f(l)};void 0!==this._supportsGeolocation?f(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(l=>r("denied"!==l.state)).catch(()=>r()):r()}_isOutOfMapMaxBounds(f){const r=this._map.getMaxBounds(),l=f.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new d.A("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new d.A("geolocate",f)),this._finish()}}_updateCamera(f){const r=new d.ci(f.coords.longitude,f.coords.latitude),l=f.coords.accuracy,p=this._map.getBearing(),y=d.h({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),y,{geolocateSource:!0})}_updateMarker(f){if(f){const r=new d.ci(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,r=d.cb(1,f._center.lat)*f.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new d.A("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=pn("button","mapboxgl-ctrl-geolocate",this._container),pn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===f){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=pn("div","mapboxgl-user-location"),this._dotElement.appendChild(pn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(pn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Is({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=pn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Is({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.A("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ld,ScaleControl:class{constructor(f={}){this.options=d.h({},Sh,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),d.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,p=r._containerWidth/2-f/2,y=r.unproject([p,l]),v=r.unproject([p+f,l]),b=y.distanceTo(v);if("imperial"===this.options.unit){const C=3.2808*b;C>5280?this._setScale(f,C/5280,"mile"):this._setScale(f,C,"foot")}else"nautical"===this.options.unit?this._setScale(f,b/1852,"nautical-mile"):b>=1e3?this._setScale(f,b/1e3,"kilometer"):this._setScale(f,b,"meter")}_setScale(f,r,l){this._map._requestDomTask(()=>{const p=function(v){const b=Math.pow(10,`${Math.floor(v)}`.length-1);let C=v/b;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(D){const R=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*R)/R}(C),b*C}(r),y=p/r;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==l?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(p):`${p}&nbsp;${Gv[l]}`,this._container.style.width=f*y+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=pn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:d.w("Full screen control 'container' must be a DOM element.")),d.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=pn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=pn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);pn("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Ch,Popup:class extends d.E{constructor(f){super(),this.options=d.h(Object.create(ps),f),this._altitude=this.options.altitude,d.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new d.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new d.A("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=d.ci.convert(f),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const r=document.createDocumentFragment(),l=document.createElement("body");let p;for(l.innerHTML=f;p=l.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=pn("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(f),this.options.closeButton){const l=this._closeButton=pn("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.innerHTML='<span aria-hidden="true">&#215;</span>',l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let r;return this._classList.delete(f)?r=!1:(this._classList.add(f),r=!0),this._updateClassList(),r}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const r=this._map,l=this._container,p=this._pos;if(!r||!l||!p)return"bottom";const y=l.offsetWidth,v=l.offsetHeight,b=p.x<y/2,C=p.x>r.transform.width-y/2;if(p.y+f<v)return b?"top-left":C?"top-right":"top";if(p.y>r.transform.height-v){if(b)return"bottom-left";if(C)return"bottom-right"}return b?"left":C?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),f.className=r.join(" ")}_update(f){const r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=pn("div","mapboxgl-popup",r.getContainer()),this._tip=pn("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=fs(this._lngLat,this._pos,r.transform)),!this._trackPointer||f){const y=this._pos=this._trackPointer&&f instanceof d.P?f:r.project(this._lngLat,this._altitude),v=Zi(this.options.offset),b=this._anchor=this._getAnchor(v.y),C=Zi(this.options.offset,b),D=y.add(C).round();r._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${co[b]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&r._showingGlobe()){const y=d.eW(r.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(M_);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Is,Style:js,LngLat:d.ci,LngLatBounds:d.aG,Point:d.P,MercatorCoordinate:d.ac,FreeCameraOptions:Jd,Evented:d.E,config:d.e,prewarm:d.e_,clearPrewarmedResources:d.eZ,get accessToken(){return d.e.ACCESS_TOKEN},set accessToken(f){d.e.ACCESS_TOKEN=f},get baseApiUrl(){return d.e.API_URL},set baseApiUrl(f){d.e.API_URL=f},get workerCount(){return d.f7.workerCount},set workerCount(f){d.f7.workerCount=f},get maxParallelImageRequests(){return d.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){d.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){d.f6(f)},get workerUrl(){return d.f5.workerUrl},set workerUrl(f){d.f5.workerUrl=f},get workerClass(){return d.f5.workerClass},set workerClass(f){d.f5.workerClass=f},get workerParams(){return d.f5.workerParams},set workerParams(f){d.f5.workerParams=f},get dracoUrl(){return d.f4()},set dracoUrl(f){d.f3(f)},get meshoptUrl(){return d.f2()},set meshoptUrl(f){d.f1(f)},setNow:d.q.setNow,restoreNow:d.q.restoreNow}}),Yi}()}},wv=>{wv(wv.s=84)}]);